<!DOCTYPE html>
<!-- saved from url=(0071)https://chat.deepseek.com/a/chat/s/88e5ddb4-0281-4f85-9a78-92a34839fbe6 -->
<html lang="en" class="notranslate" translate="no"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Build PDF Chatbot with Gemini Flash - DeepSeek</title><meta name="viewport" content="initial-scale=1.0,maximum-scale=1,width=device-width,viewport-fit=cover"><meta name="commit-id" content="cd2dd810"><meta name="description" content="Chat with DeepSeek AI – your intelligent assistant for coding, content creation, file reading, and more. Upload documents, engage in long-context conversations, and get expert help in AI, natural language processing, and beyond. | 深度求索（DeepSeek）助力编程代码开发、创意写作、文件处理等任务，支持文件上传及长文本对话，随时为您提供高效的AI支持。"><meta name="keywords" content="DeepSeek,DeepSeek AI,DeepSeek Chat,AI assistant,coding assistant,long-context LLM,Open Source LLM,natural language processing,AI chatbot,AI long text,AI content creation,large language model,深度求索,大语言模型,自然语言处理,AI聊天机器人,代码开发,创意写作,AI助手,长文本对话,文件处理AI,大模型公司,人工智能,AI开发助手"><meta property="og:url" content="https://chat.deepseek.com"><meta property="og:type" content="website"><meta property="og:title" content="DeepSeek"><meta property="og:description" content="Chat with DeepSeek AI."><meta property="og:image" content="https://cdn.deepseek.com/images/deepseek-chat-open-graph-image.jpeg"><meta name="twitter:card" content="summary_large_image"><meta property="twitter:domain" content="deepseek.com"><meta property="twitter:url" content="https://chat.deepseek.com"><meta name="twitter:title" content="DeepSeek"><meta name="twitter:description" content="Chat with DeepSeek AI."><meta name="twitter:image" content="https://cdn.deepseek.com/images/deepseek-chat-open-graph-image.jpeg"><meta name="google" content="notranslate"><meta name="ip" content="103.215.237.2"><meta name="region" content="IN"><link rel="apple-touch-icon" href="https://cdn.deepseek.com/chat/icon.png"><style type="text/css">@font-face {font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(/cf-fonts/v/roboto-mono/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(/cf-fonts/v/roboto-mono/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(/cf-fonts/v/roboto-mono/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(/cf-fonts/v/roboto-mono/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(/cf-fonts/v/roboto-mono/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(/cf-fonts/v/roboto-mono/5.0.16/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Roboto Mono;font-style:normal;font-weight:500;src:url(/cf-fonts/v/roboto-mono/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Roboto Mono;font-style:normal;font-weight:500;src:url(/cf-fonts/v/roboto-mono/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Roboto Mono;font-style:normal;font-weight:500;src:url(/cf-fonts/v/roboto-mono/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Roboto Mono;font-style:normal;font-weight:500;src:url(/cf-fonts/v/roboto-mono/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Roboto Mono;font-style:normal;font-weight:500;src:url(/cf-fonts/v/roboto-mono/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Roboto Mono;font-style:normal;font-weight:500;src:url(/cf-fonts/v/roboto-mono/5.0.16/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}</style><link rel="icon" type="image/x-icon" href="https://chat.deepseek.com/favicon.svg"><script type="text/javascript" async="" id="_intercom_npm_loader" src="./Build PDF Chatbot with Gemini Flash - DeepSeek_files/guh50jw4"></script><script>!function(n,t){if(n.LogAnalyticsObject=t,!n[t]){var c=function(){c.q.push(arguments)};c.q=c.q||[],n[t]=c}n[t].l=+new Date}(window,"collectEvent")</script><script async="" src="./Build PDF Chatbot with Gemini Flash - DeepSeek_files/collect-rangers-v5.2.1.js.download"></script><script defer="" src="./Build PDF Chatbot with Gemini Flash - DeepSeek_files/default-vendors.29a168ecb3.js.download"></script><script defer="" src="./Build PDF Chatbot with Gemini Flash - DeepSeek_files/main.59c745a90f.js.download"></script><link href="./Build PDF Chatbot with Gemini Flash - DeepSeek_files/main.c3671f2e5c.css" rel="stylesheet"><style>
body.change-theme * {
  transition: none !important;
}

body.change-theme *::before {
  transition: none !important;
}

body.change-theme *::after {
  transition: none !important;
}
</style><link data-webpack="@deepseek/chat:chunk-945" rel="stylesheet" href="./Build PDF Chatbot with Gemini Flash - DeepSeek_files/katex.66a418a9b7.css"></head><body class="en_US dark" data-ds-dark-theme="dark" style="--app-height: 671px;"><div id="root"><div class="ds-theme" style="--ds-rgb-hover: 255 255 255 / 8%;"><div class="cb86951c"><div class="cddfb2ed"></div><div class="c3ecdb44"><div class="dc04ec1d a02af2e6"><div class="ca6d4be1 _5a20a69"><div class="_6acebc2"><svg width="35" height="24" viewBox="0 0 35 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_4892_24313)"><path d="M26.5542 4.34393C26.2719 4.20592 26.1506 4.46928 25.9856 4.60268C25.9292 4.64581 25.8815 4.70216 25.8338 4.75391C25.4215 5.19438 24.9396 5.48361 24.3105 5.44911C23.3905 5.39736 22.605 5.68659 21.9104 6.39041C21.7626 5.52271 21.2721 5.00462 20.5258 4.67226C20.1353 4.49976 19.7403 4.32668 19.4666 3.95119C19.2757 3.68381 19.2234 3.38595 19.1279 3.09211C19.0669 2.91501 19.0066 2.73388 18.8024 2.7034C18.5811 2.6689 18.4942 2.85463 18.4074 3.00989C18.0601 3.6447 17.9255 4.34393 17.9388 5.05235C17.9692 6.64572 18.642 7.91478 19.9789 8.81756C20.1307 8.92106 20.1698 9.02457 20.1221 9.1758C20.0307 9.48688 19.9226 9.78876 19.8271 10.0998C19.7662 10.2982 19.6753 10.3419 19.4626 10.2551C18.7288 9.94862 18.0952 9.49493 17.5351 8.94694C16.5846 8.02749 15.7249 7.01258 14.6531 6.21791C14.4013 6.03218 14.1494 5.85967 13.8889 5.69522C12.7952 4.63316 14.0321 3.76086 14.3185 3.65736C14.618 3.54925 14.4225 3.17779 13.4548 3.18239C12.487 3.18642 11.6015 3.51073 10.4727 3.94256C10.3077 4.00754 10.1341 4.05469 9.95637 4.09379C8.93227 3.89944 7.86849 3.85631 6.75755 3.98167C4.66564 4.21455 2.99464 5.20358 1.7664 6.89183C0.290908 8.92106 -0.0564026 11.2269 0.368535 13.6316C0.815324 16.1663 2.10911 18.2645 4.09695 19.905C6.15838 21.6059 8.53263 22.4397 11.2415 22.2799C12.8867 22.185 14.7181 21.9648 16.7841 20.2161C17.3051 20.4755 17.8519 20.579 18.7587 20.6566C19.4574 20.7216 20.1302 20.6221 20.6511 20.514C21.4671 20.3415 21.4107 19.5859 21.1157 19.4473C18.7242 18.3335 19.2492 18.7866 18.772 18.4198C19.987 16.9822 21.8431 14.4269 22.4158 10.9474C22.4722 10.5633 22.5441 10.0222 22.5355 9.71114C22.5309 9.52138 22.5746 9.44778 22.7913 9.42593C23.3905 9.35693 23.9718 9.19305 24.506 8.89921C26.0557 8.05279 26.6808 6.6624 26.828 4.996C26.8498 4.74126 26.8234 4.47791 26.5542 4.34393ZM13.0511 19.3438C10.7332 17.5216 9.60906 16.9219 9.14502 16.9477C8.71089 16.9736 8.78909 17.4704 8.88454 17.7942C8.98459 18.1139 9.11455 18.3341 9.29683 18.6147C9.42276 18.8004 9.50959 19.0764 9.1709 19.284C8.42453 19.7458 7.12671 19.1288 7.06576 19.0983C5.55519 18.2087 4.29245 17.0346 3.40233 15.4285C2.54268 13.8829 2.04356 12.2245 1.96133 10.4546C1.93948 10.0274 2.06541 9.87617 2.49092 9.79854C3.05099 9.69504 3.62831 9.67319 4.1878 9.75541C6.55342 10.101 8.56713 11.1585 10.2554 12.8341C11.2191 13.788 11.9482 14.9283 12.6992 16.0421C13.4979 17.2249 14.357 18.3519 15.4512 19.276C15.8377 19.5997 16.1459 19.8458 16.4408 20.0275C15.5513 20.127 14.0666 20.1483 13.0511 19.345V19.3438ZM14.162 12.1981C14.162 12.0083 14.3139 11.8571 14.5048 11.8571C14.5479 11.8571 14.587 11.8657 14.6221 11.8784C14.6698 11.8956 14.7135 11.9215 14.748 11.9606C14.8089 12.021 14.8434 12.1072 14.8434 12.1981C14.8434 12.3878 14.6916 12.5391 14.5007 12.5391C14.3098 12.5391 14.162 12.3878 14.162 12.1981ZM17.6127 13.968C17.3913 14.0588 17.17 14.1365 16.9572 14.1451C16.6271 14.1623 16.2672 14.0284 16.0717 13.8645C15.7681 13.6098 15.5507 13.4671 15.4599 13.0227C15.4208 12.8329 15.4426 12.5391 15.4771 12.3706C15.5553 12.0078 15.4685 11.7749 15.2126 11.5633C15.0045 11.3908 14.7394 11.343 14.4484 11.343C14.3397 11.343 14.2403 11.2953 14.1661 11.2568C14.0447 11.1964 13.9447 11.0452 14.0401 10.8594C14.0706 10.7991 14.2184 10.6524 14.2529 10.6266C14.6479 10.4017 15.1034 10.4753 15.5248 10.6438C15.9153 10.8037 16.2108 11.0969 16.6358 11.5115C17.0699 12.0124 17.1481 12.1504 17.3954 12.5264C17.5909 12.8203 17.7686 13.1221 17.8905 13.4677C17.9641 13.6834 17.8686 13.8599 17.6127 13.968Z" fill="var(--dsw-alias-brand-primary)"></path></g><defs><clippath id="clip0_4892_24313"><rect width="26.634" height="19.6" fill="white" transform="translate(0.199951 2.69922)"></rect></clippath></defs></svg></div><div class="e5bf614e"><div style="width: 3px;"></div><div class="_17e543b _4f3769f" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 34px; width: 34px; height: 34px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.67269 0.522888C10.8339 0.522888 11.7599 0.522762 12.4963 0.602541C13.2453 0.683705 13.8789 0.854296 14.4263 1.25202C14.7504 1.48744 15.0354 1.77252 15.2709 2.09654C15.6686 2.64398 15.8392 3.27762 15.9203 4.0266C16.0001 4.76295 16 5.689 16 6.85019V9.14991C16 10.3111 16.0001 11.2372 15.9203 11.9735C15.8392 12.7225 15.6686 13.3561 15.2709 13.9036C15.0354 14.2276 14.7504 14.5127 14.4263 14.7481C13.8789 15.1458 13.2453 15.3164 12.4963 15.3976C11.7599 15.4773 10.8339 15.4772 9.67269 15.4772H6.32727C5.16608 15.4772 4.24003 15.4773 3.50368 15.3976C2.75471 15.3164 2.12106 15.1458 1.57363 14.7481C1.2496 14.5127 0.964519 14.2276 0.7291 13.9036C0.331377 13.3561 0.160786 12.7225 0.0796224 11.9735C-0.000156655 11.2372 -3.05163e-05 10.3111 -3.05163e-05 9.14991V6.85019C-3.05163e-05 5.689 -0.000156655 4.76295 0.0796224 4.0266C0.160786 3.27762 0.331377 2.64398 0.7291 2.09654C0.964519 1.77252 1.2496 1.48744 1.57363 1.25202C2.12106 0.854296 2.75471 0.683705 3.50368 0.602541C4.24003 0.522762 5.16608 0.522888 6.32727 0.522888H9.67269ZM5.543 1.8872V14.1119C5.78633 14.1128 6.04706 14.117 6.32727 14.117H9.67269C10.8639 14.117 11.7032 14.1165 12.3492 14.0465C12.9824 13.9779 13.3497 13.8495 13.6267 13.6483C13.8354 13.4967 14.0195 13.3126 14.171 13.104C14.3722 12.8269 14.5007 12.4596 14.5693 11.8265C14.6393 11.1804 14.6398 10.3411 14.6398 9.14991V6.85019C14.6398 5.65901 14.6393 4.81972 14.5693 4.17365C14.5007 3.54053 14.3722 3.17323 14.171 2.89614C14.0195 2.68752 13.8354 2.50341 13.6267 2.35184C13.3497 2.15065 12.9824 2.02217 12.3492 1.95358C11.7032 1.88362 10.8639 1.88311 9.67269 1.88311H6.32727C6.04706 1.88311 5.78633 1.88625 5.543 1.8872ZM4.18277 1.91171C3.99122 1.92164 3.81477 1.93582 3.65073 1.95358C3.01761 2.02217 2.65031 2.15065 2.37322 2.35184C2.1646 2.50341 1.98049 2.68752 1.82892 2.89614C1.62773 3.17323 1.49925 3.54053 1.43066 4.17365C1.36071 4.81972 1.3602 5.65901 1.3602 6.85019V9.14991C1.3602 10.3411 1.36071 11.1804 1.43066 11.8265C1.49925 12.4596 1.62773 12.8269 1.82892 13.104C1.98049 13.3126 2.1646 13.4967 2.37322 13.6483C2.65031 13.8495 3.01761 13.9779 3.65073 14.0465C3.81475 14.0643 3.99124 14.0774 4.18277 14.0874V1.91171Z" fill="currentColor"></path></svg></div></div><div class="_17e543b _4f3769f" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 34px; width: 34px; height: 34px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 0.599609C3.91309 0.599609 0.599609 3.91309 0.599609 8C0.599609 9.13376 0.855461 10.2098 1.3125 11.1719L1.5918 11.7588L2.76562 11.2012L2.48633 10.6143C2.11034 9.82278 1.90039 8.93675 1.90039 8C1.90039 4.63106 4.63106 1.90039 8 1.90039C11.3689 1.90039 14.0996 4.63106 14.0996 8C14.0996 11.3689 11.3689 14.0996 8 14.0996C7.31041 14.0996 6.80528 14.0514 6.35742 13.9277C5.91623 13.8059 5.49768 13.6021 4.99707 13.2529C4.26492 12.7422 3.21611 12.5616 2.35156 13.1074L2.33789 13.1162L2.32422 13.126L1.58789 13.6436L2.01953 14.9297L3.0459 14.207C3.36351 14.0065 3.83838 14.0294 4.25293 14.3184C4.84547 14.7317 5.39743 15.011 6.01172 15.1807C6.61947 15.3485 7.25549 15.4004 8 15.4004C12.0869 15.4004 15.4004 12.0869 15.4004 8C15.4004 3.91309 12.0869 0.599609 8 0.599609ZM7.34473 4.93945V7.34961H4.93945V8.65039H7.34473V11.0605H8.64551V8.65039H11.0605V7.34961H8.64551V4.93945H7.34473Z" fill="currentColor"></path></svg></div></div></div></div><div class="b8812f16 a2f3d50e _70b689f"><div class="_262baab"><div class="e066abb8"><svg width="143" height="23" viewBox="0 0 143 23" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M78.6785 18.6823H77.1078V16.2472H78.6785C79.6513 16.2472 80.6342 16.0047 81.2672 15.3308C81.9009 14.6569 82.14 13.6232 82.14 12.59C82.14 11.5569 81.9109 10.5231 81.2672 9.84981C80.6247 9.17594 79.6513 8.93343 78.6785 8.93343C77.7056 8.93343 76.7228 9.17594 76.0886 9.84981C75.4549 10.5237 75.2158 11.5569 75.2158 12.59V22.5909H72.4605V6.50781H75.2158V7.53204H75.7209C75.7757 7.4689 75.8304 7.41525 75.8857 7.36161C76.5752 6.73244 77.6308 6.50781 78.6684 6.50781C80.2944 6.50781 81.9193 6.91236 82.9849 8.03549C84.0499 9.15861 84.4265 10.8835 84.4265 12.6001C84.4265 14.3166 84.0404 16.0326 82.9849 17.1647C81.9288 18.2967 80.2944 18.6834 78.6785 18.6834V18.6823Z" fill="var(--dsw-alias-brand-primary)"></path><path d="M36.7486 6.94097H38.3188V9.37609H36.7486C35.7753 9.37609 34.7929 9.61859 34.1593 10.2925C33.5257 10.9663 33.2871 12.0001 33.2871 13.0332C33.2871 14.0664 33.5167 15.0996 34.1593 15.7734C34.8019 16.4473 35.7753 16.6898 36.7486 16.6898C37.722 16.6898 38.7049 16.4473 39.3385 15.7734C39.9722 15.0996 40.2108 14.0664 40.2108 13.0332V3.02344H42.9655V19.116H40.2108V18.0918H39.7057C39.6503 18.1544 39.5956 18.2086 39.5403 18.2622C38.8513 18.8908 37.7952 19.116 36.7576 19.116C35.1321 19.116 33.5067 18.712 32.4416 17.5889C31.3766 16.4658 31 14.7403 31 13.0243C31 11.3083 31.3856 9.59177 32.4416 8.45971C33.5067 7.33658 35.1321 6.94097 36.7486 6.94097Z" fill="var(--dsw-alias-brand-primary)"></path><path d="M56.7855 12.8155V13.795H49.4483V11.8454H54.3152C54.2051 11.1358 53.9481 10.4709 53.4887 9.9853C52.8277 9.2846 51.808 9.03316 50.7983 9.03316C49.7886 9.03316 48.7688 9.2846 48.1078 9.9853C47.4468 10.686 47.2076 11.7555 47.2076 12.816C47.2076 13.8766 47.4462 14.9544 48.1078 15.6462C48.7688 16.338 49.788 16.5989 50.7983 16.5989C51.8085 16.5989 52.8277 16.3475 53.4887 15.6462C53.5804 15.5473 53.6631 15.4395 53.7458 15.3316H56.4642C56.2256 16.1765 55.849 16.9403 55.2796 17.5332C54.1777 18.692 52.479 19.1145 50.7983 19.1145C49.1175 19.1145 47.4188 18.701 46.3169 17.5332C45.215 16.3653 44.8111 14.5862 44.8111 12.816C44.8111 11.0458 45.2061 9.25778 46.3169 8.0989C47.4283 6.94001 49.1175 6.51758 50.7983 6.51758C52.479 6.51758 54.1777 6.93107 55.2796 8.0989C56.3904 9.26672 56.7855 11.0458 56.7855 12.816V12.8155Z" fill="var(--dsw-alias-brand-primary)"></path><path d="M70.6151 12.8155V13.795H63.2779V11.8454H68.1448C68.0341 11.1358 67.7776 10.4709 67.3183 9.9853C66.6573 9.2846 65.6376 9.03316 64.6279 9.03316C63.6182 9.03316 62.5984 9.2846 61.9374 9.9853C61.2764 10.686 61.0372 11.7555 61.0372 12.816C61.0372 13.8766 61.2758 14.9544 61.9374 15.6462C62.5984 16.338 63.6182 16.5989 64.6279 16.5989C65.6376 16.5989 66.6573 16.3475 67.3183 15.6462C67.4105 15.5473 67.4927 15.4395 67.5748 15.3316H70.2938C70.0546 16.1765 69.678 16.9403 69.1086 17.5332C68.0067 18.692 66.3081 19.1145 64.6279 19.1145C62.9476 19.1145 61.2484 18.701 60.1465 17.5332C59.0446 16.3653 58.6406 14.5862 58.6406 12.816C58.6406 11.0458 59.0357 9.25778 60.1465 8.0989C61.2579 6.94001 62.9471 6.51758 64.6279 6.51758C66.3086 6.51758 68.0067 6.93107 69.1086 8.0989C70.22 9.26672 70.6151 11.0458 70.6151 12.816V12.8155Z" fill="var(--dsw-alias-brand-primary)"></path><path d="M92.2781 19.1156C93.9589 19.1156 95.657 18.8731 96.7589 18.1813C97.8608 17.4896 98.2653 16.438 98.2653 15.3959C98.2653 14.3538 97.8697 13.2932 96.7589 12.6104C95.657 11.9276 93.9583 11.6756 92.2781 11.6756C91.5612 11.6756 90.9002 11.5767 90.4319 11.3163C89.9637 11.0464 89.7893 10.6424 89.7893 10.2379C89.7893 9.83332 89.9547 9.42039 90.4319 9.15944C90.9002 8.88955 91.626 8.80015 92.3418 8.80015C93.0576 8.80015 93.7834 8.89905 94.2528 9.15944C94.721 9.42933 94.8954 9.83332 94.8954 10.2379H97.6959C97.6959 9.1952 97.3383 8.13522 96.3376 7.4524C95.3368 6.76958 93.803 6.51758 92.2787 6.51758C90.7543 6.51758 89.2211 6.76008 88.2198 7.4524C87.219 8.14416 86.8603 9.1952 86.8603 10.2379C86.8603 11.2805 87.2185 12.3405 88.2198 13.0233C89.2205 13.7061 90.7538 13.9582 92.2787 13.9582C93.0682 13.9582 93.941 14.0571 94.464 14.3174C94.9881 14.5784 95.1714 14.9913 95.1714 15.3959C95.1714 15.8004 94.9881 16.2133 94.464 16.4743C93.941 16.7347 93.142 16.8336 92.3524 16.8336C91.5629 16.8336 90.7543 16.7347 90.2397 16.4743C89.7256 16.2139 89.5323 15.8004 89.5323 15.3959H86.2998C86.2998 16.4385 86.6943 17.4985 87.8063 18.1813C88.9171 18.8641 90.5979 19.1156 92.2787 19.1156H92.2781Z" fill="var(--dsw-alias-brand-primary)"></path><path d="M112.094 12.8155V13.795H104.757V11.8454H109.624C109.514 11.1358 109.257 10.4709 108.798 9.9853C108.136 9.2846 107.117 9.03316 106.106 9.03316C105.095 9.03316 104.077 9.2846 103.416 9.9853C102.755 10.686 102.517 11.7555 102.517 12.816C102.517 13.8766 102.755 14.9544 103.416 15.6462C104.077 16.338 105.097 16.5989 106.106 16.5989C107.116 16.5989 108.136 16.3475 108.798 15.6462C108.889 15.5473 108.972 15.4395 109.054 15.3316H111.772C111.533 16.1765 111.157 16.9403 110.588 17.5332C109.486 18.692 107.787 19.1145 106.106 19.1145C104.425 19.1145 102.727 18.701 101.625 17.5332C100.524 16.3653 100.12 14.5862 100.12 12.816C100.12 11.0458 100.515 9.25778 101.625 8.0989C102.737 6.94001 104.427 6.51758 106.106 6.51758C107.786 6.51758 109.486 6.93107 110.588 8.0989C111.699 9.26672 112.093 11.0458 112.093 12.816L112.094 12.8155Z" fill="var(--dsw-alias-brand-primary)"></path><path d="M125.924 12.8155V13.795H118.586V11.8454H123.453C123.344 11.1358 123.086 10.4709 122.627 9.9853C121.966 9.2846 120.947 9.03316 119.936 9.03316C118.926 9.03316 117.907 9.2846 117.246 9.9853C116.585 10.686 116.346 11.7555 116.346 12.816C116.346 13.8766 116.585 14.9544 117.246 15.6462C117.907 16.338 118.927 16.5989 119.936 16.5989C120.946 16.5989 121.966 16.3475 122.627 15.6462C122.719 15.5473 122.801 15.4395 122.885 15.3316H125.602C125.363 16.1765 124.987 16.9403 124.418 17.5332C123.316 18.692 121.617 19.1145 119.936 19.1145C118.256 19.1145 116.558 18.701 115.456 17.5332C114.354 16.3653 113.949 14.5862 113.949 12.816C113.949 11.0458 114.344 9.25778 115.456 8.0989C116.567 6.94001 118.256 6.51758 119.936 6.51758C121.617 6.51758 123.315 6.93107 124.418 8.0989C125.529 9.26672 125.924 11.0458 125.924 12.816V12.8155Z" fill="var(--dsw-alias-brand-primary)"></path><path d="M130.524 3.02344H127.77V19.116H130.524V3.02344Z" fill="var(--dsw-alias-brand-primary)"></path><path d="M135.227 12.4384L139.744 19.1146H136.337L131.819 12.4384L136.337 7.07422H139.744L135.227 12.4384Z" fill="var(--dsw-alias-brand-primary)"></path><g clip-path="url(#clip0_4329_19769)"><path d="M26.5174 3.39471C26.235 3.2567 26.1137 3.52006 25.9487 3.65346C25.8923 3.69659 25.8446 3.75294 25.7969 3.80469C25.3846 4.24516 24.9027 4.53439 24.2737 4.49989C23.3536 4.44814 22.5682 4.73737 21.8735 5.44119C21.7258 4.57349 21.2353 4.0554 20.4889 3.72304C20.0985 3.55054 19.7034 3.37746 19.4297 3.00197C19.2388 2.73459 19.1865 2.43673 19.091 2.14289C19.0301 1.96579 18.9697 1.78466 18.7656 1.75418C18.5442 1.71968 18.4574 1.90541 18.3705 2.06067C18.0232 2.69549 17.8887 3.39471 17.9019 4.10313C17.9324 5.6965 18.6051 6.96556 19.9421 7.86834C20.0939 7.97184 20.133 8.07535 20.0852 8.22658C19.9938 8.53766 19.8857 8.83955 19.7903 9.15063C19.7293 9.34901 19.6385 9.39271 19.4257 9.30588C18.692 8.9994 18.0583 8.54571 17.4982 7.99772C16.5477 7.07827 15.6881 6.06336 14.6162 5.26869C14.3644 5.08296 14.1125 4.91045 13.8521 4.746C12.7584 3.68394 13.9952 2.81164 14.2816 2.70814C14.5812 2.60003 14.3857 2.22857 13.4179 2.23317C12.4502 2.2372 11.5646 2.56151 10.4359 2.99335C10.2708 3.05832 10.0972 3.10547 9.91951 3.14457C8.8954 2.95022 7.83162 2.90709 6.72069 3.03245C4.62877 3.26533 2.95777 4.25436 1.72954 5.94261C0.254043 7.97184 -0.0932679 10.2777 0.33167 12.6824C0.778458 15.2171 2.07225 17.3153 4.06008 18.9558C6.12152 20.6567 8.49577 21.4905 11.2047 21.3306C12.8498 21.2358 14.6812 21.0155 16.7473 19.2669C17.2682 19.5262 17.8151 19.6297 18.7219 19.7074C19.4205 19.7724 20.0933 19.6729 20.6143 19.5648C21.4302 19.3923 21.3739 18.6367 21.0789 18.4981C18.6874 17.3843 19.2124 17.8374 18.7351 17.4706C19.9501 16.033 21.8063 13.4776 22.379 9.99821C22.4353 9.61409 22.5072 9.073 22.4986 8.76192C22.494 8.57216 22.5377 8.49856 22.7545 8.47671C23.3536 8.40771 23.935 8.24383 24.4692 7.94999C26.0188 7.10357 26.6439 5.71318 26.7911 4.04678C26.8129 3.79204 26.7865 3.52869 26.5174 3.39471ZM13.0143 18.3946C10.6964 16.5724 9.5722 15.9726 9.10816 15.9985C8.67402 16.0244 8.75222 16.5212 8.84768 16.8449C8.94773 17.1646 9.07768 17.3849 9.25996 17.6655C9.38589 17.8512 9.47272 18.1272 9.13404 18.3348C8.38766 18.7965 7.08985 18.1796 7.0289 18.1491C5.51833 17.2595 4.25559 16.0853 3.36546 14.4793C2.50581 12.9337 2.0067 11.2753 1.92447 9.50542C1.90262 9.07818 2.02855 8.92695 2.45406 8.84932C3.01413 8.74582 3.59144 8.72397 4.15093 8.80619C6.51656 9.15178 8.53027 10.2092 10.2185 11.8848C11.1822 12.8388 11.9114 13.979 12.6623 15.0929C13.461 16.2757 14.3201 17.4027 15.4144 18.3268C15.8008 18.6505 16.109 18.8966 16.404 19.0783C15.5144 19.1778 14.0297 19.1991 13.0143 18.3958V18.3946ZM14.1252 11.2489C14.1252 11.0591 14.277 10.9079 14.4679 10.9079C14.511 10.9079 14.5501 10.9165 14.5852 10.9292C14.6329 10.9464 14.6766 10.9723 14.7111 11.0114C14.7721 11.0718 14.8066 11.158 14.8066 11.2489C14.8066 11.4386 14.6548 11.5899 14.4639 11.5899C14.273 11.5899 14.1252 11.4386 14.1252 11.2489ZM17.5759 13.0188C17.3545 13.1096 17.1331 13.1873 16.9203 13.1959C16.5903 13.2131 16.2303 13.0791 16.0348 12.9153C15.7312 12.6605 15.5139 12.5179 15.423 12.0734C15.3839 11.8837 15.4057 11.5899 15.4402 11.4214C15.5185 11.0585 15.4316 10.8257 15.1757 10.614C14.9676 10.4415 14.7025 10.3938 14.4115 10.3938C14.3029 10.3938 14.2034 10.3461 14.1292 10.3076C14.0079 10.2472 13.9078 10.096 14.0033 9.91023C14.0338 9.84985 14.1815 9.70322 14.216 9.67734C14.6111 9.45251 15.0665 9.52612 15.488 9.6946C15.8784 9.85445 16.174 10.1477 16.5989 10.5623C17.033 11.0631 17.1112 11.2011 17.3585 11.5772C17.554 11.871 17.7317 12.1729 17.8536 12.5185C17.9272 12.7341 17.8317 12.9107 17.5759 13.0188Z" fill="var(--dsw-alias-brand-primary)"></path></g><defs><clippath id="clip0_4329_19769"><rect width="26.634" height="19.6" fill="white" transform="translate(0.163086 1.75)"></rect></clippath></defs></svg></div></div><div class="_5a8ac7a a084f19e"><div class="ds-icon _1c42ad7" style="font-size: 16px; width: 16px; height: 16px;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 0.599609C3.91309 0.599609 0.599609 3.91309 0.599609 8C0.599609 9.13376 0.855461 10.2098 1.3125 11.1719L1.5918 11.7588L2.76562 11.2012L2.48633 10.6143C2.11034 9.82278 1.90039 8.93675 1.90039 8C1.90039 4.63106 4.63106 1.90039 8 1.90039C11.3689 1.90039 14.0996 4.63106 14.0996 8C14.0996 11.3689 11.3689 14.0996 8 14.0996C7.31041 14.0996 6.80528 14.0514 6.35742 13.9277C5.91623 13.8059 5.49768 13.6021 4.99707 13.2529C4.26492 12.7422 3.21611 12.5616 2.35156 13.1074L2.33789 13.1162L2.32422 13.126L1.58789 13.6436L2.01953 14.9297L3.0459 14.207C3.36351 14.0065 3.83838 14.0294 4.25293 14.3184C4.84547 14.7317 5.39743 15.011 6.01172 15.1807C6.61947 15.3485 7.25549 15.4004 8 15.4004C12.0869 15.4004 15.4004 12.0869 15.4004 8C15.4004 3.91309 12.0869 0.599609 8 0.599609ZM7.34473 4.93945V7.34961H4.93945V8.65039H7.34473V11.0605H8.64551V8.65039H11.0605V7.34961H8.64551V4.93945H7.34473Z" fill="currentColor"></path></svg></div><span>New chat</span></div><div class="_3586175 ds-scroll-area"><div class="ds-scroll-area__gutters" style="position: sticky; top: 0px; left: 0px; right: 0px; height: 0px; --container-height: 491px;"><div class="ds-scroll-area__horizontal-gutter" style="left: 8px; right: 8px; top: calc(var(--container-height) - 8px); height: 8px;"><div class="ds-scroll-area__horizontal-bar" style="display: none;"></div></div><div class="ds-scroll-area__vertical-gutter" style="right: -12px; top: 0px; bottom: calc(0px - var(--container-height) + 0px); width: 8px;"><div class="ds-scroll-area__vertical-bar" style="top: 0px; height: 162.783px;"></div></div></div><div class="_6d215eb"><div class="_77cdc67 _8a693f3"><div class="_5d4b535"><div class="_48cdfc1">Today</div><a class="_546d736 b64fb9ae" href="https://chat.deepseek.com/a/chat/s/88e5ddb4-0281-4f85-9a78-92a34839fbe6" tabindex="0"><div class="c08e6e93">Build PDF Chatbot with Gemini Flash</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a></div><div class="_5d4b535"><div class="_48cdfc1">Yesterday</div><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/af85d7c2-43f4-45b3-b1bc-d303f9a3a455" tabindex="0"><div class="c08e6e93">Automated Data Pipeline for Hospital Pricing</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a></div><div class="_5d4b535"><div class="_48cdfc1">7 Days</div><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/7d1c2283-5f5c-4e06-9311-6d4eace7cb50" tabindex="0"><div class="c08e6e93">Data Scientist Assignment Step-by-Step Guide</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/1b7d358b-8247-4851-b52a-a28e9516f2d1" tabindex="0"><div class="c08e6e93">Lang Graph Agent Implementation Guide</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a></div><div class="_5d4b535"><div class="_48cdfc1">30 Days</div><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/b57398d8-9fea-4e5e-ba8f-5869dc3d5961" tabindex="0"><div class="c08e6e93">Enhancing Restaurant Recommendation Chatbot Functionality</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/b500cbcb-024a-48b8-b77b-3024d2ace24c" tabindex="0"><div class="c08e6e93">Build ETL Pipeline for Web Log Analytics</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a></div><div class="_5d4b535"><div class="_48cdfc1">2025-07</div><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/da5cbe9c-1edf-4bfd-9a39-376f9c24a520" tabindex="0"><div class="c08e6e93">Fixing CSV Encoding Error in Python</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/e315a8c1-ca2d-4f66-b246-07998382136f" tabindex="0"><div class="c08e6e93">Calculating PERCENT_RANK in SQL Steps</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a></div><div class="_5d4b535"><div class="_48cdfc1">2025-06</div><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/1b8279bf-f550-443a-82ac-10748bc2d90b" tabindex="0"><div class="c08e6e93">Adjust LaTeX itemize list spacing tips</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a></div><div class="_5d4b535"><div class="_48cdfc1">2025-02</div><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/9a58453c-659e-4f7a-a26c-1966d12216f0" tabindex="0"><div class="c08e6e93">The attached file contains my co</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/9f63a240-7124-4781-8f5c-d39bf841d8ac" tabindex="0"><div class="c08e6e93">R2 and MAPE values are negative,</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/70c7544e-acef-4553-9464-94e1bc4f6101" tabindex="0"><div class="c08e6e93">R2 and MAPE values are negative,</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/5bca0cb4-ccf7-457d-84eb-ebe26b1e1465" tabindex="0"><div class="c08e6e93">Read this ipynb file thoroughly </div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/02e94ad6-b897-4eef-b867-031d6911455a" tabindex="0"><div class="c08e6e93">Read this ipynb file thoroughly </div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/16538d74-ec46-49b1-aa9e-0d7cd87cecb4" tabindex="0"><div class="c08e6e93">Give me the whole text into late</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/6f3106e9-6ecb-4636-a3e7-de7ad23f0ae6" tabindex="0"><div class="c08e6e93">This is the complete text of my </div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/cd8c0940-a166-43e9-ac32-bc3e59dac66d" tabindex="0"><div class="c08e6e93">According to my code below, gene</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/02b8c207-90cc-4124-98a8-b123f2233798" tabindex="0"><div class="c08e6e93"># Step 3: Plotting the results f</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/907a0b19-8468-4032-9b6a-d6eef38a9c92" tabindex="0"><div class="c08e6e93">This is my dissertation work. Mo</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a></div><div class="_5d4b535"><div class="_48cdfc1">2025-01</div><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/8f2bf17a-d6df-4ad3-b981-71f9a2306958" tabindex="0"><div class="c08e6e93">Deliverables:
● A report on your</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/7f5b295f-c2f6-4b66-965f-c35853eaaa4e" tabindex="0"><div class="c08e6e93">Complete elaborated solution of </div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/45449211-f934-4590-9fa2-7abc808dc27b" tabindex="0"><div class="c08e6e93">For my assignment, I have prepar</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/500f85ed-9216-4d36-b7ac-e2ddd7367722" tabindex="0"><div class="c08e6e93">For the attached assignment, I h</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/ddc8f959-c45b-4309-b438-e82570597842" tabindex="0"><div class="c08e6e93">Building Dataset Analysis Agent with LLM</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/013ff778-1d2f-4f77-8b9a-a0cc78855089" tabindex="0"><div class="c08e6e93">Understanding -q in pip install command</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/71c155ce-460d-4518-8fc5-4aef4e032457" tabindex="0"><div class="c08e6e93">Optimize ARIMA with Best Parameters Only</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/e5d536d3-2437-4a84-97d5-25ae02c12649" tabindex="0"><div class="c08e6e93">Updated Table with New Algorithm Values</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/a0bcca5c-10ed-47be-805f-8c7cd008ff8a" tabindex="0"><div class="c08e6e93">Code Fix for Saving Model Metrics</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a><a class="_546d736" href="https://chat.deepseek.com/a/chat/s/4cbca317-10b5-40fa-8e8e-31cbc4a7e9b2" tabindex="0"><div class="c08e6e93">Dissertation References and Research Sources</div><div class="_254829d"><div class="_17e543b _2090548" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; color: var(--dsw-alias-label-tertiary);"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div></a></div></div><div class="de3d058c be66d622"></div></div><div class="_1d72f01"></div></div><div class="_2afd28d" tabindex="0"><div class="ede5bc47">A</div><div class="_9d8da05">abh******ero@gmail.com</div><div class="ds-icon _39cc453" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.5514 8.00006C4.5514 8.63519 4.03653 9.15006 3.4014 9.15006C2.76628 9.15006 2.2514 8.63519 2.2514 8.00006C2.2514 7.36493 2.76628 6.85006 3.4014 6.85006C4.03653 6.85006 4.5514 7.36493 4.5514 8.00006Z" fill="currentColor"></path><path d="M9.14754 8.00006C9.14754 8.63519 8.63267 9.15006 7.99754 9.15006C7.36242 9.15006 6.84754 8.63519 6.84754 8.00006C6.84754 7.36493 7.36242 6.85006 7.99754 6.85006C8.63267 6.85006 9.14754 7.36493 9.14754 8.00006Z" fill="currentColor"></path><path d="M13.7486 8.00006C13.7486 8.63519 13.2337 9.15006 12.5986 9.15006C11.9634 9.15006 11.4486 8.63519 11.4486 8.00006C11.4486 7.36493 11.9634 6.85006 12.5986 6.85006C13.2337 6.85006 13.7486 7.36493 13.7486 8.00006Z" fill="currentColor"></path></svg></div></div></div></div><div class="_4cbcd96 _7d10bb1"></div><div class="_7780f2e"><div class="_765a5cd"><div class="_2be88ba"><div class="f8d1e4c0"><div style="flex: 1 1 0%; min-width: 0px; display: flex; place-content: center; z-index: 12;"><div class="afa34042 e37a04e4 e0a1edb7" tabindex="0" style="outline: none;">Build PDF Chatbot with Gemini Flash</div></div></div><div class="_0efe408"><div class="_17e543b" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 44px; width: 44px; height: 44px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.2028 4.90042V6.43663H2.7973V4.90042H17.2028Z" fill="currentColor"></path><path d="M10.9604 13.0635V14.5997H2.7973V13.0635H10.9604Z" fill="currentColor"></path></svg></div></div><div class="_348bebe"></div><div class="_17e543b" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 44px; width: 44px; height: 44px;"><div class="ds-icon" style="font-size: 20px; width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 1.22949C5.15604 1.22949 1.22943 5.1561 1.22943 10.0001C1.22943 11.3438 1.53197 12.619 2.07365 13.7593L2.40679 14.4596L3.80656 13.7943L3.47436 13.0939L3.31631 12.7371C2.97057 11.8939 2.77968 10.97 2.77968 10.0001C2.77968 6.0125 6.01243 2.77974 10 2.77974C13.9876 2.77974 17.2203 6.0125 17.2203 10.0001C17.2203 13.9876 13.9876 17.2204 10 17.2204C9.18341 17.2204 8.58586 17.1622 8.05603 17.0159C7.53403 16.8718 7.03891 16.6306 6.44615 16.2172C5.5775 15.6113 4.3323 15.3976 3.3059 16.0459L3.28981 16.0563L3.27372 16.0676L2.5904 16.5484L3.10431 18.0826L4.14444 17.35C4.51837 17.1207 5.07302 17.1507 5.5584 17.4892C6.26064 17.979 6.91506 18.3092 7.64339 18.5104C8.36397 18.7093 9.11785 18.7706 10 18.7706C14.844 18.7706 18.7706 14.844 18.7706 10.0001C18.7706 5.1561 14.844 1.22949 10 1.22949ZM9.2192 6.36955V9.22493H6.36949V10.7752H9.2192V13.6306H10.7694V10.7752H13.6305V9.22493H10.7694V6.36955H9.2192Z" fill="currentColor"></path></svg></div></div></div></div><div class="_3919b83"><div class="_8f60047"><div class="ds-scroll-area__gutters" style="position: sticky; top: 0px; left: 0px; right: 0px; height: 0px; --container-height: 611px;"><div class="ds-scroll-area__horizontal-gutter" style="left: 8px; right: 8px; top: calc(var(--container-height) - 8px); height: 8px;"><div class="ds-scroll-area__horizontal-bar" style="display: none;"></div></div><div class="ds-scroll-area__vertical-gutter" style="right: 0px; top: 0px; bottom: calc(0px - var(--container-height) + 2px); width: 8px;"><div class="ds-scroll-area__vertical-bar" style="top: 583.912px; height: 24px;"></div></div></div><div class="_0f72b0b ds-scroll-area"><div class="dad65929"><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="_5cadb25" style="margin-bottom: 0px; max-height: none; position: relative; overflow: visible; pointer-events: auto; margin-top: 0px;"><div class="_76cd190 _0004e59"><div class="d2d04dae"><div class="ds-icon b3a5d6c1" style="font-size: 28px; width: 28px; height: 28px;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="28" viewBox="0 0 24 28" fill="none"><path d="M16.5 0l7 7v15.6c0 2.25 0 3.375-.573 4.164a3 3 0 0 1-.663.663C21.475 28 20.349 28 18.1 28H5.9c-2.25 0-3.375 0-4.164-.573a3 3 0 0 1-.663-.663C.5 25.975.5 24.849.5 22.6V5.4c0-2.25 0-3.375.573-4.164a3 3 0 0 1 .663-.663C2.525 0 3.651 0 5.9 0h10.6z" fill="url(#paint0_linear_4691_18172)"></path><path d="M16.5 0l7 7h-3.8c-1.12 0-1.68 0-2.108-.218a2 2 0 0 1-.874-.874C16.5 5.48 16.5 4.92 16.5 3.8V0z" fill="#fff" fill-opacity=".55"></path><path d="M16.72 18.7a4.618 4.618 0 0 1-2.678-1.086c-1.484.326-2.896.796-4.307 1.375-1.122 1.99-2.172 3.004-3.077 3.004-.18 0-.398-.036-.543-.145a1.067 1.067 0 0 1-.615-.977c0-.325.072-1.23 3.51-2.714a25.767 25.767 0 0 0 1.919-4.488c-.434-.869-1.375-3.004-.724-4.09.217-.398.652-.615 1.122-.579a1.2 1.2 0 0 1 .941.47c.47.652.434 2.027-.18 4.054a10.916 10.916 0 0 0 2.243 2.896c.76-.145 1.52-.254 2.28-.254 1.701.036 1.955.833 1.918 1.303 0 1.23-1.194 1.23-1.81 1.23zM6.586 20.944l.108-.037c.507-.18.905-.543 1.195-1.013a2.86 2.86 0 0 0-1.303 1.05zm4.813-10.858h-.108c-.036 0-.109 0-.145.036-.145.615-.036 1.267.217 1.846a3.041 3.041 0 0 0 .036-1.882zm.254 5.248l-.036.072-.037-.036a29.881 29.881 0 0 1-1.085 2.461l.072-.036v.072c.796-.29 1.665-.543 2.461-.724l-.036-.036h.108a11.088 11.088 0 0 1-1.447-1.773zm4.922 1.918c-.326 0-.615 0-.941.072.362.181.724.254 1.086.29a1.6 1.6 0 0 0 .724-.073c0-.108-.145-.29-.869-.29z" fill="#fff"></path><defs><lineargradient id="paint0_linear_4691_18172" x1="1.5" y1="-1" x2="23.5" y2="28" gradientUnits="userSpaceOnUse"><stop stop-color="#FD6D3A"></stop><stop offset="1" stop-color="#F05A6B"></stop></lineargradient></defs></svg></div><div class="_789aea7"><div class="_7e13492"><div class="f3a54b52">ManpowerGroup Take Home Assignment.pdf</div><div class=""></div></div><div class="_5119742">PDF 103.44KB</div></div></div></div></div><div class="fbb737a4 _8271fc3">Do an exhaustive analysis of this project statement and guide me step by step with python code in a GitHub repo format. Think well and answer the best methodology using Gemini flash 1.5 API (in .env file) and faiss db on windows platform.</div></div><div class="_11d6b3a"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5" style="--assistant-last-margin-bottom: 32px;"><div class="ds-message _656c965"><div class="_7d763a7 _45cdda5" style="--deep-search-title-height: 38px; --group-title-sticky-top: 0px;"><div class="_68f84dc"></div><div class="ddd2f74b"></div></div><div class="ds-markdown" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph"><span>I'll help you build a comprehensive PDF chatbot application using Gemini Flash 1.5 and FAISS. Let's break this down step by step.</span></p><h2><span>Project Analysis</span></h2><p class="ds-markdown-paragraph"><strong><span>Key Requirements:</span></strong></p><ol start="1"><li><p class="ds-markdown-paragraph"><span>Streamlit UI with PDF upload and chat interface</span></p></li><li><p class="ds-markdown-paragraph"><span>PDF processing pipeline (chunking → embeddings → vector DB)</span></p></li><li><p class="ds-markdown-paragraph"><span>RAG system with citations</span></p></li><li><p class="ds-markdown-paragraph"><span>Persistent conversation history</span></p></li><li><p class="ds-markdown-paragraph"><span>Local execution capability</span></p></li></ol><p class="ds-markdown-paragraph"><strong><span>Technology Stack:</span></strong></p><ul><li><p class="ds-markdown-paragraph"><span>Frontend: Streamlit</span></p></li><li><p class="ds-markdown-paragraph"><span>LLM: Gemini Flash 1.5</span></p></li><li><p class="ds-markdown-paragraph"><span>Embeddings: Gemini Embeddings</span></p></li><li><p class="ds-markdown-paragraph"><span>Vector DB: FAISS (local, efficient for Windows)</span></p></li><li><p class="ds-markdown-paragraph"><span>PDF Processing: PyPDF2</span></p></li></ul><h2><span>Project Structure</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">text</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>pdf-chatbot/
├── app.py
├── modules/
│   ├── __init__.py
│   ├── pdf_processor.py
│   ├── vector_store.py
│   └── rag_engine.py
├── utils/
│   ├── __init__.py
│   └── helpers.py
├── storage/
│   └── (FAISS index will be stored here)
├── .env
├── requirements.txt
├── README.md
└── test_questions.json</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Step-by-Step Implementation</span></h2><h3><span>1. Setup Environment</span></h3><p class="ds-markdown-paragraph"><strong><span>requirements.txt</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">txt</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>streamlit==1.35.0
google-generativeai==0.3.2
faiss-cpu==1.7.4
PyPDF2==3.0.1
python-dotenv==1.0.1
sentence-transformers==2.2.2
numpy==1.24.3
chromadb==0.4.24</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>2. Environment Configuration</span></h3><p class="ds-markdown-paragraph"><strong><span>.env</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">env</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>GEMINI_API_KEY=your_gemini_api_key_here</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>3. Core Modules</span></h3><p class="ds-markdown-paragraph"><strong><span>modules/pdf_</span><a href="https://processor.py/" target="_blank" rel="noreferrer"><span>processor.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> PyPDF2
<span class="token keyword">import</span> io
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict<span class="token punctuation">,</span> Tuple
<span class="token keyword">import</span> re

<span class="token keyword">class</span> <span class="token class-name">PDFProcessor</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> chunk_size<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span> chunk_overlap<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>chunk_size <span class="token operator">=</span> chunk_size
        self<span class="token punctuation">.</span>chunk_overlap <span class="token operator">=</span> chunk_overlap
    
    <span class="token keyword">def</span> <span class="token function">extract_text_from_pdf</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pdf_file<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Tuple<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Extract text from PDF with page numbers"""</span>
        pdf_reader <span class="token operator">=</span> PyPDF2<span class="token punctuation">.</span>PdfReader<span class="token punctuation">(</span>pdf_file<span class="token punctuation">)</span>
        text_with_pages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> page_num<span class="token punctuation">,</span> page <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>pdf_reader<span class="token punctuation">.</span>pages<span class="token punctuation">)</span><span class="token punctuation">:</span>
            text <span class="token operator">=</span> page<span class="token punctuation">.</span>extract_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> text<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                text_with_pages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> page_num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> text_with_pages
    
    <span class="token keyword">def</span> <span class="token function">chunk_text</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> page_num<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Split text into overlapping chunks with metadata"""</span>
        chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        words <span class="token operator">=</span> text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>chunk_size <span class="token operator">-</span> self<span class="token punctuation">.</span>chunk_overlap<span class="token punctuation">)</span><span class="token punctuation">:</span>
            chunk_words <span class="token operator">=</span> words<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> self<span class="token punctuation">.</span>chunk_size<span class="token punctuation">]</span>
            chunk_text <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>chunk_words<span class="token punctuation">)</span>
            
            chunks<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token string">'text'</span><span class="token punctuation">:</span> chunk_text<span class="token punctuation">,</span>
                <span class="token string">'page'</span><span class="token punctuation">:</span> page_num<span class="token punctuation">,</span>
                <span class="token string">'start_word'</span><span class="token punctuation">:</span> i<span class="token punctuation">,</span>
                <span class="token string">'end_word'</span><span class="token punctuation">:</span> i <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>chunk_words<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> chunks
    
    <span class="token keyword">def</span> <span class="token function">process_pdf</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pdf_file<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Main method to process PDF into chunks"""</span>
        text_with_pages <span class="token operator">=</span> self<span class="token punctuation">.</span>extract_text_from_pdf<span class="token punctuation">(</span>pdf_file<span class="token punctuation">)</span>
        all_chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> text<span class="token punctuation">,</span> page_num <span class="token keyword">in</span> text_with_pages<span class="token punctuation">:</span>
            chunks <span class="token operator">=</span> self<span class="token punctuation">.</span>chunk_text<span class="token punctuation">(</span>text<span class="token punctuation">,</span> page_num<span class="token punctuation">)</span>
            all_chunks<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>chunks<span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> all_chunks</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><p class="ds-markdown-paragraph"><strong><span>modules/vector_</span><a href="https://store.py/" target="_blank" rel="noreferrer"><span>store.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> faiss
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict
<span class="token keyword">import</span> google<span class="token punctuation">.</span>generativeai <span class="token keyword">as</span> genai
<span class="token keyword">from</span> sentence_transformers <span class="token keyword">import</span> SentenceTransformer

<span class="token keyword">class</span> <span class="token class-name">VectorStore</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span><span class="token punctuation">,</span> metadata_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>index_path <span class="token operator">=</span> index_path
        self<span class="token punctuation">.</span>metadata_path <span class="token operator">=</span> metadata_path
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> <span class="token boolean">None</span>
        
    <span class="token keyword">def</span> <span class="token function">initialize_embedding_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialize embedding model (using SentenceTransformer as fallback)"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># Try to use Gemini embeddings</span>
            genai<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>api_key<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> <span class="token string">'gemini'</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token comment"># Fallback to local model</span>
            self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> SentenceTransformer<span class="token punctuation">(</span><span class="token string">'all-MiniLM-L6-v2'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">get_embeddings</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> texts<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Get embeddings for texts"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>embedding_model <span class="token operator">==</span> <span class="token string">'gemini'</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                result <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                    model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                    content<span class="token operator">=</span>texts<span class="token punctuation">,</span>
                    task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
                <span class="token punctuation">)</span>
                <span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                <span class="token comment"># Fallback to local model if Gemini fails</span>
                self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> SentenceTransformer<span class="token punctuation">(</span><span class="token string">'all-MiniLM-L6-v2'</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Use local model</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>texts<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_index</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Create FAISS index from chunks"""</span>
        texts <span class="token operator">=</span> <span class="token punctuation">[</span>chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> chunk <span class="token keyword">in</span> chunks<span class="token punctuation">]</span>
        embeddings <span class="token operator">=</span> self<span class="token punctuation">.</span>get_embeddings<span class="token punctuation">(</span>texts<span class="token punctuation">)</span>
        
        <span class="token comment"># Create FAISS index</span>
        dimension <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>IndexFlatL2<span class="token punctuation">(</span>dimension<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>add<span class="token punctuation">(</span>embeddings<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> chunks
        
        <span class="token comment"># Create storage directory if it doesn't exist</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Save index and metadata</span>
        faiss<span class="token punctuation">.</span>write_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index<span class="token punctuation">,</span> self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">load_index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Load existing index"""</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>read_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Search for similar chunks"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Index not initialized"</span><span class="token punctuation">)</span>
        
        query_embedding <span class="token operator">=</span> self<span class="token punctuation">.</span>get_embeddings<span class="token punctuation">(</span><span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span>
        distances<span class="token punctuation">,</span> indices <span class="token operator">=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>search<span class="token punctuation">(</span>query_embedding<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
        
        results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> idx<span class="token punctuation">,</span> distance <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>indices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> distances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> idx <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">:</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>metadata<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
                result<span class="token punctuation">[</span><span class="token string">'similarity_score'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> distance<span class="token punctuation">)</span><span class="token punctuation">)</span>
                results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> results</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><p class="ds-markdown-paragraph"><strong><span>modules/rag_</span><a href="https://engine.py/" target="_blank" rel="noreferrer"><span>engine.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> google<span class="token punctuation">.</span>generativeai <span class="token keyword">as</span> genai
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">class</span> <span class="token class-name">RAGEngine</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        genai<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>api_key<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>model <span class="token operator">=</span> genai<span class="token punctuation">.</span>GenerativeModel<span class="token punctuation">(</span><span class="token string">'gemini-1.5-flash'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>chat_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">format_context</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> retrieved_chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Format retrieved chunks into context string"""</span>
        context <span class="token operator">=</span> <span class="token string">"Relevant document excerpts:\n\n"</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> chunk <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>retrieved_chunks<span class="token punctuation">)</span><span class="token punctuation">:</span>
            context <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"Excerpt </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string"> (Page </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">): </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">500]</span><span class="token punctuation">}</span></span><span class="token string">...\n"</span></span>
            context <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"Similarity score: </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">[</span><span class="token string">'similarity_score'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string">\n\n"</span></span>
        <span class="token keyword">return</span> context
    
    <span class="token keyword">def</span> <span class="token function">generate_response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> context<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> chat_history<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Dict<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Generate response using RAG"""</span>
        <span class="token comment"># Build conversation history</span>
        history_str <span class="token operator">=</span> <span class="token string">""</span>
        <span class="token keyword">if</span> chat_history<span class="token punctuation">:</span>
            <span class="token keyword">for</span> msg <span class="token keyword">in</span> chat_history<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># Keep last 6 messages for context</span>
                role <span class="token operator">=</span> <span class="token string">"User"</span> <span class="token keyword">if</span> msg<span class="token punctuation">[</span><span class="token string">'role'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'user'</span> <span class="token keyword">else</span> <span class="token string">"Assistant"</span>
                history_str <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>role<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>msg<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span>
        
        prompt <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""
        You are a helpful assistant that answers questions based on the provided document excerpts.
        Always ground your answers in the provided context and cite your sources using page numbers.
        
        </span><span class="token interpolation"><span class="token punctuation">{</span>history_str<span class="token punctuation">}</span></span><span class="token string">
        
        </span><span class="token interpolation"><span class="token punctuation">{</span>context<span class="token punctuation">}</span></span><span class="token string">
        
        Current Question: </span><span class="token interpolation"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token string">
        
        Instructions:
        1. Answer based ONLY on the provided context
        2. If the answer isn't in the context, say "I couldn't find that information in the document"
        3. Cite specific page numbers for your information
        4. Be concise and accurate
        5. If asked about previous conversation, use the chat history provided
        
        Assistant:"""</span></span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            response <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>generate_content<span class="token punctuation">(</span>prompt<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">'answer'</span><span class="token punctuation">:</span> response<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
                <span class="token string">'timestamp'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'sources'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'page'</span><span class="token punctuation">:</span> chunk<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'text'</span><span class="token punctuation">:</span> chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">}</span> 
                           <span class="token keyword">for</span> chunk <span class="token keyword">in</span> retrieved_chunks<span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"Error generating response: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
                <span class="token string">'timestamp'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'sources'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
    
    <span class="token keyword">def</span> <span class="token function">add_to_history</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> role<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> sources<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Add message to chat history"""</span>
        self<span class="token punctuation">.</span>chat_history<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">'role'</span><span class="token punctuation">:</span> role<span class="token punctuation">,</span>
            <span class="token string">'content'</span><span class="token punctuation">:</span> content<span class="token punctuation">,</span>
            <span class="token string">'timestamp'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'sources'</span><span class="token punctuation">:</span> sources <span class="token keyword">or</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">get_history</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Get chat history"""</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>chat_history</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>4. Main Application</span></h3><p class="ds-markdown-paragraph"><strong><a href="https://app.py/" target="_blank" rel="noreferrer"><span>app.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st
<span class="token keyword">import</span> os
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>pdf_processor <span class="token keyword">import</span> PDFProcessor
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>rag_engine <span class="token keyword">import</span> RAGEngine
<span class="token keyword">import</span> json

<span class="token comment"># Load environment variables</span>
load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Initialize components</span>
pdf_processor <span class="token operator">=</span> PDFProcessor<span class="token punctuation">(</span><span class="token punctuation">)</span>
vector_store <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
rag_engine <span class="token operator">=</span> RAGEngine<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">initialize_session_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Initialize session state variables"""</span>
    <span class="token keyword">if</span> <span class="token string">'processed'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">if</span> <span class="token string">'vector_store_loaded'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">if</span> <span class="token string">'messages'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">process_pdf</span><span class="token punctuation">(</span>uploaded_file<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Process uploaded PDF file"""</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> st<span class="token punctuation">.</span>spinner<span class="token punctuation">(</span><span class="token string">"Processing PDF..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            chunks <span class="token operator">=</span> pdf_processor<span class="token punctuation">.</span>process_pdf<span class="token punctuation">(</span>uploaded_file<span class="token punctuation">)</span>
            vector_store<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
            vector_store<span class="token punctuation">.</span>create_index<span class="token punctuation">(</span>chunks<span class="token punctuation">)</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed <span class="token operator">=</span> <span class="token boolean">True</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded <span class="token operator">=</span> <span class="token boolean">True</span>
            st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"PDF processed successfully!"</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error processing PDF: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    st<span class="token punctuation">.</span>set_page_config<span class="token punctuation">(</span>
        page_title<span class="token operator">=</span><span class="token string">"PDF Chatbot"</span><span class="token punctuation">,</span>
        page_icon<span class="token operator">=</span><span class="token string">"📚"</span><span class="token punctuation">,</span>
        layout<span class="token operator">=</span><span class="token string">"wide"</span>
    <span class="token punctuation">)</span>
    
    st<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"📚 PDF Chatbot with Gemini Flash 1.5"</span><span class="token punctuation">)</span>
    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"Upload a PDF and chat with it using AI!"</span><span class="token punctuation">)</span>
    
    initialize_session_state<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Sidebar for PDF upload</span>
    <span class="token keyword">with</span> st<span class="token punctuation">.</span>sidebar<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"📄 Upload PDF"</span><span class="token punctuation">)</span>
        uploaded_file <span class="token operator">=</span> st<span class="token punctuation">.</span>file_uploader<span class="token punctuation">(</span>
            <span class="token string">"Choose a PDF file"</span><span class="token punctuation">,</span> 
            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"pdf"</span><span class="token punctuation">,</span>
            <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Upload any PDF document to start chatting"</span>
        <span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> uploaded_file <span class="token keyword">and</span> <span class="token keyword">not</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed<span class="token punctuation">:</span>
            <span class="token keyword">if</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"Process PDF"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                process_pdf<span class="token punctuation">(</span>uploaded_file<span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"✅ PDF ready for chatting!"</span><span class="token punctuation">)</span>
            
        <span class="token comment"># Display chat history</span>
        st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"💬 Conversation History"</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> msg <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span>msg<span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>msg<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> msg<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"View Sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">for</span> source <span class="token keyword">in</span> msg<span class="token punctuation">[</span><span class="token string">"sources"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Page </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># Main chat area</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded<span class="token punctuation">:</span>
        <span class="token comment"># Try to load existing index</span>
        <span class="token keyword">if</span> vector_store<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded <span class="token operator">=</span> <span class="token boolean">True</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed <span class="token operator">=</span> <span class="token boolean">True</span>
            st<span class="token punctuation">.</span>sidebar<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"Loaded existing PDF index!"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded<span class="token punctuation">:</span>
        <span class="token comment"># Display chat messages</span>
        <span class="token keyword">for</span> message <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">:</span>
            <span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span>message<span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>message<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"Sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">for</span> source <span class="token keyword">in</span> message<span class="token punctuation">[</span><span class="token string">"sources"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Page </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">:** </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Chat input</span>
        <span class="token keyword">if</span> prompt <span class="token operator">:=</span> st<span class="token punctuation">.</span>chat_input<span class="token punctuation">(</span><span class="token string">"Ask a question about the PDF..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># Add user message</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> prompt<span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>prompt<span class="token punctuation">)</span>
            
            <span class="token comment"># Generate response</span>
            <span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span><span class="token string">"assistant"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> st<span class="token punctuation">.</span>spinner<span class="token punctuation">(</span><span class="token string">"Thinking..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token comment"># Search for relevant chunks</span>
                    retrieved_chunks <span class="token operator">=</span> vector_store<span class="token punctuation">.</span>search<span class="token punctuation">(</span>prompt<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
                    
                    <span class="token comment"># Format context</span>
                    context <span class="token operator">=</span> rag_engine<span class="token punctuation">.</span>format_context<span class="token punctuation">(</span>retrieved_chunks<span class="token punctuation">)</span>
                    
                    <span class="token comment"># Generate response</span>
                    response <span class="token operator">=</span> rag_engine<span class="token punctuation">.</span>generate_response<span class="token punctuation">(</span>
                        prompt<span class="token punctuation">,</span> 
                        context<span class="token punctuation">,</span> 
                        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages
                    <span class="token punctuation">)</span>
                    
                    <span class="token comment"># Display response</span>
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    
                    <span class="token comment"># Display sources</span>
                    <span class="token keyword">if</span> response<span class="token punctuation">[</span><span class="token string">'sources'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"Sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            <span class="token keyword">for</span> source <span class="token keyword">in</span> response<span class="token punctuation">[</span><span class="token string">'sources'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Page </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">:** </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
                
                <span class="token comment"># Add to session state</span>
                st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> 
                    <span class="token string">"content"</span><span class="token punctuation">:</span> response<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">"sources"</span><span class="token punctuation">:</span> response<span class="token punctuation">[</span><span class="token string">'sources'</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"👈 Please upload a PDF file to get started!"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>5. Utility Functions</span></h3><p class="ds-markdown-paragraph"><strong><span>utils/</span><a href="https://helpers.py/" target="_blank" rel="noreferrer"><span>helpers.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> json
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict

<span class="token keyword">def</span> <span class="token function">save_test_questions</span><span class="token punctuation">(</span>questions<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">,</span> filename<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"test_questions.json"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Save test questions to JSON file"""</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>questions<span class="token punctuation">,</span> f<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">load_test_questions</span><span class="token punctuation">(</span>filename<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"test_questions.json"</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Load test questions from JSON file"""</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            <span class="token keyword">return</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">except</span> FileNotFoundError<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">calculate_accuracy</span><span class="token punctuation">(</span>test_results<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Calculate accuracy from test results"""</span>
    correct <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">for</span> result <span class="token keyword">in</span> test_results <span class="token keyword">if</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_correct'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    total <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>test_results<span class="token punctuation">)</span>
    <span class="token keyword">return</span> correct <span class="token operator">/</span> total <span class="token keyword">if</span> total <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>6. Evaluation Script</span></h3><p class="ds-markdown-paragraph"><strong><a href="https://evaluate.py/" target="_blank" rel="noreferrer"><span>evaluate.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>rag_engine <span class="token keyword">import</span> RAGEngine
<span class="token keyword">from</span> utils<span class="token punctuation">.</span>helpers <span class="token keyword">import</span> load_test_questions<span class="token punctuation">,</span> calculate_accuracy
<span class="token keyword">import</span> json

<span class="token keyword">def</span> <span class="token function">run_evaluation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    st<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"🧪 PDF Chatbot Evaluation"</span><span class="token punctuation">)</span>
    
    vector_store <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
    rag_engine <span class="token operator">=</span> RAGEngine<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token keyword">not</span> vector_store<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"No PDF index found. Please process a PDF first."</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    
    <span class="token comment"># Load test questions</span>
    test_questions <span class="token operator">=</span> load_test_questions<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token keyword">not</span> test_questions<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"No test questions found. Add some questions in test_questions.json"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    
    results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> question_data <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>test_questions<span class="token punctuation">)</span><span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Question </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">:** </span><span class="token interpolation"><span class="token punctuation">{</span>question_data<span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"*Expected Answer:* </span><span class="token interpolation"><span class="token punctuation">{</span>question_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'expected_answer'</span><span class="token punctuation">,</span> <span class="token string">'N/A'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Generate response</span>
        retrieved_chunks <span class="token operator">=</span> vector_store<span class="token punctuation">.</span>search<span class="token punctuation">(</span>question_data<span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
        context <span class="token operator">=</span> rag_engine<span class="token punctuation">.</span>format_context<span class="token punctuation">(</span>retrieved_chunks<span class="token punctuation">)</span>
        response <span class="token operator">=</span> rag_engine<span class="token punctuation">.</span>generate_response<span class="token punctuation">(</span>question_data<span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>
        
        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Generated Answer:** </span><span class="token interpolation"><span class="token punctuation">{</span>response<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Manual evaluation</span>
        is_correct <span class="token operator">=</span> st<span class="token punctuation">.</span>radio<span class="token punctuation">(</span>
            <span class="token string-interpolation"><span class="token string">f"Is answer </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string"> correct?"</span></span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token string">"Yes"</span><span class="token punctuation">,</span> <span class="token string">"No"</span><span class="token punctuation">,</span> <span class="token string">"Partial"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            key<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"eval_</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">"</span></span>
        <span class="token punctuation">)</span>
        
        results<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">'question'</span><span class="token punctuation">:</span> question_data<span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'expected'</span><span class="token punctuation">:</span> question_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'expected_answer'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'actual'</span><span class="token punctuation">:</span> response<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'is_correct'</span><span class="token punctuation">:</span> is_correct <span class="token operator">==</span> <span class="token string">"Yes"</span><span class="token punctuation">,</span>
            <span class="token string">'is_partial'</span><span class="token punctuation">:</span> is_correct <span class="token operator">==</span> <span class="token string">"Partial"</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"Calculate Accuracy"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        accuracy <span class="token operator">=</span> calculate_accuracy<span class="token punctuation">(</span>results<span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Accuracy: </span><span class="token interpolation"><span class="token punctuation">{</span>accuracy<span class="token punctuation">:</span><span class="token format-spec">.2%</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Show detailed results</span>
        <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"Detailed Results"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Q:** </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**A:** </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'actual'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Correct:** </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'is_correct'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"---"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    run_evaluation<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>7. </span><a href="https://readme.md/" target="_blank" rel="noreferrer"><span>README.md</span></a></h3><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">markdown</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token title important"><span class="token punctuation">#</span> PDF Chatbot with Gemini Flash 1.5</span>

A Streamlit application that allows users to upload PDF documents and chat with them using Google's Gemini Flash 1.5 model.

<span class="token title important"><span class="token punctuation">##</span> Features</span>

<span class="token list punctuation">-</span> 📄 PDF upload and text extraction
<span class="token list punctuation">-</span> 🔍 Semantic search using FAISS vector database
<span class="token list punctuation">-</span> 💬 Conversational AI with chat history
<span class="token list punctuation">-</span> 📑 Source citations with page numbers
<span class="token list punctuation">-</span> 🧪 Evaluation framework for testing

<span class="token title important"><span class="token punctuation">##</span> Setup</span>

<span class="token list punctuation">1.</span> <span class="token bold"><span class="token punctuation">**</span><span class="token content">Install dependencies:</span><span class="token punctuation">**</span></span>
   ```bash
   pip install -r requirements.txt</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><ol start="2"><li><p class="ds-markdown-paragraph"><strong><span>Set up environment variables:</span></strong><span></span><br><span>Create a </span><code>.env</code><span> file:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">env</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>GEMINI_API_KEY=your_gemini_api_key_here</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>Run the application:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>streamlit run app.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li></ol><h2><span>Usage</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><span>Upload a PDF file using the sidebar</span></p></li><li><p class="ds-markdown-paragraph"><span>Click "Process PDF" to extract and index the content</span></p></li><li><p class="ds-markdown-paragraph"><span>Start asking questions in the chat interface</span></p></li><li><p class="ds-markdown-paragraph"><span>View sources by expanding the "Sources" section</span></p></li></ol><h2><span>Architecture</span></h2><h3><span>Components</span></h3><ul><li><p class="ds-markdown-paragraph"><strong><span>PDF Processor</span></strong><span>: Extracts text and chunks documents</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Vector Store</span></strong><span>: FAISS-based semantic search with Gemini embeddings</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>RAG Engine</span></strong><span>: Gemini Flash 1.5 with context-aware prompting</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Streamlit UI</span></strong><span>: Interactive web interface</span></p></li></ul><h3><span>Chunking Strategy</span></h3><ul><li><p class="ds-markdown-paragraph"><span>Chunk size: 1000 words</span></p></li><li><p class="ds-markdown-paragraph"><span>Overlap: 200 words</span></p></li><li><p class="ds-markdown-paragraph"><span>Preserves page metadata for citations</span></p></li></ul><h3><span>Models Used</span></h3><ul><li><p class="ds-markdown-paragraph"><strong><span>Embeddings</span></strong><span>: Gemini Embedding-001 (fallback to SentenceTransformer)</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>LLM</span></strong><span>: Gemini Flash 1.5</span></p></li></ul><h2><span>Evaluation</span></h2><p class="ds-markdown-paragraph"><span>To run evaluation:</span></p><ol start="1"><li><p class="ds-markdown-paragraph"><span>Add test questions to </span><code>test_questions.json</code></p></li><li><p class="ds-markdown-paragraph"><span>Run: </span><code>streamlit run evaluate.py</code></p></li></ol><h2><span>Known Limitations</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><span>Large PDFs may take time to process</span></p></li><li><p class="ds-markdown-paragraph"><span>Complex layouts may affect text extraction</span></p></li><li><p class="ds-markdown-paragraph"><span>Gemini API rate limits may apply</span></p></li><li><p class="ds-markdown-paragraph"><span>FAISS index size grows with document size</span></p></li></ol><h2><span>Conversation History</span></h2><p class="ds-markdown-paragraph"><span>Chat history is maintained in the session state and includes:</span></p><ul><li><p class="ds-markdown-paragraph"><span>User questions</span></p></li><li><p class="ds-markdown-paragraph"><span>AI responses</span></p></li><li><p class="ds-markdown-paragraph"><span>Source citations</span></p></li><li><p class="ds-markdown-paragraph"><span>Timestamps</span></p></li></ul><p class="ds-markdown-paragraph"><span>Last 6 messages are used as context for follow-up questions.</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">text</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>
### 8. Test Questions

**test_questions.json**
```json
[
  {
    "question": "What is the main topic of this document?",
    "expected_answer": "The document discusses artificial intelligence and machine learning applications."
  },
  {
    "question": "On which pages is machine learning mentioned?",
    "expected_answer": "Machine learning is discussed on pages 3, 5, and 7-9."
  },
  {
    "question": "What are the key findings of the research?",
    "expected_answer": "The research found that AI systems can improve efficiency by 40% in certain tasks."
  }
]</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Running the Application</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>Install dependencies:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>pip <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>Set your Gemini API key in </span><code>.env</code></strong></p></li><li><p class="ds-markdown-paragraph"><strong><span>Run the app:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>streamlit run app.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li></ol><h2><span>Key Features Implemented</span></h2><p class="ds-markdown-paragraph"><span>✅ </span><strong><span>Streamlit UI</span></strong><span> with PDF upload and chat interface</span><br><span>✅ </span><strong><span>PDF Processing</span></strong><span> with sensible chunking strategy</span><br><span>✅ </span><strong><span>FAISS Vector Store</span></strong><span> with Gemini embeddings</span><br><span>✅ </span><strong><span>RAG System</span></strong><span> with proper citations</span><br><span>✅ </span><strong><span>Conversation History</span></strong><span> persistence</span><br><span>✅ </span><strong><span>Local Execution</span></strong><span> capability</span><br><span>✅ </span><strong><span>Modular Code</span></strong><span> structure</span><br><span>✅ </span><strong><span>Basic Evaluation</span></strong><span> framework</span></p><p class="ds-markdown-paragraph"><span>This implementation provides a robust foundation for a PDF chatbot that meets all the requirements specified in the assignment, with special consideration for Windows compatibility and using the Gemini Flash 1.5 API.</span></p></div></div><div class="ds-theme" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE;"></div><div class="ds-flex _0a3d93b" style="align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 10px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92142 0.349213C10.3745 0.349295 12.5564 1.50526 13.9558 3.299L15.1282 2.12765C15.3304 1.92552 15.6768 2.06949 15.6768 2.35544V5.53929C15.6766 5.71632 15.533 5.85982 15.356 5.86008H12.1711C11.8855 5.85976 11.7427 5.51471 11.9443 5.31255L12.9642 4.29062C11.8238 2.74311 9.98914 1.74112 7.92142 1.74104C4.46442 1.74104 1.66239 4.54307 1.66239 8.00006C1.66239 11.4571 4.46442 14.2591 7.92142 14.2591C11.3783 14.2589 14.1804 11.457 14.1804 8.00006H15.5723C15.5723 12.2252 12.1465 15.6508 7.92142 15.6509C3.6962 15.6509 0.270569 12.2253 0.270569 8.00006C0.270569 3.77485 3.6962 0.349213 7.92142 0.349213Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.27861 0.811633C8.81985 0.142255 9.79016 0.0422445 10.4537 0.557662L10.5823 0.669367L10.6065 0.693605L10.6097 0.695713L10.6392 0.72522C11.3549 1.44685 11.6336 2.49474 11.3716 3.47675L11.3705 3.48097L11.361 3.5168L11.36 3.51891L10.8889 5.2261C10.8796 5.26003 10.8706 5.29164 10.8626 5.32094C10.8934 5.32101 10.927 5.322 10.9627 5.322H11.9006C12.4263 5.322 12.783 5.31906 13.0651 5.36731C14.8182 5.66725 15.9851 7.34574 15.6564 9.09363C15.6035 9.37493 15.4769 9.70926 15.2939 10.2023L14.337 12.7799C14.1401 13.3105 13.9773 13.7518 13.8101 14.1025C13.6375 14.4646 13.4385 14.7794 13.1441 15.0425C12.9712 15.197 12.7801 15.3303 12.5751 15.4387C12.2259 15.6232 11.8608 15.7 11.4612 15.7359C11.0742 15.7705 10.6034 15.7696 10.0374 15.7696H4.87371C4.08047 15.7696 3.42922 15.7703 2.90728 15.7138C2.37206 15.6558 1.88985 15.5311 1.4667 15.2237C1.22409 15.0475 1.01072 14.834 0.834405 14.5914C0.52696 14.1683 0.401312 13.6861 0.343323 13.1509C0.286761 12.6288 0.28747 11.977 0.28747 11.1834V9.51411C0.28747 8.84785 0.281286 8.36721 0.399176 7.95656C0.671091 7.00941 1.41109 6.26838 2.35823 5.99645C2.76888 5.87855 3.24952 5.88579 3.91579 5.88579C4.11977 5.88579 4.14542 5.88325 4.16238 5.88053C4.23526 5.8687 4.30403 5.83669 4.35839 5.78674C4.37104 5.77511 4.38755 5.7561 4.51436 5.59494L8.25648 0.839033L8.25754 0.837979L8.27861 0.811633ZM1.69116 11.1834C1.69116 12.0083 1.69211 12.5712 1.73859 13.0002C1.78365 13.4158 1.86467 13.6222 1.96937 13.7663C2.05914 13.8898 2.16727 13.999 2.29079 14.0888C2.43495 14.1935 2.6421 14.2745 3.05797 14.3195C3.45891 14.363 3.97631 14.3656 4.71564 14.3659C4.30795 13.8053 4.06447 13.1172 4.06437 12.371V8.59412H5.46807V12.371C5.46832 13.4734 6.3616 14.367 7.46401 14.367H10.0374C10.6286 14.367 11.0269 14.3663 11.3368 14.3385C11.6339 14.3118 11.7956 14.2639 11.9196 14.1984C12.024 14.1431 12.1213 14.0747 12.2094 13.996C12.3139 13.9025 12.4151 13.7679 12.5434 13.4986C12.6774 13.2177 12.8162 12.8451 13.0219 12.2909L13.9787 9.71328C14.1848 9.15822 14.253 8.96737 14.278 8.83439C14.4617 7.85698 13.8092 6.91901 12.829 6.75098C12.6956 6.72816 12.4928 6.72464 11.9006 6.72464H10.9627C10.7737 6.72464 10.5693 6.72663 10.4 6.70672C10.2211 6.68568 9.96696 6.6303 9.74764 6.43167C9.64448 6.33817 9.5595 6.22616 9.49683 6.10183C9.36384 5.8379 9.37793 5.57905 9.40515 5.40104C9.43094 5.23267 9.48666 5.03623 9.53688 4.8541L10.0079 3.14585L10.0174 3.11108C10.1488 2.61344 10.0077 2.08344 9.64648 1.71687L9.60854 1.67893L9.55058 1.6431C9.48789 1.62049 9.41419 1.6382 9.36932 1.69368L9.35773 1.70633L9.35878 1.70738L5.61666 6.46224C5.51816 6.58741 5.42231 6.71336 5.30683 6.81948C5.05069 7.05477 4.73119 7.20945 4.3879 7.26525C4.23309 7.29038 4.07507 7.28843 3.91579 7.28843C3.1535 7.28843 2.9191 7.29576 2.74604 7.34534C2.26358 7.48385 1.88558 7.86087 1.74702 8.34331C1.69732 8.51642 1.69116 8.75116 1.69116 9.51411V11.1834Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.72451 15.1086C7.18929 15.7706 6.22975 15.8695 5.57357 15.3598L5.44643 15.2493L5.42247 15.2253L5.41934 15.2233L5.39016 15.1941C4.68239 14.4805 4.40679 13.4442 4.66589 12.4731L4.66693 12.4689L4.67631 12.4335L4.67735 12.4314L5.14318 10.7432C5.15243 10.7096 5.1613 10.6784 5.16923 10.6494C5.13878 10.6493 5.10558 10.6484 5.07023 10.6484H4.14274C3.62288 10.6484 3.27015 10.6513 2.9912 10.6035C1.25757 10.3069 0.103662 8.64709 0.42863 6.91861C0.480965 6.64044 0.606164 6.30981 0.787119 5.8223L1.73336 3.27328C1.92812 2.74859 2.08912 2.31215 2.25442 1.96542C2.42515 1.60731 2.62191 1.296 2.91304 1.03584C3.08408 0.883016 3.273 0.751185 3.47579 0.644009C3.82102 0.461569 4.18214 0.385575 4.57731 0.350131C4.95993 0.315849 5.42553 0.316783 5.98521 0.316783H11.0916C11.876 0.316783 12.52 0.316134 13.0362 0.372015C13.5655 0.429358 14.0423 0.552599 14.4608 0.856601C14.7007 1.03091 14.9117 1.24199 15.086 1.48187C15.3901 1.90033 15.5143 2.37716 15.5717 2.90645C15.6276 3.42275 15.6269 4.06727 15.6269 4.85209V6.5028C15.6269 7.16167 15.633 7.63697 15.5164 8.04306C15.2475 8.97969 14.5158 9.71248 13.5791 9.9814C13.173 10.098 12.6977 10.0908 12.0389 10.0908C11.8372 10.0908 11.8118 10.0933 11.795 10.096C11.723 10.1077 11.6549 10.1394 11.6012 10.1888C11.5887 10.2003 11.5724 10.2191 11.447 10.3784L7.74639 15.0815L7.74535 15.0826L7.72451 15.1086ZM14.2388 4.85209C14.2388 4.03635 14.2379 3.47971 14.1919 3.05547C14.1473 2.64449 14.0672 2.44037 13.9637 2.29785C13.8749 2.17569 13.768 2.06776 13.6458 1.97896C13.5033 1.87539 13.2984 1.7953 12.8872 1.75074C12.4907 1.70779 11.979 1.70518 11.2479 1.70489C11.6511 2.25924 11.8918 2.93974 11.8919 3.67762V7.41257H10.5038V3.67762C10.5036 2.58751 9.62023 1.70384 8.53007 1.70384H5.98521C5.40065 1.70384 5.00679 1.70449 4.70028 1.73198C4.40651 1.75836 4.24662 1.80577 4.12399 1.87058C4.02069 1.92518 3.92452 1.99283 3.8374 2.07067C3.73401 2.16312 3.634 2.29627 3.50705 2.56255C3.37462 2.84034 3.23734 3.2088 3.03393 3.75682L2.08768 6.30584C1.88395 6.85474 1.81646 7.04347 1.79172 7.17497C1.61005 8.14152 2.25533 9.06908 3.22464 9.23524C3.35654 9.25781 3.55717 9.26129 4.14274 9.26129H5.07023C5.25717 9.26129 5.4593 9.25932 5.62672 9.27901C5.80364 9.29982 6.05492 9.35458 6.27179 9.551C6.37381 9.64347 6.45784 9.75424 6.51982 9.87719C6.65133 10.1382 6.6374 10.3942 6.61048 10.5702C6.58498 10.7367 6.52988 10.931 6.48022 11.1111L6.01439 12.8003L6.00501 12.8347C5.87513 13.3268 6.01464 13.8509 6.37184 14.2134L6.40935 14.251L6.46667 14.2864C6.52866 14.3088 6.60155 14.2912 6.64591 14.2364L6.65738 14.2239L6.65633 14.2228L10.3569 9.52078C10.4543 9.397 10.5491 9.27245 10.6633 9.1675C10.9166 8.93483 11.2325 8.78186 11.572 8.72669C11.7251 8.70184 11.8814 8.70376 12.0389 8.70376C12.7927 8.70376 13.0245 8.69651 13.1956 8.64748C13.6727 8.51051 14.0465 8.13768 14.1836 7.6606C14.2327 7.48941 14.2388 7.25727 14.2388 6.5028V4.85209Z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="fbb737a4">ImportError: cannot import name 'cached_download' from 'huggingface_hub' (D:\ML_Projects\pdf-chatbot\pcvenv\Lib\site-packages\huggingface_hub\__init__.py)</div></div><div class="_11d6b3a"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5" style="--assistant-last-margin-bottom: 32px;"><div class="ds-message _656c965"><div class="_7d763a7 _45cdda5" style="--deep-search-title-height: 38px; --group-title-sticky-top: 0px;"><div class="_68f84dc"></div><div class="ddd2f74b"></div></div><div class="ds-markdown" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph"><span>This error occurs because the </span><code>cached_download</code><span> function has been deprecated and removed from recent versions of </span><code>huggingface_hub</code><span>. Let me fix the code to use the modern alternative.</span></p><h2><span>Updated Code</span></h2><h3><span>1. Update requirements.txt</span></h3><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">txt</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>streamlit==1.35.0
google-generativeai==0.3.2
faiss-cpu==1.7.4
PyPDF2==3.0.1
python-dotenv==1.0.1
sentence-transformers==2.2.2
numpy==1.24.3
chromadb==0.4.24
huggingface-hub==0.22.2</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>2. Update modules/vector_</span><a href="https://store.py/" target="_blank" rel="noreferrer"><span>store.py</span></a></h3><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> faiss
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict
<span class="token keyword">import</span> google<span class="token punctuation">.</span>generativeai <span class="token keyword">as</span> genai
<span class="token keyword">from</span> sentence_transformers <span class="token keyword">import</span> SentenceTransformer

<span class="token keyword">class</span> <span class="token class-name">VectorStore</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span><span class="token punctuation">,</span> metadata_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>index_path <span class="token operator">=</span> index_path
        self<span class="token punctuation">.</span>metadata_path <span class="token operator">=</span> metadata_path
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> <span class="token number">384</span>  <span class="token comment"># Default for fallback model</span>
        
    <span class="token keyword">def</span> <span class="token function">initialize_embedding_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialize embedding model"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># Try to use Gemini embeddings</span>
            genai<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>api_key<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> <span class="token string">'gemini'</span>
            <span class="token comment"># Test the API key</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                test_embedding <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                    model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                    content<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"test"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
                <span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>test_embedding<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Using Gemini embeddings with dimension </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Gemini API failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">, falling back to local model"</span></span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Gemini configuration failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">, using local model"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">_initialize_local_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialize local embedding model as fallback"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> SentenceTransformer<span class="token punctuation">(</span><span class="token string">'all-MiniLM-L6-v2'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">.</span>get_sentence_embedding_dimension<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Using local SentenceTransformer with dimension </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Failed to initialize local model: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">raise</span>
    
    <span class="token keyword">def</span> <span class="token function">get_embeddings</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> texts<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Get embeddings for texts"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>embedding_model <span class="token operator">==</span> <span class="token string">'gemini'</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                result <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                    model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                    content<span class="token operator">=</span>texts<span class="token punctuation">,</span>
                    task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
                <span class="token punctuation">)</span>
                embeddings <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
                <span class="token comment"># Ensure correct shape: (n_texts, embedding_dim)</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    embeddings <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token keyword">and</span> embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    embeddings <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">)</span>
                <span class="token keyword">return</span> embeddings
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Gemini embedding failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">, switching to local model"</span></span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Use local model</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">,</span> SentenceTransformer<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>texts<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No valid embedding model available"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_index</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Create FAISS index from chunks"""</span>
        texts <span class="token operator">=</span> <span class="token punctuation">[</span>chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> chunk <span class="token keyword">in</span> chunks<span class="token punctuation">]</span>
        
        <span class="token comment"># Initialize embedding model if not done</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>embedding_model <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        embeddings <span class="token operator">=</span> self<span class="token punctuation">.</span>get_embeddings<span class="token punctuation">(</span>texts<span class="token punctuation">)</span>
        
        <span class="token comment"># Create FAISS index</span>
        dimension <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>IndexFlatL2<span class="token punctuation">(</span>dimension<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>add<span class="token punctuation">(</span>embeddings<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> chunks
        
        <span class="token comment"># Create storage directory if it doesn't exist</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Save index and metadata</span>
        faiss<span class="token punctuation">.</span>write_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index<span class="token punctuation">,</span> self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span> f<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">load_index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Load existing index"""</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>read_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
                
                <span class="token comment"># Initialize embedding model for new searches</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>embedding_model <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
                
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Search for similar chunks"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> self<span class="token punctuation">.</span>embedding_model <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Index or embedding model not initialized"</span><span class="token punctuation">)</span>
        
        query_embedding <span class="token operator">=</span> self<span class="token punctuation">.</span>get_embeddings<span class="token punctuation">(</span><span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Ensure k doesn't exceed number of vectors</span>
        k <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">)</span>
        
        distances<span class="token punctuation">,</span> indices <span class="token operator">=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>search<span class="token punctuation">(</span>query_embedding<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
        
        results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> idx<span class="token punctuation">,</span> distance <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>indices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> distances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> idx <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">:</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>metadata<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
                result<span class="token punctuation">[</span><span class="token string">'similarity_score'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> distance<span class="token punctuation">)</span><span class="token punctuation">)</span>
                results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        
        <span class="token comment"># Sort by similarity score (descending)</span>
        results<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token string">'similarity_score'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> results</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>3. Alternative: Simplified Vector Store without huggingface_hub</span></h3><p class="ds-markdown-paragraph"><span>If you prefer to completely avoid the huggingface_hub dependency, here's an even simpler version:</span></p><p class="ds-markdown-paragraph"><strong><span>modules/simple_vector_</span><a href="https://store.py/" target="_blank" rel="noreferrer"><span>store.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> faiss
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict
<span class="token keyword">import</span> google<span class="token punctuation">.</span>generativeai <span class="token keyword">as</span> genai

<span class="token keyword">class</span> <span class="token class-name">SimpleVectorStore</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span><span class="token punctuation">,</span> metadata_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>index_path <span class="token operator">=</span> index_path
        self<span class="token punctuation">.</span>metadata_path <span class="token operator">=</span> metadata_path
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
    <span class="token keyword">def</span> <span class="token function">initialize_embedding_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialize Gemini embedding model"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            genai<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>api_key<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment"># Test the API</span>
            test_embedding <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                content<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"test"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
            <span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Gemini embeddings initialized successfully"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Failed to initialize Gemini: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">get_embeddings</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> texts<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Get embeddings using Gemini"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            result <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                content<span class="token operator">=</span>texts<span class="token punctuation">,</span>
                task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
            <span class="token punctuation">)</span>
            embeddings <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
            
            <span class="token comment"># Reshape if necessary</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                embeddings <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> embeddings
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Embedding generation failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_index</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Create FAISS index from chunks"""</span>
        texts <span class="token operator">=</span> <span class="token punctuation">[</span>chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> chunk <span class="token keyword">in</span> chunks<span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Gemini API not available. Please check your API key."</span><span class="token punctuation">)</span>
        
        embeddings <span class="token operator">=</span> self<span class="token punctuation">.</span>get_embeddings<span class="token punctuation">(</span>texts<span class="token punctuation">)</span>
        
        <span class="token comment"># Create FAISS index</span>
        dimension <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>IndexFlatL2<span class="token punctuation">(</span>dimension<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>add<span class="token punctuation">(</span>embeddings<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> chunks
        
        <span class="token comment"># Create storage directory</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Save index and metadata</span>
        faiss<span class="token punctuation">.</span>write_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index<span class="token punctuation">,</span> self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span> f<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">load_index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Load existing index"""</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>read_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Search for similar chunks"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Index not initialized"</span><span class="token punctuation">)</span>
        
        query_embedding <span class="token operator">=</span> self<span class="token punctuation">.</span>get_embeddings<span class="token punctuation">(</span><span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span>
        k <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">)</span>
        
        distances<span class="token punctuation">,</span> indices <span class="token operator">=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>search<span class="token punctuation">(</span>query_embedding<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
        
        results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> idx<span class="token punctuation">,</span> distance <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>indices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> distances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> idx <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">:</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>metadata<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
                result<span class="token punctuation">[</span><span class="token string">'similarity_score'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> distance<span class="token punctuation">)</span><span class="token punctuation">)</span>
                results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        
        results<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token string">'similarity_score'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> results</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>4. Update </span><a href="https://app.py/" target="_blank" rel="noreferrer"><span>app.py</span></a><span> to use the simple version</span></h3><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st
<span class="token keyword">import</span> os
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>pdf_processor <span class="token keyword">import</span> PDFProcessor
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>simple_vector_store <span class="token keyword">import</span> SimpleVectorStore  <span class="token comment"># Changed import</span>
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>rag_engine <span class="token keyword">import</span> RAGEngine
<span class="token keyword">import</span> json

<span class="token comment"># Load environment variables</span>
load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Initialize components</span>
pdf_processor <span class="token operator">=</span> PDFProcessor<span class="token punctuation">(</span><span class="token punctuation">)</span>
vector_store <span class="token operator">=</span> SimpleVectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Use simple version</span>
rag_engine <span class="token operator">=</span> RAGEngine<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># ... rest of the app.py code remains the same ...</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>5. Alternative: Pure FAISS with Random Embeddings (for testing)</span></h3><p class="ds-markdown-paragraph"><span>If you want to test without any API dependencies:</span></p><p class="ds-markdown-paragraph"><strong><span>modules/test_vector_</span><a href="https://store.py/" target="_blank" rel="noreferrer"><span>store.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> faiss
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict

<span class="token keyword">class</span> <span class="token class-name">TestVectorStore</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span><span class="token punctuation">,</span> metadata_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>index_path <span class="token operator">=</span> index_path
        self<span class="token punctuation">.</span>metadata_path <span class="token operator">=</span> metadata_path
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> <span class="token number">384</span>
        
    <span class="token keyword">def</span> <span class="token function">get_embeddings</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> texts<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Generate random embeddings for testing"""</span>
        <span class="token keyword">return</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>texts<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_index</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Create FAISS index with random embeddings"""</span>
        texts <span class="token operator">=</span> <span class="token punctuation">[</span>chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> chunk <span class="token keyword">in</span> chunks<span class="token punctuation">]</span>
        embeddings <span class="token operator">=</span> self<span class="token punctuation">.</span>get_embeddings<span class="token punctuation">(</span>texts<span class="token punctuation">)</span>
        
        <span class="token comment"># Create FAISS index</span>
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>IndexFlatL2<span class="token punctuation">(</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>add<span class="token punctuation">(</span>embeddings<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> chunks
        
        <span class="token comment"># Create storage directory</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Save index and metadata</span>
        faiss<span class="token punctuation">.</span>write_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index<span class="token punctuation">,</span> self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span> f<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">load_index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Load existing index"""</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>read_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Random search for testing"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>metadata<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token comment"># Return random chunks for testing</span>
        <span class="token keyword">import</span> random
        k <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">)</span>
        random_chunks <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
        
        <span class="token keyword">for</span> chunk <span class="token keyword">in</span> random_chunks<span class="token punctuation">:</span>
            chunk<span class="token punctuation">[</span><span class="token string">'similarity_score'</span><span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> random_chunks</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Installation and Testing</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>Create a new virtual environment:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>python <span class="token parameter variable">-m</span> venv pcvenv
pcvenv<span class="token punctuation">\</span>Scripts<span class="token punctuation">\</span>activate</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>Install the updated requirements:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>pip <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>Set your Gemini API key in </span><code>.env</code><span>:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">env</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>GEMINI_API_KEY=your_actual_api_key_here</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>Run the application:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>streamlit run app.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li></ol><h2><span>Key Changes Made</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>Removed huggingface_hub dependency</span></strong><span> by using either:</span></p><ul><li><p class="ds-markdown-paragraph"><span>Gemini embeddings directly</span></p></li><li><p class="ds-markdown-paragraph"><span>Local SentenceTransformer without hub dependency</span></p></li><li><p class="ds-markdown-paragraph"><span>Simple test version with random embeddings</span></p></li></ul></li><li><p class="ds-markdown-paragraph"><strong><span>Improved error handling</span></strong><span> for embedding generation</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Added proper shape handling</span></strong><span> for embeddings</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Provided alternative implementations</span></strong><span> for different scenarios</span></p></li></ol><p class="ds-markdown-paragraph"><span>The application should now run without the </span><code>cached_download</code><span> import error. Choose the vector store implementation that best fits your needs:</span></p><ul><li><p class="ds-markdown-paragraph"><strong><span>SimpleVectorStore</span></strong><span>: Uses only Gemini API (recommended if you have API key)</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>VectorStore</span></strong><span>: Uses Gemini with fallback to local model</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>TestVectorStore</span></strong><span>: No external dependencies, good for testing</span></p></li></ul><p class="ds-markdown-paragraph"><span>Let me know if you encounter any other issues!</span></p></div></div><div class="ds-theme" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE;"></div><div class="ds-flex _0a3d93b" style="align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 10px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92142 0.349213C10.3745 0.349295 12.5564 1.50526 13.9558 3.299L15.1282 2.12765C15.3304 1.92552 15.6768 2.06949 15.6768 2.35544V5.53929C15.6766 5.71632 15.533 5.85982 15.356 5.86008H12.1711C11.8855 5.85976 11.7427 5.51471 11.9443 5.31255L12.9642 4.29062C11.8238 2.74311 9.98914 1.74112 7.92142 1.74104C4.46442 1.74104 1.66239 4.54307 1.66239 8.00006C1.66239 11.4571 4.46442 14.2591 7.92142 14.2591C11.3783 14.2589 14.1804 11.457 14.1804 8.00006H15.5723C15.5723 12.2252 12.1465 15.6508 7.92142 15.6509C3.6962 15.6509 0.270569 12.2253 0.270569 8.00006C0.270569 3.77485 3.6962 0.349213 7.92142 0.349213Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.27861 0.811633C8.81985 0.142255 9.79016 0.0422445 10.4537 0.557662L10.5823 0.669367L10.6065 0.693605L10.6097 0.695713L10.6392 0.72522C11.3549 1.44685 11.6336 2.49474 11.3716 3.47675L11.3705 3.48097L11.361 3.5168L11.36 3.51891L10.8889 5.2261C10.8796 5.26003 10.8706 5.29164 10.8626 5.32094C10.8934 5.32101 10.927 5.322 10.9627 5.322H11.9006C12.4263 5.322 12.783 5.31906 13.0651 5.36731C14.8182 5.66725 15.9851 7.34574 15.6564 9.09363C15.6035 9.37493 15.4769 9.70926 15.2939 10.2023L14.337 12.7799C14.1401 13.3105 13.9773 13.7518 13.8101 14.1025C13.6375 14.4646 13.4385 14.7794 13.1441 15.0425C12.9712 15.197 12.7801 15.3303 12.5751 15.4387C12.2259 15.6232 11.8608 15.7 11.4612 15.7359C11.0742 15.7705 10.6034 15.7696 10.0374 15.7696H4.87371C4.08047 15.7696 3.42922 15.7703 2.90728 15.7138C2.37206 15.6558 1.88985 15.5311 1.4667 15.2237C1.22409 15.0475 1.01072 14.834 0.834405 14.5914C0.52696 14.1683 0.401312 13.6861 0.343323 13.1509C0.286761 12.6288 0.28747 11.977 0.28747 11.1834V9.51411C0.28747 8.84785 0.281286 8.36721 0.399176 7.95656C0.671091 7.00941 1.41109 6.26838 2.35823 5.99645C2.76888 5.87855 3.24952 5.88579 3.91579 5.88579C4.11977 5.88579 4.14542 5.88325 4.16238 5.88053C4.23526 5.8687 4.30403 5.83669 4.35839 5.78674C4.37104 5.77511 4.38755 5.7561 4.51436 5.59494L8.25648 0.839033L8.25754 0.837979L8.27861 0.811633ZM1.69116 11.1834C1.69116 12.0083 1.69211 12.5712 1.73859 13.0002C1.78365 13.4158 1.86467 13.6222 1.96937 13.7663C2.05914 13.8898 2.16727 13.999 2.29079 14.0888C2.43495 14.1935 2.6421 14.2745 3.05797 14.3195C3.45891 14.363 3.97631 14.3656 4.71564 14.3659C4.30795 13.8053 4.06447 13.1172 4.06437 12.371V8.59412H5.46807V12.371C5.46832 13.4734 6.3616 14.367 7.46401 14.367H10.0374C10.6286 14.367 11.0269 14.3663 11.3368 14.3385C11.6339 14.3118 11.7956 14.2639 11.9196 14.1984C12.024 14.1431 12.1213 14.0747 12.2094 13.996C12.3139 13.9025 12.4151 13.7679 12.5434 13.4986C12.6774 13.2177 12.8162 12.8451 13.0219 12.2909L13.9787 9.71328C14.1848 9.15822 14.253 8.96737 14.278 8.83439C14.4617 7.85698 13.8092 6.91901 12.829 6.75098C12.6956 6.72816 12.4928 6.72464 11.9006 6.72464H10.9627C10.7737 6.72464 10.5693 6.72663 10.4 6.70672C10.2211 6.68568 9.96696 6.6303 9.74764 6.43167C9.64448 6.33817 9.5595 6.22616 9.49683 6.10183C9.36384 5.8379 9.37793 5.57905 9.40515 5.40104C9.43094 5.23267 9.48666 5.03623 9.53688 4.8541L10.0079 3.14585L10.0174 3.11108C10.1488 2.61344 10.0077 2.08344 9.64648 1.71687L9.60854 1.67893L9.55058 1.6431C9.48789 1.62049 9.41419 1.6382 9.36932 1.69368L9.35773 1.70633L9.35878 1.70738L5.61666 6.46224C5.51816 6.58741 5.42231 6.71336 5.30683 6.81948C5.05069 7.05477 4.73119 7.20945 4.3879 7.26525C4.23309 7.29038 4.07507 7.28843 3.91579 7.28843C3.1535 7.28843 2.9191 7.29576 2.74604 7.34534C2.26358 7.48385 1.88558 7.86087 1.74702 8.34331C1.69732 8.51642 1.69116 8.75116 1.69116 9.51411V11.1834Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.72451 15.1086C7.18929 15.7706 6.22975 15.8695 5.57357 15.3598L5.44643 15.2493L5.42247 15.2253L5.41934 15.2233L5.39016 15.1941C4.68239 14.4805 4.40679 13.4442 4.66589 12.4731L4.66693 12.4689L4.67631 12.4335L4.67735 12.4314L5.14318 10.7432C5.15243 10.7096 5.1613 10.6784 5.16923 10.6494C5.13878 10.6493 5.10558 10.6484 5.07023 10.6484H4.14274C3.62288 10.6484 3.27015 10.6513 2.9912 10.6035C1.25757 10.3069 0.103662 8.64709 0.42863 6.91861C0.480965 6.64044 0.606164 6.30981 0.787119 5.8223L1.73336 3.27328C1.92812 2.74859 2.08912 2.31215 2.25442 1.96542C2.42515 1.60731 2.62191 1.296 2.91304 1.03584C3.08408 0.883016 3.273 0.751185 3.47579 0.644009C3.82102 0.461569 4.18214 0.385575 4.57731 0.350131C4.95993 0.315849 5.42553 0.316783 5.98521 0.316783H11.0916C11.876 0.316783 12.52 0.316134 13.0362 0.372015C13.5655 0.429358 14.0423 0.552599 14.4608 0.856601C14.7007 1.03091 14.9117 1.24199 15.086 1.48187C15.3901 1.90033 15.5143 2.37716 15.5717 2.90645C15.6276 3.42275 15.6269 4.06727 15.6269 4.85209V6.5028C15.6269 7.16167 15.633 7.63697 15.5164 8.04306C15.2475 8.97969 14.5158 9.71248 13.5791 9.9814C13.173 10.098 12.6977 10.0908 12.0389 10.0908C11.8372 10.0908 11.8118 10.0933 11.795 10.096C11.723 10.1077 11.6549 10.1394 11.6012 10.1888C11.5887 10.2003 11.5724 10.2191 11.447 10.3784L7.74639 15.0815L7.74535 15.0826L7.72451 15.1086ZM14.2388 4.85209C14.2388 4.03635 14.2379 3.47971 14.1919 3.05547C14.1473 2.64449 14.0672 2.44037 13.9637 2.29785C13.8749 2.17569 13.768 2.06776 13.6458 1.97896C13.5033 1.87539 13.2984 1.7953 12.8872 1.75074C12.4907 1.70779 11.979 1.70518 11.2479 1.70489C11.6511 2.25924 11.8918 2.93974 11.8919 3.67762V7.41257H10.5038V3.67762C10.5036 2.58751 9.62023 1.70384 8.53007 1.70384H5.98521C5.40065 1.70384 5.00679 1.70449 4.70028 1.73198C4.40651 1.75836 4.24662 1.80577 4.12399 1.87058C4.02069 1.92518 3.92452 1.99283 3.8374 2.07067C3.73401 2.16312 3.634 2.29627 3.50705 2.56255C3.37462 2.84034 3.23734 3.2088 3.03393 3.75682L2.08768 6.30584C1.88395 6.85474 1.81646 7.04347 1.79172 7.17497C1.61005 8.14152 2.25533 9.06908 3.22464 9.23524C3.35654 9.25781 3.55717 9.26129 4.14274 9.26129H5.07023C5.25717 9.26129 5.4593 9.25932 5.62672 9.27901C5.80364 9.29982 6.05492 9.35458 6.27179 9.551C6.37381 9.64347 6.45784 9.75424 6.51982 9.87719C6.65133 10.1382 6.6374 10.3942 6.61048 10.5702C6.58498 10.7367 6.52988 10.931 6.48022 11.1111L6.01439 12.8003L6.00501 12.8347C5.87513 13.3268 6.01464 13.8509 6.37184 14.2134L6.40935 14.251L6.46667 14.2864C6.52866 14.3088 6.60155 14.2912 6.64591 14.2364L6.65738 14.2239L6.65633 14.2228L10.3569 9.52078C10.4543 9.397 10.5491 9.27245 10.6633 9.1675C10.9166 8.93483 11.2325 8.78186 11.572 8.72669C11.7251 8.70184 11.8814 8.70376 12.0389 8.70376C12.7927 8.70376 13.0245 8.69651 13.1956 8.64748C13.6727 8.51051 14.0465 8.13768 14.1836 7.6606C14.2327 7.48941 14.2388 7.25727 14.2388 6.5028V4.85209Z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="fbb737a4">I am using vector_store.py

It is raising this error when I ask a question from the streamlit app:

File "D:\ML_Projects\pdf-chatbot\pcvenv\Lib\site-packages\streamlit\runtime\scriptrunner\script_runner.py", line 600, in _run_script
    exec(code, module.__dict__)
File "D:\ML_Projects\pdf-chatbot\app.py", line 137, in &lt;module&gt;
    main()
File "D:\ML_Projects\pdf-chatbot\app.py", line 106, in main
    retrieved_chunks = vector_store.search(prompt, k=5)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "D:\ML_Projects\pdf-chatbot\modules\vector_store.py", line 121, in search
    raise ValueError("Index or embedding model not initialized")</div></div><div class="_11d6b3a"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5" style="--assistant-last-margin-bottom: 32px;"><div class="ds-message _656c965"><div class="_7d763a7 _45cdda5" style="--deep-search-title-height: 38px; --group-title-sticky-top: 0px;"><div class="_68f84dc"></div><div class="ddd2f74b"></div></div><div class="ds-markdown" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph"><span>The error indicates that either the FAISS index or the embedding model hasn't been properly initialized when you try to search. Let me fix this issue step by step.</span></p><h2><span>Problem Analysis</span></h2><p class="ds-markdown-paragraph"><span>The error occurs because:</span></p><ol start="1"><li><p class="ds-markdown-paragraph"><span>The vector store isn't properly initialized before searching</span></p></li><li><p class="ds-markdown-paragraph"><span>The index or embedding model is </span><code>None</code><span> when </span><code>search()</code><span> is called</span></p></li><li><p class="ds-markdown-paragraph"><span>There might be an issue with the initialization flow</span></p></li></ol><h2><span>Updated Code Fixes</span></h2><h3><span>1. Update </span><code>modules/vector_store.py</code></h3><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> faiss
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict
<span class="token keyword">import</span> google<span class="token punctuation">.</span>generativeai <span class="token keyword">as</span> genai
<span class="token keyword">from</span> sentence_transformers <span class="token keyword">import</span> SentenceTransformer

<span class="token keyword">class</span> <span class="token class-name">VectorStore</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span><span class="token punctuation">,</span> metadata_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>index_path <span class="token operator">=</span> index_path
        self<span class="token punctuation">.</span>metadata_path <span class="token operator">=</span> metadata_path
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> <span class="token number">384</span>
        self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">False</span>
        
    <span class="token keyword">def</span> <span class="token function">initialize_embedding_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialize embedding model with proper error handling"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># Try to use Gemini embeddings</span>
            api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> api_key<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"GEMINI_API_KEY not found in environment variables"</span><span class="token punctuation">)</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"API key missing"</span><span class="token punctuation">)</span>
                
            genai<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>api_key<span class="token operator">=</span>api_key<span class="token punctuation">)</span>
            
            <span class="token comment"># Test the API with a simple embedding</span>
            test_result <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                content<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"test embedding"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
            <span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> <span class="token string">'embedding'</span> <span class="token keyword">in</span> test_result<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>test_result<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> <span class="token string">'gemini'</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Using Gemini embeddings (dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">True</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No embedding returned from Gemini"</span><span class="token punctuation">)</span>
                
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Gemini embedding failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">, falling back to local model"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">_initialize_local_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialize local embedding model as fallback"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> SentenceTransformer<span class="token punctuation">(</span><span class="token string">'all-MiniLM-L6-v2'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">.</span>get_sentence_embedding_dimension<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Using local SentenceTransformer (dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Failed to initialize local model: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">get_embeddings</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> texts<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Get embeddings for texts with proper error handling"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_initialized<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Embedding model not initialized"</span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>embedding_model <span class="token operator">==</span> <span class="token string">'gemini'</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                result <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                    model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                    content<span class="token operator">=</span>texts<span class="token punctuation">,</span>
                    task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
                <span class="token punctuation">)</span>
                
                embeddings <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
                
                <span class="token comment"># Ensure correct shape</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    embeddings <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>texts<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    <span class="token comment"># Handle case where Gemini returns single embedding for multiple texts</span>
                    embeddings <span class="token operator">=</span> np<span class="token punctuation">.</span>tile<span class="token punctuation">(</span>embeddings<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>texts<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token keyword">return</span> embeddings
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Gemini embedding generation failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"All embedding methods failed"</span><span class="token punctuation">)</span>
                <span class="token comment"># Fall through to local model</span>
        
        <span class="token comment"># Use local model</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">,</span> SentenceTransformer<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>texts<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No valid embedding model available"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_index</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Create FAISS index from chunks"""</span>
        texts <span class="token operator">=</span> <span class="token punctuation">[</span>chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> chunk <span class="token keyword">in</span> chunks<span class="token punctuation">]</span>
        
        <span class="token comment"># Initialize embedding model</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Failed to initialize embedding model"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Get embeddings</span>
        embeddings <span class="token operator">=</span> self<span class="token punctuation">.</span>get_embeddings<span class="token punctuation">(</span>texts<span class="token punctuation">)</span>
        
        <span class="token comment"># Create FAISS index</span>
        dimension <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>IndexFlatL2<span class="token punctuation">(</span>dimension<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>add<span class="token punctuation">(</span>embeddings<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> chunks
        
        <span class="token comment"># Create storage directory if it doesn't exist</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Save index and metadata</span>
        faiss<span class="token punctuation">.</span>write_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index<span class="token punctuation">,</span> self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span> f<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Index created with </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>chunks<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> chunks"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">load_index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Load existing index with proper initialization"""</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading existing index..."</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>read_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
                
                <span class="token comment"># Initialize embedding model for new searches</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Warning: Failed to initialize embedding model after loading index"</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">False</span>
                
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Index loaded with </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> chunks"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Search for similar chunks with proper validation"""</span>
        <span class="token comment"># Check if index is loaded</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Index not loaded, attempting to load..."</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Index not initialized and cannot be loaded"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Check if embedding model is initialized</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_initialized<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Embedding model not initialized, initializing..."</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Embedding model not initialized"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Check if we have data to search</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Warning: Index is empty"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token comment"># Get query embedding</span>
        query_embedding <span class="token operator">=</span> self<span class="token punctuation">.</span>get_embeddings<span class="token punctuation">(</span><span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Ensure k doesn't exceed number of vectors</span>
        k <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">)</span>
        
        <span class="token comment"># Perform search</span>
        distances<span class="token punctuation">,</span> indices <span class="token operator">=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>search<span class="token punctuation">(</span>query_embedding<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
        
        results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> idx<span class="token punctuation">,</span> distance <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>indices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> distances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> idx <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">:</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>metadata<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
                result<span class="token punctuation">[</span><span class="token string">'similarity_score'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> distance<span class="token punctuation">)</span><span class="token punctuation">)</span>
                results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        
        <span class="token comment"># Sort by similarity score (descending)</span>
        results<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token string">'similarity_score'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> results
    
    <span class="token keyword">def</span> <span class="token function">is_ready</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Check if the vector store is ready for searching"""</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> 
                self<span class="token punctuation">.</span>is_initialized <span class="token keyword">and</span> 
                <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>2. Update </span><code>app.py</code><span> with Better Error Handling</span></h3><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st
<span class="token keyword">import</span> os
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>pdf_processor <span class="token keyword">import</span> PDFProcessor
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>rag_engine <span class="token keyword">import</span> RAGEngine
<span class="token keyword">import</span> json
<span class="token keyword">import</span> time

<span class="token comment"># Load environment variables</span>
load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Initialize components</span>
pdf_processor <span class="token operator">=</span> PDFProcessor<span class="token punctuation">(</span><span class="token punctuation">)</span>
vector_store <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
rag_engine <span class="token operator">=</span> RAGEngine<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">initialize_session_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Initialize session state variables"""</span>
    <span class="token keyword">if</span> <span class="token string">'processed'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">if</span> <span class="token string">'vector_store_loaded'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">if</span> <span class="token string">'messages'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token string">'processing_error'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processing_error <span class="token operator">=</span> <span class="token boolean">None</span>

<span class="token keyword">def</span> <span class="token function">process_pdf</span><span class="token punctuation">(</span>uploaded_file<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Process uploaded PDF file with better error handling"""</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> st<span class="token punctuation">.</span>spinner<span class="token punctuation">(</span><span class="token string">"Processing PDF..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># Clear any previous errors</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processing_error <span class="token operator">=</span> <span class="token boolean">None</span>
            
            <span class="token comment"># Extract text from PDF</span>
            chunks <span class="token operator">=</span> pdf_processor<span class="token punctuation">.</span>process_pdf<span class="token punctuation">(</span>uploaded_file<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> chunks<span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No text could be extracted from the PDF"</span><span class="token punctuation">)</span>
            
            <span class="token comment"># Create vector index</span>
            vector_store<span class="token punctuation">.</span>create_index<span class="token punctuation">(</span>chunks<span class="token punctuation">)</span>
            
            <span class="token comment"># Update session state</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed <span class="token operator">=</span> <span class="token boolean">True</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded <span class="token operator">=</span> <span class="token boolean">True</span>
            st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"PDF processed successfully!"</span><span class="token punctuation">)</span>
            
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        error_msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"Error processing PDF: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processing_error <span class="token operator">=</span> error_msg
        st<span class="token punctuation">.</span>error<span class="token punctuation">(</span>error_msg<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Processing error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    st<span class="token punctuation">.</span>set_page_config<span class="token punctuation">(</span>
        page_title<span class="token operator">=</span><span class="token string">"PDF Chatbot"</span><span class="token punctuation">,</span>
        page_icon<span class="token operator">=</span><span class="token string">"📚"</span><span class="token punctuation">,</span>
        layout<span class="token operator">=</span><span class="token string">"wide"</span>
    <span class="token punctuation">)</span>
    
    st<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"📚 PDF Chatbot with Gemini Flash 1.5"</span><span class="token punctuation">)</span>
    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"Upload a PDF and chat with it using AI!"</span><span class="token punctuation">)</span>
    
    initialize_session_state<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Sidebar for PDF upload</span>
    <span class="token keyword">with</span> st<span class="token punctuation">.</span>sidebar<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"📄 Upload PDF"</span><span class="token punctuation">)</span>
        uploaded_file <span class="token operator">=</span> st<span class="token punctuation">.</span>file_uploader<span class="token punctuation">(</span>
            <span class="token string">"Choose a PDF file"</span><span class="token punctuation">,</span> 
            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"pdf"</span><span class="token punctuation">,</span>
            <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Upload any PDF document to start chatting"</span>
        <span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> uploaded_file <span class="token keyword">and</span> <span class="token keyword">not</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed<span class="token punctuation">:</span>
            <span class="token keyword">if</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"Process PDF"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"primary"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                process_pdf<span class="token punctuation">(</span>uploaded_file<span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"✅ PDF ready for chatting!"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Display errors if any</span>
        <span class="token keyword">if</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processing_error<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>error<span class="token punctuation">(</span>st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processing_error<span class="token punctuation">)</span>
            
        <span class="token comment"># Display chat history</span>
        st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"💬 Conversation History"</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> msg <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span>msg<span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>msg<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> msg<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"View Sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">for</span> source <span class="token keyword">in</span> msg<span class="token punctuation">[</span><span class="token string">"sources"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Page </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># Main chat area</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded<span class="token punctuation">:</span>
        <span class="token comment"># Try to load existing index</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> vector_store<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded <span class="token operator">=</span> <span class="token boolean">True</span>
                st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed <span class="token operator">=</span> <span class="token boolean">True</span>
                st<span class="token punctuation">.</span>sidebar<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"Loaded existing PDF index!"</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"👈 Please upload a PDF file to get started!"</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading index: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded <span class="token operator">=</span> <span class="token boolean">False</span>
    
    <span class="token keyword">if</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded<span class="token punctuation">:</span>
        <span class="token comment"># Display chat messages</span>
        <span class="token keyword">for</span> message <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">:</span>
            <span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span>message<span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>message<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"Sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">for</span> source <span class="token keyword">in</span> message<span class="token punctuation">[</span><span class="token string">"sources"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Page </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">:** </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Chat input</span>
        <span class="token keyword">if</span> prompt <span class="token operator">:=</span> st<span class="token punctuation">.</span>chat_input<span class="token punctuation">(</span><span class="token string">"Ask a question about the PDF..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># Add user message</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> prompt<span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>prompt<span class="token punctuation">)</span>
            
            <span class="token comment"># Generate response</span>
            <span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span><span class="token string">"assistant"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    <span class="token keyword">with</span> st<span class="token punctuation">.</span>spinner<span class="token punctuation">(</span><span class="token string">"Thinking..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token comment"># Search for relevant chunks</span>
                        retrieved_chunks <span class="token operator">=</span> vector_store<span class="token punctuation">.</span>search<span class="token punctuation">(</span>prompt<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
                        
                        <span class="token keyword">if</span> <span class="token keyword">not</span> retrieved_chunks<span class="token punctuation">:</span>
                            st<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">"No relevant information found in the document."</span><span class="token punctuation">)</span>
                            response_text <span class="token operator">=</span> <span class="token string">"I couldn't find relevant information in the document to answer your question."</span>
                            sources <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            <span class="token comment"># Format context</span>
                            context <span class="token operator">=</span> rag_engine<span class="token punctuation">.</span>format_context<span class="token punctuation">(</span>retrieved_chunks<span class="token punctuation">)</span>
                            
                            <span class="token comment"># Generate response</span>
                            response <span class="token operator">=</span> rag_engine<span class="token punctuation">.</span>generate_response<span class="token punctuation">(</span>
                                prompt<span class="token punctuation">,</span> 
                                context<span class="token punctuation">,</span> 
                                st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages
                            <span class="token punctuation">)</span>
                            response_text <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span>
                            sources <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'sources'</span><span class="token punctuation">]</span>
                        
                        <span class="token comment"># Display response</span>
                        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response_text<span class="token punctuation">)</span>
                        
                        <span class="token comment"># Display sources if available</span>
                        <span class="token keyword">if</span> sources<span class="token punctuation">:</span>
                            <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"Sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                                <span class="token keyword">for</span> source <span class="token keyword">in</span> sources<span class="token punctuation">:</span>
                                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Page </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">:** </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
                    
                    <span class="token comment"># Add to session state</span>
                    st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> 
                        <span class="token string">"content"</span><span class="token punctuation">:</span> response_text<span class="token punctuation">,</span>
                        <span class="token string">"sources"</span><span class="token punctuation">:</span> sources
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    error_msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"Error generating response: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                    st<span class="token punctuation">.</span>error<span class="token punctuation">(</span>error_msg<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Response generation error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    
                    <span class="token comment"># Add error message to history</span>
                    st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> 
                        <span class="token string">"content"</span><span class="token punctuation">:</span> error_msg<span class="token punctuation">,</span>
                        <span class="token string">"sources"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>3. Add Debug Information to Your App</span></h3><p class="ds-markdown-paragraph"><span>Add this debug section to your sidebar to help troubleshoot:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment"># Add this to your sidebar in app.py</span>
<span class="token keyword">with</span> st<span class="token punctuation">.</span>sidebar<span class="token punctuation">:</span>
    <span class="token comment"># ... existing code ...</span>
    
    <span class="token comment"># Debug information (optional)</span>
    <span class="token keyword">if</span> st<span class="token punctuation">.</span>checkbox<span class="token punctuation">(</span><span class="token string">"Show debug info"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"### Debug Information"</span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Vector store initialized: </span><span class="token interpolation"><span class="token punctuation">{</span>vector_store<span class="token punctuation">.</span>is_initialized<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Index loaded: </span><span class="token interpolation"><span class="token punctuation">{</span>vector_store<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> vector_store<span class="token punctuation">.</span>index<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Index size: </span><span class="token interpolation"><span class="token punctuation">{</span>vector_store<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Metadata count: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>vector_store<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Session processed: </span><span class="token interpolation"><span class="token punctuation">{</span>st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Session vector_store_loaded: </span><span class="token interpolation"><span class="token punctuation">{</span>st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Testing Steps</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>Restart your Streamlit app:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>streamlit run app.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>Upload a PDF and click "Process PDF"</span></strong></p></li><li><p class="ds-markdown-paragraph"><strong><span>Check the console for initialization messages:</span></strong></p><ul><li><p class="ds-markdown-paragraph"><span>You should see "Using Gemini embeddings" or "Using local SentenceTransformer"</span></p></li><li><p class="ds-markdown-paragraph"><span>You should see "Index created with X chunks"</span></p></li></ul></li><li><p class="ds-markdown-paragraph"><strong><span>Try asking a question</span></strong></p></li></ol><h2><span>Common Issues and Solutions</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>API Key Issues:</span></strong></p><ul><li><p class="ds-markdown-paragraph"><span>Make sure your </span><code>.env</code><span> file has </span><code>GEMINI_API_KEY=your_actual_key</code></p></li><li><p class="ds-markdown-paragraph"><span>The key should be in the same directory as </span><code>app.py</code></p></li></ul></li><li><p class="ds-markdown-paragraph"><strong><span>PDF Extraction Issues:</span></strong></p><ul><li><p class="ds-markdown-paragraph"><span>Try a simple PDF with clear text</span></p></li><li><p class="ds-markdown-paragraph"><span>Some PDFs with images/scans won't extract text well</span></p></li></ul></li><li><p class="ds-markdown-paragraph"><strong><span>Storage Directory Permissions:</span></strong></p><ul><li><p class="ds-markdown-paragraph"><span>Make sure the </span><code>storage/</code><span> directory can be created</span></p></li><li><p class="ds-markdown-paragraph"><span>Check write permissions in your project directory</span></p></li></ul></li><li><p class="ds-markdown-paragraph"><strong><span>FAISS Compatibility:</span></strong></p><ul><li><p class="ds-markdown-paragraph"><span>Ensure you're using </span><code>faiss-cpu</code><span> version compatible with your Python version</span></p></li></ul></li></ol><p class="ds-markdown-paragraph"><span>The updated code should now properly handle initialization and provide better error messages to help diagnose any issues.</span></p></div></div><div class="ds-theme" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE;"></div><div class="ds-flex _0a3d93b" style="align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 10px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92142 0.349213C10.3745 0.349295 12.5564 1.50526 13.9558 3.299L15.1282 2.12765C15.3304 1.92552 15.6768 2.06949 15.6768 2.35544V5.53929C15.6766 5.71632 15.533 5.85982 15.356 5.86008H12.1711C11.8855 5.85976 11.7427 5.51471 11.9443 5.31255L12.9642 4.29062C11.8238 2.74311 9.98914 1.74112 7.92142 1.74104C4.46442 1.74104 1.66239 4.54307 1.66239 8.00006C1.66239 11.4571 4.46442 14.2591 7.92142 14.2591C11.3783 14.2589 14.1804 11.457 14.1804 8.00006H15.5723C15.5723 12.2252 12.1465 15.6508 7.92142 15.6509C3.6962 15.6509 0.270569 12.2253 0.270569 8.00006C0.270569 3.77485 3.6962 0.349213 7.92142 0.349213Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.27861 0.811633C8.81985 0.142255 9.79016 0.0422445 10.4537 0.557662L10.5823 0.669367L10.6065 0.693605L10.6097 0.695713L10.6392 0.72522C11.3549 1.44685 11.6336 2.49474 11.3716 3.47675L11.3705 3.48097L11.361 3.5168L11.36 3.51891L10.8889 5.2261C10.8796 5.26003 10.8706 5.29164 10.8626 5.32094C10.8934 5.32101 10.927 5.322 10.9627 5.322H11.9006C12.4263 5.322 12.783 5.31906 13.0651 5.36731C14.8182 5.66725 15.9851 7.34574 15.6564 9.09363C15.6035 9.37493 15.4769 9.70926 15.2939 10.2023L14.337 12.7799C14.1401 13.3105 13.9773 13.7518 13.8101 14.1025C13.6375 14.4646 13.4385 14.7794 13.1441 15.0425C12.9712 15.197 12.7801 15.3303 12.5751 15.4387C12.2259 15.6232 11.8608 15.7 11.4612 15.7359C11.0742 15.7705 10.6034 15.7696 10.0374 15.7696H4.87371C4.08047 15.7696 3.42922 15.7703 2.90728 15.7138C2.37206 15.6558 1.88985 15.5311 1.4667 15.2237C1.22409 15.0475 1.01072 14.834 0.834405 14.5914C0.52696 14.1683 0.401312 13.6861 0.343323 13.1509C0.286761 12.6288 0.28747 11.977 0.28747 11.1834V9.51411C0.28747 8.84785 0.281286 8.36721 0.399176 7.95656C0.671091 7.00941 1.41109 6.26838 2.35823 5.99645C2.76888 5.87855 3.24952 5.88579 3.91579 5.88579C4.11977 5.88579 4.14542 5.88325 4.16238 5.88053C4.23526 5.8687 4.30403 5.83669 4.35839 5.78674C4.37104 5.77511 4.38755 5.7561 4.51436 5.59494L8.25648 0.839033L8.25754 0.837979L8.27861 0.811633ZM1.69116 11.1834C1.69116 12.0083 1.69211 12.5712 1.73859 13.0002C1.78365 13.4158 1.86467 13.6222 1.96937 13.7663C2.05914 13.8898 2.16727 13.999 2.29079 14.0888C2.43495 14.1935 2.6421 14.2745 3.05797 14.3195C3.45891 14.363 3.97631 14.3656 4.71564 14.3659C4.30795 13.8053 4.06447 13.1172 4.06437 12.371V8.59412H5.46807V12.371C5.46832 13.4734 6.3616 14.367 7.46401 14.367H10.0374C10.6286 14.367 11.0269 14.3663 11.3368 14.3385C11.6339 14.3118 11.7956 14.2639 11.9196 14.1984C12.024 14.1431 12.1213 14.0747 12.2094 13.996C12.3139 13.9025 12.4151 13.7679 12.5434 13.4986C12.6774 13.2177 12.8162 12.8451 13.0219 12.2909L13.9787 9.71328C14.1848 9.15822 14.253 8.96737 14.278 8.83439C14.4617 7.85698 13.8092 6.91901 12.829 6.75098C12.6956 6.72816 12.4928 6.72464 11.9006 6.72464H10.9627C10.7737 6.72464 10.5693 6.72663 10.4 6.70672C10.2211 6.68568 9.96696 6.6303 9.74764 6.43167C9.64448 6.33817 9.5595 6.22616 9.49683 6.10183C9.36384 5.8379 9.37793 5.57905 9.40515 5.40104C9.43094 5.23267 9.48666 5.03623 9.53688 4.8541L10.0079 3.14585L10.0174 3.11108C10.1488 2.61344 10.0077 2.08344 9.64648 1.71687L9.60854 1.67893L9.55058 1.6431C9.48789 1.62049 9.41419 1.6382 9.36932 1.69368L9.35773 1.70633L9.35878 1.70738L5.61666 6.46224C5.51816 6.58741 5.42231 6.71336 5.30683 6.81948C5.05069 7.05477 4.73119 7.20945 4.3879 7.26525C4.23309 7.29038 4.07507 7.28843 3.91579 7.28843C3.1535 7.28843 2.9191 7.29576 2.74604 7.34534C2.26358 7.48385 1.88558 7.86087 1.74702 8.34331C1.69732 8.51642 1.69116 8.75116 1.69116 9.51411V11.1834Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.72451 15.1086C7.18929 15.7706 6.22975 15.8695 5.57357 15.3598L5.44643 15.2493L5.42247 15.2253L5.41934 15.2233L5.39016 15.1941C4.68239 14.4805 4.40679 13.4442 4.66589 12.4731L4.66693 12.4689L4.67631 12.4335L4.67735 12.4314L5.14318 10.7432C5.15243 10.7096 5.1613 10.6784 5.16923 10.6494C5.13878 10.6493 5.10558 10.6484 5.07023 10.6484H4.14274C3.62288 10.6484 3.27015 10.6513 2.9912 10.6035C1.25757 10.3069 0.103662 8.64709 0.42863 6.91861C0.480965 6.64044 0.606164 6.30981 0.787119 5.8223L1.73336 3.27328C1.92812 2.74859 2.08912 2.31215 2.25442 1.96542C2.42515 1.60731 2.62191 1.296 2.91304 1.03584C3.08408 0.883016 3.273 0.751185 3.47579 0.644009C3.82102 0.461569 4.18214 0.385575 4.57731 0.350131C4.95993 0.315849 5.42553 0.316783 5.98521 0.316783H11.0916C11.876 0.316783 12.52 0.316134 13.0362 0.372015C13.5655 0.429358 14.0423 0.552599 14.4608 0.856601C14.7007 1.03091 14.9117 1.24199 15.086 1.48187C15.3901 1.90033 15.5143 2.37716 15.5717 2.90645C15.6276 3.42275 15.6269 4.06727 15.6269 4.85209V6.5028C15.6269 7.16167 15.633 7.63697 15.5164 8.04306C15.2475 8.97969 14.5158 9.71248 13.5791 9.9814C13.173 10.098 12.6977 10.0908 12.0389 10.0908C11.8372 10.0908 11.8118 10.0933 11.795 10.096C11.723 10.1077 11.6549 10.1394 11.6012 10.1888C11.5887 10.2003 11.5724 10.2191 11.447 10.3784L7.74639 15.0815L7.74535 15.0826L7.72451 15.1086ZM14.2388 4.85209C14.2388 4.03635 14.2379 3.47971 14.1919 3.05547C14.1473 2.64449 14.0672 2.44037 13.9637 2.29785C13.8749 2.17569 13.768 2.06776 13.6458 1.97896C13.5033 1.87539 13.2984 1.7953 12.8872 1.75074C12.4907 1.70779 11.979 1.70518 11.2479 1.70489C11.6511 2.25924 11.8918 2.93974 11.8919 3.67762V7.41257H10.5038V3.67762C10.5036 2.58751 9.62023 1.70384 8.53007 1.70384H5.98521C5.40065 1.70384 5.00679 1.70449 4.70028 1.73198C4.40651 1.75836 4.24662 1.80577 4.12399 1.87058C4.02069 1.92518 3.92452 1.99283 3.8374 2.07067C3.73401 2.16312 3.634 2.29627 3.50705 2.56255C3.37462 2.84034 3.23734 3.2088 3.03393 3.75682L2.08768 6.30584C1.88395 6.85474 1.81646 7.04347 1.79172 7.17497C1.61005 8.14152 2.25533 9.06908 3.22464 9.23524C3.35654 9.25781 3.55717 9.26129 4.14274 9.26129H5.07023C5.25717 9.26129 5.4593 9.25932 5.62672 9.27901C5.80364 9.29982 6.05492 9.35458 6.27179 9.551C6.37381 9.64347 6.45784 9.75424 6.51982 9.87719C6.65133 10.1382 6.6374 10.3942 6.61048 10.5702C6.58498 10.7367 6.52988 10.931 6.48022 11.1111L6.01439 12.8003L6.00501 12.8347C5.87513 13.3268 6.01464 13.8509 6.37184 14.2134L6.40935 14.251L6.46667 14.2864C6.52866 14.3088 6.60155 14.2912 6.64591 14.2364L6.65738 14.2239L6.65633 14.2228L10.3569 9.52078C10.4543 9.397 10.5491 9.27245 10.6633 9.1675C10.9166 8.93483 11.2325 8.78186 11.572 8.72669C11.7251 8.70184 11.8814 8.70376 12.0389 8.70376C12.7927 8.70376 13.0245 8.69651 13.1956 8.64748C13.6727 8.51051 14.0465 8.13768 14.1836 7.6606C14.2327 7.48941 14.2388 7.25727 14.2388 6.5028V4.85209Z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="fbb737a4">Error generating response: name 'retrieved_chunks' is not defined</div></div><div class="_11d6b3a"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5" style="--assistant-last-margin-bottom: 32px;"><div class="ds-message _656c965"><div class="_7d763a7 _45cdda5" style="--deep-search-title-height: 38px; --group-title-sticky-top: 0px;"><div class="_68f84dc"></div><div class="ddd2f74b"></div></div><div class="ds-markdown" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph"><span>This error occurs because </span><code>retrieved_chunks</code><span> is being used in the </span><code>generate_response</code><span> method before it's defined. Let me fix the </span><code>rag_engine.py</code><span> file.</span></p><h2><span>Updated </span><code>modules/rag_engine.py</code></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> google<span class="token punctuation">.</span>generativeai <span class="token keyword">as</span> genai
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">class</span> <span class="token class-name">RAGEngine</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> api_key<span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"GEMINI_API_KEY not found in environment variables"</span><span class="token punctuation">)</span>
            
            genai<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>api_key<span class="token operator">=</span>api_key<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>model <span class="token operator">=</span> genai<span class="token punctuation">.</span>GenerativeModel<span class="token punctuation">(</span><span class="token string">'gemini-1.5-flash'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>chat_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✓ Gemini Flash 1.5 model initialized successfully"</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Failed to initialize Gemini: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>model <span class="token operator">=</span> <span class="token boolean">None</span>
            self<span class="token punctuation">.</span>chat_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">format_context</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> retrieved_chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Format retrieved chunks into context string"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> retrieved_chunks<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"No relevant document excerpts found."</span>
        
        context <span class="token operator">=</span> <span class="token string">"Relevant document excerpts:\n\n"</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> chunk <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>retrieved_chunks<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># Truncate text for better readability</span>
            text_preview <span class="token operator">=</span> chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">300</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'...'</span> <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">300</span> <span class="token keyword">else</span> chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span>
            context <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"Excerpt </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string"> (Page </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">): </span><span class="token interpolation"><span class="token punctuation">{</span>text_preview<span class="token punctuation">}</span></span><span class="token string">\n"</span></span>
            context <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"Similarity score: </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'similarity_score'</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string">\n\n"</span></span>
        <span class="token keyword">return</span> context
    
    <span class="token keyword">def</span> <span class="token function">generate_response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> retrieved_chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">,</span> chat_history<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Dict<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Generate response using RAG with proper parameter handling"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>model <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">"Error: AI model not initialized. Please check your API key."</span><span class="token punctuation">,</span>
                <span class="token string">'timestamp'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'sources'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        
        <span class="token comment"># Format the context from retrieved chunks</span>
        context <span class="token operator">=</span> self<span class="token punctuation">.</span>format_context<span class="token punctuation">(</span>retrieved_chunks<span class="token punctuation">)</span>
        
        <span class="token comment"># Build conversation history</span>
        history_str <span class="token operator">=</span> <span class="token string">""</span>
        <span class="token keyword">if</span> chat_history<span class="token punctuation">:</span>
            <span class="token keyword">for</span> msg <span class="token keyword">in</span> chat_history<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># Keep last 6 messages for context</span>
                role <span class="token operator">=</span> <span class="token string">"User"</span> <span class="token keyword">if</span> msg<span class="token punctuation">[</span><span class="token string">'role'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'user'</span> <span class="token keyword">else</span> <span class="token string">"Assistant"</span>
                history_str <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>role<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>msg<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span>
        
        <span class="token comment"># Create the prompt with proper context</span>
        prompt <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""
        You are a helpful assistant that answers questions based on the provided document excerpts.
        Always ground your answers in the provided context and cite your sources using page numbers.
        
        </span><span class="token interpolation"><span class="token punctuation">{</span>history_str<span class="token punctuation">}</span></span><span class="token string">
        
        </span><span class="token interpolation"><span class="token punctuation">{</span>context<span class="token punctuation">}</span></span><span class="token string">
        
        Current Question: </span><span class="token interpolation"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token string">
        
        Instructions:
        1. Answer based ONLY on the provided context
        2. If the answer isn't in the context, say "I couldn't find that information in the document"
        3. Cite specific page numbers for your information (e.g., [Page X])
        4. Be concise and accurate
        5. If asked about previous conversation, use the chat history provided
        6. If no relevant context is provided, acknowledge this politely
        
        Assistant:"""</span></span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            response <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>generate_content<span class="token punctuation">(</span>prompt<span class="token punctuation">)</span>
            
            <span class="token comment"># Extract sources from retrieved chunks</span>
            sources <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> retrieved_chunks<span class="token punctuation">:</span>
                sources <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'page'</span><span class="token punctuation">:</span> chunk<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'text'</span><span class="token punctuation">:</span> chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">}</span> 
                          <span class="token keyword">for</span> chunk <span class="token keyword">in</span> retrieved_chunks<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># Top 3 sources</span>
            
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">'answer'</span><span class="token punctuation">:</span> response<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
                <span class="token string">'timestamp'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'sources'</span><span class="token punctuation">:</span> sources
            <span class="token punctuation">}</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            error_msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"Error generating response: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>error_msg<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">"I'm having trouble generating a response at the moment. Please try again."</span><span class="token punctuation">,</span>
                <span class="token string">'timestamp'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'sources'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
    
    <span class="token keyword">def</span> <span class="token function">add_to_history</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> role<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> sources<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Add message to chat history"""</span>
        self<span class="token punctuation">.</span>chat_history<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">'role'</span><span class="token punctuation">:</span> role<span class="token punctuation">,</span>
            <span class="token string">'content'</span><span class="token punctuation">:</span> content<span class="token punctuation">,</span>
            <span class="token string">'timestamp'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'sources'</span><span class="token punctuation">:</span> sources <span class="token keyword">or</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">get_history</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Get chat history"""</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>chat_history
    
    <span class="token keyword">def</span> <span class="token function">clear_history</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Clear chat history"""</span>
        self<span class="token punctuation">.</span>chat_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Also Update </span><code>app.py</code><span> to Fix the Response Handling</span></h2><p class="ds-markdown-paragraph"><span>Update the response generation section in </span><code>app.py</code><span>:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment"># ... existing code ...</span>

<span class="token comment"># Generate response</span>
<span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span><span class="token string">"assistant"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> st<span class="token punctuation">.</span>spinner<span class="token punctuation">(</span><span class="token string">"Thinking..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># Search for relevant chunks</span>
            retrieved_chunks <span class="token operator">=</span> vector_store<span class="token punctuation">.</span>search<span class="token punctuation">(</span>prompt<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> <span class="token keyword">not</span> retrieved_chunks<span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">"No relevant information found in the document."</span><span class="token punctuation">)</span>
                response_text <span class="token operator">=</span> <span class="token string">"I couldn't find relevant information in the document to answer your question."</span>
                sources <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># Generate response - FIXED: pass retrieved_chunks as parameter</span>
                response <span class="token operator">=</span> rag_engine<span class="token punctuation">.</span>generate_response<span class="token punctuation">(</span>
                    prompt<span class="token punctuation">,</span> 
                    retrieved_chunks<span class="token punctuation">,</span>  <span class="token comment"># Pass the chunks directly</span>
                    st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages
                <span class="token punctuation">)</span>
                response_text <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span>
                sources <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'sources'</span><span class="token punctuation">]</span>
            
            <span class="token comment"># Display response</span>
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response_text<span class="token punctuation">)</span>
            
            <span class="token comment"># Display sources if available</span>
            <span class="token keyword">if</span> sources<span class="token punctuation">:</span>
                <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"Sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">for</span> source <span class="token keyword">in</span> sources<span class="token punctuation">:</span>
                        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Page </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">:** </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Add to session state</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> 
            <span class="token string">"content"</span><span class="token punctuation">:</span> response_text<span class="token punctuation">,</span>
            <span class="token string">"sources"</span><span class="token punctuation">:</span> sources
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        error_msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"Error generating response: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
        st<span class="token punctuation">.</span>error<span class="token punctuation">(</span>error_msg<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Response generation error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Add error message to history</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> 
            <span class="token string">"content"</span><span class="token punctuation">:</span> error_msg<span class="token punctuation">,</span>
            <span class="token string">"sources"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># ... rest of the code ...</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Alternative: Simplified RAG Engine</span></h2><p class="ds-markdown-paragraph"><span>If you're still having issues, here's a more robust version:</span></p><p class="ds-markdown-paragraph"><strong><span>modules/simple_rag_</span><a href="https://engine.py/" target="_blank" rel="noreferrer"><span>engine.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> google<span class="token punctuation">.</span>generativeai <span class="token keyword">as</span> genai
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">class</span> <span class="token class-name">SimpleRAGEngine</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>model <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>chat_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>_initialize_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">_initialize_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialize the Gemini model with error handling"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> api_key<span class="token punctuation">:</span>
                genai<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>api_key<span class="token operator">=</span>api_key<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>model <span class="token operator">=</span> genai<span class="token punctuation">.</span>GenerativeModel<span class="token punctuation">(</span><span class="token string">'gemini-1.5-flash'</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✓ Gemini model initialized"</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"⚠ GEMINI_API_KEY not found, using fallback mode"</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Failed to initialize Gemini: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">generate_response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> retrieved_chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">,</span> chat_history<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Dict<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Generate response with proper error handling"""</span>
        <span class="token comment"># Prepare context from retrieved chunks</span>
        context <span class="token operator">=</span> self<span class="token punctuation">.</span>_prepare_context<span class="token punctuation">(</span>retrieved_chunks<span class="token punctuation">)</span>
        
        <span class="token comment"># Prepare chat history</span>
        history_text <span class="token operator">=</span> self<span class="token punctuation">.</span>_prepare_history<span class="token punctuation">(</span>chat_history<span class="token punctuation">)</span>
        
        <span class="token comment"># Create the prompt</span>
        prompt <span class="token operator">=</span> self<span class="token punctuation">.</span>_create_prompt<span class="token punctuation">(</span>query<span class="token punctuation">,</span> context<span class="token punctuation">,</span> history_text<span class="token punctuation">)</span>
        
        <span class="token comment"># Generate response</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>model<span class="token punctuation">:</span>
                response <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>generate_content<span class="token punctuation">(</span>prompt<span class="token punctuation">)</span>
                answer <span class="token operator">=</span> response<span class="token punctuation">.</span>text
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># Fallback response if model isn't available</span>
                answer <span class="token operator">=</span> self<span class="token punctuation">.</span>_fallback_response<span class="token punctuation">(</span>query<span class="token punctuation">,</span> retrieved_chunks<span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">'answer'</span><span class="token punctuation">:</span> answer<span class="token punctuation">,</span>
                <span class="token string">'timestamp'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'sources'</span><span class="token punctuation">:</span> retrieved_chunks<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">if</span> retrieved_chunks <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"I encountered an error: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
                <span class="token string">'timestamp'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'sources'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
    
    <span class="token keyword">def</span> <span class="token function">_prepare_context</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Prepare context from retrieved chunks"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> chunks<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"No relevant document content available."</span>
        
        context <span class="token operator">=</span> <span class="token string">"Document content:\n\n"</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> chunk <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>chunks<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># Limit to top 5 chunks</span>
            context <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"[Page </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">,</span> <span class="token string">'N/A'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">]: </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">200]</span><span class="token punctuation">}</span></span><span class="token string">...\n\n"</span></span>
        <span class="token keyword">return</span> context
    
    <span class="token keyword">def</span> <span class="token function">_prepare_history</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> chat_history<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Prepare chat history text"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> chat_history<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">""</span>
        
        history_text <span class="token operator">=</span> <span class="token string">"Previous conversation:\n"</span>
        <span class="token keyword">for</span> msg <span class="token keyword">in</span> chat_history<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># Last 4 messages</span>
            role <span class="token operator">=</span> <span class="token string">"User"</span> <span class="token keyword">if</span> msg<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'role'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'user'</span> <span class="token keyword">else</span> <span class="token string">"Assistant"</span>
            history_text <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>role<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>msg<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span>
        <span class="token keyword">return</span> history_text <span class="token operator">+</span> <span class="token string">"\n"</span>
    
    <span class="token keyword">def</span> <span class="token function">_create_prompt</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> context<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> history<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Create the prompt for the LLM"""</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"""
        You are a helpful assistant answering questions about a document.
        
        </span><span class="token interpolation"><span class="token punctuation">{</span>history<span class="token punctuation">}</span></span><span class="token string">
        
        </span><span class="token interpolation"><span class="token punctuation">{</span>context<span class="token punctuation">}</span></span><span class="token string">
        
        Current question: </span><span class="token interpolation"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token string">
        
        Instructions:
        - Answer based only on the document content provided
        - If the answer isn't in the document, say so
        - Mention page numbers when possible [Page X]
        - Be concise and helpful
        
        Answer:"""</span></span>
    
    <span class="token keyword">def</span> <span class="token function">_fallback_response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Fallback response if Gemini isn't available"""</span>
        <span class="token keyword">if</span> chunks<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"I found some relevant information on pages </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">,</span> <span class="token string">'N/A'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> chunk <span class="token keyword">in</span> chunks<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">. However, I'm currently unable to generate a detailed response due to technical limitations."</span></span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"I couldn't find relevant information in the document for your question."</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Quick Fix for Immediate Testing</span></h2><p class="ds-markdown-paragraph"><span>If you want the quickest fix, just update the </span><code>generate_response</code><span> method in your current </span><code>rag_engine.py</code><span>:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">def</span> <span class="token function">generate_response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> retrieved_chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">,</span> chat_history<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Dict<span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Generate response using RAG - FIXED parameter name"""</span>
    <span class="token comment"># Format the context FIRST using the retrieved_chunks parameter</span>
    context <span class="token operator">=</span> self<span class="token punctuation">.</span>format_context<span class="token punctuation">(</span>retrieved_chunks<span class="token punctuation">)</span>
    
    <span class="token comment"># ... rest of the original method code ...</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><p class="ds-markdown-paragraph"><span>The key issue was that </span><code>retrieved_chunks</code><span> was being used in the method before it was defined as a parameter. The fix ensures that </span><code>retrieved_chunks</code><span> is properly passed as a parameter and used to create the context.</span></p><p class="ds-markdown-paragraph"><span>After making these changes, restart your Streamlit app and it should work without the "name 'retrieved_chunks' is not defined" error.</span></p></div></div><div class="ds-theme" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE;"></div><div class="ds-flex _0a3d93b" style="align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 10px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92142 0.349213C10.3745 0.349295 12.5564 1.50526 13.9558 3.299L15.1282 2.12765C15.3304 1.92552 15.6768 2.06949 15.6768 2.35544V5.53929C15.6766 5.71632 15.533 5.85982 15.356 5.86008H12.1711C11.8855 5.85976 11.7427 5.51471 11.9443 5.31255L12.9642 4.29062C11.8238 2.74311 9.98914 1.74112 7.92142 1.74104C4.46442 1.74104 1.66239 4.54307 1.66239 8.00006C1.66239 11.4571 4.46442 14.2591 7.92142 14.2591C11.3783 14.2589 14.1804 11.457 14.1804 8.00006H15.5723C15.5723 12.2252 12.1465 15.6508 7.92142 15.6509C3.6962 15.6509 0.270569 12.2253 0.270569 8.00006C0.270569 3.77485 3.6962 0.349213 7.92142 0.349213Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.27861 0.811633C8.81985 0.142255 9.79016 0.0422445 10.4537 0.557662L10.5823 0.669367L10.6065 0.693605L10.6097 0.695713L10.6392 0.72522C11.3549 1.44685 11.6336 2.49474 11.3716 3.47675L11.3705 3.48097L11.361 3.5168L11.36 3.51891L10.8889 5.2261C10.8796 5.26003 10.8706 5.29164 10.8626 5.32094C10.8934 5.32101 10.927 5.322 10.9627 5.322H11.9006C12.4263 5.322 12.783 5.31906 13.0651 5.36731C14.8182 5.66725 15.9851 7.34574 15.6564 9.09363C15.6035 9.37493 15.4769 9.70926 15.2939 10.2023L14.337 12.7799C14.1401 13.3105 13.9773 13.7518 13.8101 14.1025C13.6375 14.4646 13.4385 14.7794 13.1441 15.0425C12.9712 15.197 12.7801 15.3303 12.5751 15.4387C12.2259 15.6232 11.8608 15.7 11.4612 15.7359C11.0742 15.7705 10.6034 15.7696 10.0374 15.7696H4.87371C4.08047 15.7696 3.42922 15.7703 2.90728 15.7138C2.37206 15.6558 1.88985 15.5311 1.4667 15.2237C1.22409 15.0475 1.01072 14.834 0.834405 14.5914C0.52696 14.1683 0.401312 13.6861 0.343323 13.1509C0.286761 12.6288 0.28747 11.977 0.28747 11.1834V9.51411C0.28747 8.84785 0.281286 8.36721 0.399176 7.95656C0.671091 7.00941 1.41109 6.26838 2.35823 5.99645C2.76888 5.87855 3.24952 5.88579 3.91579 5.88579C4.11977 5.88579 4.14542 5.88325 4.16238 5.88053C4.23526 5.8687 4.30403 5.83669 4.35839 5.78674C4.37104 5.77511 4.38755 5.7561 4.51436 5.59494L8.25648 0.839033L8.25754 0.837979L8.27861 0.811633ZM1.69116 11.1834C1.69116 12.0083 1.69211 12.5712 1.73859 13.0002C1.78365 13.4158 1.86467 13.6222 1.96937 13.7663C2.05914 13.8898 2.16727 13.999 2.29079 14.0888C2.43495 14.1935 2.6421 14.2745 3.05797 14.3195C3.45891 14.363 3.97631 14.3656 4.71564 14.3659C4.30795 13.8053 4.06447 13.1172 4.06437 12.371V8.59412H5.46807V12.371C5.46832 13.4734 6.3616 14.367 7.46401 14.367H10.0374C10.6286 14.367 11.0269 14.3663 11.3368 14.3385C11.6339 14.3118 11.7956 14.2639 11.9196 14.1984C12.024 14.1431 12.1213 14.0747 12.2094 13.996C12.3139 13.9025 12.4151 13.7679 12.5434 13.4986C12.6774 13.2177 12.8162 12.8451 13.0219 12.2909L13.9787 9.71328C14.1848 9.15822 14.253 8.96737 14.278 8.83439C14.4617 7.85698 13.8092 6.91901 12.829 6.75098C12.6956 6.72816 12.4928 6.72464 11.9006 6.72464H10.9627C10.7737 6.72464 10.5693 6.72663 10.4 6.70672C10.2211 6.68568 9.96696 6.6303 9.74764 6.43167C9.64448 6.33817 9.5595 6.22616 9.49683 6.10183C9.36384 5.8379 9.37793 5.57905 9.40515 5.40104C9.43094 5.23267 9.48666 5.03623 9.53688 4.8541L10.0079 3.14585L10.0174 3.11108C10.1488 2.61344 10.0077 2.08344 9.64648 1.71687L9.60854 1.67893L9.55058 1.6431C9.48789 1.62049 9.41419 1.6382 9.36932 1.69368L9.35773 1.70633L9.35878 1.70738L5.61666 6.46224C5.51816 6.58741 5.42231 6.71336 5.30683 6.81948C5.05069 7.05477 4.73119 7.20945 4.3879 7.26525C4.23309 7.29038 4.07507 7.28843 3.91579 7.28843C3.1535 7.28843 2.9191 7.29576 2.74604 7.34534C2.26358 7.48385 1.88558 7.86087 1.74702 8.34331C1.69732 8.51642 1.69116 8.75116 1.69116 9.51411V11.1834Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.72451 15.1086C7.18929 15.7706 6.22975 15.8695 5.57357 15.3598L5.44643 15.2493L5.42247 15.2253L5.41934 15.2233L5.39016 15.1941C4.68239 14.4805 4.40679 13.4442 4.66589 12.4731L4.66693 12.4689L4.67631 12.4335L4.67735 12.4314L5.14318 10.7432C5.15243 10.7096 5.1613 10.6784 5.16923 10.6494C5.13878 10.6493 5.10558 10.6484 5.07023 10.6484H4.14274C3.62288 10.6484 3.27015 10.6513 2.9912 10.6035C1.25757 10.3069 0.103662 8.64709 0.42863 6.91861C0.480965 6.64044 0.606164 6.30981 0.787119 5.8223L1.73336 3.27328C1.92812 2.74859 2.08912 2.31215 2.25442 1.96542C2.42515 1.60731 2.62191 1.296 2.91304 1.03584C3.08408 0.883016 3.273 0.751185 3.47579 0.644009C3.82102 0.461569 4.18214 0.385575 4.57731 0.350131C4.95993 0.315849 5.42553 0.316783 5.98521 0.316783H11.0916C11.876 0.316783 12.52 0.316134 13.0362 0.372015C13.5655 0.429358 14.0423 0.552599 14.4608 0.856601C14.7007 1.03091 14.9117 1.24199 15.086 1.48187C15.3901 1.90033 15.5143 2.37716 15.5717 2.90645C15.6276 3.42275 15.6269 4.06727 15.6269 4.85209V6.5028C15.6269 7.16167 15.633 7.63697 15.5164 8.04306C15.2475 8.97969 14.5158 9.71248 13.5791 9.9814C13.173 10.098 12.6977 10.0908 12.0389 10.0908C11.8372 10.0908 11.8118 10.0933 11.795 10.096C11.723 10.1077 11.6549 10.1394 11.6012 10.1888C11.5887 10.2003 11.5724 10.2191 11.447 10.3784L7.74639 15.0815L7.74535 15.0826L7.72451 15.1086ZM14.2388 4.85209C14.2388 4.03635 14.2379 3.47971 14.1919 3.05547C14.1473 2.64449 14.0672 2.44037 13.9637 2.29785C13.8749 2.17569 13.768 2.06776 13.6458 1.97896C13.5033 1.87539 13.2984 1.7953 12.8872 1.75074C12.4907 1.70779 11.979 1.70518 11.2479 1.70489C11.6511 2.25924 11.8918 2.93974 11.8919 3.67762V7.41257H10.5038V3.67762C10.5036 2.58751 9.62023 1.70384 8.53007 1.70384H5.98521C5.40065 1.70384 5.00679 1.70449 4.70028 1.73198C4.40651 1.75836 4.24662 1.80577 4.12399 1.87058C4.02069 1.92518 3.92452 1.99283 3.8374 2.07067C3.73401 2.16312 3.634 2.29627 3.50705 2.56255C3.37462 2.84034 3.23734 3.2088 3.03393 3.75682L2.08768 6.30584C1.88395 6.85474 1.81646 7.04347 1.79172 7.17497C1.61005 8.14152 2.25533 9.06908 3.22464 9.23524C3.35654 9.25781 3.55717 9.26129 4.14274 9.26129H5.07023C5.25717 9.26129 5.4593 9.25932 5.62672 9.27901C5.80364 9.29982 6.05492 9.35458 6.27179 9.551C6.37381 9.64347 6.45784 9.75424 6.51982 9.87719C6.65133 10.1382 6.6374 10.3942 6.61048 10.5702C6.58498 10.7367 6.52988 10.931 6.48022 11.1111L6.01439 12.8003L6.00501 12.8347C5.87513 13.3268 6.01464 13.8509 6.37184 14.2134L6.40935 14.251L6.46667 14.2864C6.52866 14.3088 6.60155 14.2912 6.64591 14.2364L6.65738 14.2239L6.65633 14.2228L10.3569 9.52078C10.4543 9.397 10.5491 9.27245 10.6633 9.1675C10.9166 8.93483 11.2325 8.78186 11.572 8.72669C11.7251 8.70184 11.8814 8.70376 12.0389 8.70376C12.7927 8.70376 13.0245 8.69651 13.1956 8.64748C13.6727 8.51051 14.0465 8.13768 14.1836 7.6606C14.2327 7.48941 14.2388 7.25727 14.2388 6.5028V4.85209Z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="fbb737a4">The codes are working nice but a few issues.
How can you confirm it is using chat history?
I asked the question "What was my first question in this chat?"
It answered:
"I couldn't find that information in the document."
While it should retrieve from the past conversation in the chat.</div></div><div class="_11d6b3a"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5" style="--assistant-last-margin-bottom: 32px;"><div class="ds-message _656c965"><div class="_7d763a7 _45cdda5" style="--deep-search-title-height: 38px; --group-title-sticky-top: 0px;"><div class="_68f84dc"></div><div class="ddd2f74b"></div></div><div class="ds-markdown" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph"><span>You're right! The issue is that the chat history isn't being properly utilized in the RAG prompt. The current implementation only uses the document context but doesn't effectively incorporate the conversation history. Let me fix this.</span></p><h2><span>Updated </span><code>modules/rag_engine.py</code></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> google<span class="token punctuation">.</span>generativeai <span class="token keyword">as</span> genai
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">class</span> <span class="token class-name">RAGEngine</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> api_key<span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"GEMINI_API_KEY not found in environment variables"</span><span class="token punctuation">)</span>
            
            genai<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>api_key<span class="token operator">=</span>api_key<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>model <span class="token operator">=</span> genai<span class="token punctuation">.</span>GenerativeModel<span class="token punctuation">(</span><span class="token string">'gemini-1.5-flash'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>chat_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✓ Gemini Flash 1.5 model initialized successfully"</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Failed to initialize Gemini: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>model <span class="token operator">=</span> <span class="token boolean">None</span>
            self<span class="token punctuation">.</span>chat_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">format_context</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> retrieved_chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Format retrieved chunks into context string"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> retrieved_chunks<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"No relevant document excerpts found."</span>
        
        context <span class="token operator">=</span> <span class="token string">"RELEVANT DOCUMENT CONTEXT:\n\n"</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> chunk <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>retrieved_chunks<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># Truncate text for better readability</span>
            text_preview <span class="token operator">=</span> chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">300</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'...'</span> <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">300</span> <span class="token keyword">else</span> chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span>
            context <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"📄 Excerpt </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string"> (Page </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">): </span><span class="token interpolation"><span class="token punctuation">{</span>text_preview<span class="token punctuation">}</span></span><span class="token string">\n"</span></span>
            context <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"   Similarity: </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'similarity_score'</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string">\n\n"</span></span>
        <span class="token keyword">return</span> context
    
    <span class="token keyword">def</span> <span class="token function">format_chat_history</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> chat_history<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Format chat history for context"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> chat_history<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"No previous conversation history."</span>
        
        history_text <span class="token operator">=</span> <span class="token string">"CONVERSATION HISTORY:\n\n"</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> msg <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>chat_history<span class="token punctuation">)</span><span class="token punctuation">:</span>
            role <span class="token operator">=</span> <span class="token string">"👤 USER"</span> <span class="token keyword">if</span> msg<span class="token punctuation">[</span><span class="token string">'role'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'user'</span> <span class="token keyword">else</span> <span class="token string">"🤖 ASSISTANT"</span>
            <span class="token comment"># Skip the current question if it's in history</span>
            <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>chat_history<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token keyword">and</span> msg<span class="token punctuation">[</span><span class="token string">'role'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'user'</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            history_text <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>role<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>msg<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span>
            
            <span class="token comment"># Add sources for assistant messages</span>
            <span class="token keyword">if</span> msg<span class="token punctuation">[</span><span class="token string">'role'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'assistant'</span> <span class="token keyword">and</span> msg<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'sources'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                history_text <span class="token operator">+=</span> <span class="token string">"   📍 Sources: "</span>
                source_pages <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>s<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> s <span class="token keyword">in</span> msg<span class="token punctuation">[</span><span class="token string">'sources'</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token string">'page'</span> <span class="token keyword">in</span> s<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                history_text <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"Pages </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>source_pages<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span>
            
            history_text <span class="token operator">+=</span> <span class="token string">"\n"</span>
        
        <span class="token keyword">return</span> history_text
    
    <span class="token keyword">def</span> <span class="token function">generate_response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> retrieved_chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">,</span> chat_history<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Dict<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Generate response using RAG with proper chat history integration"""</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>model <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">"Error: AI model not initialized. Please check your API key."</span><span class="token punctuation">,</span>
                <span class="token string">'timestamp'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'sources'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        
        <span class="token comment"># Format contexts</span>
        document_context <span class="token operator">=</span> self<span class="token punctuation">.</span>format_context<span class="token punctuation">(</span>retrieved_chunks<span class="token punctuation">)</span>
        history_context <span class="token operator">=</span> self<span class="token punctuation">.</span>format_chat_history<span class="token punctuation">(</span>chat_history <span class="token keyword">or</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Determine if this is a follow-up/about conversation question</span>
        is_about_conversation <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">(</span>keyword <span class="token keyword">in</span> query<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> keyword <span class="token keyword">in</span> <span class="token punctuation">[</span>
            <span class="token string">'previous'</span><span class="token punctuation">,</span> <span class="token string">'before'</span><span class="token punctuation">,</span> <span class="token string">'earlier'</span><span class="token punctuation">,</span> <span class="token string">'first question'</span><span class="token punctuation">,</span> <span class="token string">'last question'</span><span class="token punctuation">,</span>
            <span class="token string">'what did i ask'</span><span class="token punctuation">,</span> <span class="token string">'what was my'</span><span class="token punctuation">,</span> <span class="token string">'our conversation'</span><span class="token punctuation">,</span> <span class="token string">'chat history'</span><span class="token punctuation">,</span>
            <span class="token string">'did i ask'</span><span class="token punctuation">,</span> <span class="token string">'have we discussed'</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Create the prompt with enhanced instructions</span>
        prompt <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""
        ROLE: You are a helpful assistant that answers questions based on both the provided document content AND the conversation history.

        </span><span class="token interpolation"><span class="token punctuation">{</span>history_context<span class="token punctuation">}</span></span><span class="token string">

        </span><span class="token interpolation"><span class="token punctuation">{</span>document_context<span class="token punctuation">}</span></span><span class="token string">

        CURRENT QUESTION: </span><span class="token interpolation"><span class="token punctuation">{</span>query<span class="token punctuation">}</span></span><span class="token string">

        IMPORTANT INSTRUCTIONS:
        1. FIRST check if this question is about the CONVERSATION HISTORY (e.g., "what was my first question", "what did we discuss earlier")
        2. If it's about conversation history, answer using ONLY the conversation history above
        3. If it's about document content, answer using BOTH document context and conversation history when relevant
        4. If the answer requires document content but none is provided, say "I couldn't find relevant information in the document"
        5. ALWAYS cite page numbers when using document content [Page X]
        6. For conversation-based answers, be specific about what was discussed
        7. If you need to reference previous answers, mention they were based on specific pages

        CRITICAL: If the user asks about the conversation (e.g., "what was my first question"), you MUST use the conversation history, not the document.

        ANSWER:
        """</span></span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            response <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>generate_content<span class="token punctuation">(</span>prompt<span class="token punctuation">)</span>
            
            <span class="token comment"># Extract sources - only include document sources, not conversation references</span>
            sources <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> retrieved_chunks <span class="token keyword">and</span> <span class="token keyword">not</span> is_about_conversation<span class="token punctuation">:</span>
                sources <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'page'</span><span class="token punctuation">:</span> chunk<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'text'</span><span class="token punctuation">:</span> chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">}</span> 
                          <span class="token keyword">for</span> chunk <span class="token keyword">in</span> retrieved_chunks<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
            
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">'answer'</span><span class="token punctuation">:</span> response<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
                <span class="token string">'timestamp'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'sources'</span><span class="token punctuation">:</span> sources<span class="token punctuation">,</span>
                <span class="token string">'used_history'</span><span class="token punctuation">:</span> is_about_conversation
            <span class="token punctuation">}</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            error_msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"Error generating response: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>error_msg<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">"I'm having trouble generating a response at the moment. Please try again."</span><span class="token punctuation">,</span>
                <span class="token string">'timestamp'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'sources'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">'used_history'</span><span class="token punctuation">:</span> <span class="token boolean">False</span>
            <span class="token punctuation">}</span>
    
    <span class="token keyword">def</span> <span class="token function">add_to_history</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> role<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> sources<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Add message to chat history"""</span>
        self<span class="token punctuation">.</span>chat_history<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">'role'</span><span class="token punctuation">:</span> role<span class="token punctuation">,</span>
            <span class="token string">'content'</span><span class="token punctuation">:</span> content<span class="token punctuation">,</span>
            <span class="token string">'timestamp'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'sources'</span><span class="token punctuation">:</span> sources <span class="token keyword">or</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">get_history</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Get chat history"""</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>chat_history
    
    <span class="token keyword">def</span> <span class="token function">clear_history</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Clear chat history"""</span>
        self<span class="token punctuation">.</span>chat_history <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Update </span><code>app.py</code><span> to Handle Conversation History Better</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment"># ... existing imports and setup ...</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ... existing setup code ...</span>
    
    <span class="token keyword">if</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded<span class="token punctuation">:</span>
        <span class="token comment"># Display chat messages</span>
        <span class="token keyword">for</span> message <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">:</span>
            <span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span>message<span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>message<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"sources"</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"used_history"</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"Document Sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">for</span> source <span class="token keyword">in</span> message<span class="token punctuation">[</span><span class="token string">"sources"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Page </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">:** </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"used_history"</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    st<span class="token punctuation">.</span>caption<span class="token punctuation">(</span><span class="token string">"🤖 Answered using conversation history"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Chat input</span>
        <span class="token keyword">if</span> prompt <span class="token operator">:=</span> st<span class="token punctuation">.</span>chat_input<span class="token punctuation">(</span><span class="token string">"Ask a question about the PDF..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># Add user message</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> prompt<span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>prompt<span class="token punctuation">)</span>
            
            <span class="token comment"># Generate response</span>
            <span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span><span class="token string">"assistant"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    <span class="token keyword">with</span> st<span class="token punctuation">.</span>spinner<span class="token punctuation">(</span><span class="token string">"Thinking..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token comment"># For conversation history questions, don't search the document</span>
                        is_about_chat <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">(</span>keyword <span class="token keyword">in</span> prompt<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> keyword <span class="token keyword">in</span> <span class="token punctuation">[</span>
                            <span class="token string">'previous'</span><span class="token punctuation">,</span> <span class="token string">'before'</span><span class="token punctuation">,</span> <span class="token string">'earlier'</span><span class="token punctuation">,</span> <span class="token string">'first question'</span><span class="token punctuation">,</span> 
                            <span class="token string">'last question'</span><span class="token punctuation">,</span> <span class="token string">'what did i ask'</span><span class="token punctuation">,</span> <span class="token string">'what was my'</span><span class="token punctuation">,</span>
                            <span class="token string">'our conversation'</span><span class="token punctuation">,</span> <span class="token string">'chat history'</span><span class="token punctuation">,</span> <span class="token string">'did i ask'</span>
                        <span class="token punctuation">]</span><span class="token punctuation">)</span>
                        
                        <span class="token keyword">if</span> is_about_chat<span class="token punctuation">:</span>
                            <span class="token comment"># Don't search document for chat history questions</span>
                            retrieved_chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            <span class="token comment"># Search for relevant document chunks</span>
                            retrieved_chunks <span class="token operator">=</span> vector_store<span class="token punctuation">.</span>search<span class="token punctuation">(</span>prompt<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
                        
                        <span class="token comment"># Generate response</span>
                        response <span class="token operator">=</span> rag_engine<span class="token punctuation">.</span>generate_response<span class="token punctuation">(</span>
                            prompt<span class="token punctuation">,</span> 
                            retrieved_chunks<span class="token punctuation">,</span> 
                            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages
                        <span class="token punctuation">)</span>
                        response_text <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span>
                        sources <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'sources'</span><span class="token punctuation">]</span>
                        used_history <span class="token operator">=</span> response<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'used_history'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
                    
                    <span class="token comment"># Display response</span>
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response_text<span class="token punctuation">)</span>
                    
                    <span class="token comment"># Display sources if available and not using history</span>
                    <span class="token keyword">if</span> sources <span class="token keyword">and</span> <span class="token keyword">not</span> used_history<span class="token punctuation">:</span>
                        <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"Document Sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            <span class="token keyword">for</span> source <span class="token keyword">in</span> sources<span class="token punctuation">:</span>
                                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Page </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">:** </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">elif</span> used_history<span class="token punctuation">:</span>
                        st<span class="token punctuation">.</span>caption<span class="token punctuation">(</span><span class="token string">"🤖 Answered using conversation history"</span><span class="token punctuation">)</span>
                
                    <span class="token comment"># Add to session state</span>
                    st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> 
                        <span class="token string">"content"</span><span class="token punctuation">:</span> response_text<span class="token punctuation">,</span>
                        <span class="token string">"sources"</span><span class="token punctuation">:</span> sources<span class="token punctuation">,</span>
                        <span class="token string">"used_history"</span><span class="token punctuation">:</span> used_history
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    error_msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"Error generating response: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                    st<span class="token punctuation">.</span>error<span class="token punctuation">(</span>error_msg<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Response generation error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    
                    <span class="token comment"># Add error message to history</span>
                    st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> 
                        <span class="token string">"content"</span><span class="token punctuation">:</span> error_msg<span class="token punctuation">,</span>
                        <span class="token string">"sources"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string">"used_history"</span><span class="token punctuation">:</span> <span class="token boolean">False</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># ... rest of the code ...</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Enhanced Prompt for Better Conversation Handling</span></h2><p class="ds-markdown-paragraph"><span>The key improvements:</span></p><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>Better History Formatting</span></strong><span>: The conversation history is now clearly formatted and labeled</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Explicit Instructions</span></strong><span>: The prompt explicitly tells the model to use conversation history for chat-related questions</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Keyword Detection</span></strong><span>: The app detects when questions are about the conversation vs the document</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Visual Indicators</span></strong><span>: Shows when answers are based on conversation history vs document content</span></p></li></ol><h2><span>Test Questions to Verify Chat History Works</span></h2><p class="ds-markdown-paragraph"><span>Try these questions after having a conversation:</span></p><ol start="1"><li><p class="ds-markdown-paragraph"><span>"What was my first question?"</span></p></li><li><p class="ds-markdown-paragraph"><span>"What did we discuss earlier?"</span></p></li><li><p class="ds-markdown-paragraph"><span>"What was the last thing I asked about?"</span></p></li><li><p class="ds-markdown-paragraph"><span>"Summarize our conversation so far"</span></p></li><li><p class="ds-markdown-paragraph"><span>"What pages did you reference in your previous answers?"</span></p></li></ol><h2><span>Alternative: Even More Robust History Handling</span></h2><p class="ds-markdown-paragraph"><span>If you want even better conversation history handling, add this method to your RAG engine:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">def</span> <span class="token function">is_conversation_question</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> chat_history<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Determine if the question is about the conversation itself"""</span>
    query_lower <span class="token operator">=</span> query<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Keywords that indicate conversation questions</span>
    conversation_keywords <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'previous'</span><span class="token punctuation">,</span> <span class="token string">'before'</span><span class="token punctuation">,</span> <span class="token string">'earlier'</span><span class="token punctuation">,</span> <span class="token string">'first question'</span><span class="token punctuation">,</span> <span class="token string">'last question'</span><span class="token punctuation">,</span>
        <span class="token string">'what did i ask'</span><span class="token punctuation">,</span> <span class="token string">'what was my'</span><span class="token punctuation">,</span> <span class="token string">'our conversation'</span><span class="token punctuation">,</span> <span class="token string">'chat history'</span><span class="token punctuation">,</span>
        <span class="token string">'did i ask'</span><span class="token punctuation">,</span> <span class="token string">'have we discussed'</span><span class="token punctuation">,</span> <span class="token string">'summarize our chat'</span><span class="token punctuation">,</span>
        <span class="token string">'what did you say about'</span><span class="token punctuation">,</span> <span class="token string">'repeat your answer about'</span>
    <span class="token punctuation">]</span>
    
    <span class="token comment"># Check for conversation keywords</span>
    has_keywords <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">(</span>keyword <span class="token keyword">in</span> query_lower <span class="token keyword">for</span> keyword <span class="token keyword">in</span> conversation_keywords<span class="token punctuation">)</span>
    
    <span class="token comment"># Check if it's asking about specific previous topics</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> has_keywords <span class="token keyword">and</span> chat_history<span class="token punctuation">:</span>
        <span class="token comment"># Look for references to previous topics</span>
        previous_topics <span class="token operator">=</span> <span class="token punctuation">[</span>msg<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> msg <span class="token keyword">in</span> chat_history <span class="token keyword">if</span> msg<span class="token punctuation">[</span><span class="token string">'role'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'user'</span><span class="token punctuation">]</span>
        topic_references <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">(</span>topic<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> query_lower <span class="token keyword">for</span> topic <span class="token keyword">in</span> previous_topics<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> topic_references <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>chat_history<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
    
    <span class="token keyword">return</span> has_keywords</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><p class="ds-markdown-paragraph"><span>Then use this method in your </span><code>generate_response</code><span> function.</span></p><p class="ds-markdown-paragraph"><span>The updated code should now properly handle conversation history questions like "What was my first question?" by using the chat history instead of trying to find the answer in the document.</span></p></div></div><div class="ds-theme" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE;"></div><div class="ds-flex _0a3d93b" style="align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 10px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92142 0.349213C10.3745 0.349295 12.5564 1.50526 13.9558 3.299L15.1282 2.12765C15.3304 1.92552 15.6768 2.06949 15.6768 2.35544V5.53929C15.6766 5.71632 15.533 5.85982 15.356 5.86008H12.1711C11.8855 5.85976 11.7427 5.51471 11.9443 5.31255L12.9642 4.29062C11.8238 2.74311 9.98914 1.74112 7.92142 1.74104C4.46442 1.74104 1.66239 4.54307 1.66239 8.00006C1.66239 11.4571 4.46442 14.2591 7.92142 14.2591C11.3783 14.2589 14.1804 11.457 14.1804 8.00006H15.5723C15.5723 12.2252 12.1465 15.6508 7.92142 15.6509C3.6962 15.6509 0.270569 12.2253 0.270569 8.00006C0.270569 3.77485 3.6962 0.349213 7.92142 0.349213Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.27861 0.811633C8.81985 0.142255 9.79016 0.0422445 10.4537 0.557662L10.5823 0.669367L10.6065 0.693605L10.6097 0.695713L10.6392 0.72522C11.3549 1.44685 11.6336 2.49474 11.3716 3.47675L11.3705 3.48097L11.361 3.5168L11.36 3.51891L10.8889 5.2261C10.8796 5.26003 10.8706 5.29164 10.8626 5.32094C10.8934 5.32101 10.927 5.322 10.9627 5.322H11.9006C12.4263 5.322 12.783 5.31906 13.0651 5.36731C14.8182 5.66725 15.9851 7.34574 15.6564 9.09363C15.6035 9.37493 15.4769 9.70926 15.2939 10.2023L14.337 12.7799C14.1401 13.3105 13.9773 13.7518 13.8101 14.1025C13.6375 14.4646 13.4385 14.7794 13.1441 15.0425C12.9712 15.197 12.7801 15.3303 12.5751 15.4387C12.2259 15.6232 11.8608 15.7 11.4612 15.7359C11.0742 15.7705 10.6034 15.7696 10.0374 15.7696H4.87371C4.08047 15.7696 3.42922 15.7703 2.90728 15.7138C2.37206 15.6558 1.88985 15.5311 1.4667 15.2237C1.22409 15.0475 1.01072 14.834 0.834405 14.5914C0.52696 14.1683 0.401312 13.6861 0.343323 13.1509C0.286761 12.6288 0.28747 11.977 0.28747 11.1834V9.51411C0.28747 8.84785 0.281286 8.36721 0.399176 7.95656C0.671091 7.00941 1.41109 6.26838 2.35823 5.99645C2.76888 5.87855 3.24952 5.88579 3.91579 5.88579C4.11977 5.88579 4.14542 5.88325 4.16238 5.88053C4.23526 5.8687 4.30403 5.83669 4.35839 5.78674C4.37104 5.77511 4.38755 5.7561 4.51436 5.59494L8.25648 0.839033L8.25754 0.837979L8.27861 0.811633ZM1.69116 11.1834C1.69116 12.0083 1.69211 12.5712 1.73859 13.0002C1.78365 13.4158 1.86467 13.6222 1.96937 13.7663C2.05914 13.8898 2.16727 13.999 2.29079 14.0888C2.43495 14.1935 2.6421 14.2745 3.05797 14.3195C3.45891 14.363 3.97631 14.3656 4.71564 14.3659C4.30795 13.8053 4.06447 13.1172 4.06437 12.371V8.59412H5.46807V12.371C5.46832 13.4734 6.3616 14.367 7.46401 14.367H10.0374C10.6286 14.367 11.0269 14.3663 11.3368 14.3385C11.6339 14.3118 11.7956 14.2639 11.9196 14.1984C12.024 14.1431 12.1213 14.0747 12.2094 13.996C12.3139 13.9025 12.4151 13.7679 12.5434 13.4986C12.6774 13.2177 12.8162 12.8451 13.0219 12.2909L13.9787 9.71328C14.1848 9.15822 14.253 8.96737 14.278 8.83439C14.4617 7.85698 13.8092 6.91901 12.829 6.75098C12.6956 6.72816 12.4928 6.72464 11.9006 6.72464H10.9627C10.7737 6.72464 10.5693 6.72663 10.4 6.70672C10.2211 6.68568 9.96696 6.6303 9.74764 6.43167C9.64448 6.33817 9.5595 6.22616 9.49683 6.10183C9.36384 5.8379 9.37793 5.57905 9.40515 5.40104C9.43094 5.23267 9.48666 5.03623 9.53688 4.8541L10.0079 3.14585L10.0174 3.11108C10.1488 2.61344 10.0077 2.08344 9.64648 1.71687L9.60854 1.67893L9.55058 1.6431C9.48789 1.62049 9.41419 1.6382 9.36932 1.69368L9.35773 1.70633L9.35878 1.70738L5.61666 6.46224C5.51816 6.58741 5.42231 6.71336 5.30683 6.81948C5.05069 7.05477 4.73119 7.20945 4.3879 7.26525C4.23309 7.29038 4.07507 7.28843 3.91579 7.28843C3.1535 7.28843 2.9191 7.29576 2.74604 7.34534C2.26358 7.48385 1.88558 7.86087 1.74702 8.34331C1.69732 8.51642 1.69116 8.75116 1.69116 9.51411V11.1834Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.72451 15.1086C7.18929 15.7706 6.22975 15.8695 5.57357 15.3598L5.44643 15.2493L5.42247 15.2253L5.41934 15.2233L5.39016 15.1941C4.68239 14.4805 4.40679 13.4442 4.66589 12.4731L4.66693 12.4689L4.67631 12.4335L4.67735 12.4314L5.14318 10.7432C5.15243 10.7096 5.1613 10.6784 5.16923 10.6494C5.13878 10.6493 5.10558 10.6484 5.07023 10.6484H4.14274C3.62288 10.6484 3.27015 10.6513 2.9912 10.6035C1.25757 10.3069 0.103662 8.64709 0.42863 6.91861C0.480965 6.64044 0.606164 6.30981 0.787119 5.8223L1.73336 3.27328C1.92812 2.74859 2.08912 2.31215 2.25442 1.96542C2.42515 1.60731 2.62191 1.296 2.91304 1.03584C3.08408 0.883016 3.273 0.751185 3.47579 0.644009C3.82102 0.461569 4.18214 0.385575 4.57731 0.350131C4.95993 0.315849 5.42553 0.316783 5.98521 0.316783H11.0916C11.876 0.316783 12.52 0.316134 13.0362 0.372015C13.5655 0.429358 14.0423 0.552599 14.4608 0.856601C14.7007 1.03091 14.9117 1.24199 15.086 1.48187C15.3901 1.90033 15.5143 2.37716 15.5717 2.90645C15.6276 3.42275 15.6269 4.06727 15.6269 4.85209V6.5028C15.6269 7.16167 15.633 7.63697 15.5164 8.04306C15.2475 8.97969 14.5158 9.71248 13.5791 9.9814C13.173 10.098 12.6977 10.0908 12.0389 10.0908C11.8372 10.0908 11.8118 10.0933 11.795 10.096C11.723 10.1077 11.6549 10.1394 11.6012 10.1888C11.5887 10.2003 11.5724 10.2191 11.447 10.3784L7.74639 15.0815L7.74535 15.0826L7.72451 15.1086ZM14.2388 4.85209C14.2388 4.03635 14.2379 3.47971 14.1919 3.05547C14.1473 2.64449 14.0672 2.44037 13.9637 2.29785C13.8749 2.17569 13.768 2.06776 13.6458 1.97896C13.5033 1.87539 13.2984 1.7953 12.8872 1.75074C12.4907 1.70779 11.979 1.70518 11.2479 1.70489C11.6511 2.25924 11.8918 2.93974 11.8919 3.67762V7.41257H10.5038V3.67762C10.5036 2.58751 9.62023 1.70384 8.53007 1.70384H5.98521C5.40065 1.70384 5.00679 1.70449 4.70028 1.73198C4.40651 1.75836 4.24662 1.80577 4.12399 1.87058C4.02069 1.92518 3.92452 1.99283 3.8374 2.07067C3.73401 2.16312 3.634 2.29627 3.50705 2.56255C3.37462 2.84034 3.23734 3.2088 3.03393 3.75682L2.08768 6.30584C1.88395 6.85474 1.81646 7.04347 1.79172 7.17497C1.61005 8.14152 2.25533 9.06908 3.22464 9.23524C3.35654 9.25781 3.55717 9.26129 4.14274 9.26129H5.07023C5.25717 9.26129 5.4593 9.25932 5.62672 9.27901C5.80364 9.29982 6.05492 9.35458 6.27179 9.551C6.37381 9.64347 6.45784 9.75424 6.51982 9.87719C6.65133 10.1382 6.6374 10.3942 6.61048 10.5702C6.58498 10.7367 6.52988 10.931 6.48022 11.1111L6.01439 12.8003L6.00501 12.8347C5.87513 13.3268 6.01464 13.8509 6.37184 14.2134L6.40935 14.251L6.46667 14.2864C6.52866 14.3088 6.60155 14.2912 6.64591 14.2364L6.65738 14.2239L6.65633 14.2228L10.3569 9.52078C10.4543 9.397 10.5491 9.27245 10.6633 9.1675C10.9166 8.93483 11.2325 8.78186 11.572 8.72669C11.7251 8.70184 11.8814 8.70376 12.0389 8.70376C12.7927 8.70376 13.0245 8.69651 13.1956 8.64748C13.6727 8.51051 14.0465 8.13768 14.1836 7.6606C14.2327 7.48941 14.2388 7.25727 14.2388 6.5028V4.85209Z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="fbb737a4">I think it is trying to respond from past faiss index and not updating the faiss with new PDF files.</div></div><div class="_11d6b3a"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5" style="--assistant-last-margin-bottom: 32px;"><div class="ds-message _656c965"><div class="_7d763a7 _45cdda5" style="--deep-search-title-height: 38px; --group-title-sticky-top: 0px;"><div class="_68f84dc"></div><div class="ddd2f74b"></div></div><div class="ds-markdown" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph"><span>You're absolutely right! The issue is that the FAISS index isn't being updated when a new PDF is uploaded. The app is loading the old index from storage instead of creating a new one for the new PDF. Let me fix this.</span></p><h2><span>Updated </span><code>app.py</code><span> with Proper PDF Handling</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st
<span class="token keyword">import</span> os
<span class="token keyword">import</span> shutil
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>pdf_processor <span class="token keyword">import</span> PDFProcessor
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>rag_engine <span class="token keyword">import</span> RAGEngine
<span class="token keyword">import</span> json
<span class="token keyword">import</span> time

<span class="token comment"># Load environment variables</span>
load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Initialize components</span>
pdf_processor <span class="token operator">=</span> PDFProcessor<span class="token punctuation">(</span><span class="token punctuation">)</span>
vector_store <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
rag_engine <span class="token operator">=</span> RAGEngine<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">initialize_session_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Initialize session state variables"""</span>
    <span class="token keyword">if</span> <span class="token string">'processed'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">if</span> <span class="token string">'vector_store_loaded'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">if</span> <span class="token string">'messages'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token string">'processing_error'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processing_error <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">if</span> <span class="token string">'current_pdf_hash'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>current_pdf_hash <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">if</span> <span class="token string">'pdf_uploaded'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>pdf_uploaded <span class="token operator">=</span> <span class="token boolean">False</span>

<span class="token keyword">def</span> <span class="token function">get_file_hash</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Generate a simple hash for the file to track changes"""</span>
    <span class="token keyword">import</span> hashlib
    <span class="token builtin">file</span><span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    content <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># Reset file pointer</span>
    <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">clear_old_index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Clear the existing vector store index"""</span>
    index_path <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span>
    metadata_path <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>index_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>index_path<span class="token punctuation">)</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>metadata_path<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✓ Cleared old index files"</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error clearing old index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">process_pdf</span><span class="token punctuation">(</span>uploaded_file<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Process uploaded PDF file with proper cleanup"""</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> st<span class="token punctuation">.</span>spinner<span class="token punctuation">(</span><span class="token string">"Processing PDF..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># Clear any previous errors and state</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processing_error <span class="token operator">=</span> <span class="token boolean">None</span>
            
            <span class="token comment"># Generate file hash to track changes</span>
            file_hash <span class="token operator">=</span> get_file_hash<span class="token punctuation">(</span>uploaded_file<span class="token punctuation">)</span>
            
            <span class="token comment"># Check if this is a different file than before</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>current_pdf_hash <span class="token keyword">and</span> 
                st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>current_pdf_hash <span class="token operator">==</span> file_hash <span class="token keyword">and</span>
                st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded<span class="token punctuation">)</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"This PDF has already been processed. Using existing index."</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>
            
            <span class="token comment"># Clear old index if it exists</span>
            clear_old_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment"># Extract text from PDF</span>
            chunks <span class="token operator">=</span> pdf_processor<span class="token punctuation">.</span>process_pdf<span class="token punctuation">(</span>uploaded_file<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> chunks<span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No text could be extracted from the PDF"</span><span class="token punctuation">)</span>
            
            <span class="token comment"># Create new vector index</span>
            vector_store<span class="token punctuation">.</span>create_index<span class="token punctuation">(</span>chunks<span class="token punctuation">)</span>
            
            <span class="token comment"># Update session state</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed <span class="token operator">=</span> <span class="token boolean">True</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded <span class="token operator">=</span> <span class="token boolean">True</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>current_pdf_hash <span class="token operator">=</span> file_hash
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>pdf_uploaded <span class="token operator">=</span> <span class="token boolean">True</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># Clear chat history for new PDF</span>
            
            st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"PDF processed successfully! You can now ask questions."</span><span class="token punctuation">)</span>
            
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        error_msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"Error processing PDF: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processing_error <span class="token operator">=</span> error_msg
        st<span class="token punctuation">.</span>error<span class="token punctuation">(</span>error_msg<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Processing error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">load_existing_index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Load existing index if available"""</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> vector_store<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded <span class="token operator">=</span> <span class="token boolean">True</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading existing index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    st<span class="token punctuation">.</span>set_page_config<span class="token punctuation">(</span>
        page_title<span class="token operator">=</span><span class="token string">"PDF Chatbot"</span><span class="token punctuation">,</span>
        page_icon<span class="token operator">=</span><span class="token string">"📚"</span><span class="token punctuation">,</span>
        layout<span class="token operator">=</span><span class="token string">"wide"</span>
    <span class="token punctuation">)</span>
    
    st<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"📚 PDF Chatbot with Gemini Flash 1.5"</span><span class="token punctuation">)</span>
    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"Upload a PDF and chat with it using AI!"</span><span class="token punctuation">)</span>
    
    initialize_session_state<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Sidebar for PDF upload</span>
    <span class="token keyword">with</span> st<span class="token punctuation">.</span>sidebar<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"📄 Upload PDF"</span><span class="token punctuation">)</span>
        uploaded_file <span class="token operator">=</span> st<span class="token punctuation">.</span>file_uploader<span class="token punctuation">(</span>
            <span class="token string">"Choose a PDF file"</span><span class="token punctuation">,</span> 
            <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"pdf"</span><span class="token punctuation">,</span>
            <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Upload any PDF document to start chatting"</span>
        <span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> uploaded_file<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>pdf_uploaded <span class="token operator">=</span> <span class="token boolean">True</span>
            file_hash <span class="token operator">=</span> get_file_hash<span class="token punctuation">(</span>uploaded_file<span class="token punctuation">)</span>
            
            <span class="token comment"># Show processing button only for new files</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">not</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>current_pdf_hash <span class="token keyword">or</span> 
                st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>current_pdf_hash <span class="token operator">!=</span> file_hash <span class="token keyword">or</span>
                <span class="token keyword">not</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded<span class="token punctuation">)</span><span class="token punctuation">:</span>
                
                <span class="token keyword">if</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"Process PDF"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"primary"</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token string">"process_btn"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    process_pdf<span class="token punctuation">(</span>uploaded_file<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"✅ PDF already processed and ready!"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Display processing status</span>
        <span class="token keyword">if</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"✅ PDF processed successfully!"</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"🔄 Process New PDF"</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token string">"new_pdf_btn"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># Reset state for new PDF</span>
                st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processed <span class="token operator">=</span> <span class="token boolean">False</span>
                st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded <span class="token operator">=</span> <span class="token boolean">False</span>
                st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>current_pdf_hash <span class="token operator">=</span> <span class="token boolean">None</span>
                st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                st<span class="token punctuation">.</span>rerun<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Display errors if any</span>
        <span class="token keyword">if</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processing_error<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>error<span class="token punctuation">(</span>st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>processing_error<span class="token punctuation">)</span>
            
        <span class="token comment"># Display chat history</span>
        st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"💬 Conversation History"</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> msg <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span>msg<span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>msg<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> msg<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"sources"</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> msg<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"used_history"</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"View Sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">for</span> source <span class="token keyword">in</span> msg<span class="token punctuation">[</span><span class="token string">"sources"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Page </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># Main chat area</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded <span class="token keyword">and</span> <span class="token keyword">not</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>pdf_uploaded<span class="token punctuation">:</span>
        <span class="token comment"># Try to load existing index on startup</span>
        <span class="token keyword">if</span> load_existing_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>sidebar<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"Loaded existing PDF index!"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"👈 Please upload a PDF file to get started!"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded<span class="token punctuation">:</span>
        <span class="token comment"># Display chat messages</span>
        <span class="token keyword">for</span> message <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">:</span>
            <span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span>message<span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>message<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"sources"</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"used_history"</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"Document Sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">for</span> source <span class="token keyword">in</span> message<span class="token punctuation">[</span><span class="token string">"sources"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Page </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">:** </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"used_history"</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    st<span class="token punctuation">.</span>caption<span class="token punctuation">(</span><span class="token string">"🤖 Answered using conversation history"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Chat input</span>
        <span class="token keyword">if</span> prompt <span class="token operator">:=</span> st<span class="token punctuation">.</span>chat_input<span class="token punctuation">(</span><span class="token string">"Ask a question about the PDF..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># Add user message</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> prompt<span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>prompt<span class="token punctuation">)</span>
            
            <span class="token comment"># Generate response</span>
            <span class="token keyword">with</span> st<span class="token punctuation">.</span>chat_message<span class="token punctuation">(</span><span class="token string">"assistant"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    <span class="token keyword">with</span> st<span class="token punctuation">.</span>spinner<span class="token punctuation">(</span><span class="token string">"Thinking..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token comment"># For conversation history questions, don't search the document</span>
                        is_about_chat <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">(</span>keyword <span class="token keyword">in</span> prompt<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> keyword <span class="token keyword">in</span> <span class="token punctuation">[</span>
                            <span class="token string">'previous'</span><span class="token punctuation">,</span> <span class="token string">'before'</span><span class="token punctuation">,</span> <span class="token string">'earlier'</span><span class="token punctuation">,</span> <span class="token string">'first question'</span><span class="token punctuation">,</span> 
                            <span class="token string">'last question'</span><span class="token punctuation">,</span> <span class="token string">'what did i ask'</span><span class="token punctuation">,</span> <span class="token string">'what was my'</span><span class="token punctuation">,</span>
                            <span class="token string">'our conversation'</span><span class="token punctuation">,</span> <span class="token string">'chat history'</span><span class="token punctuation">,</span> <span class="token string">'did i ask'</span>
                        <span class="token punctuation">]</span><span class="token punctuation">)</span>
                        
                        <span class="token keyword">if</span> is_about_chat<span class="token punctuation">:</span>
                            <span class="token comment"># Don't search document for chat history questions</span>
                            retrieved_chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            <span class="token comment"># Search for relevant document chunks</span>
                            retrieved_chunks <span class="token operator">=</span> vector_store<span class="token punctuation">.</span>search<span class="token punctuation">(</span>prompt<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
                        
                        <span class="token comment"># Generate response</span>
                        response <span class="token operator">=</span> rag_engine<span class="token punctuation">.</span>generate_response<span class="token punctuation">(</span>
                            prompt<span class="token punctuation">,</span> 
                            retrieved_chunks<span class="token punctuation">,</span> 
                            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages
                        <span class="token punctuation">)</span>
                        response_text <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span>
                        sources <span class="token operator">=</span> response<span class="token punctuation">[</span><span class="token string">'sources'</span><span class="token punctuation">]</span>
                        used_history <span class="token operator">=</span> response<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'used_history'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
                    
                    <span class="token comment"># Display response</span>
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response_text<span class="token punctuation">)</span>
                    
                    <span class="token comment"># Display sources if available and not using history</span>
                    <span class="token keyword">if</span> sources <span class="token keyword">and</span> <span class="token keyword">not</span> used_history<span class="token punctuation">:</span>
                        <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"Document Sources"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            <span class="token keyword">for</span> source <span class="token keyword">in</span> sources<span class="token punctuation">:</span>
                                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Page </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">:** </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">elif</span> used_history<span class="token punctuation">:</span>
                        st<span class="token punctuation">.</span>caption<span class="token punctuation">(</span><span class="token string">"🤖 Answered using conversation history"</span><span class="token punctuation">)</span>
                
                    <span class="token comment"># Add to session state</span>
                    st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> 
                        <span class="token string">"content"</span><span class="token punctuation">:</span> response_text<span class="token punctuation">,</span>
                        <span class="token string">"sources"</span><span class="token punctuation">:</span> sources<span class="token punctuation">,</span>
                        <span class="token string">"used_history"</span><span class="token punctuation">:</span> used_history
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    error_msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"Error generating response: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                    st<span class="token punctuation">.</span>error<span class="token punctuation">(</span>error_msg<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Response generation error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    
                    <span class="token comment"># Add error message to history</span>
                    st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> 
                        <span class="token string">"content"</span><span class="token punctuation">:</span> error_msg<span class="token punctuation">,</span>
                        <span class="token string">"sources"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string">"used_history"</span><span class="token punctuation">:</span> <span class="token boolean">False</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>pdf_uploaded <span class="token keyword">and</span> <span class="token keyword">not</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>vector_store_loaded<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">"⚠️ PDF uploaded but not processed. Click 'Process PDF' in the sidebar."</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Enhanced </span><code>vector_store.py</code><span> with Better Cleanup</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> faiss
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict
<span class="token keyword">import</span> google<span class="token punctuation">.</span>generativeai <span class="token keyword">as</span> genai
<span class="token keyword">from</span> sentence_transformers <span class="token keyword">import</span> SentenceTransformer

<span class="token keyword">class</span> <span class="token class-name">VectorStore</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span><span class="token punctuation">,</span> metadata_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>index_path <span class="token operator">=</span> index_path
        self<span class="token punctuation">.</span>metadata_path <span class="token operator">=</span> metadata_path
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> <span class="token number">384</span>
        self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">False</span>
        
    <span class="token keyword">def</span> <span class="token function">clear_index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Clear the current index and metadata"""</span>
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
    <span class="token keyword">def</span> <span class="token function">delete_storage_files</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Delete the index and metadata files from storage"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✓ Storage files deleted"</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error deleting storage files: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">initialize_embedding_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialize embedding model with proper error handling"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># Try to use Gemini embeddings</span>
            api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> api_key<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"GEMINI_API_KEY not found in environment variables"</span><span class="token punctuation">)</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"API key missing"</span><span class="token punctuation">)</span>
                
            genai<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>api_key<span class="token operator">=</span>api_key<span class="token punctuation">)</span>
            
            <span class="token comment"># Test the API with a simple embedding</span>
            test_result <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                content<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"test embedding"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
            <span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> <span class="token string">'embedding'</span> <span class="token keyword">in</span> test_result<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>test_result<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> <span class="token string">'gemini'</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Using Gemini embeddings (dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">True</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No embedding returned from Gemini"</span><span class="token punctuation">)</span>
                
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Gemini embedding failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">, falling back to local model"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">_initialize_local_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialize local embedding model as fallback"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> SentenceTransformer<span class="token punctuation">(</span><span class="token string">'all-MiniLM-L6-v2'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">.</span>get_sentence_embedding_dimension<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Using local SentenceTransformer (dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Failed to initialize local model: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">get_embeddings</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> texts<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Get embeddings for texts with proper error handling"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_initialized<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Embedding model not initialized"</span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>embedding_model <span class="token operator">==</span> <span class="token string">'gemini'</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                result <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                    model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                    content<span class="token operator">=</span>texts<span class="token punctuation">,</span>
                    task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
                <span class="token punctuation">)</span>
                
                embeddings <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
                
                <span class="token comment"># Ensure correct shape</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    embeddings <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>texts<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    <span class="token comment"># Handle case where Gemini returns single embedding for multiple texts</span>
                    embeddings <span class="token operator">=</span> np<span class="token punctuation">.</span>tile<span class="token punctuation">(</span>embeddings<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>texts<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token keyword">return</span> embeddings
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Gemini embedding generation failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"All embedding methods failed"</span><span class="token punctuation">)</span>
                <span class="token comment"># Fall through to local model</span>
        
        <span class="token comment"># Use local model</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">,</span> SentenceTransformer<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>texts<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No valid embedding model available"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_index</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Create FAISS index from chunks - with cleanup"""</span>
        <span class="token comment"># Clear any existing index first</span>
        self<span class="token punctuation">.</span>clear_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>delete_storage_files<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        texts <span class="token operator">=</span> <span class="token punctuation">[</span>chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> chunk <span class="token keyword">in</span> chunks<span class="token punctuation">]</span>
        
        <span class="token comment"># Initialize embedding model</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Failed to initialize embedding model"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Get embeddings</span>
        embeddings <span class="token operator">=</span> self<span class="token punctuation">.</span>get_embeddings<span class="token punctuation">(</span>texts<span class="token punctuation">)</span>
        
        <span class="token comment"># Create FAISS index</span>
        dimension <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>IndexFlatL2<span class="token punctuation">(</span>dimension<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>add<span class="token punctuation">(</span>embeddings<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> chunks
        
        <span class="token comment"># Create storage directory if it doesn't exist</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Save index and metadata</span>
        faiss<span class="token punctuation">.</span>write_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index<span class="token punctuation">,</span> self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span> f<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ New index created with </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>chunks<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> chunks"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">load_index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Load existing index with proper initialization"""</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading existing index..."</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>read_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
                
                <span class="token comment"># Initialize embedding model for new searches</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Warning: Failed to initialize embedding model after loading index"</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">False</span>
                
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Index loaded with </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> chunks"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Search for similar chunks with proper validation"""</span>
        <span class="token comment"># Check if index is loaded</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Index not loaded, attempting to load..."</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Index not initialized and cannot be loaded"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Check if embedding model is initialized</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_initialized<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Embedding model not initialized, initializing..."</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Embedding model not initialized"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Check if we have data to search</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Warning: Index is empty"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token comment"># Get query embedding</span>
        query_embedding <span class="token operator">=</span> self<span class="token punctuation">.</span>get_embeddings<span class="token punctuation">(</span><span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Ensure k doesn't exceed number of vectors</span>
        k <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">)</span>
        
        <span class="token comment"># Perform search</span>
        distances<span class="token punctuation">,</span> indices <span class="token operator">=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>search<span class="token punctuation">(</span>query_embedding<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
        
        results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> idx<span class="token punctuation">,</span> distance <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>indices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> distances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> idx <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">:</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>metadata<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
                result<span class="token punctuation">[</span><span class="token string">'similarity_score'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> distance<span class="token punctuation">)</span><span class="token punctuation">)</span>
                results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        
        <span class="token comment"># Sort by similarity score (descending)</span>
        results<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token string">'similarity_score'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> results
    
    <span class="token keyword">def</span> <span class="token function">is_ready</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Check if the vector store is ready for searching"""</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> 
                self<span class="token punctuation">.</span>is_initialized <span class="token keyword">and</span> 
                <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Key Improvements:</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>File Hash Tracking</span></strong><span>: Uses MD5 hashes to detect when a new PDF is uploaded</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Proper Cleanup</span></strong><span>: Clears old index files before creating new ones</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>State Management</span></strong><span>: Better session state management for tracking PDF changes</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Visual Feedback</span></strong><span>: Clear UI indicators showing processing status</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Reset Functionality</span></strong><span>: Added button to process new PDFs</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Chat History Reset</span></strong><span>: Clears chat history when a new PDF is processed</span></p></li></ol><p class="ds-markdown-paragraph"><span>Now when you upload a new PDF, the app will:</span></p><ol start="1"><li><p class="ds-markdown-paragraph"><span>Detect it's a different file</span></p></li><li><p class="ds-markdown-paragraph"><span>Clear the old index</span></p></li><li><p class="ds-markdown-paragraph"><span>Create a new index for the new PDF</span></p></li><li><p class="ds-markdown-paragraph"><span>Reset the chat history</span></p></li><li><p class="ds-markdown-paragraph"><span>Provide clear visual feedback</span></p></li></ol><p class="ds-markdown-paragraph"><span>This should resolve the issue of the app using old FAISS index data when new PDFs are uploaded.</span></p></div></div><div class="ds-theme" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE;"></div><div class="ds-flex _0a3d93b" style="align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 10px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92142 0.349213C10.3745 0.349295 12.5564 1.50526 13.9558 3.299L15.1282 2.12765C15.3304 1.92552 15.6768 2.06949 15.6768 2.35544V5.53929C15.6766 5.71632 15.533 5.85982 15.356 5.86008H12.1711C11.8855 5.85976 11.7427 5.51471 11.9443 5.31255L12.9642 4.29062C11.8238 2.74311 9.98914 1.74112 7.92142 1.74104C4.46442 1.74104 1.66239 4.54307 1.66239 8.00006C1.66239 11.4571 4.46442 14.2591 7.92142 14.2591C11.3783 14.2589 14.1804 11.457 14.1804 8.00006H15.5723C15.5723 12.2252 12.1465 15.6508 7.92142 15.6509C3.6962 15.6509 0.270569 12.2253 0.270569 8.00006C0.270569 3.77485 3.6962 0.349213 7.92142 0.349213Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.27861 0.811633C8.81985 0.142255 9.79016 0.0422445 10.4537 0.557662L10.5823 0.669367L10.6065 0.693605L10.6097 0.695713L10.6392 0.72522C11.3549 1.44685 11.6336 2.49474 11.3716 3.47675L11.3705 3.48097L11.361 3.5168L11.36 3.51891L10.8889 5.2261C10.8796 5.26003 10.8706 5.29164 10.8626 5.32094C10.8934 5.32101 10.927 5.322 10.9627 5.322H11.9006C12.4263 5.322 12.783 5.31906 13.0651 5.36731C14.8182 5.66725 15.9851 7.34574 15.6564 9.09363C15.6035 9.37493 15.4769 9.70926 15.2939 10.2023L14.337 12.7799C14.1401 13.3105 13.9773 13.7518 13.8101 14.1025C13.6375 14.4646 13.4385 14.7794 13.1441 15.0425C12.9712 15.197 12.7801 15.3303 12.5751 15.4387C12.2259 15.6232 11.8608 15.7 11.4612 15.7359C11.0742 15.7705 10.6034 15.7696 10.0374 15.7696H4.87371C4.08047 15.7696 3.42922 15.7703 2.90728 15.7138C2.37206 15.6558 1.88985 15.5311 1.4667 15.2237C1.22409 15.0475 1.01072 14.834 0.834405 14.5914C0.52696 14.1683 0.401312 13.6861 0.343323 13.1509C0.286761 12.6288 0.28747 11.977 0.28747 11.1834V9.51411C0.28747 8.84785 0.281286 8.36721 0.399176 7.95656C0.671091 7.00941 1.41109 6.26838 2.35823 5.99645C2.76888 5.87855 3.24952 5.88579 3.91579 5.88579C4.11977 5.88579 4.14542 5.88325 4.16238 5.88053C4.23526 5.8687 4.30403 5.83669 4.35839 5.78674C4.37104 5.77511 4.38755 5.7561 4.51436 5.59494L8.25648 0.839033L8.25754 0.837979L8.27861 0.811633ZM1.69116 11.1834C1.69116 12.0083 1.69211 12.5712 1.73859 13.0002C1.78365 13.4158 1.86467 13.6222 1.96937 13.7663C2.05914 13.8898 2.16727 13.999 2.29079 14.0888C2.43495 14.1935 2.6421 14.2745 3.05797 14.3195C3.45891 14.363 3.97631 14.3656 4.71564 14.3659C4.30795 13.8053 4.06447 13.1172 4.06437 12.371V8.59412H5.46807V12.371C5.46832 13.4734 6.3616 14.367 7.46401 14.367H10.0374C10.6286 14.367 11.0269 14.3663 11.3368 14.3385C11.6339 14.3118 11.7956 14.2639 11.9196 14.1984C12.024 14.1431 12.1213 14.0747 12.2094 13.996C12.3139 13.9025 12.4151 13.7679 12.5434 13.4986C12.6774 13.2177 12.8162 12.8451 13.0219 12.2909L13.9787 9.71328C14.1848 9.15822 14.253 8.96737 14.278 8.83439C14.4617 7.85698 13.8092 6.91901 12.829 6.75098C12.6956 6.72816 12.4928 6.72464 11.9006 6.72464H10.9627C10.7737 6.72464 10.5693 6.72663 10.4 6.70672C10.2211 6.68568 9.96696 6.6303 9.74764 6.43167C9.64448 6.33817 9.5595 6.22616 9.49683 6.10183C9.36384 5.8379 9.37793 5.57905 9.40515 5.40104C9.43094 5.23267 9.48666 5.03623 9.53688 4.8541L10.0079 3.14585L10.0174 3.11108C10.1488 2.61344 10.0077 2.08344 9.64648 1.71687L9.60854 1.67893L9.55058 1.6431C9.48789 1.62049 9.41419 1.6382 9.36932 1.69368L9.35773 1.70633L9.35878 1.70738L5.61666 6.46224C5.51816 6.58741 5.42231 6.71336 5.30683 6.81948C5.05069 7.05477 4.73119 7.20945 4.3879 7.26525C4.23309 7.29038 4.07507 7.28843 3.91579 7.28843C3.1535 7.28843 2.9191 7.29576 2.74604 7.34534C2.26358 7.48385 1.88558 7.86087 1.74702 8.34331C1.69732 8.51642 1.69116 8.75116 1.69116 9.51411V11.1834Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.72451 15.1086C7.18929 15.7706 6.22975 15.8695 5.57357 15.3598L5.44643 15.2493L5.42247 15.2253L5.41934 15.2233L5.39016 15.1941C4.68239 14.4805 4.40679 13.4442 4.66589 12.4731L4.66693 12.4689L4.67631 12.4335L4.67735 12.4314L5.14318 10.7432C5.15243 10.7096 5.1613 10.6784 5.16923 10.6494C5.13878 10.6493 5.10558 10.6484 5.07023 10.6484H4.14274C3.62288 10.6484 3.27015 10.6513 2.9912 10.6035C1.25757 10.3069 0.103662 8.64709 0.42863 6.91861C0.480965 6.64044 0.606164 6.30981 0.787119 5.8223L1.73336 3.27328C1.92812 2.74859 2.08912 2.31215 2.25442 1.96542C2.42515 1.60731 2.62191 1.296 2.91304 1.03584C3.08408 0.883016 3.273 0.751185 3.47579 0.644009C3.82102 0.461569 4.18214 0.385575 4.57731 0.350131C4.95993 0.315849 5.42553 0.316783 5.98521 0.316783H11.0916C11.876 0.316783 12.52 0.316134 13.0362 0.372015C13.5655 0.429358 14.0423 0.552599 14.4608 0.856601C14.7007 1.03091 14.9117 1.24199 15.086 1.48187C15.3901 1.90033 15.5143 2.37716 15.5717 2.90645C15.6276 3.42275 15.6269 4.06727 15.6269 4.85209V6.5028C15.6269 7.16167 15.633 7.63697 15.5164 8.04306C15.2475 8.97969 14.5158 9.71248 13.5791 9.9814C13.173 10.098 12.6977 10.0908 12.0389 10.0908C11.8372 10.0908 11.8118 10.0933 11.795 10.096C11.723 10.1077 11.6549 10.1394 11.6012 10.1888C11.5887 10.2003 11.5724 10.2191 11.447 10.3784L7.74639 15.0815L7.74535 15.0826L7.72451 15.1086ZM14.2388 4.85209C14.2388 4.03635 14.2379 3.47971 14.1919 3.05547C14.1473 2.64449 14.0672 2.44037 13.9637 2.29785C13.8749 2.17569 13.768 2.06776 13.6458 1.97896C13.5033 1.87539 13.2984 1.7953 12.8872 1.75074C12.4907 1.70779 11.979 1.70518 11.2479 1.70489C11.6511 2.25924 11.8918 2.93974 11.8919 3.67762V7.41257H10.5038V3.67762C10.5036 2.58751 9.62023 1.70384 8.53007 1.70384H5.98521C5.40065 1.70384 5.00679 1.70449 4.70028 1.73198C4.40651 1.75836 4.24662 1.80577 4.12399 1.87058C4.02069 1.92518 3.92452 1.99283 3.8374 2.07067C3.73401 2.16312 3.634 2.29627 3.50705 2.56255C3.37462 2.84034 3.23734 3.2088 3.03393 3.75682L2.08768 6.30584C1.88395 6.85474 1.81646 7.04347 1.79172 7.17497C1.61005 8.14152 2.25533 9.06908 3.22464 9.23524C3.35654 9.25781 3.55717 9.26129 4.14274 9.26129H5.07023C5.25717 9.26129 5.4593 9.25932 5.62672 9.27901C5.80364 9.29982 6.05492 9.35458 6.27179 9.551C6.37381 9.64347 6.45784 9.75424 6.51982 9.87719C6.65133 10.1382 6.6374 10.3942 6.61048 10.5702C6.58498 10.7367 6.52988 10.931 6.48022 11.1111L6.01439 12.8003L6.00501 12.8347C5.87513 13.3268 6.01464 13.8509 6.37184 14.2134L6.40935 14.251L6.46667 14.2864C6.52866 14.3088 6.60155 14.2912 6.64591 14.2364L6.65738 14.2239L6.65633 14.2228L10.3569 9.52078C10.4543 9.397 10.5491 9.27245 10.6633 9.1675C10.9166 8.93483 11.2325 8.78186 11.572 8.72669C11.7251 8.70184 11.8814 8.70376 12.0389 8.70376C12.7927 8.70376 13.0245 8.69651 13.1956 8.64748C13.6727 8.51051 14.0465 8.13768 14.1836 7.6606C14.2327 7.48941 14.2388 7.25727 14.2388 6.5028V4.85209Z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="fbb737a4">I think, now it's almost done. How to prepare an accuracy table (manual judgment is okay) for this project?</div></div><div class="_11d6b3a"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5" style="--assistant-last-margin-bottom: 32px;"><div class="ds-message _656c965"><div class="_7d763a7 _45cdda5" style="--deep-search-title-height: 38px; --group-title-sticky-top: 0px;"><div class="_68f84dc"></div><div class="ddd2f74b"></div></div><div class="ds-markdown" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph"><span>Excellent! Let me help you create an accuracy evaluation system for your PDF chatbot. I'll provide a comprehensive evaluation module that includes test questions, manual judgment, and an accuracy table.</span></p><h2><span>1. Evaluation Module</span></h2><p class="ds-markdown-paragraph"><strong><span>modules/</span><a href="https://evaluator.py/" target="_blank" rel="noreferrer"><span>evaluator.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict<span class="token punctuation">,</span> Any
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>rag_engine <span class="token keyword">import</span> RAGEngine

<span class="token keyword">class</span> <span class="token class-name">Evaluator</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>vector_store <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>rag_engine <span class="token operator">=</span> RAGEngine<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>results_file <span class="token operator">=</span> <span class="token string">"evaluation_results.json"</span>
        self<span class="token punctuation">.</span>test_questions_file <span class="token operator">=</span> <span class="token string">"test_questions.json"</span>
        
    <span class="token keyword">def</span> <span class="token function">load_test_questions</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Load test questions from JSON file"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>test_questions_file<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>test_questions_file<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    <span class="token keyword">return</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># Return default test questions</span>
                <span class="token keyword">return</span> self<span class="token punctuation">.</span>get_default_test_questions<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading test questions: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>get_default_test_questions<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">get_default_test_questions</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Get default test questions for evaluation"""</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"What is the main topic of this document?"</span><span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"general"</span><span class="token punctuation">,</span>
                <span class="token string">"difficulty"</span><span class="token punctuation">:</span> <span class="token string">"easy"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"What are the key findings or conclusions?"</span><span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"general"</span><span class="token punctuation">,</span> 
                <span class="token string">"difficulty"</span><span class="token punctuation">:</span> <span class="token string">"medium"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                <span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"On which pages is [important concept] discussed?"</span><span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"specific"</span><span class="token punctuation">,</span>
                <span class="token string">"difficulty"</span><span class="token punctuation">:</span> <span class="token string">"medium"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
                <span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"What methodology was used in the research?"</span><span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"specific"</span><span class="token punctuation">,</span>
                <span class="token string">"difficulty"</span><span class="token punctuation">:</span> <span class="token string">"medium"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
                <span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"What are the recommendations provided?"</span><span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"specific"</span><span class="token punctuation">,</span>
                <span class="token string">"difficulty"</span><span class="token punctuation">:</span> <span class="token string">"easy"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
                <span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"Who are the authors and what are their affiliations?"</span><span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"factual"</span><span class="token punctuation">,</span> 
                <span class="token string">"difficulty"</span><span class="token punctuation">:</span> <span class="token string">"easy"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
                <span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"What data sources were used?"</span><span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"specific"</span><span class="token punctuation">,</span>
                <span class="token string">"difficulty"</span><span class="token punctuation">:</span> <span class="token string">"hard"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
                <span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"What limitations are mentioned in the document?"</span><span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"specific"</span><span class="token punctuation">,</span>
                <span class="token string">"difficulty"</span><span class="token punctuation">:</span> <span class="token string">"medium"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
                <span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"How many sections does the document have?"</span><span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"structural"</span><span class="token punctuation">,</span>
                <span class="token string">"difficulty"</span><span class="token punctuation">:</span> <span class="token string">"easy"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                <span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"What future work is suggested?"</span><span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"specific"</span><span class="token punctuation">,</span>
                <span class="token string">"difficulty"</span><span class="token punctuation">:</span> <span class="token string">"medium"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">generate_answers</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> questions<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Generate answers for test questions"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>vector_store<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No PDF index found. Please process a PDF first."</span><span class="token punctuation">)</span>
        
        results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> question <span class="token keyword">in</span> questions<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># Search for relevant chunks</span>
                retrieved_chunks <span class="token operator">=</span> self<span class="token punctuation">.</span>vector_store<span class="token punctuation">.</span>search<span class="token punctuation">(</span>question<span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
                
                <span class="token comment"># Generate response</span>
                response <span class="token operator">=</span> self<span class="token punctuation">.</span>rag_engine<span class="token punctuation">.</span>generate_response<span class="token punctuation">(</span>
                    question<span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                    retrieved_chunks<span class="token punctuation">,</span> 
                    <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token punctuation">)</span>
                
                result <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token operator">**</span>question<span class="token punctuation">,</span>
                    <span class="token string">"generated_answer"</span><span class="token punctuation">:</span> response<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">"retrieved_chunks"</span><span class="token punctuation">:</span> retrieved_chunks<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># Top 3 chunks</span>
                    <span class="token string">"timestamp"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">"sources_used"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>chunk<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> chunk <span class="token keyword">in</span> retrieved_chunks<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">"manual_judgment"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
                    <span class="token string">"is_correct"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
                    <span class="token string">"confidence"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
                    <span class="token string">"notes"</span><span class="token punctuation">:</span> <span class="token boolean">None</span>
                <span class="token punctuation">}</span>
                
                results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
                
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error generating answer for question </span><span class="token interpolation"><span class="token punctuation">{</span>question<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                results<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token operator">**</span>question<span class="token punctuation">,</span>
                    <span class="token string">"generated_answer"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"Error: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
                    <span class="token string">"retrieved_chunks"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">"timestamp"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">"sources_used"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">"manual_judgment"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
                    <span class="token string">"is_correct"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
                    <span class="token string">"confidence"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    <span class="token string">"notes"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"Generation error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> results
    
    <span class="token keyword">def</span> <span class="token function">save_results</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> results<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Save evaluation results to JSON file"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># Load existing results if any</span>
            all_results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>results_file<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>results_file<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    all_results <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
            
            <span class="token comment"># Add new results</span>
            all_results<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>results<span class="token punctuation">)</span>
            
            <span class="token comment"># Save back to file</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>results_file<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>all_results<span class="token punctuation">,</span> f<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Saved </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> evaluation results"</span></span><span class="token punctuation">)</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error saving results: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">load_results</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Load evaluation results from JSON file"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>results_file<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>results_file<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    <span class="token keyword">return</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading results: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">calculate_metrics</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> results<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Calculate accuracy metrics from results"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> results<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        
        total <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
        correct <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">for</span> r <span class="token keyword">in</span> results <span class="token keyword">if</span> r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_correct'</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        partially_correct <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">for</span> r <span class="token keyword">in</span> results <span class="token keyword">if</span> r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_correct'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'partial'</span><span class="token punctuation">)</span>
        incorrect <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">for</span> r <span class="token keyword">in</span> results <span class="token keyword">if</span> r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_correct'</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
        not_judged <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">for</span> r <span class="token keyword">in</span> results <span class="token keyword">if</span> r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_correct'</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        
        accuracy <span class="token operator">=</span> correct <span class="token operator">/</span> total <span class="token keyword">if</span> total <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
        partial_accuracy <span class="token operator">=</span> <span class="token punctuation">(</span>correct <span class="token operator">+</span> partially_correct <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">/</span> total <span class="token keyword">if</span> total <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
        
        <span class="token comment"># Calculate by category</span>
        categories <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">:</span>
            cat <span class="token operator">=</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'category'</span><span class="token punctuation">,</span> <span class="token string">'unknown'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> cat <span class="token keyword">not</span> <span class="token keyword">in</span> categories<span class="token punctuation">:</span>
                categories<span class="token punctuation">[</span>cat<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'total'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'correct'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'partial'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
            
            categories<span class="token punctuation">[</span>cat<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">if</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_correct'</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                categories<span class="token punctuation">[</span>cat<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'correct'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">elif</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_correct'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'partial'</span><span class="token punctuation">:</span>
                categories<span class="token punctuation">[</span>cat<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'partial'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
        
        <span class="token comment"># Calculate by difficulty</span>
        difficulties <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">:</span>
            diff <span class="token operator">=</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'difficulty'</span><span class="token punctuation">,</span> <span class="token string">'unknown'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> diff <span class="token keyword">not</span> <span class="token keyword">in</span> difficulties<span class="token punctuation">:</span>
                difficulties<span class="token punctuation">[</span>diff<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'total'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'correct'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'partial'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
            
            difficulties<span class="token punctuation">[</span>diff<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">if</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_correct'</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                difficulties<span class="token punctuation">[</span>diff<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'correct'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">elif</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_correct'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'partial'</span><span class="token punctuation">:</span>
                difficulties<span class="token punctuation">[</span>diff<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'partial'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
        
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token string">'total_questions'</span><span class="token punctuation">:</span> total<span class="token punctuation">,</span>
            <span class="token string">'correct_answers'</span><span class="token punctuation">:</span> correct<span class="token punctuation">,</span>
            <span class="token string">'partially_correct'</span><span class="token punctuation">:</span> partially_correct<span class="token punctuation">,</span>
            <span class="token string">'incorrect_answers'</span><span class="token punctuation">:</span> incorrect<span class="token punctuation">,</span>
            <span class="token string">'not_judged'</span><span class="token punctuation">:</span> not_judged<span class="token punctuation">,</span>
            <span class="token string">'accuracy'</span><span class="token punctuation">:</span> <span class="token builtin">round</span><span class="token punctuation">(</span>accuracy <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'partial_accuracy'</span><span class="token punctuation">:</span> <span class="token builtin">round</span><span class="token punctuation">(</span>partial_accuracy <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">'categories'</span><span class="token punctuation">:</span> categories<span class="token punctuation">,</span>
            <span class="token string">'difficulties'</span><span class="token punctuation">:</span> difficulties<span class="token punctuation">,</span>
            <span class="token string">'evaluation_date'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    
    <span class="token keyword">def</span> <span class="token function">generate_accuracy_table</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> results<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Generate a pandas DataFrame with accuracy metrics"""</span>
        metrics <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_metrics<span class="token punctuation">(</span>results<span class="token punctuation">)</span>
        
        <span class="token comment"># Create summary table</span>
        summary_data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'Metric'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token string">'Total Questions'</span><span class="token punctuation">,</span>
                <span class="token string">'Correct Answers'</span><span class="token punctuation">,</span> 
                <span class="token string">'Partially Correct'</span><span class="token punctuation">,</span>
                <span class="token string">'Incorrect Answers'</span><span class="token punctuation">,</span>
                <span class="token string">'Not Judged'</span><span class="token punctuation">,</span>
                <span class="token string">'Accuracy (%)'</span><span class="token punctuation">,</span>
                <span class="token string">'Partial Accuracy (%)'</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'Value'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                metrics<span class="token punctuation">[</span><span class="token string">'total_questions'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                metrics<span class="token punctuation">[</span><span class="token string">'correct_answers'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                metrics<span class="token punctuation">[</span><span class="token string">'partially_correct'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                metrics<span class="token punctuation">[</span><span class="token string">'incorrect_answers'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                metrics<span class="token punctuation">[</span><span class="token string">'not_judged'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                metrics<span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                metrics<span class="token punctuation">[</span><span class="token string">'partial_accuracy'</span><span class="token punctuation">]</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">return</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>summary_data<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">generate_detailed_report</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> results<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Generate a detailed text report"""</span>
        metrics <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_metrics<span class="token punctuation">(</span>results<span class="token punctuation">)</span>
        
        report <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">"PDF Chatbot Evaluation Report"</span><span class="token punctuation">,</span>
            <span class="token string">"="</span> <span class="token operator">*</span> <span class="token number">40</span><span class="token punctuation">,</span>
            <span class="token string-interpolation"><span class="token string">f"Evaluation Date: </span><span class="token interpolation"><span class="token punctuation">{</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d %H:%M'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
            <span class="token string-interpolation"><span class="token string">f"Total Questions: </span><span class="token interpolation"><span class="token punctuation">{</span>metrics<span class="token punctuation">[</span><span class="token string">'total_questions'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
            <span class="token string-interpolation"><span class="token string">f"Correct Answers: </span><span class="token interpolation"><span class="token punctuation">{</span>metrics<span class="token punctuation">[</span><span class="token string">'correct_answers'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
            <span class="token string-interpolation"><span class="token string">f"Partially Correct: </span><span class="token interpolation"><span class="token punctuation">{</span>metrics<span class="token punctuation">[</span><span class="token string">'partially_correct'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
            <span class="token string-interpolation"><span class="token string">f"Incorrect Answers: </span><span class="token interpolation"><span class="token punctuation">{</span>metrics<span class="token punctuation">[</span><span class="token string">'incorrect_answers'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
            <span class="token string-interpolation"><span class="token string">f"Accuracy: </span><span class="token interpolation"><span class="token punctuation">{</span>metrics<span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">%"</span></span><span class="token punctuation">,</span>
            <span class="token string-interpolation"><span class="token string">f"Partial Accuracy: </span><span class="token interpolation"><span class="token punctuation">{</span>metrics<span class="token punctuation">[</span><span class="token string">'partial_accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">%"</span></span><span class="token punctuation">,</span>
            <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"By Category:"</span>
        <span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> category<span class="token punctuation">,</span> stats <span class="token keyword">in</span> metrics<span class="token punctuation">[</span><span class="token string">'categories'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            acc <span class="token operator">=</span> <span class="token punctuation">(</span>stats<span class="token punctuation">[</span><span class="token string">'correct'</span><span class="token punctuation">]</span> <span class="token operator">/</span> stats<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">if</span> stats<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
            report<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  </span><span class="token interpolation"><span class="token punctuation">{</span>category<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>stats<span class="token punctuation">[</span><span class="token string">'correct'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>stats<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">{</span>acc<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">%)"</span></span><span class="token punctuation">)</span>
        
        report<span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"By Difficulty:"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> difficulty<span class="token punctuation">,</span> stats <span class="token keyword">in</span> metrics<span class="token punctuation">[</span><span class="token string">'difficulties'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            acc <span class="token operator">=</span> <span class="token punctuation">(</span>stats<span class="token punctuation">[</span><span class="token string">'correct'</span><span class="token punctuation">]</span> <span class="token operator">/</span> stats<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">if</span> stats<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
            report<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  </span><span class="token interpolation"><span class="token punctuation">{</span>difficulty<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>stats<span class="token punctuation">[</span><span class="token string">'correct'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>stats<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">{</span>acc<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">%)"</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> <span class="token string">"\n"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>report<span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>2. Evaluation Interface</span></h2><p class="ds-markdown-paragraph"><strong><a href="https://evaluate.py/" target="_blank" rel="noreferrer"><span>evaluate.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> json
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>evaluator <span class="token keyword">import</span> Evaluator
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    st<span class="token punctuation">.</span>set_page_config<span class="token punctuation">(</span>
        page_title<span class="token operator">=</span><span class="token string">"PDF Chatbot Evaluation"</span><span class="token punctuation">,</span>
        page_icon<span class="token operator">=</span><span class="token string">"📊"</span><span class="token punctuation">,</span>
        layout<span class="token operator">=</span><span class="token string">"wide"</span>
    <span class="token punctuation">)</span>
    
    st<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"📊 PDF Chatbot Evaluation"</span><span class="token punctuation">)</span>
    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"Evaluate the accuracy of your PDF chatbot"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Initialize components</span>
    evaluator <span class="token operator">=</span> Evaluator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    vector_store <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Check if PDF is processed</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> vector_store<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"❌ No PDF index found. Please process a PDF first in the main app."</span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Go to the main app, upload a PDF, and click 'Process PDF' before evaluating."</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    
    st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"✅ PDF index loaded successfully!"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Load or create test questions</span>
    test_questions <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>load_test_questions<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Section 1: Generate Answers</span>
    st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"1. Generate Answers"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"🔄 Generate Answers for Test Questions"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"primary"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> st<span class="token punctuation">.</span>spinner<span class="token punctuation">(</span><span class="token string">"Generating answers for test questions..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            results <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>generate_answers<span class="token punctuation">(</span>test_questions<span class="token punctuation">)</span>
            evaluator<span class="token punctuation">.</span>save_results<span class="token punctuation">(</span>results<span class="token punctuation">)</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results <span class="token operator">=</span> results
            st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ Generated answers for </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> questions!"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># Load existing results if available</span>
    <span class="token keyword">if</span> <span class="token string">'results'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        existing_results <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>load_results<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> existing_results<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results <span class="token operator">=</span> existing_results
            st<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Loaded </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>existing_results<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> existing evaluation results"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token comment"># Section 2: Manual Judgment</span>
    st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"2. Manual Judgment"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token keyword">not</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Generate answers first or load existing results to begin manual judgment."</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># Filter to only unjudged results</span>
        unjudged_results <span class="token operator">=</span> <span class="token punctuation">[</span>r <span class="token keyword">for</span> r <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results <span class="token keyword">if</span> r<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_correct'</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> unjudged_results<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>unjudged_results<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> questions need manual judgment**"</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">for</span> i<span class="token punctuation">,</span> result <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>unjudged_results<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># Show first 5</span>
                <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Question </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Generated Answer:**"</span></span><span class="token punctuation">)</span>
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'generated_answer'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"**Retrieved Sources:**"</span><span class="token punctuation">)</span>
                    <span class="token keyword">for</span> chunk <span class="token keyword">in</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'retrieved_chunks'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Page </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">,</span> <span class="token string">'N/A'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">200]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
                    
                    col1<span class="token punctuation">,</span> col2<span class="token punctuation">,</span> col3 <span class="token operator">=</span> st<span class="token punctuation">.</span>columns<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
                    
                    <span class="token keyword">with</span> col1<span class="token punctuation">:</span>
                        judgment <span class="token operator">=</span> st<span class="token punctuation">.</span>radio<span class="token punctuation">(</span>
                            <span class="token string">"Judgment:"</span><span class="token punctuation">,</span>
                            <span class="token punctuation">[</span><span class="token string">"Correct"</span><span class="token punctuation">,</span> <span class="token string">"Partially Correct"</span><span class="token punctuation">,</span> <span class="token string">"Incorrect"</span><span class="token punctuation">,</span> <span class="token string">"Not Sure"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                            key<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"judge_</span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                        <span class="token punctuation">)</span>
                    
                    <span class="token keyword">with</span> col2<span class="token punctuation">:</span>
                        confidence <span class="token operator">=</span> st<span class="token punctuation">.</span>slider<span class="token punctuation">(</span>
                            <span class="token string">"Confidence:"</span><span class="token punctuation">,</span>
                            <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
                            key<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"conf_</span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                        <span class="token punctuation">)</span>
                    
                    <span class="token keyword">with</span> col3<span class="token punctuation">:</span>
                        notes <span class="token operator">=</span> st<span class="token punctuation">.</span>text_area<span class="token punctuation">(</span>
                            <span class="token string">"Notes:"</span><span class="token punctuation">,</span>
                            key<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"notes_</span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                        <span class="token punctuation">)</span>
                    
                    <span class="token keyword">if</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"Save Judgment"</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"save_</span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token comment"># Update the result</span>
                        result<span class="token punctuation">[</span><span class="token string">'manual_judgment'</span><span class="token punctuation">]</span> <span class="token operator">=</span> judgment
                        result<span class="token punctuation">[</span><span class="token string">'confidence'</span><span class="token punctuation">]</span> <span class="token operator">=</span> confidence
                        result<span class="token punctuation">[</span><span class="token string">'notes'</span><span class="token punctuation">]</span> <span class="token operator">=</span> notes
                        
                        <span class="token comment"># Map judgment to is_correct</span>
                        <span class="token keyword">if</span> judgment <span class="token operator">==</span> <span class="token string">"Correct"</span><span class="token punctuation">:</span>
                            result<span class="token punctuation">[</span><span class="token string">'is_correct'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">elif</span> judgment <span class="token operator">==</span> <span class="token string">"Partially Correct"</span><span class="token punctuation">:</span>
                            result<span class="token punctuation">[</span><span class="token string">'is_correct'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'partial'</span>
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            result<span class="token punctuation">[</span><span class="token string">'is_correct'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>
                        
                        <span class="token comment"># Save updated results</span>
                        evaluator<span class="token punctuation">.</span>save_results<span class="token punctuation">(</span>st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results<span class="token punctuation">)</span>
                        st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"Judgment saved!"</span><span class="token punctuation">)</span>
                        st<span class="token punctuation">.</span>rerun<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"✅ All questions have been judged!"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Section 3: Accuracy Table</span>
    st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"3. Accuracy Results"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results<span class="token punctuation">:</span>
        <span class="token comment"># Calculate metrics</span>
        metrics <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>calculate_metrics<span class="token punctuation">(</span>st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results<span class="token punctuation">)</span>
        
        <span class="token comment"># Summary table</span>
        st<span class="token punctuation">.</span>subheader<span class="token punctuation">(</span><span class="token string">"Summary Metrics"</span><span class="token punctuation">)</span>
        summary_df <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>generate_accuracy_table<span class="token punctuation">(</span>st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results<span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>dataframe<span class="token punctuation">(</span>summary_df<span class="token punctuation">,</span> use_container_width<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Detailed results</span>
        st<span class="token punctuation">.</span>subheader<span class="token punctuation">(</span><span class="token string">"Detailed Results"</span><span class="token punctuation">)</span>
        results_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results<span class="token punctuation">)</span>
        
        <span class="token comment"># Select columns to display</span>
        display_cols <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'question'</span><span class="token punctuation">,</span> <span class="token string">'category'</span><span class="token punctuation">,</span> <span class="token string">'difficulty'</span><span class="token punctuation">,</span> <span class="token string">'is_correct'</span><span class="token punctuation">,</span> <span class="token string">'confidence'</span><span class="token punctuation">,</span> <span class="token string">'manual_judgment'</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token builtin">all</span><span class="token punctuation">(</span>col <span class="token keyword">in</span> results_df<span class="token punctuation">.</span>columns <span class="token keyword">for</span> col <span class="token keyword">in</span> display_cols<span class="token punctuation">)</span><span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>dataframe<span class="token punctuation">(</span>results_df<span class="token punctuation">[</span>display_cols<span class="token punctuation">]</span><span class="token punctuation">,</span> use_container_width<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Download options</span>
        col1<span class="token punctuation">,</span> col2 <span class="token operator">=</span> st<span class="token punctuation">.</span>columns<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token keyword">with</span> col1<span class="token punctuation">:</span>
            <span class="token keyword">if</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"📥 Download Detailed Results (JSON)"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                json_data <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
                st<span class="token punctuation">.</span>download_button<span class="token punctuation">(</span>
                    label<span class="token operator">=</span><span class="token string">"Download JSON"</span><span class="token punctuation">,</span>
                    data<span class="token operator">=</span>json_data<span class="token punctuation">,</span>
                    file_name<span class="token operator">=</span><span class="token string">"evaluation_results.json"</span><span class="token punctuation">,</span>
                    mime<span class="token operator">=</span><span class="token string">"application/json"</span>
                <span class="token punctuation">)</span>
        
        <span class="token keyword">with</span> col2<span class="token punctuation">:</span>
            <span class="token keyword">if</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"📊 Download Summary Report"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                report <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>generate_detailed_report<span class="token punctuation">(</span>st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results<span class="token punctuation">)</span>
                st<span class="token punctuation">.</span>download_button<span class="token punctuation">(</span>
                    label<span class="token operator">=</span><span class="token string">"Download Report"</span><span class="token punctuation">,</span>
                    data<span class="token operator">=</span>report<span class="token punctuation">,</span>
                    file_name<span class="token operator">=</span><span class="token string">"evaluation_report.txt"</span><span class="token punctuation">,</span>
                    mime<span class="token operator">=</span><span class="token string">"text/plain"</span>
                <span class="token punctuation">)</span>
        
        <span class="token comment"># Visualizations</span>
        st<span class="token punctuation">.</span>subheader<span class="token punctuation">(</span><span class="token string">"Visualizations"</span><span class="token punctuation">)</span>
        
        col1<span class="token punctuation">,</span> col2 <span class="token operator">=</span> st<span class="token punctuation">.</span>columns<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token keyword">with</span> col1<span class="token punctuation">:</span>
            <span class="token comment"># Category accuracy</span>
            <span class="token keyword">if</span> metrics<span class="token punctuation">[</span><span class="token string">'categories'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                cat_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span>
                    <span class="token punctuation">{</span><span class="token string">'Category'</span><span class="token punctuation">:</span> cat<span class="token punctuation">,</span> <span class="token string">'Accuracy'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>stats<span class="token punctuation">[</span><span class="token string">'correct'</span><span class="token punctuation">]</span> <span class="token operator">/</span> stats<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                    <span class="token keyword">for</span> cat<span class="token punctuation">,</span> stats <span class="token keyword">in</span> metrics<span class="token punctuation">[</span><span class="token string">'categories'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">]</span><span class="token punctuation">)</span>
                st<span class="token punctuation">.</span>bar_chart<span class="token punctuation">(</span>cat_df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'Category'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token keyword">with</span> col2<span class="token punctuation">:</span>
            <span class="token comment"># Difficulty accuracy</span>
            <span class="token keyword">if</span> metrics<span class="token punctuation">[</span><span class="token string">'difficulties'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                diff_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span>
                    <span class="token punctuation">{</span><span class="token string">'Difficulty'</span><span class="token punctuation">:</span> diff<span class="token punctuation">,</span> <span class="token string">'Accuracy'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>stats<span class="token punctuation">[</span><span class="token string">'correct'</span><span class="token punctuation">]</span> <span class="token operator">/</span> stats<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                    <span class="token keyword">for</span> diff<span class="token punctuation">,</span> stats <span class="token keyword">in</span> metrics<span class="token punctuation">[</span><span class="token string">'difficulties'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">]</span><span class="token punctuation">)</span>
                st<span class="token punctuation">.</span>bar_chart<span class="token punctuation">(</span>diff_df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'Difficulty'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"No evaluation results available. Generate answers first."</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>3. Sample Test Questions File</span></h2><p class="ds-markdown-paragraph"><strong><span>test_questions.json</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">json</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"question"</span><span class="token operator">:</span> <span class="token string">"What is the main topic or subject of this document?"</span><span class="token punctuation">,</span>
    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"general"</span><span class="token punctuation">,</span>
    <span class="token property">"difficulty"</span><span class="token operator">:</span> <span class="token string">"easy"</span><span class="token punctuation">,</span>
    <span class="token property">"expected_keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"main topic"</span><span class="token punctuation">,</span> <span class="token string">"subject"</span><span class="token punctuation">,</span> <span class="token string">"primary focus"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">"question"</span><span class="token operator">:</span> <span class="token string">"What are the key findings or conclusions presented?"</span><span class="token punctuation">,</span>
    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"general"</span><span class="token punctuation">,</span>
    <span class="token property">"difficulty"</span><span class="token operator">:</span> <span class="token string">"medium"</span><span class="token punctuation">,</span>
    <span class="token property">"expected_keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"findings"</span><span class="token punctuation">,</span> <span class="token string">"conclusions"</span><span class="token punctuation">,</span> <span class="token string">"results"</span><span class="token punctuation">,</span> <span class="token string">"summary"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">"question"</span><span class="token operator">:</span> <span class="token string">"What methodology or approach was used in this research?"</span><span class="token punctuation">,</span>
    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"specific"</span><span class="token punctuation">,</span>
    <span class="token property">"difficulty"</span><span class="token operator">:</span> <span class="token string">"medium"</span><span class="token punctuation">,</span>
    <span class="token property">"expected_keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"methodology"</span><span class="token punctuation">,</span> <span class="token string">"approach"</span><span class="token punctuation">,</span> <span class="token string">"methods"</span><span class="token punctuation">,</span> <span class="token string">"research design"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token property">"question"</span><span class="token operator">:</span> <span class="token string">"What are the main recommendations or suggestions?"</span><span class="token punctuation">,</span>
    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"specific"</span><span class="token punctuation">,</span>
    <span class="token property">"difficulty"</span><span class="token operator">:</span> <span class="token string">"easy"</span><span class="token punctuation">,</span>
    <span class="token property">"expected_keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"recommendations"</span><span class="token punctuation">,</span> <span class="token string">"suggestions"</span><span class="token punctuation">,</span> <span class="token string">"proposals"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"question"</span><span class="token operator">:</span> <span class="token string">"Who are the authors and what are their affiliations?"</span><span class="token punctuation">,</span>
    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"factual"</span><span class="token punctuation">,</span>
    <span class="token property">"difficulty"</span><span class="token operator">:</span> <span class="token string">"easy"</span><span class="token punctuation">,</span>
    <span class="token property">"expected_keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"authors"</span><span class="token punctuation">,</span> <span class="token string">"affiliations"</span><span class="token punctuation">,</span> <span class="token string">"institution"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
    <span class="token property">"question"</span><span class="token operator">:</span> <span class="token string">"What limitations or constraints are mentioned?"</span><span class="token punctuation">,</span>
    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"specific"</span><span class="token punctuation">,</span>
    <span class="token property">"difficulty"</span><span class="token operator">:</span> <span class="token string">"medium"</span><span class="token punctuation">,</span>
    <span class="token property">"expected_keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"limitations"</span><span class="token punctuation">,</span> <span class="token string">"constraints"</span><span class="token punctuation">,</span> <span class="token string">"challenges"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token property">"question"</span><span class="token operator">:</span> <span class="token string">"What future work or research directions are suggested?"</span><span class="token punctuation">,</span>
    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"specific"</span><span class="token punctuation">,</span>
    <span class="token property">"difficulty"</span><span class="token operator">:</span> <span class="token string">"medium"</span><span class="token punctuation">,</span>
    <span class="token property">"expected_keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"future work"</span><span class="token punctuation">,</span> <span class="token string">"research directions"</span><span class="token punctuation">,</span> <span class="token string">"next steps"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token property">"question"</span><span class="token operator">:</span> <span class="token string">"What data sources or references are used?"</span><span class="token punctuation">,</span>
    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"specific"</span><span class="token punctuation">,</span>
    <span class="token property">"difficulty"</span><span class="token operator">:</span> <span class="token string">"hard"</span><span class="token punctuation">,</span>
    <span class="token property">"expected_keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"data sources"</span><span class="token punctuation">,</span> <span class="token string">"references"</span><span class="token punctuation">,</span> <span class="token string">"bibliography"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
    <span class="token property">"question"</span><span class="token operator">:</span> <span class="token string">"How is the document structured? What are the main sections?"</span><span class="token punctuation">,</span>
    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"structural"</span><span class="token punctuation">,</span>
    <span class="token property">"difficulty"</span><span class="token operator">:</span> <span class="token string">"easy"</span><span class="token punctuation">,</span>
    <span class="token property">"expected_keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"structure"</span><span class="token punctuation">,</span> <span class="token string">"sections"</span><span class="token punctuation">,</span> <span class="token string">"organization"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token property">"question"</span><span class="token operator">:</span> <span class="token string">"What problem or gap does this document address?"</span><span class="token punctuation">,</span>
    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"general"</span><span class="token punctuation">,</span>
    <span class="token property">"difficulty"</span><span class="token operator">:</span> <span class="token string">"medium"</span><span class="token punctuation">,</span>
    <span class="token property">"expected_keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"problem"</span><span class="token punctuation">,</span> <span class="token string">"gap"</span><span class="token punctuation">,</span> <span class="token string">"research question"</span><span class="token punctuation">,</span> <span class="token string">"objective"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>4. How to Use the Evaluation System</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>Run the evaluation app:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>streamlit run evaluate.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>Process your PDF in the main app first</span></strong></p></li><li><p class="ds-markdown-paragraph"><strong><span>Generate answers</span></strong><span> for the test questions</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Manually judge</span></strong><span> each answer:</span></p><ul><li><p class="ds-markdown-paragraph"><strong><span>Correct</span></strong><span>: Answer is accurate and complete</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Partially Correct</span></strong><span>: Answer has some correct information but incomplete</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Incorrect</span></strong><span>: Answer is wrong or not from the document</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Rate confidence</span></strong><span> from 1-5</span></p></li></ul></li><li><p class="ds-markdown-paragraph"><strong><span>View the accuracy table</span></strong><span> with metrics:</span></p><ul><li><p class="ds-markdown-paragraph"><span>Overall accuracy</span></p></li><li><p class="ds-markdown-paragraph"><span>Accuracy by question category</span></p></li><li><p class="ds-markdown-paragraph"><span>Accuracy by difficulty level</span></p></li><li><p class="ds-markdown-paragraph"><span>Partial accuracy (counting partial as 0.5)</span></p></li></ul></li><li><p class="ds-markdown-paragraph"><strong><span>Download results</span></strong><span> as JSON or text report</span></p></li></ol><h2><span>5. Sample Accuracy Table Output</span></h2><p class="ds-markdown-paragraph"><span>The system will generate tables like:</span></p><div class="ds-scroll-area _1210dd7"><div class="ds-scroll-area__gutters" style="position: sticky; top: 0px; left: 0px; right: 0px; height: 0px; --container-height: 320px;"><div class="ds-scroll-area__horizontal-gutter" style="left: 0px; right: 0px; top: calc(var(--container-height) - 12px); height: 8px;"><div class="ds-scroll-area__horizontal-bar" style="display: none;"></div></div><div class="ds-scroll-area__vertical-gutter" style="right: 0px; top: 8px; bottom: calc(0px - var(--container-height) + 8px); width: 8px;"><div class="ds-scroll-area__vertical-bar" style="display: none;"></div></div></div><table><thead><tr><th><span>Metric</span></th><th><span>Value</span></th></tr></thead><tbody><tr><td><span>Total Questions</span></td><td><span>10</span></td></tr><tr><td><span>Correct Answers</span></td><td><span>7</span></td></tr><tr><td><span>Partially Correct</span></td><td><span>2</span></td></tr><tr><td><span>Incorrect Answers</span></td><td><span>1</span></td></tr><tr><td><span>Accuracy (%)</span></td><td><span>70.0</span></td></tr><tr><td><span>Partial Accuracy (%)</span></td><td><span>80.0</span></td></tr></tbody></table></div><p class="ds-markdown-paragraph"><span>And breakdowns by category and difficulty level.</span></p><p class="ds-markdown-paragraph"><span>This evaluation system meets the project requirement for "5–10 test questions + an accuracy table (manual judgment is okay)" and provides comprehensive metrics for assessing your PDF chatbot's performance.</span></p></div></div><div class="ds-theme" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE;"></div><div class="ds-flex _0a3d93b" style="align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 10px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92142 0.349213C10.3745 0.349295 12.5564 1.50526 13.9558 3.299L15.1282 2.12765C15.3304 1.92552 15.6768 2.06949 15.6768 2.35544V5.53929C15.6766 5.71632 15.533 5.85982 15.356 5.86008H12.1711C11.8855 5.85976 11.7427 5.51471 11.9443 5.31255L12.9642 4.29062C11.8238 2.74311 9.98914 1.74112 7.92142 1.74104C4.46442 1.74104 1.66239 4.54307 1.66239 8.00006C1.66239 11.4571 4.46442 14.2591 7.92142 14.2591C11.3783 14.2589 14.1804 11.457 14.1804 8.00006H15.5723C15.5723 12.2252 12.1465 15.6508 7.92142 15.6509C3.6962 15.6509 0.270569 12.2253 0.270569 8.00006C0.270569 3.77485 3.6962 0.349213 7.92142 0.349213Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.27861 0.811633C8.81985 0.142255 9.79016 0.0422445 10.4537 0.557662L10.5823 0.669367L10.6065 0.693605L10.6097 0.695713L10.6392 0.72522C11.3549 1.44685 11.6336 2.49474 11.3716 3.47675L11.3705 3.48097L11.361 3.5168L11.36 3.51891L10.8889 5.2261C10.8796 5.26003 10.8706 5.29164 10.8626 5.32094C10.8934 5.32101 10.927 5.322 10.9627 5.322H11.9006C12.4263 5.322 12.783 5.31906 13.0651 5.36731C14.8182 5.66725 15.9851 7.34574 15.6564 9.09363C15.6035 9.37493 15.4769 9.70926 15.2939 10.2023L14.337 12.7799C14.1401 13.3105 13.9773 13.7518 13.8101 14.1025C13.6375 14.4646 13.4385 14.7794 13.1441 15.0425C12.9712 15.197 12.7801 15.3303 12.5751 15.4387C12.2259 15.6232 11.8608 15.7 11.4612 15.7359C11.0742 15.7705 10.6034 15.7696 10.0374 15.7696H4.87371C4.08047 15.7696 3.42922 15.7703 2.90728 15.7138C2.37206 15.6558 1.88985 15.5311 1.4667 15.2237C1.22409 15.0475 1.01072 14.834 0.834405 14.5914C0.52696 14.1683 0.401312 13.6861 0.343323 13.1509C0.286761 12.6288 0.28747 11.977 0.28747 11.1834V9.51411C0.28747 8.84785 0.281286 8.36721 0.399176 7.95656C0.671091 7.00941 1.41109 6.26838 2.35823 5.99645C2.76888 5.87855 3.24952 5.88579 3.91579 5.88579C4.11977 5.88579 4.14542 5.88325 4.16238 5.88053C4.23526 5.8687 4.30403 5.83669 4.35839 5.78674C4.37104 5.77511 4.38755 5.7561 4.51436 5.59494L8.25648 0.839033L8.25754 0.837979L8.27861 0.811633ZM1.69116 11.1834C1.69116 12.0083 1.69211 12.5712 1.73859 13.0002C1.78365 13.4158 1.86467 13.6222 1.96937 13.7663C2.05914 13.8898 2.16727 13.999 2.29079 14.0888C2.43495 14.1935 2.6421 14.2745 3.05797 14.3195C3.45891 14.363 3.97631 14.3656 4.71564 14.3659C4.30795 13.8053 4.06447 13.1172 4.06437 12.371V8.59412H5.46807V12.371C5.46832 13.4734 6.3616 14.367 7.46401 14.367H10.0374C10.6286 14.367 11.0269 14.3663 11.3368 14.3385C11.6339 14.3118 11.7956 14.2639 11.9196 14.1984C12.024 14.1431 12.1213 14.0747 12.2094 13.996C12.3139 13.9025 12.4151 13.7679 12.5434 13.4986C12.6774 13.2177 12.8162 12.8451 13.0219 12.2909L13.9787 9.71328C14.1848 9.15822 14.253 8.96737 14.278 8.83439C14.4617 7.85698 13.8092 6.91901 12.829 6.75098C12.6956 6.72816 12.4928 6.72464 11.9006 6.72464H10.9627C10.7737 6.72464 10.5693 6.72663 10.4 6.70672C10.2211 6.68568 9.96696 6.6303 9.74764 6.43167C9.64448 6.33817 9.5595 6.22616 9.49683 6.10183C9.36384 5.8379 9.37793 5.57905 9.40515 5.40104C9.43094 5.23267 9.48666 5.03623 9.53688 4.8541L10.0079 3.14585L10.0174 3.11108C10.1488 2.61344 10.0077 2.08344 9.64648 1.71687L9.60854 1.67893L9.55058 1.6431C9.48789 1.62049 9.41419 1.6382 9.36932 1.69368L9.35773 1.70633L9.35878 1.70738L5.61666 6.46224C5.51816 6.58741 5.42231 6.71336 5.30683 6.81948C5.05069 7.05477 4.73119 7.20945 4.3879 7.26525C4.23309 7.29038 4.07507 7.28843 3.91579 7.28843C3.1535 7.28843 2.9191 7.29576 2.74604 7.34534C2.26358 7.48385 1.88558 7.86087 1.74702 8.34331C1.69732 8.51642 1.69116 8.75116 1.69116 9.51411V11.1834Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.72451 15.1086C7.18929 15.7706 6.22975 15.8695 5.57357 15.3598L5.44643 15.2493L5.42247 15.2253L5.41934 15.2233L5.39016 15.1941C4.68239 14.4805 4.40679 13.4442 4.66589 12.4731L4.66693 12.4689L4.67631 12.4335L4.67735 12.4314L5.14318 10.7432C5.15243 10.7096 5.1613 10.6784 5.16923 10.6494C5.13878 10.6493 5.10558 10.6484 5.07023 10.6484H4.14274C3.62288 10.6484 3.27015 10.6513 2.9912 10.6035C1.25757 10.3069 0.103662 8.64709 0.42863 6.91861C0.480965 6.64044 0.606164 6.30981 0.787119 5.8223L1.73336 3.27328C1.92812 2.74859 2.08912 2.31215 2.25442 1.96542C2.42515 1.60731 2.62191 1.296 2.91304 1.03584C3.08408 0.883016 3.273 0.751185 3.47579 0.644009C3.82102 0.461569 4.18214 0.385575 4.57731 0.350131C4.95993 0.315849 5.42553 0.316783 5.98521 0.316783H11.0916C11.876 0.316783 12.52 0.316134 13.0362 0.372015C13.5655 0.429358 14.0423 0.552599 14.4608 0.856601C14.7007 1.03091 14.9117 1.24199 15.086 1.48187C15.3901 1.90033 15.5143 2.37716 15.5717 2.90645C15.6276 3.42275 15.6269 4.06727 15.6269 4.85209V6.5028C15.6269 7.16167 15.633 7.63697 15.5164 8.04306C15.2475 8.97969 14.5158 9.71248 13.5791 9.9814C13.173 10.098 12.6977 10.0908 12.0389 10.0908C11.8372 10.0908 11.8118 10.0933 11.795 10.096C11.723 10.1077 11.6549 10.1394 11.6012 10.1888C11.5887 10.2003 11.5724 10.2191 11.447 10.3784L7.74639 15.0815L7.74535 15.0826L7.72451 15.1086ZM14.2388 4.85209C14.2388 4.03635 14.2379 3.47971 14.1919 3.05547C14.1473 2.64449 14.0672 2.44037 13.9637 2.29785C13.8749 2.17569 13.768 2.06776 13.6458 1.97896C13.5033 1.87539 13.2984 1.7953 12.8872 1.75074C12.4907 1.70779 11.979 1.70518 11.2479 1.70489C11.6511 2.25924 11.8918 2.93974 11.8919 3.67762V7.41257H10.5038V3.67762C10.5036 2.58751 9.62023 1.70384 8.53007 1.70384H5.98521C5.40065 1.70384 5.00679 1.70449 4.70028 1.73198C4.40651 1.75836 4.24662 1.80577 4.12399 1.87058C4.02069 1.92518 3.92452 1.99283 3.8374 2.07067C3.73401 2.16312 3.634 2.29627 3.50705 2.56255C3.37462 2.84034 3.23734 3.2088 3.03393 3.75682L2.08768 6.30584C1.88395 6.85474 1.81646 7.04347 1.79172 7.17497C1.61005 8.14152 2.25533 9.06908 3.22464 9.23524C3.35654 9.25781 3.55717 9.26129 4.14274 9.26129H5.07023C5.25717 9.26129 5.4593 9.25932 5.62672 9.27901C5.80364 9.29982 6.05492 9.35458 6.27179 9.551C6.37381 9.64347 6.45784 9.75424 6.51982 9.87719C6.65133 10.1382 6.6374 10.3942 6.61048 10.5702C6.58498 10.7367 6.52988 10.931 6.48022 11.1111L6.01439 12.8003L6.00501 12.8347C5.87513 13.3268 6.01464 13.8509 6.37184 14.2134L6.40935 14.251L6.46667 14.2864C6.52866 14.3088 6.60155 14.2912 6.64591 14.2364L6.65738 14.2239L6.65633 14.2228L10.3569 9.52078C10.4543 9.397 10.5491 9.27245 10.6633 9.1675C10.9166 8.93483 11.2325 8.78186 11.572 8.72669C11.7251 8.70184 11.8814 8.70376 12.0389 8.70376C12.7927 8.70376 13.0245 8.69651 13.1956 8.64748C13.6727 8.51051 14.0465 8.13768 14.1836 7.6606C14.2327 7.48941 14.2388 7.25727 14.2388 6.5028V4.85209Z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="fbb737a4">It is showing PDF index loaded successfully! while I did not upload any PDF. Also, it is showing all the answers are wrong. How to confirm that it is using the same method and logic to answer the questions as in app.py?</div></div><div class="_11d6b3a"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5" style="--assistant-last-margin-bottom: 32px;"><div class="ds-message _656c965"><div class="_7d763a7 _45cdda5" style="--deep-search-title-height: 38px; --group-title-sticky-top: 0px;"><div class="_68f84dc"></div><div class="ddd2f74b"></div></div><div class="ds-markdown" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph"><span>You've identified two critical issues! Let me fix them:</span></p><h2><span>Problem 1: The evaluator is incorrectly loading old/stale indexes</span></h2><h2><span>Problem 2: The evaluator isn't using the same logic as the main app</span></h2><p class="ds-markdown-paragraph"><span>Here are the fixes:</span></p><h2><span>1. Update </span><code>modules/evaluator.py</code><span> to Match Main App Logic</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict<span class="token punctuation">,</span> Any
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>rag_engine <span class="token keyword">import</span> RAGEngine

<span class="token keyword">class</span> <span class="token class-name">Evaluator</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>vector_store <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>rag_engine <span class="token operator">=</span> RAGEngine<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>results_file <span class="token operator">=</span> <span class="token string">"evaluation_results.json"</span>
        self<span class="token punctuation">.</span>test_questions_file <span class="token operator">=</span> <span class="token string">"test_questions.json"</span>
        
    <span class="token keyword">def</span> <span class="token function">load_test_questions</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Load test questions from JSON file"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>test_questions_file<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>test_questions_file<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    <span class="token keyword">return</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># Return default test questions</span>
                <span class="token keyword">return</span> self<span class="token punctuation">.</span>get_default_test_questions<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading test questions: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>get_default_test_questions<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">get_default_test_questions</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Get default test questions for evaluation"""</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"What is the main topic of this document?"</span><span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"general"</span><span class="token punctuation">,</span>
                <span class="token string">"difficulty"</span><span class="token punctuation">:</span> <span class="token string">"easy"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"What are the key findings or conclusions?"</span><span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"general"</span><span class="token punctuation">,</span> 
                <span class="token string">"difficulty"</span><span class="token punctuation">:</span> <span class="token string">"medium"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                <span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"What methodology was used in the research?"</span><span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"specific"</span><span class="token punctuation">,</span>
                <span class="token string">"difficulty"</span><span class="token punctuation">:</span> <span class="token string">"medium"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
                <span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"What are the recommendations provided?"</span><span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"specific"</span><span class="token punctuation">,</span>
                <span class="token string">"difficulty"</span><span class="token punctuation">:</span> <span class="token string">"easy"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
                <span class="token string">"question"</span><span class="token punctuation">:</span> <span class="token string">"What limitations are mentioned in the document?"</span><span class="token punctuation">,</span>
                <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"specific"</span><span class="token punctuation">,</span>
                <span class="token string">"difficulty"</span><span class="token punctuation">:</span> <span class="token string">"medium"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">is_index_valid</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Check if the current index is valid and matches the expected PDF"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># Check if index exists and has content</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>vector_store<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
            
            <span class="token comment"># Additional checks to ensure index is not stale</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>vector_store<span class="token punctuation">,</span> <span class="token string">'metadata'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> 
                <span class="token keyword">not</span> self<span class="token punctuation">.</span>vector_store<span class="token punctuation">.</span>metadata <span class="token keyword">or</span> 
                <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>vector_store<span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> 
                self<span class="token punctuation">.</span>vector_store<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> 
                self<span class="token punctuation">.</span>vector_store<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
                
            <span class="token keyword">return</span> <span class="token boolean">True</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error checking index validity: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">generate_answers</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> questions<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Generate answers for test questions using the SAME logic as app.py"""</span>
        <span class="token comment"># First check if we have a valid index</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_index_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No valid PDF index found. Please process a PDF first in the main app."</span><span class="token punctuation">)</span>
        
        results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> question <span class="token keyword">in</span> questions<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># Use the EXACT SAME logic as app.py</span>
                <span class="token comment"># For conversation history questions, don't search the document</span>
                is_about_chat <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">(</span>keyword <span class="token keyword">in</span> question<span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> keyword <span class="token keyword">in</span> <span class="token punctuation">[</span>
                    <span class="token string">'previous'</span><span class="token punctuation">,</span> <span class="token string">'before'</span><span class="token punctuation">,</span> <span class="token string">'earlier'</span><span class="token punctuation">,</span> <span class="token string">'first question'</span><span class="token punctuation">,</span> 
                    <span class="token string">'last question'</span><span class="token punctuation">,</span> <span class="token string">'what did i ask'</span><span class="token punctuation">,</span> <span class="token string">'what was my'</span><span class="token punctuation">,</span>
                    <span class="token string">'our conversation'</span><span class="token punctuation">,</span> <span class="token string">'chat history'</span><span class="token punctuation">,</span> <span class="token string">'did i ask'</span>
                <span class="token punctuation">]</span><span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> is_about_chat<span class="token punctuation">:</span>
                    <span class="token comment"># Don't search document for chat history questions</span>
                    retrieved_chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># Search for relevant document chunks (same as app.py)</span>
                    retrieved_chunks <span class="token operator">=</span> self<span class="token punctuation">.</span>vector_store<span class="token punctuation">.</span>search<span class="token punctuation">(</span>question<span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
                
                <span class="token comment"># Generate response using the SAME method as app.py</span>
                response <span class="token operator">=</span> self<span class="token punctuation">.</span>rag_engine<span class="token punctuation">.</span>generate_response<span class="token punctuation">(</span>
                    question<span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                    retrieved_chunks<span class="token punctuation">,</span> 
                    <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># Empty chat history for evaluation</span>
                <span class="token punctuation">)</span>
                
                result <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token operator">**</span>question<span class="token punctuation">,</span>
                    <span class="token string">"generated_answer"</span><span class="token punctuation">:</span> response<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">"retrieved_chunks"</span><span class="token punctuation">:</span> retrieved_chunks<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># Top 3 chunks</span>
                    <span class="token string">"timestamp"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">"sources_used"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>chunk<span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> chunk <span class="token keyword">in</span> retrieved_chunks<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">"manual_judgment"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
                    <span class="token string">"is_correct"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
                    <span class="token string">"confidence"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
                    <span class="token string">"notes"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
                    <span class="token string">"used_history"</span><span class="token punctuation">:</span> response<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'used_history'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                
                results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
                
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error generating answer for question </span><span class="token interpolation"><span class="token punctuation">{</span>question<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                results<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token operator">**</span>question<span class="token punctuation">,</span>
                    <span class="token string">"generated_answer"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"Error: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
                    <span class="token string">"retrieved_chunks"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">"timestamp"</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isoformat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">"sources_used"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string">"manual_judgment"</span><span class="token punctuation">:</span> <span class="token string">"Error"</span><span class="token punctuation">,</span>
                    <span class="token string">"is_correct"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
                    <span class="token string">"confidence"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    <span class="token string">"notes"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"Generation error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
                    <span class="token string">"used_history"</span><span class="token punctuation">:</span> <span class="token boolean">False</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> results
    
    <span class="token comment"># ... rest of the methods remain the same ...</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>2. Update </span><code>evaluate.py</code><span> with Better Validation</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> json
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>evaluator <span class="token keyword">import</span> Evaluator
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore
<span class="token keyword">import</span> os

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    st<span class="token punctuation">.</span>set_page_config<span class="token punctuation">(</span>
        page_title<span class="token operator">=</span><span class="token string">"PDF Chatbot Evaluation"</span><span class="token punctuation">,</span>
        page_icon<span class="token operator">=</span><span class="token string">"📊"</span><span class="token punctuation">,</span>
        layout<span class="token operator">=</span><span class="token string">"wide"</span>
    <span class="token punctuation">)</span>
    
    st<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"📊 PDF Chatbot Evaluation"</span><span class="token punctuation">)</span>
    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"Evaluate the accuracy of your PDF chatbot"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Initialize components</span>
    evaluator <span class="token operator">=</span> Evaluator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    vector_store <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Enhanced index validation</span>
    <span class="token keyword">def</span> <span class="token function">is_pdf_processed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Check if a PDF is actually processed (not just index files exist)"""</span>
        index_path <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span>
        metadata_path <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span>
        
        <span class="token comment"># Check if files exist</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>index_path<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        
        <span class="token comment"># Try to load and validate the index</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> vector_store<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
            
            <span class="token comment"># Additional validation checks</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>vector_store<span class="token punctuation">,</span> <span class="token string">'metadata'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> 
                <span class="token keyword">not</span> vector_store<span class="token punctuation">.</span>metadata <span class="token keyword">or</span> 
                <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>vector_store<span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> 
                vector_store<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> 
                vector_store<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
                
            <span class="token keyword">return</span> <span class="token boolean">True</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Index validation error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token comment"># Check if PDF is actually processed</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> is_pdf_processed<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"❌ No valid PDF index found. Please process a PDF first in the main app."</span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
        **Steps to fix:**
        1. Go to the main app (`app.py`)
        2. Upload a PDF file
        3. Click 'Process PDF' button
        4. Wait for successful processing
        5. Then come back to this evaluation page
        """</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Show debug info</span>
        <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"Debug Information"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"**File existence check:**"</span><span class="token punctuation">)</span>
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- storage/faiss_index exists: </span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'storage/faiss_index'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- storage/metadata.json exists: </span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'storage/metadata.json'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'storage/metadata.json'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'storage/metadata.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                        metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Metadata entries: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>metadata<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'Invalid format'</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">except</span><span class="token punctuation">:</span>
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"- Metadata file is corrupted or invalid"</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span>
    
    <span class="token comment"># Load index and verify it's valid</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> vector_store<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># Additional validation</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">hasattr</span><span class="token punctuation">(</span>vector_store<span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> 
                vector_store<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> 
                vector_store<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> 
                <span class="token builtin">hasattr</span><span class="token punctuation">(</span>vector_store<span class="token punctuation">,</span> <span class="token string">'metadata'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> 
                <span class="token builtin">len</span><span class="token punctuation">(</span>vector_store<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                
                st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ PDF index loaded successfully! (</span><span class="token interpolation"><span class="token punctuation">{</span>vector_store<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">}</span></span><span class="token string"> chunks, </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>vector_store<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> metadata entries)"</span></span><span class="token punctuation">)</span>
                
                <span class="token comment"># Show sample content for verification</span>
                <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"🔍 Verify PDF Content"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> vector_store<span class="token punctuation">.</span>metadata<span class="token punctuation">:</span>
                        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"**Sample content from PDF:**"</span><span class="token punctuation">)</span>
                        sample_chunk <span class="token operator">=</span> vector_store<span class="token punctuation">.</span>metadata<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Page </span><span class="token interpolation"><span class="token punctuation">{</span>sample_chunk<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">,</span> <span class="token string">'N/A'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>sample_chunk<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">200]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        st<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">"No metadata found in index"</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"❌ Index loaded but appears to be empty or invalid"</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"❌ Failed to load PDF index"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Error loading index: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    
    <span class="token comment"># Load or create test questions</span>
    test_questions <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>load_test_questions<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Section 1: Test the answering logic</span>
    st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"🧪 Test Answering Logic"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Quick test to verify the evaluator uses same logic as app</span>
    test_question <span class="token operator">=</span> st<span class="token punctuation">.</span>text_input<span class="token punctuation">(</span><span class="token string">"Test a question to verify logic:"</span><span class="token punctuation">,</span> 
                                 <span class="token string">"What is this document about?"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"Test Answering"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># Use the same logic as the main app</span>
            retrieved_chunks <span class="token operator">=</span> vector_store<span class="token punctuation">.</span>search<span class="token punctuation">(</span>test_question<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
            
            <span class="token comment"># Generate response using the same RAG engine</span>
            response <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>rag_engine<span class="token punctuation">.</span>generate_response<span class="token punctuation">(</span>
                test_question<span class="token punctuation">,</span> 
                retrieved_chunks<span class="token punctuation">,</span> 
                <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
            
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"**Generated Answer:**"</span><span class="token punctuation">)</span>
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"**Retrieved Sources:**"</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> i<span class="token punctuation">,</span> chunk <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>retrieved_chunks<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">. Page </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">,</span> <span class="token string">'N/A'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">150]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
            
            st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"✅ Answering logic test completed!"</span><span class="token punctuation">)</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Test failed: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># Section 2: Generate Answers</span>
    st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"1. Generate Answers"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"🔄 Generate Answers for Test Questions"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"primary"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> st<span class="token punctuation">.</span>spinner<span class="token punctuation">(</span><span class="token string">"Generating answers for test questions..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                results <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>generate_answers<span class="token punctuation">(</span>test_questions<span class="token punctuation">)</span>
                evaluator<span class="token punctuation">.</span>save_results<span class="token punctuation">(</span>results<span class="token punctuation">)</span>
                st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results <span class="token operator">=</span> results
                st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ Generated answers for </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> questions!"</span></span><span class="token punctuation">)</span>
                
                <span class="token comment"># Show first result for verification</span>
                <span class="token keyword">if</span> results<span class="token punctuation">:</span>
                    <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"View First Result"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Question:** </span><span class="token interpolation"><span class="token punctuation">{</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Answer:** </span><span class="token interpolation"><span class="token punctuation">{</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'generated_answer'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'sources_used'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Sources:** Pages </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sources_used'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Failed to generate answers: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># ... rest of the evaluation code remains the same ...</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>3. Update </span><code>modules/vector_store.py</code><span> with Better Validation</span></h2><p class="ds-markdown-paragraph"><span>Add this method to your VectorStore class:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">def</span> <span class="token function">validate_index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Validate that the index is properly loaded and usable"""</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> 
            <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>index<span class="token punctuation">,</span> <span class="token string">'ntotal'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> 
            self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span>
            self<span class="token punctuation">.</span>metadata <span class="token keyword">and</span> 
            <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span>
            self<span class="token punctuation">.</span>is_initialized<span class="token punctuation">)</span><span class="token punctuation">:</span>
            
            <span class="token comment"># Test a simple search to ensure it works</span>
            test_results <span class="token operator">=</span> self<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>test_results<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span>  <span class="token comment"># Should not raise exception</span>
            
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Index validation failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>4. Create a Verification Script</span></h2><p class="ds-markdown-paragraph"><strong><span>verify_</span><a href="https://consistency.py/" target="_blank" rel="noreferrer"><span>consistency.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment">#!/usr/bin/env python3</span>
<span class="token triple-quoted-string string">"""
Script to verify that the evaluator uses the same logic as the main app
"""</span>

<span class="token keyword">import</span> sys
<span class="token keyword">import</span> os
sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>rag_engine <span class="token keyword">import</span> RAGEngine

<span class="token keyword">def</span> <span class="token function">test_consistency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Test that both apps use the same components and logic"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"🔍 Testing consistency between main app and evaluator..."</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Test 1: Same vector store initialization</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n1. Testing Vector Store consistency..."</span><span class="token punctuation">)</span>
    vector_store_app <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
    vector_store_eval <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Both should have same configuration</span>
    <span class="token keyword">assert</span> vector_store_app<span class="token punctuation">.</span>index_path <span class="token operator">==</span> vector_store_eval<span class="token punctuation">.</span>index_path
    <span class="token keyword">assert</span> vector_store_app<span class="token punctuation">.</span>metadata_path <span class="token operator">==</span> vector_store_eval<span class="token punctuation">.</span>metadata_path
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ Vector Store configuration consistent"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Test 2: Same RAG engine initialization</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n2. Testing RAG Engine consistency..."</span><span class="token punctuation">)</span>
    rag_app <span class="token operator">=</span> RAGEngine<span class="token punctuation">(</span><span class="token punctuation">)</span>
    rag_eval <span class="token operator">=</span> RAGEngine<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Both should use same model</span>
    <span class="token keyword">assert</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>rag_app<span class="token punctuation">,</span> <span class="token string">'model'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>rag_eval<span class="token punctuation">,</span> <span class="token string">'model'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ RAG Engine configuration consistent"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Test 3: Load index (if exists)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n3. Testing index loading..."</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> vector_store_app<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ Index loaded: </span><span class="token interpolation"><span class="token punctuation">{</span>vector_store_app<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">}</span></span><span class="token string"> vectors"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Test search consistency</span>
        test_query <span class="token operator">=</span> <span class="token string">"what is this about"</span>
        results_app <span class="token operator">=</span> vector_store_app<span class="token punctuation">.</span>search<span class="token punctuation">(</span>test_query<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        results_eval <span class="token operator">=</span> vector_store_eval<span class="token punctuation">.</span>search<span class="token punctuation">(</span>test_query<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>results_app<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>results_eval<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ Search results consistent"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ℹ️  No index found for testing"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n🎉 Consistency verification completed!"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The evaluator uses the same components and logic as the main app."</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    test_consistency<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>5. How to Verify Everything is Working</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>First, process a PDF in the main app:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>streamlit run app.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><ul><li><p class="ds-markdown-paragraph"><span>Upload a PDF</span></p></li><li><p class="ds-markdown-paragraph"><span>Click "Process PDF"</span></p></li><li><p class="ds-markdown-paragraph"><span>Verify it works by asking a question</span></p></li></ul></li><li><p class="ds-markdown-paragraph"><strong><span>Run the consistency test:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>python verify_consistency.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>Then run the evaluator:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>streamlit run evaluate.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>Test with a simple question first</span></strong><span> to verify the logic matches</span></p></li></ol><h2><span>Key Fixes:</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>Better Index Validation</span></strong><span>: Now properly checks if index is valid, not just if files exist</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Same Logic</span></strong><span>: The evaluator now uses the exact same search and response generation logic as the main app</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Verification Tools</span></strong><span>: Added scripts to verify consistency between the two applications</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Error Handling</span></strong><span>: Better error messages and debugging information</span></p></li></ol><p class="ds-markdown-paragraph"><span>The evaluator should now properly detect when no PDF is processed and should use the exact same answering logic as your main app, ensuring consistent results.</span></p></div></div><div class="ds-theme" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE;"></div><div class="ds-flex _0a3d93b" style="align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 10px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92142 0.349213C10.3745 0.349295 12.5564 1.50526 13.9558 3.299L15.1282 2.12765C15.3304 1.92552 15.6768 2.06949 15.6768 2.35544V5.53929C15.6766 5.71632 15.533 5.85982 15.356 5.86008H12.1711C11.8855 5.85976 11.7427 5.51471 11.9443 5.31255L12.9642 4.29062C11.8238 2.74311 9.98914 1.74112 7.92142 1.74104C4.46442 1.74104 1.66239 4.54307 1.66239 8.00006C1.66239 11.4571 4.46442 14.2591 7.92142 14.2591C11.3783 14.2589 14.1804 11.457 14.1804 8.00006H15.5723C15.5723 12.2252 12.1465 15.6508 7.92142 15.6509C3.6962 15.6509 0.270569 12.2253 0.270569 8.00006C0.270569 3.77485 3.6962 0.349213 7.92142 0.349213Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.27861 0.811633C8.81985 0.142255 9.79016 0.0422445 10.4537 0.557662L10.5823 0.669367L10.6065 0.693605L10.6097 0.695713L10.6392 0.72522C11.3549 1.44685 11.6336 2.49474 11.3716 3.47675L11.3705 3.48097L11.361 3.5168L11.36 3.51891L10.8889 5.2261C10.8796 5.26003 10.8706 5.29164 10.8626 5.32094C10.8934 5.32101 10.927 5.322 10.9627 5.322H11.9006C12.4263 5.322 12.783 5.31906 13.0651 5.36731C14.8182 5.66725 15.9851 7.34574 15.6564 9.09363C15.6035 9.37493 15.4769 9.70926 15.2939 10.2023L14.337 12.7799C14.1401 13.3105 13.9773 13.7518 13.8101 14.1025C13.6375 14.4646 13.4385 14.7794 13.1441 15.0425C12.9712 15.197 12.7801 15.3303 12.5751 15.4387C12.2259 15.6232 11.8608 15.7 11.4612 15.7359C11.0742 15.7705 10.6034 15.7696 10.0374 15.7696H4.87371C4.08047 15.7696 3.42922 15.7703 2.90728 15.7138C2.37206 15.6558 1.88985 15.5311 1.4667 15.2237C1.22409 15.0475 1.01072 14.834 0.834405 14.5914C0.52696 14.1683 0.401312 13.6861 0.343323 13.1509C0.286761 12.6288 0.28747 11.977 0.28747 11.1834V9.51411C0.28747 8.84785 0.281286 8.36721 0.399176 7.95656C0.671091 7.00941 1.41109 6.26838 2.35823 5.99645C2.76888 5.87855 3.24952 5.88579 3.91579 5.88579C4.11977 5.88579 4.14542 5.88325 4.16238 5.88053C4.23526 5.8687 4.30403 5.83669 4.35839 5.78674C4.37104 5.77511 4.38755 5.7561 4.51436 5.59494L8.25648 0.839033L8.25754 0.837979L8.27861 0.811633ZM1.69116 11.1834C1.69116 12.0083 1.69211 12.5712 1.73859 13.0002C1.78365 13.4158 1.86467 13.6222 1.96937 13.7663C2.05914 13.8898 2.16727 13.999 2.29079 14.0888C2.43495 14.1935 2.6421 14.2745 3.05797 14.3195C3.45891 14.363 3.97631 14.3656 4.71564 14.3659C4.30795 13.8053 4.06447 13.1172 4.06437 12.371V8.59412H5.46807V12.371C5.46832 13.4734 6.3616 14.367 7.46401 14.367H10.0374C10.6286 14.367 11.0269 14.3663 11.3368 14.3385C11.6339 14.3118 11.7956 14.2639 11.9196 14.1984C12.024 14.1431 12.1213 14.0747 12.2094 13.996C12.3139 13.9025 12.4151 13.7679 12.5434 13.4986C12.6774 13.2177 12.8162 12.8451 13.0219 12.2909L13.9787 9.71328C14.1848 9.15822 14.253 8.96737 14.278 8.83439C14.4617 7.85698 13.8092 6.91901 12.829 6.75098C12.6956 6.72816 12.4928 6.72464 11.9006 6.72464H10.9627C10.7737 6.72464 10.5693 6.72663 10.4 6.70672C10.2211 6.68568 9.96696 6.6303 9.74764 6.43167C9.64448 6.33817 9.5595 6.22616 9.49683 6.10183C9.36384 5.8379 9.37793 5.57905 9.40515 5.40104C9.43094 5.23267 9.48666 5.03623 9.53688 4.8541L10.0079 3.14585L10.0174 3.11108C10.1488 2.61344 10.0077 2.08344 9.64648 1.71687L9.60854 1.67893L9.55058 1.6431C9.48789 1.62049 9.41419 1.6382 9.36932 1.69368L9.35773 1.70633L9.35878 1.70738L5.61666 6.46224C5.51816 6.58741 5.42231 6.71336 5.30683 6.81948C5.05069 7.05477 4.73119 7.20945 4.3879 7.26525C4.23309 7.29038 4.07507 7.28843 3.91579 7.28843C3.1535 7.28843 2.9191 7.29576 2.74604 7.34534C2.26358 7.48385 1.88558 7.86087 1.74702 8.34331C1.69732 8.51642 1.69116 8.75116 1.69116 9.51411V11.1834Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.72451 15.1086C7.18929 15.7706 6.22975 15.8695 5.57357 15.3598L5.44643 15.2493L5.42247 15.2253L5.41934 15.2233L5.39016 15.1941C4.68239 14.4805 4.40679 13.4442 4.66589 12.4731L4.66693 12.4689L4.67631 12.4335L4.67735 12.4314L5.14318 10.7432C5.15243 10.7096 5.1613 10.6784 5.16923 10.6494C5.13878 10.6493 5.10558 10.6484 5.07023 10.6484H4.14274C3.62288 10.6484 3.27015 10.6513 2.9912 10.6035C1.25757 10.3069 0.103662 8.64709 0.42863 6.91861C0.480965 6.64044 0.606164 6.30981 0.787119 5.8223L1.73336 3.27328C1.92812 2.74859 2.08912 2.31215 2.25442 1.96542C2.42515 1.60731 2.62191 1.296 2.91304 1.03584C3.08408 0.883016 3.273 0.751185 3.47579 0.644009C3.82102 0.461569 4.18214 0.385575 4.57731 0.350131C4.95993 0.315849 5.42553 0.316783 5.98521 0.316783H11.0916C11.876 0.316783 12.52 0.316134 13.0362 0.372015C13.5655 0.429358 14.0423 0.552599 14.4608 0.856601C14.7007 1.03091 14.9117 1.24199 15.086 1.48187C15.3901 1.90033 15.5143 2.37716 15.5717 2.90645C15.6276 3.42275 15.6269 4.06727 15.6269 4.85209V6.5028C15.6269 7.16167 15.633 7.63697 15.5164 8.04306C15.2475 8.97969 14.5158 9.71248 13.5791 9.9814C13.173 10.098 12.6977 10.0908 12.0389 10.0908C11.8372 10.0908 11.8118 10.0933 11.795 10.096C11.723 10.1077 11.6549 10.1394 11.6012 10.1888C11.5887 10.2003 11.5724 10.2191 11.447 10.3784L7.74639 15.0815L7.74535 15.0826L7.72451 15.1086ZM14.2388 4.85209C14.2388 4.03635 14.2379 3.47971 14.1919 3.05547C14.1473 2.64449 14.0672 2.44037 13.9637 2.29785C13.8749 2.17569 13.768 2.06776 13.6458 1.97896C13.5033 1.87539 13.2984 1.7953 12.8872 1.75074C12.4907 1.70779 11.979 1.70518 11.2479 1.70489C11.6511 2.25924 11.8918 2.93974 11.8919 3.67762V7.41257H10.5038V3.67762C10.5036 2.58751 9.62023 1.70384 8.53007 1.70384H5.98521C5.40065 1.70384 5.00679 1.70449 4.70028 1.73198C4.40651 1.75836 4.24662 1.80577 4.12399 1.87058C4.02069 1.92518 3.92452 1.99283 3.8374 2.07067C3.73401 2.16312 3.634 2.29627 3.50705 2.56255C3.37462 2.84034 3.23734 3.2088 3.03393 3.75682L2.08768 6.30584C1.88395 6.85474 1.81646 7.04347 1.79172 7.17497C1.61005 8.14152 2.25533 9.06908 3.22464 9.23524C3.35654 9.25781 3.55717 9.26129 4.14274 9.26129H5.07023C5.25717 9.26129 5.4593 9.25932 5.62672 9.27901C5.80364 9.29982 6.05492 9.35458 6.27179 9.551C6.37381 9.64347 6.45784 9.75424 6.51982 9.87719C6.65133 10.1382 6.6374 10.3942 6.61048 10.5702C6.58498 10.7367 6.52988 10.931 6.48022 11.1111L6.01439 12.8003L6.00501 12.8347C5.87513 13.3268 6.01464 13.8509 6.37184 14.2134L6.40935 14.251L6.46667 14.2864C6.52866 14.3088 6.60155 14.2912 6.64591 14.2364L6.65738 14.2239L6.65633 14.2228L10.3569 9.52078C10.4543 9.397 10.5491 9.27245 10.6633 9.1675C10.9166 8.93483 11.2325 8.78186 11.572 8.72669C11.7251 8.70184 11.8814 8.70376 12.0389 8.70376C12.7927 8.70376 13.0245 8.69651 13.1956 8.64748C13.6727 8.51051 14.0465 8.13768 14.1836 7.6606C14.2327 7.48941 14.2388 7.25727 14.2388 6.5028V4.85209Z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="fbb737a4">app.py is running with my Gemini API but 

(pcvenv) D:\ML_Projects\pdf-chatbot&gt;python verify_consistency.py
🔍 Testing consistency between main app and evaluator...

1. Testing Vector Store consistency...
✅ Vector Store configuration consistent

2. Testing RAG Engine consistency...
Failed to initialize Gemini: GEMINI_API_KEY not found in environment variables
Failed to initialize Gemini: GEMINI_API_KEY not found in environment variables
✅ RAG Engine configuration consistent

3. Testing index loading...
Loading existing index...
GEMINI_API_KEY not found in environment variables
Gemini embedding failed: API key missing, falling back to local model
✓ Using local SentenceTransformer (dimension: 384)
✓ Index loaded with 37 chunks
✅ Index loaded: 37 vectors
Traceback (most recent call last):
  File "D:\ML_Projects\pdf-chatbot\verify_consistency.py", line 55, in &lt;module&gt;
    test_consistency()
  File "D:\ML_Projects\pdf-chatbot\verify_consistency.py", line 43, in test_consistency
    results_app = vector_store_app.search(test_query, k=2)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ML_Projects\pdf-chatbot\modules\vector_store.py", line 193, in search
    distances, indices = self.index.search(query_embedding, k)
3. Testing index loading...
Loading existing index...
GEMINI_API_KEY not found in environment variables
Gemini embedding failed: API key missing, falling back to local model
✓ Using local SentenceTransformer (dimension: 384)
✓ Index loaded with 37 chunks
✅ Index loaded: 37 vectors
Traceback (most recent call last):
  File "D:\ML_Projects\pdf-chatbot\verify_consistency.py", line 55, in &lt;module&gt;
    test_consistency()
  File "D:\ML_Projects\pdf-chatbot\verify_consistency.py", line 43, in test_consistency
    results_app = vector_store_app.search(test_query, k=2)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ML_Projects\pdf-chatbot\modules\vector_store.py", line 193, in search
    distances, indices = self.index.search(query_embedding, k)
GEMINI_API_KEY not found in environment variables
Gemini embedding failed: API key missing, falling back to local model
✓ Using local SentenceTransformer (dimension: 384)
✓ Index loaded with 37 chunks
✅ Index loaded: 37 vectors
Traceback (most recent call last):
  File "D:\ML_Projects\pdf-chatbot\verify_consistency.py", line 55, in &lt;module&gt;
    test_consistency()
  File "D:\ML_Projects\pdf-chatbot\verify_consistency.py", line 43, in test_consistency
    results_app = vector_store_app.search(test_query, k=2)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ML_Projects\pdf-chatbot\modules\vector_store.py", line 193, in search
    distances, indices = self.index.search(query_embedding, k)
✓ Using local SentenceTransformer (dimension: 384)
✓ Index loaded with 37 chunks
✅ Index loaded: 37 vectors
Traceback (most recent call last):
  File "D:\ML_Projects\pdf-chatbot\verify_consistency.py", line 55, in &lt;module&gt;
    test_consistency()
  File "D:\ML_Projects\pdf-chatbot\verify_consistency.py", line 43, in test_consistency
    results_app = vector_store_app.search(test_query, k=2)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ML_Projects\pdf-chatbot\modules\vector_store.py", line 193, in search
    distances, indices = self.index.search(query_embedding, k)
Traceback (most recent call last):
  File "D:\ML_Projects\pdf-chatbot\verify_consistency.py", line 55, in &lt;module&gt;
    test_consistency()
  File "D:\ML_Projects\pdf-chatbot\verify_consistency.py", line 43, in test_consistency
    results_app = vector_store_app.search(test_query, k=2)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ML_Projects\pdf-chatbot\modules\vector_store.py", line 193, in search
    distances, indices = self.index.search(query_embedding, k)
    test_consistency()
  File "D:\ML_Projects\pdf-chatbot\verify_consistency.py", line 43, in test_consistency
    results_app = vector_store_app.search(test_query, k=2)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ML_Projects\pdf-chatbot\modules\vector_store.py", line 193, in search
    distances, indices = self.index.search(query_embedding, k)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ML_Projects\pdf-chatbot\modules\vector_store.py", line 193, in search
    distances, indices = self.index.search(query_embedding, k)
  File "D:\ML_Projects\pdf-chatbot\modules\vector_store.py", line 193, in search
    distances, indices = self.index.search(query_embedding, k)
    distances, indices = self.index.search(query_embedding, k)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\ML_Projects\pdf-chatbot\pcvenv\Lib\site-packages\faiss\class_wrappers.py", line 329, in replacement_search
    assert d == self.d
           ^^^^^^^^^^^
AssertionError

(pcvenv) D:\ML_Projects\pdf-chatbot&gt;</div></div><div class="_11d6b3a"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5" style="--assistant-last-margin-bottom: 32px;"><div class="ds-message _656c965"><div class="_7d763a7 _45cdda5" style="--deep-search-title-height: 38px; --group-title-sticky-top: 0px;"><div class="_68f84dc"></div><div class="ddd2f74b"></div></div><div class="ds-markdown" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph"><span>The error is happening because the FAISS index dimension doesn't match the embedding dimension. This occurs because:</span></p><ol start="1"><li><p class="ds-markdown-paragraph"><span>The index was created with Gemini embeddings (768 dimensions)</span></p></li><li><p class="ds-markdown-paragraph"><span>But now it's trying to use local SentenceTransformer embeddings (384 dimensions)</span></p></li><li><p class="ds-markdown-paragraph"><span>The dimensions don't match, causing the AssertionError</span></p></li></ol><p class="ds-markdown-paragraph"><span>Let me fix this issue:</span></p><h2><span>1. Update </span><code>verify_consistency.py</code><span> to handle the environment properly</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment">#!/usr/bin/env python3</span>
<span class="token triple-quoted-string string">"""
Script to verify that the evaluator uses the same logic as the main app
"""</span>

<span class="token keyword">import</span> sys
<span class="token keyword">import</span> os
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv

<span class="token comment"># Load environment variables first</span>
load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>rag_engine <span class="token keyword">import</span> RAGEngine

<span class="token keyword">def</span> <span class="token function">test_consistency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Test that both apps use the same components and logic"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"🔍 Testing consistency between main app and evaluator..."</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Test 1: Same vector store initialization</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n1. Testing Vector Store consistency..."</span><span class="token punctuation">)</span>
    vector_store_app <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
    vector_store_eval <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Both should have same configuration</span>
    <span class="token keyword">assert</span> vector_store_app<span class="token punctuation">.</span>index_path <span class="token operator">==</span> vector_store_eval<span class="token punctuation">.</span>index_path
    <span class="token keyword">assert</span> vector_store_app<span class="token punctuation">.</span>metadata_path <span class="token operator">==</span> vector_store_eval<span class="token punctuation">.</span>metadata_path
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ Vector Store configuration consistent"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Test 2: Same RAG engine initialization</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n2. Testing RAG Engine consistency..."</span><span class="token punctuation">)</span>
    rag_app <span class="token operator">=</span> RAGEngine<span class="token punctuation">(</span><span class="token punctuation">)</span>
    rag_eval <span class="token operator">=</span> RAGEngine<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Both should use same model</span>
    <span class="token keyword">assert</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>rag_app<span class="token punctuation">,</span> <span class="token string">'model'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>rag_eval<span class="token punctuation">,</span> <span class="token string">'model'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ RAG Engine configuration consistent"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Test 3: Load index (if exists)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n3. Testing index loading..."</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Check if we have the same API key setup</span>
    api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> api_key<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ Gemini API key found: </span><span class="token interpolation"><span class="token punctuation">{</span>api_key<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">10]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"⚠️  No Gemini API key found, using fallback model"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> vector_store_app<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ Index loaded: </span><span class="token interpolation"><span class="token punctuation">{</span>vector_store_app<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">}</span></span><span class="token string"> vectors"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Test search consistency with simple query</span>
        test_query <span class="token operator">=</span> <span class="token string">"test"</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            results_app <span class="token operator">=</span> vector_store_app<span class="token punctuation">.</span>search<span class="token punctuation">(</span>test_query<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
            results_eval <span class="token operator">=</span> vector_store_eval<span class="token punctuation">.</span>search<span class="token punctuation">(</span>test_query<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ Search results: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>results_app<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> from app, </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>results_eval<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> from eval"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ Search results consistent"</span><span class="token punctuation">)</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Search failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"This might be due to embedding dimension mismatch"</span><span class="token punctuation">)</span>
            
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ℹ️  No index found for testing"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n🎉 Consistency verification completed!"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The evaluator uses the same components and logic as the main app."</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    test_consistency<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>2. Update </span><code>modules/vector_store.py</code><span> to handle dimension mismatches</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> faiss
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict
<span class="token keyword">import</span> google<span class="token punctuation">.</span>generativeai <span class="token keyword">as</span> genai
<span class="token keyword">from</span> sentence_transformers <span class="token keyword">import</span> SentenceTransformer

<span class="token keyword">class</span> <span class="token class-name">VectorStore</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span><span class="token punctuation">,</span> metadata_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>index_path <span class="token operator">=</span> index_path
        self<span class="token punctuation">.</span>metadata_path <span class="token operator">=</span> metadata_path
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># Will be set dynamically</span>
        self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>used_gemini_for_index <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># Track how index was created</span>
        
    <span class="token keyword">def</span> <span class="token function">initialize_embedding_model</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> force_gemini<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialize embedding model with proper error handling"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># Try to use Gemini embeddings if API key available and not forced to use local</span>
            api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> api_key <span class="token keyword">and</span> <span class="token keyword">not</span> force_gemini<span class="token punctuation">:</span>
                genai<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>api_key<span class="token operator">=</span>api_key<span class="token punctuation">)</span>
                
                <span class="token comment"># Test the API with a simple embedding</span>
                test_result <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                    model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                    content<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"test embedding"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
                <span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> <span class="token string">'embedding'</span> <span class="token keyword">in</span> test_result<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>test_result<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> <span class="token string">'gemini'</span>
                    self<span class="token punctuation">.</span>used_gemini_for_index <span class="token operator">=</span> <span class="token boolean">True</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Using Gemini embeddings (dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">True</span>
                    <span class="token keyword">return</span> <span class="token boolean">True</span>
                
            <span class="token comment"># Fall back to local model</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
                
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Gemini embedding failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">, falling back to local model"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">_initialize_local_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialize local embedding model as fallback"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> SentenceTransformer<span class="token punctuation">(</span><span class="token string">'all-MiniLM-L6-v2'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">.</span>get_sentence_embedding_dimension<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>used_gemini_for_index <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Using local SentenceTransformer (dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Failed to initialize local model: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">get_embeddings</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> texts<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Get embeddings for texts with proper error handling"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_initialized<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Embedding model not initialized"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Check if we need to handle dimension mismatch</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> 
            <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>index<span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">!=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"⚠️  Dimension mismatch: Embedding dim </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string"> vs Index dim </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Reinitializing embedding model to match index..."</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_reinitialize_for_index_compatibility<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>embedding_model <span class="token operator">==</span> <span class="token string">'gemini'</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                result <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                    model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                    content<span class="token operator">=</span>texts<span class="token punctuation">,</span>
                    task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
                <span class="token punctuation">)</span>
                
                embeddings <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
                
                <span class="token comment"># Ensure correct shape</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    embeddings <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>texts<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    embeddings <span class="token operator">=</span> np<span class="token punctuation">.</span>tile<span class="token punctuation">(</span>embeddings<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>texts<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                
                <span class="token keyword">return</span> embeddings
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Gemini embedding generation failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"All embedding methods failed"</span><span class="token punctuation">)</span>
                <span class="token comment"># Fall through to local model</span>
        
        <span class="token comment"># Use local model</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">,</span> SentenceTransformer<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>texts<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No valid embedding model available"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">_reinitialize_for_index_compatibility</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Reinitialize embedding model to be compatible with existing index"""</span>
        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            index_dimension <span class="token operator">=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d
            
            <span class="token comment"># Try to use the same type of embedding that created the index</span>
            <span class="token keyword">if</span> index_dimension <span class="token operator">==</span> <span class="token number">768</span><span class="token punctuation">:</span>  <span class="token comment"># Gemini dimension</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Index was created with Gemini, trying to use Gemini..."</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span>force_gemini<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Index requires Gemini but API not available"</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> index_dimension <span class="token operator">==</span> <span class="token number">384</span><span class="token punctuation">:</span>  <span class="token comment"># SentenceTransformer dimension</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Index was created with local model, using local model..."</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Unknown index dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>index_dimension<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_index</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Create FAISS index from chunks - with cleanup"""</span>
        <span class="token comment"># Clear any existing index first</span>
        self<span class="token punctuation">.</span>clear_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>delete_storage_files<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        texts <span class="token operator">=</span> <span class="token punctuation">[</span>chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> chunk <span class="token keyword">in</span> chunks<span class="token punctuation">]</span>
        
        <span class="token comment"># Initialize embedding model</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Failed to initialize embedding model"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Get embeddings</span>
        embeddings <span class="token operator">=</span> self<span class="token punctuation">.</span>get_embeddings<span class="token punctuation">(</span>texts<span class="token punctuation">)</span>
        
        <span class="token comment"># Create FAISS index</span>
        dimension <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>IndexFlatL2<span class="token punctuation">(</span>dimension<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>add<span class="token punctuation">(</span>embeddings<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> chunks
        
        <span class="token comment"># Create storage directory if it doesn't exist</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Save index and metadata</span>
        faiss<span class="token punctuation">.</span>write_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index<span class="token punctuation">,</span> self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span> f<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ New index created with </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>chunks<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> chunks"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Index dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>dimension<span class="token punctuation">}</span></span><span class="token string">, Using: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'Gemini'</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>used_gemini_for_index <span class="token keyword">else</span> <span class="token string">'Local model'</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">load_index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Load existing index with proper initialization and dimension checking"""</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading existing index..."</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>read_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
                
                <span class="token comment"># Initialize embedding model with compatibility check</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Warning: Failed to initialize embedding model after loading index"</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">False</span>
                
                <span class="token comment"># Check for dimension compatibility</span>
                <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>index<span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">!=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"⚠️  Dimension mismatch detected: Embedding dim </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string"> vs Index dim </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>_reinitialize_for_index_compatibility<span class="token punctuation">(</span><span class="token punctuation">)</span>
                
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Index loaded with </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> chunks"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Index dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d<span class="token punctuation">}</span></span><span class="token string">, Using: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'Gemini'</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>used_gemini_for_index <span class="token keyword">else</span> <span class="token string">'Local model'</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
                
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token comment"># ... rest of the methods remain the same ...</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>3. Create a script to check and fix index compatibility</span></h2><p class="ds-markdown-paragraph"><strong><span>check_index_</span><a href="https://compatibility.py/" target="_blank" rel="noreferrer"><span>compatibility.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment">#!/usr/bin/env python3</span>
<span class="token triple-quoted-string string">"""
Script to check and fix index compatibility issues
"""</span>

<span class="token keyword">import</span> os
<span class="token keyword">import</span> faiss
<span class="token keyword">import</span> json
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv

load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">check_index_compatibility</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Check if the index has compatibility issues"""</span>
    index_path <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span>
    metadata_path <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span>
    
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>index_path<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"❌ No index files found"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># Load index to check its dimension</span>
        index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>read_index<span class="token punctuation">(</span>index_path<span class="token punctuation">)</span>
        index_dim <span class="token operator">=</span> index<span class="token punctuation">.</span>d
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Index dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>index_dim<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Load metadata to check content</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Metadata entries: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Check what created the index based on dimension</span>
        <span class="token keyword">if</span> index_dim <span class="token operator">==</span> <span class="token number">768</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Index was created with Gemini embeddings"</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> index_dim <span class="token operator">==</span> <span class="token number">384</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Index was created with local SentenceTransformer"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Unknown index dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>index_dim<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Check if we have the right API key for the index</span>
        api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> index_dim <span class="token operator">==</span> <span class="token number">768</span> <span class="token keyword">and</span> <span class="token keyword">not</span> api_key<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"❌ Problem: Index requires Gemini but no API key found"</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Solution: Either:"</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"1. Set GEMINI_API_KEY in .env file, OR"</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"2. Delete the index and create a new one with local embeddings"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">elif</span> index_dim <span class="token operator">==</span> <span class="token number">384</span> <span class="token keyword">and</span> api_key<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ℹ️  Index uses local embeddings but Gemini API is available"</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> <span class="token boolean">True</span>
        
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error checking index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">def</span> <span class="token function">recreate_index_with_local</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Recreate the index using local embeddings"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Recreating index with local embeddings..."</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Delete existing index files</span>
    index_path <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span>
    metadata_path <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>index_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>index_path<span class="token punctuation">)</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>metadata_path<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✓ Deleted old index files"</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error deleting files: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Please run the main app again to create a new index with local embeddings"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"🔍 Checking index compatibility..."</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> check_index_compatibility<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ Index compatibility check completed"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"❌ Index has compatibility issues"</span><span class="token punctuation">)</span>
        
        response <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Do you want to recreate the index with local embeddings? (y/n): "</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> response<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'y'</span><span class="token punctuation">:</span>
            recreate_index_with_local<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>4. How to Fix the Issue</span></h2><p class="ds-markdown-paragraph"><span>Run the compatibility checker first:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>python check_index_compatibility.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><p class="ds-markdown-paragraph"><span>Based on the output, you have two options:</span></p><p class="ds-markdown-paragraph"><strong><span>Option 1: Use Gemini (Recommended)</span></strong></p><ol start="1"><li><p class="ds-markdown-paragraph"><span>Make sure your </span><code>.env</code><span> file has the correct Gemini API key</span></p></li><li><p class="ds-markdown-paragraph"><span>The app will automatically use Gemini embeddings</span></p></li></ol><p class="ds-markdown-paragraph"><strong><span>Option 2: Use Local Embeddings</span></strong></p><ol start="1"><li><p class="ds-markdown-paragraph"><span>Delete the existing index:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token function">rm</span> storage/faiss_index storage/metadata.json</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><span>Run the main app again - it will create a new index with local embeddings</span></p></li></ol><h2><span>5. Run the Fixed Verification</span></h2><p class="ds-markdown-paragraph"><span>After fixing the compatibility issue:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>python verify_consistency.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><p class="ds-markdown-paragraph"><span>The error should be resolved now. The key fix is that the vector store now:</span></p><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>Detects dimension mismatches</span></strong><span> between the index and current embedding model</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Automatically reinitializes</span></strong><span> to use the correct embedding type</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Provides better error messages</span></strong><span> and diagnostics</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Tracks how the index was created</span></strong><span> to maintain consistency</span></p></li></ol><p class="ds-markdown-paragraph"><span>This should resolve the AssertionError you were seeing.</span></p></div></div><div class="ds-theme" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE;"></div><div class="ds-flex _0a3d93b" style="align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 10px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92142 0.349213C10.3745 0.349295 12.5564 1.50526 13.9558 3.299L15.1282 2.12765C15.3304 1.92552 15.6768 2.06949 15.6768 2.35544V5.53929C15.6766 5.71632 15.533 5.85982 15.356 5.86008H12.1711C11.8855 5.85976 11.7427 5.51471 11.9443 5.31255L12.9642 4.29062C11.8238 2.74311 9.98914 1.74112 7.92142 1.74104C4.46442 1.74104 1.66239 4.54307 1.66239 8.00006C1.66239 11.4571 4.46442 14.2591 7.92142 14.2591C11.3783 14.2589 14.1804 11.457 14.1804 8.00006H15.5723C15.5723 12.2252 12.1465 15.6508 7.92142 15.6509C3.6962 15.6509 0.270569 12.2253 0.270569 8.00006C0.270569 3.77485 3.6962 0.349213 7.92142 0.349213Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.27861 0.811633C8.81985 0.142255 9.79016 0.0422445 10.4537 0.557662L10.5823 0.669367L10.6065 0.693605L10.6097 0.695713L10.6392 0.72522C11.3549 1.44685 11.6336 2.49474 11.3716 3.47675L11.3705 3.48097L11.361 3.5168L11.36 3.51891L10.8889 5.2261C10.8796 5.26003 10.8706 5.29164 10.8626 5.32094C10.8934 5.32101 10.927 5.322 10.9627 5.322H11.9006C12.4263 5.322 12.783 5.31906 13.0651 5.36731C14.8182 5.66725 15.9851 7.34574 15.6564 9.09363C15.6035 9.37493 15.4769 9.70926 15.2939 10.2023L14.337 12.7799C14.1401 13.3105 13.9773 13.7518 13.8101 14.1025C13.6375 14.4646 13.4385 14.7794 13.1441 15.0425C12.9712 15.197 12.7801 15.3303 12.5751 15.4387C12.2259 15.6232 11.8608 15.7 11.4612 15.7359C11.0742 15.7705 10.6034 15.7696 10.0374 15.7696H4.87371C4.08047 15.7696 3.42922 15.7703 2.90728 15.7138C2.37206 15.6558 1.88985 15.5311 1.4667 15.2237C1.22409 15.0475 1.01072 14.834 0.834405 14.5914C0.52696 14.1683 0.401312 13.6861 0.343323 13.1509C0.286761 12.6288 0.28747 11.977 0.28747 11.1834V9.51411C0.28747 8.84785 0.281286 8.36721 0.399176 7.95656C0.671091 7.00941 1.41109 6.26838 2.35823 5.99645C2.76888 5.87855 3.24952 5.88579 3.91579 5.88579C4.11977 5.88579 4.14542 5.88325 4.16238 5.88053C4.23526 5.8687 4.30403 5.83669 4.35839 5.78674C4.37104 5.77511 4.38755 5.7561 4.51436 5.59494L8.25648 0.839033L8.25754 0.837979L8.27861 0.811633ZM1.69116 11.1834C1.69116 12.0083 1.69211 12.5712 1.73859 13.0002C1.78365 13.4158 1.86467 13.6222 1.96937 13.7663C2.05914 13.8898 2.16727 13.999 2.29079 14.0888C2.43495 14.1935 2.6421 14.2745 3.05797 14.3195C3.45891 14.363 3.97631 14.3656 4.71564 14.3659C4.30795 13.8053 4.06447 13.1172 4.06437 12.371V8.59412H5.46807V12.371C5.46832 13.4734 6.3616 14.367 7.46401 14.367H10.0374C10.6286 14.367 11.0269 14.3663 11.3368 14.3385C11.6339 14.3118 11.7956 14.2639 11.9196 14.1984C12.024 14.1431 12.1213 14.0747 12.2094 13.996C12.3139 13.9025 12.4151 13.7679 12.5434 13.4986C12.6774 13.2177 12.8162 12.8451 13.0219 12.2909L13.9787 9.71328C14.1848 9.15822 14.253 8.96737 14.278 8.83439C14.4617 7.85698 13.8092 6.91901 12.829 6.75098C12.6956 6.72816 12.4928 6.72464 11.9006 6.72464H10.9627C10.7737 6.72464 10.5693 6.72663 10.4 6.70672C10.2211 6.68568 9.96696 6.6303 9.74764 6.43167C9.64448 6.33817 9.5595 6.22616 9.49683 6.10183C9.36384 5.8379 9.37793 5.57905 9.40515 5.40104C9.43094 5.23267 9.48666 5.03623 9.53688 4.8541L10.0079 3.14585L10.0174 3.11108C10.1488 2.61344 10.0077 2.08344 9.64648 1.71687L9.60854 1.67893L9.55058 1.6431C9.48789 1.62049 9.41419 1.6382 9.36932 1.69368L9.35773 1.70633L9.35878 1.70738L5.61666 6.46224C5.51816 6.58741 5.42231 6.71336 5.30683 6.81948C5.05069 7.05477 4.73119 7.20945 4.3879 7.26525C4.23309 7.29038 4.07507 7.28843 3.91579 7.28843C3.1535 7.28843 2.9191 7.29576 2.74604 7.34534C2.26358 7.48385 1.88558 7.86087 1.74702 8.34331C1.69732 8.51642 1.69116 8.75116 1.69116 9.51411V11.1834Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.72451 15.1086C7.18929 15.7706 6.22975 15.8695 5.57357 15.3598L5.44643 15.2493L5.42247 15.2253L5.41934 15.2233L5.39016 15.1941C4.68239 14.4805 4.40679 13.4442 4.66589 12.4731L4.66693 12.4689L4.67631 12.4335L4.67735 12.4314L5.14318 10.7432C5.15243 10.7096 5.1613 10.6784 5.16923 10.6494C5.13878 10.6493 5.10558 10.6484 5.07023 10.6484H4.14274C3.62288 10.6484 3.27015 10.6513 2.9912 10.6035C1.25757 10.3069 0.103662 8.64709 0.42863 6.91861C0.480965 6.64044 0.606164 6.30981 0.787119 5.8223L1.73336 3.27328C1.92812 2.74859 2.08912 2.31215 2.25442 1.96542C2.42515 1.60731 2.62191 1.296 2.91304 1.03584C3.08408 0.883016 3.273 0.751185 3.47579 0.644009C3.82102 0.461569 4.18214 0.385575 4.57731 0.350131C4.95993 0.315849 5.42553 0.316783 5.98521 0.316783H11.0916C11.876 0.316783 12.52 0.316134 13.0362 0.372015C13.5655 0.429358 14.0423 0.552599 14.4608 0.856601C14.7007 1.03091 14.9117 1.24199 15.086 1.48187C15.3901 1.90033 15.5143 2.37716 15.5717 2.90645C15.6276 3.42275 15.6269 4.06727 15.6269 4.85209V6.5028C15.6269 7.16167 15.633 7.63697 15.5164 8.04306C15.2475 8.97969 14.5158 9.71248 13.5791 9.9814C13.173 10.098 12.6977 10.0908 12.0389 10.0908C11.8372 10.0908 11.8118 10.0933 11.795 10.096C11.723 10.1077 11.6549 10.1394 11.6012 10.1888C11.5887 10.2003 11.5724 10.2191 11.447 10.3784L7.74639 15.0815L7.74535 15.0826L7.72451 15.1086ZM14.2388 4.85209C14.2388 4.03635 14.2379 3.47971 14.1919 3.05547C14.1473 2.64449 14.0672 2.44037 13.9637 2.29785C13.8749 2.17569 13.768 2.06776 13.6458 1.97896C13.5033 1.87539 13.2984 1.7953 12.8872 1.75074C12.4907 1.70779 11.979 1.70518 11.2479 1.70489C11.6511 2.25924 11.8918 2.93974 11.8919 3.67762V7.41257H10.5038V3.67762C10.5036 2.58751 9.62023 1.70384 8.53007 1.70384H5.98521C5.40065 1.70384 5.00679 1.70449 4.70028 1.73198C4.40651 1.75836 4.24662 1.80577 4.12399 1.87058C4.02069 1.92518 3.92452 1.99283 3.8374 2.07067C3.73401 2.16312 3.634 2.29627 3.50705 2.56255C3.37462 2.84034 3.23734 3.2088 3.03393 3.75682L2.08768 6.30584C1.88395 6.85474 1.81646 7.04347 1.79172 7.17497C1.61005 8.14152 2.25533 9.06908 3.22464 9.23524C3.35654 9.25781 3.55717 9.26129 4.14274 9.26129H5.07023C5.25717 9.26129 5.4593 9.25932 5.62672 9.27901C5.80364 9.29982 6.05492 9.35458 6.27179 9.551C6.37381 9.64347 6.45784 9.75424 6.51982 9.87719C6.65133 10.1382 6.6374 10.3942 6.61048 10.5702C6.58498 10.7367 6.52988 10.931 6.48022 11.1111L6.01439 12.8003L6.00501 12.8347C5.87513 13.3268 6.01464 13.8509 6.37184 14.2134L6.40935 14.251L6.46667 14.2864C6.52866 14.3088 6.60155 14.2912 6.64591 14.2364L6.65738 14.2239L6.65633 14.2228L10.3569 9.52078C10.4543 9.397 10.5491 9.27245 10.6633 9.1675C10.9166 8.93483 11.2325 8.78186 11.572 8.72669C11.7251 8.70184 11.8814 8.70376 12.0389 8.70376C12.7927 8.70376 13.0245 8.69651 13.1956 8.64748C13.6727 8.51051 14.0465 8.13768 14.1836 7.6606C14.2327 7.48941 14.2388 7.25727 14.2388 6.5028V4.85209Z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="fbb737a4">(pcvenv) D:\ML_Projects\pdf-chatbot&gt;python check_index_compatibility.py
🔍 Checking index compatibility...
Index dimension: 768
Metadata entries: 37
Index was created with Gemini embeddings
✅ Index compatibility check completed

(pcvenv) D:\ML_Projects\pdf-chatbot&gt;</div></div><div class="_11d6b3a"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5" style="--assistant-last-margin-bottom: 32px;"><div class="ds-message _656c965"><div class="_7d763a7 _45cdda5" style="--deep-search-title-height: 38px; --group-title-sticky-top: 0px;"><div class="_68f84dc"></div><div class="ddd2f74b"></div></div><div class="ds-markdown" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph"><span>Perfect! The compatibility check shows that your index was created with </span><strong><span>Gemini embeddings</span></strong><span> (768 dimensions), which is exactly what we want. The issue is that when you run the verification script, it's not finding your Gemini API key in the environment.</span></p><h2><span>Quick Fix: Ensure the API Key is Available Everywhere</span></h2><p class="ds-markdown-paragraph"><span>The problem is that your </span><code>.env</code><span> file is being loaded in </span><code>app.py</code><span> but not in the verification script. Let me fix this:</span></p><h3><span>1. Update </span><code>verify_consistency.py</code><span> to properly load environment</span></h3><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment">#!/usr/bin/env python3</span>
<span class="token triple-quoted-string string">"""
Script to verify that the evaluator uses the same logic as the main app
"""</span>

<span class="token keyword">import</span> sys
<span class="token keyword">import</span> os
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv

<span class="token comment"># Load environment variables FIRST - use the same .env file as app.py</span>
load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>rag_engine <span class="token keyword">import</span> RAGEngine

<span class="token keyword">def</span> <span class="token function">test_consistency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Test that both apps use the same components and logic"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"🔍 Testing consistency between main app and evaluator..."</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Check API key first</span>
    api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> api_key<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ Gemini API key found: </span><span class="token interpolation"><span class="token punctuation">{</span>api_key<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">10]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"❌ Gemini API key not found in environment"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Please make sure your .env file is in the same directory as this script"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"And contains: GEMINI_API_KEY=your_actual_key_here"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    
    <span class="token comment"># Test 1: Same vector store initialization</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n1. Testing Vector Store consistency..."</span><span class="token punctuation">)</span>
    vector_store_app <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
    vector_store_eval <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Both should have same configuration</span>
    <span class="token keyword">assert</span> vector_store_app<span class="token punctuation">.</span>index_path <span class="token operator">==</span> vector_store_eval<span class="token punctuation">.</span>index_path
    <span class="token keyword">assert</span> vector_store_app<span class="token punctuation">.</span>metadata_path <span class="token operator">==</span> vector_store_eval<span class="token punctuation">.</span>metadata_path
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ Vector Store configuration consistent"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Test 2: Same RAG engine initialization</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n2. Testing RAG Engine consistency..."</span><span class="token punctuation">)</span>
    rag_app <span class="token operator">=</span> RAGEngine<span class="token punctuation">(</span><span class="token punctuation">)</span>
    rag_eval <span class="token operator">=</span> RAGEngine<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Both should use same model</span>
    <span class="token keyword">assert</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>rag_app<span class="token punctuation">,</span> <span class="token string">'model'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>rag_eval<span class="token punctuation">,</span> <span class="token string">'model'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ RAG Engine configuration consistent"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Test 3: Load index (if exists)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n3. Testing index loading..."</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> vector_store_app<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ Index loaded: </span><span class="token interpolation"><span class="token punctuation">{</span>vector_store_app<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">}</span></span><span class="token string"> vectors"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Test search consistency with simple query</span>
        test_query <span class="token operator">=</span> <span class="token string">"test"</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            results_app <span class="token operator">=</span> vector_store_app<span class="token punctuation">.</span>search<span class="token punctuation">(</span>test_query<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
            results_eval <span class="token operator">=</span> vector_store_eval<span class="token punctuation">.</span>search<span class="token punctuation">(</span>test_query<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ Search results: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>results_app<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> from app, </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>results_eval<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> from eval"</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># Show sample results</span>
            <span class="token keyword">if</span> results_app<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Sample result - Page </span><span class="token interpolation"><span class="token punctuation">{</span>results_app<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">,</span> <span class="token string">'N/A'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>results_app<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">100]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ Search results consistent"</span><span class="token punctuation">)</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Search failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"This might be due to embedding dimension mismatch"</span><span class="token punctuation">)</span>
            
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ℹ️  No index found for testing"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n🎉 Consistency verification completed!"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The evaluator uses the same components and logic as the main app."</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    test_consistency<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>2. Update </span><code>evaluate.py</code><span> to ensure proper environment loading</span></h3><p class="ds-markdown-paragraph"><span>Add this at the top of </span><code>evaluate.py</code><span>:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> json
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv

<span class="token comment"># Load environment variables FIRST</span>
load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Now import your modules</span>
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>evaluator <span class="token keyword">import</span> Evaluator
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore
<span class="token keyword">import</span> os</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>3. Create a simple test script to verify API key availability</span></h3><p class="ds-markdown-paragraph"><strong><span>test_api_</span><a href="https://key.py/" target="_blank" rel="noreferrer"><span>key.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment">#!/usr/bin/env python3</span>
<span class="token triple-quoted-string string">"""
Simple script to test if Gemini API key is available
"""</span>

<span class="token keyword">import</span> os
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv

<span class="token comment"># Load environment variables</span>
load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> api_key<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ Gemini API key found: </span><span class="token interpolation"><span class="token punctuation">{</span>api_key<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">10]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ Environment variables are loading correctly"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"❌ Gemini API key not found"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Please check:"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"1. Your .env file exists in the same directory"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"2. It contains: GEMINI_API_KEY=your_actual_key_here"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"3. The file is named exactly '.env' (not .env.txt or something else)"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Show current directory contents</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nCurrent directory contents:"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">'env'</span> <span class="token keyword">in</span> <span class="token builtin">file</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"  - </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">file</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>4. Run the API key test</span></h3><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>python test_api_key.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>5. If the API key is still not found, check your </span><code>.env</code><span> file</span></h3><p class="ds-markdown-paragraph"><span>Make sure your </span><code>.env</code><span> file:</span></p><ol start="1"><li><p class="ds-markdown-paragraph"><span>Is in the same directory as your scripts</span></p></li><li><p class="ds-markdown-paragraph"><span>Has the exact filename </span><code>.env</code><span> (not </span><code>.env.txt</code><span> or anything else)</span></p></li><li><p class="ds-markdown-paragraph"><span>Contains exactly: </span><code>GEMINI_API_KEY=your_actual_key_here</code></p></li></ol><h3><span>6. Alternative: Set environment variable directly</span></h3><p class="ds-markdown-paragraph"><span>If you're still having issues, you can set the environment variable directly in your scripts:</span></p><p class="ds-markdown-paragraph"><strong><span>temp_</span><a href="https://fix.py/" target="_blank" rel="noreferrer"><span>fix.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> os
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'your_actual_api_key_here'</span>

<span class="token comment"># Now run your verification</span>
<span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'verify_consistency.py'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h3><span>7. Final verification</span></h3><p class="ds-markdown-paragraph"><span>After ensuring the API key is available everywhere, run:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>python verify_consistency.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><p class="ds-markdown-paragraph"><span>You should now see output like:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">text</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>🔍 Testing consistency between main app and evaluator...
✅ Gemini API key found: AIzaSyC0E...
✅ Vector Store configuration consistent
✅ RAG Engine configuration consistent
Loading existing index...
✅ Using Gemini embeddings (dimension: 768)
✅ Index loaded with 37 chunks
✅ Index loaded: 37 vectors
✅ Search results: 2 from app, 2 from eval
Sample result - Page 1: This is a sample from your PDF...
✅ Search results consistent

🎉 Consistency verification completed!</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><p class="ds-markdown-paragraph"><span>The key issue was that different scripts weren't consistently loading the environment variables. The fixes ensure that:</span></p><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>All scripts load the </span><code>.env</code><span> file</span></strong><span> using </span><code>load_dotenv()</code></p></li><li><p class="ds-markdown-paragraph"><strong><span>API key is checked first</span></strong><span> before proceeding</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Consistent environment</span></strong><span> across all components</span></p></li></ol><p class="ds-markdown-paragraph"><span>Your index is perfectly fine (created with Gemini embeddings), you just need to ensure the API key is available to all scripts that need it.</span></p></div></div><div class="ds-theme" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE;"></div><div class="ds-flex _0a3d93b" style="align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 10px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92142 0.349213C10.3745 0.349295 12.5564 1.50526 13.9558 3.299L15.1282 2.12765C15.3304 1.92552 15.6768 2.06949 15.6768 2.35544V5.53929C15.6766 5.71632 15.533 5.85982 15.356 5.86008H12.1711C11.8855 5.85976 11.7427 5.51471 11.9443 5.31255L12.9642 4.29062C11.8238 2.74311 9.98914 1.74112 7.92142 1.74104C4.46442 1.74104 1.66239 4.54307 1.66239 8.00006C1.66239 11.4571 4.46442 14.2591 7.92142 14.2591C11.3783 14.2589 14.1804 11.457 14.1804 8.00006H15.5723C15.5723 12.2252 12.1465 15.6508 7.92142 15.6509C3.6962 15.6509 0.270569 12.2253 0.270569 8.00006C0.270569 3.77485 3.6962 0.349213 7.92142 0.349213Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.27861 0.811633C8.81985 0.142255 9.79016 0.0422445 10.4537 0.557662L10.5823 0.669367L10.6065 0.693605L10.6097 0.695713L10.6392 0.72522C11.3549 1.44685 11.6336 2.49474 11.3716 3.47675L11.3705 3.48097L11.361 3.5168L11.36 3.51891L10.8889 5.2261C10.8796 5.26003 10.8706 5.29164 10.8626 5.32094C10.8934 5.32101 10.927 5.322 10.9627 5.322H11.9006C12.4263 5.322 12.783 5.31906 13.0651 5.36731C14.8182 5.66725 15.9851 7.34574 15.6564 9.09363C15.6035 9.37493 15.4769 9.70926 15.2939 10.2023L14.337 12.7799C14.1401 13.3105 13.9773 13.7518 13.8101 14.1025C13.6375 14.4646 13.4385 14.7794 13.1441 15.0425C12.9712 15.197 12.7801 15.3303 12.5751 15.4387C12.2259 15.6232 11.8608 15.7 11.4612 15.7359C11.0742 15.7705 10.6034 15.7696 10.0374 15.7696H4.87371C4.08047 15.7696 3.42922 15.7703 2.90728 15.7138C2.37206 15.6558 1.88985 15.5311 1.4667 15.2237C1.22409 15.0475 1.01072 14.834 0.834405 14.5914C0.52696 14.1683 0.401312 13.6861 0.343323 13.1509C0.286761 12.6288 0.28747 11.977 0.28747 11.1834V9.51411C0.28747 8.84785 0.281286 8.36721 0.399176 7.95656C0.671091 7.00941 1.41109 6.26838 2.35823 5.99645C2.76888 5.87855 3.24952 5.88579 3.91579 5.88579C4.11977 5.88579 4.14542 5.88325 4.16238 5.88053C4.23526 5.8687 4.30403 5.83669 4.35839 5.78674C4.37104 5.77511 4.38755 5.7561 4.51436 5.59494L8.25648 0.839033L8.25754 0.837979L8.27861 0.811633ZM1.69116 11.1834C1.69116 12.0083 1.69211 12.5712 1.73859 13.0002C1.78365 13.4158 1.86467 13.6222 1.96937 13.7663C2.05914 13.8898 2.16727 13.999 2.29079 14.0888C2.43495 14.1935 2.6421 14.2745 3.05797 14.3195C3.45891 14.363 3.97631 14.3656 4.71564 14.3659C4.30795 13.8053 4.06447 13.1172 4.06437 12.371V8.59412H5.46807V12.371C5.46832 13.4734 6.3616 14.367 7.46401 14.367H10.0374C10.6286 14.367 11.0269 14.3663 11.3368 14.3385C11.6339 14.3118 11.7956 14.2639 11.9196 14.1984C12.024 14.1431 12.1213 14.0747 12.2094 13.996C12.3139 13.9025 12.4151 13.7679 12.5434 13.4986C12.6774 13.2177 12.8162 12.8451 13.0219 12.2909L13.9787 9.71328C14.1848 9.15822 14.253 8.96737 14.278 8.83439C14.4617 7.85698 13.8092 6.91901 12.829 6.75098C12.6956 6.72816 12.4928 6.72464 11.9006 6.72464H10.9627C10.7737 6.72464 10.5693 6.72663 10.4 6.70672C10.2211 6.68568 9.96696 6.6303 9.74764 6.43167C9.64448 6.33817 9.5595 6.22616 9.49683 6.10183C9.36384 5.8379 9.37793 5.57905 9.40515 5.40104C9.43094 5.23267 9.48666 5.03623 9.53688 4.8541L10.0079 3.14585L10.0174 3.11108C10.1488 2.61344 10.0077 2.08344 9.64648 1.71687L9.60854 1.67893L9.55058 1.6431C9.48789 1.62049 9.41419 1.6382 9.36932 1.69368L9.35773 1.70633L9.35878 1.70738L5.61666 6.46224C5.51816 6.58741 5.42231 6.71336 5.30683 6.81948C5.05069 7.05477 4.73119 7.20945 4.3879 7.26525C4.23309 7.29038 4.07507 7.28843 3.91579 7.28843C3.1535 7.28843 2.9191 7.29576 2.74604 7.34534C2.26358 7.48385 1.88558 7.86087 1.74702 8.34331C1.69732 8.51642 1.69116 8.75116 1.69116 9.51411V11.1834Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.72451 15.1086C7.18929 15.7706 6.22975 15.8695 5.57357 15.3598L5.44643 15.2493L5.42247 15.2253L5.41934 15.2233L5.39016 15.1941C4.68239 14.4805 4.40679 13.4442 4.66589 12.4731L4.66693 12.4689L4.67631 12.4335L4.67735 12.4314L5.14318 10.7432C5.15243 10.7096 5.1613 10.6784 5.16923 10.6494C5.13878 10.6493 5.10558 10.6484 5.07023 10.6484H4.14274C3.62288 10.6484 3.27015 10.6513 2.9912 10.6035C1.25757 10.3069 0.103662 8.64709 0.42863 6.91861C0.480965 6.64044 0.606164 6.30981 0.787119 5.8223L1.73336 3.27328C1.92812 2.74859 2.08912 2.31215 2.25442 1.96542C2.42515 1.60731 2.62191 1.296 2.91304 1.03584C3.08408 0.883016 3.273 0.751185 3.47579 0.644009C3.82102 0.461569 4.18214 0.385575 4.57731 0.350131C4.95993 0.315849 5.42553 0.316783 5.98521 0.316783H11.0916C11.876 0.316783 12.52 0.316134 13.0362 0.372015C13.5655 0.429358 14.0423 0.552599 14.4608 0.856601C14.7007 1.03091 14.9117 1.24199 15.086 1.48187C15.3901 1.90033 15.5143 2.37716 15.5717 2.90645C15.6276 3.42275 15.6269 4.06727 15.6269 4.85209V6.5028C15.6269 7.16167 15.633 7.63697 15.5164 8.04306C15.2475 8.97969 14.5158 9.71248 13.5791 9.9814C13.173 10.098 12.6977 10.0908 12.0389 10.0908C11.8372 10.0908 11.8118 10.0933 11.795 10.096C11.723 10.1077 11.6549 10.1394 11.6012 10.1888C11.5887 10.2003 11.5724 10.2191 11.447 10.3784L7.74639 15.0815L7.74535 15.0826L7.72451 15.1086ZM14.2388 4.85209C14.2388 4.03635 14.2379 3.47971 14.1919 3.05547C14.1473 2.64449 14.0672 2.44037 13.9637 2.29785C13.8749 2.17569 13.768 2.06776 13.6458 1.97896C13.5033 1.87539 13.2984 1.7953 12.8872 1.75074C12.4907 1.70779 11.979 1.70518 11.2479 1.70489C11.6511 2.25924 11.8918 2.93974 11.8919 3.67762V7.41257H10.5038V3.67762C10.5036 2.58751 9.62023 1.70384 8.53007 1.70384H5.98521C5.40065 1.70384 5.00679 1.70449 4.70028 1.73198C4.40651 1.75836 4.24662 1.80577 4.12399 1.87058C4.02069 1.92518 3.92452 1.99283 3.8374 2.07067C3.73401 2.16312 3.634 2.29627 3.50705 2.56255C3.37462 2.84034 3.23734 3.2088 3.03393 3.75682L2.08768 6.30584C1.88395 6.85474 1.81646 7.04347 1.79172 7.17497C1.61005 8.14152 2.25533 9.06908 3.22464 9.23524C3.35654 9.25781 3.55717 9.26129 4.14274 9.26129H5.07023C5.25717 9.26129 5.4593 9.25932 5.62672 9.27901C5.80364 9.29982 6.05492 9.35458 6.27179 9.551C6.37381 9.64347 6.45784 9.75424 6.51982 9.87719C6.65133 10.1382 6.6374 10.3942 6.61048 10.5702C6.58498 10.7367 6.52988 10.931 6.48022 11.1111L6.01439 12.8003L6.00501 12.8347C5.87513 13.3268 6.01464 13.8509 6.37184 14.2134L6.40935 14.251L6.46667 14.2864C6.52866 14.3088 6.60155 14.2912 6.64591 14.2364L6.65738 14.2239L6.65633 14.2228L10.3569 9.52078C10.4543 9.397 10.5491 9.27245 10.6633 9.1675C10.9166 8.93483 11.2325 8.78186 11.572 8.72669C11.7251 8.70184 11.8814 8.70376 12.0389 8.70376C12.7927 8.70376 13.0245 8.69651 13.1956 8.64748C13.6727 8.51051 14.0465 8.13768 14.1836 7.6606C14.2327 7.48941 14.2388 7.25727 14.2388 6.5028V4.85209Z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="fbb737a4">(pcvenv) D:\ML_Projects\pdf-chatbot&gt;python verify_consistency.py
🔍 Testing consistency between main app and evaluator...

1. Testing Vector Store consistency...
✅ Vector Store configuration consistent

2. Testing RAG Engine consistency...
✓ Gemini Flash 1.5 model initialized successfully
✅ Index compatibility check completed

(pcvenv) D:\ML_Projects\pdf-chatbot&gt;python verify_consistency.py
🔍 Testing consistency between main app and evaluator...

1. Testing Vector Store consistency...
✅ Vector Store configuration consistent

2. Testing RAG Engine consistency...

1. Testing Vector Store consistency...
✅ Vector Store configuration consistent

2. Testing RAG Engine consistency...
✅ Vector Store configuration consistent

2. Testing RAG Engine consistency...
2. Testing RAG Engine consistency...
✓ Gemini Flash 1.5 model initialized successfully
✓ Gemini Flash 1.5 model initialized successfully
✅ RAG Engine configuration consistent

✅ RAG Engine configuration consistent


3. Testing index loading...
✅ Gemini API key found: AIzaSyD2Wf...
Loading existing index...
✓ Using Gemini embeddings (dimension: 1)
⚠️  Dimension mismatch detected: Embedding dim 1 vs Index dim 768
Index was created with Gemini, trying to use Gemini...
Error loading index: VectorStore.initialize_embedding_model() got an unexpected keyword argument 'force_gemini'
ℹ️  No index found for testing

🎉 Consistency verification completed!
The evaluator uses the same components and logic as the main app.

(pcvenv) D:\ML_Projects\pdf-chatbot&gt;</div></div><div class="_11d6b3a"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5" style="--assistant-last-margin-bottom: 32px;"><div class="ds-message _656c965"><div class="_7d763a7 _45cdda5" style="--deep-search-title-height: 38px; --group-title-sticky-top: 0px;"><div class="_68f84dc"></div><div class="ddd2f74b"></div></div><div class="ds-markdown" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph"><span>I see the issue! There are a couple of problems:</span></p><ol start="1"><li><p class="ds-markdown-paragraph"><span>The embedding dimension is showing as </span><code>1</code><span> instead of </span><code>768</code><span> - this suggests the Gemini embedding call is returning unexpected results</span></p></li><li><p class="ds-markdown-paragraph"><span>There's an error with the </span><code>force_gemini</code><span> parameter</span></p></li></ol><p class="ds-markdown-paragraph"><span>Let me fix these issues:</span></p><h2><span>1. Update </span><code>modules/vector_store.py</code><span> with proper Gemini embedding handling</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> faiss
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict
<span class="token keyword">import</span> google<span class="token punctuation">.</span>generativeai <span class="token keyword">as</span> genai
<span class="token keyword">from</span> sentence_transformers <span class="token keyword">import</span> SentenceTransformer

<span class="token keyword">class</span> <span class="token class-name">VectorStore</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span><span class="token punctuation">,</span> metadata_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>index_path <span class="token operator">=</span> index_path
        self<span class="token punctuation">.</span>metadata_path <span class="token operator">=</span> metadata_path
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>used_gemini_for_index <span class="token operator">=</span> <span class="token boolean">False</span>
        
    <span class="token keyword">def</span> <span class="token function">initialize_embedding_model</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> use_gemini<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialize embedding model with proper error handling"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># Try to use Gemini embeddings if requested and API key available</span>
            api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> use_gemini <span class="token keyword">and</span> api_key<span class="token punctuation">:</span>
                genai<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>api_key<span class="token operator">=</span>api_key<span class="token punctuation">)</span>
                
                <span class="token comment"># Test the API with a simple embedding - ensure proper format</span>
                test_result <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                    model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                    content<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"test embedding"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
                <span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> <span class="token string">'embedding'</span> <span class="token keyword">in</span> test_result<span class="token punctuation">:</span>
                    <span class="token comment"># Handle the embedding response format correctly</span>
                    embedding_data <span class="token operator">=</span> test_result<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span>
                    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>embedding_data<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>embedding_data<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>embedding_data<span class="token punctuation">)</span>
                        self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> <span class="token string">'gemini'</span>
                        self<span class="token punctuation">.</span>used_gemini_for_index <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Using Gemini embeddings (dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
                        self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">return</span> <span class="token boolean">True</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"⚠️ Gemini returned empty or invalid embedding"</span><span class="token punctuation">)</span>
                
            <span class="token comment"># Fall back to local model</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
                
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Gemini embedding failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">, falling back to local model"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">_initialize_local_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialize local embedding model as fallback"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> SentenceTransformer<span class="token punctuation">(</span><span class="token string">'all-MiniLM-L6-v2'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">.</span>get_sentence_embedding_dimension<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>used_gemini_for_index <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Using local SentenceTransformer (dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Failed to initialize local model: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">get_embeddings</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> texts<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Get embeddings for texts with proper error handling"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_initialized<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Embedding model not initialized"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Check if we need to handle dimension mismatch</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> 
            <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>index<span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">!=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"⚠️  Dimension mismatch: Embedding dim </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string"> vs Index dim </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_reinitialize_for_index_compatibility<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>embedding_model <span class="token operator">==</span> <span class="token string">'gemini'</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># Handle single text vs multiple texts</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>texts<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    result <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                        model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                        content<span class="token operator">=</span>texts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
                    <span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    result <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                        model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                        content<span class="token operator">=</span>texts<span class="token punctuation">,</span>
                        task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
                    <span class="token punctuation">)</span>
                
                <span class="token comment"># Handle the response format correctly</span>
                <span class="token keyword">if</span> <span class="token string">'embedding'</span> <span class="token keyword">in</span> result<span class="token punctuation">:</span>
                    embedding_data <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span>
                    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>embedding_data<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>embedding_data<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>embedding_data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            <span class="token comment"># Multiple embeddings returned</span>
                            embeddings <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>embedding_data<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            <span class="token comment"># Single embedding returned</span>
                            embeddings <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>embedding_data<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Unexpected embedding format from Gemini"</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No embedding in Gemini response"</span><span class="token punctuation">)</span>
                
                <span class="token comment"># Ensure correct shape</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    embeddings <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Generated embeddings: </span><span class="token interpolation"><span class="token punctuation">{</span>embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> embeddings
                
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Gemini embedding generation failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Falling back to local model..."</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"All embedding methods failed"</span><span class="token punctuation">)</span>
                <span class="token comment"># Fall through to local model</span>
        
        <span class="token comment"># Use local model</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">,</span> SentenceTransformer<span class="token punctuation">)</span><span class="token punctuation">:</span>
            embeddings <span class="token operator">=</span> self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>texts<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Generated local embeddings: </span><span class="token interpolation"><span class="token punctuation">{</span>embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> embeddings
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No valid embedding model available"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">_reinitialize_for_index_compatibility</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Reinitialize embedding model to be compatible with existing index"""</span>
        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            index_dimension <span class="token operator">=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d
            
            <span class="token comment"># Try to use the same type of embedding that created the index</span>
            <span class="token keyword">if</span> index_dimension <span class="token operator">==</span> <span class="token number">768</span><span class="token punctuation">:</span>  <span class="token comment"># Gemini dimension</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Index was created with Gemini, trying to use Gemini..."</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span>use_gemini<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Index requires Gemini but API not available"</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> index_dimension <span class="token operator">==</span> <span class="token number">384</span><span class="token punctuation">:</span>  <span class="token comment"># SentenceTransformer dimension</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Index was created with local model, using local model..."</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Unknown index dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>index_dimension<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">create_index</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> chunks<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Create FAISS index from chunks"""</span>
        texts <span class="token operator">=</span> <span class="token punctuation">[</span>chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> chunk <span class="token keyword">in</span> chunks<span class="token punctuation">]</span>
        
        <span class="token comment"># Initialize embedding model (try Gemini first)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span>use_gemini<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Failed to initialize embedding model"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Get embeddings</span>
        embeddings <span class="token operator">=</span> self<span class="token punctuation">.</span>get_embeddings<span class="token punctuation">(</span>texts<span class="token punctuation">)</span>
        
        <span class="token comment"># Create FAISS index</span>
        dimension <span class="token operator">=</span> embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>IndexFlatL2<span class="token punctuation">(</span>dimension<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>add<span class="token punctuation">(</span>embeddings<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> chunks
        
        <span class="token comment"># Create storage directory if it doesn't exist</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Save index and metadata</span>
        faiss<span class="token punctuation">.</span>write_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index<span class="token punctuation">,</span> self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span> f<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ New index created with </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>chunks<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> chunks"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Index dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>dimension<span class="token punctuation">}</span></span><span class="token string">, Using: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'Gemini'</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>used_gemini_for_index <span class="token keyword">else</span> <span class="token string">'Local model'</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">load_index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Load existing index with proper initialization"""</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading existing index..."</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>read_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
                
                <span class="token comment"># Initialize embedding model (try to match index type)</span>
                index_dimension <span class="token operator">=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d
                <span class="token keyword">if</span> index_dimension <span class="token operator">==</span> <span class="token number">768</span><span class="token punctuation">:</span>
                    <span class="token comment"># Index was created with Gemini</span>
                    <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span>use_gemini<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"⚠️  Index requires Gemini but failed to initialize, trying local..."</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            <span class="token keyword">return</span> <span class="token boolean">False</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token comment"># Use appropriate model</span>
                    <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span>use_gemini<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> <span class="token boolean">False</span>
                
                <span class="token comment"># Final dimension check</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">!=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Critical: Embedding dimension </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string"> doesn't match index dimension </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">False</span>
                
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Index loaded with </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> chunks"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Index dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d<span class="token punctuation">}</span></span><span class="token string">, Using: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'Gemini'</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>used_gemini_for_index <span class="token keyword">else</span> <span class="token string">'Local model'</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
                
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Search for similar chunks with proper validation"""</span>
        <span class="token comment"># Check if index is loaded</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Index not loaded, attempting to load..."</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Index not initialized and cannot be loaded"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Check if embedding model is initialized</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_initialized<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Embedding model not initialized, initializing..."</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Embedding model not initialized"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Check if we have data to search</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Warning: Index is empty"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token comment"># Get query embedding</span>
        query_embedding <span class="token operator">=</span> self<span class="token punctuation">.</span>get_embeddings<span class="token punctuation">(</span><span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Ensure k doesn't exceed number of vectors</span>
        k <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">)</span>
        
        <span class="token comment"># Perform search</span>
        distances<span class="token punctuation">,</span> indices <span class="token operator">=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>search<span class="token punctuation">(</span>query_embedding<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
        
        results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> idx<span class="token punctuation">,</span> distance <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>indices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> distances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> idx <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">:</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>metadata<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
                result<span class="token punctuation">[</span><span class="token string">'similarity_score'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> distance<span class="token punctuation">)</span><span class="token punctuation">)</span>
                results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        
        <span class="token comment"># Sort by similarity score (descending)</span>
        results<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token string">'similarity_score'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> results
    
    <span class="token keyword">def</span> <span class="token function">is_ready</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Check if the vector store is ready for searching"""</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> 
                self<span class="token punctuation">.</span>is_initialized <span class="token keyword">and</span> 
                <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">clear_index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Clear the current index and metadata"""</span>
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
    <span class="token keyword">def</span> <span class="token function">delete_storage_files</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Delete the index and metadata files from storage"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✓ Storage files deleted"</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error deleting storage files: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>2. Create a simple debug script to test Gemini embeddings</span></h2><p class="ds-markdown-paragraph"><strong><span>debug_</span><a href="https://embeddings.py/" target="_blank" rel="noreferrer"><span>embeddings.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment">#!/usr/bin/env python3</span>
<span class="token triple-quoted-string string">"""
Debug script to test Gemini embeddings directly
"""</span>

<span class="token keyword">import</span> os
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv
<span class="token keyword">import</span> google<span class="token punctuation">.</span>generativeai <span class="token keyword">as</span> genai
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># Load environment variables</span>
load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">test_gemini_embeddings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Test Gemini embeddings directly"""</span>
    api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> api_key<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"❌ No Gemini API key found"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ Gemini API key found: </span><span class="token interpolation"><span class="token punctuation">{</span>api_key<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">10]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        genai<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>api_key<span class="token operator">=</span>api_key<span class="token punctuation">)</span>
        
        <span class="token comment"># Test single text</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n1. Testing single text embedding..."</span><span class="token punctuation">)</span>
        result_single <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
            model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
            content<span class="token operator">=</span><span class="token string">"test embedding"</span><span class="token punctuation">,</span>
            task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
        <span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Single text response keys:"</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>result_single<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">'embedding'</span> <span class="token keyword">in</span> result_single<span class="token punctuation">:</span>
            embedding <span class="token operator">=</span> result_single<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Embedding type: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">type</span><span class="token punctuation">(</span>embedding<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>embedding<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Embedding length: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>embedding<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"First 5 values: </span><span class="token interpolation"><span class="token punctuation">{</span>embedding<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">5]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                
                <span class="token comment"># Convert to numpy array</span>
                embedding_array <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>embedding<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Numpy array shape: </span><span class="token interpolation"><span class="token punctuation">{</span>embedding_array<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Test multiple texts</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n2. Testing multiple texts embedding..."</span><span class="token punctuation">)</span>
        result_multi <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
            model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
            content<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"test one"</span><span class="token punctuation">,</span> <span class="token string">"test two"</span><span class="token punctuation">,</span> <span class="token string">"test three"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
        <span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Multiple texts response keys:"</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>result_multi<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">'embedding'</span> <span class="token keyword">in</span> result_multi<span class="token punctuation">:</span>
            embedding <span class="token operator">=</span> result_multi<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Embedding type: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">type</span><span class="token punctuation">(</span>embedding<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>embedding<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>embedding<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>embedding<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Number of embeddings: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>embedding<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Each embedding length: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>embedding<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    
                    <span class="token comment"># Convert to numpy array</span>
                    embedding_array <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>embedding<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Numpy array shape: </span><span class="token interpolation"><span class="token punctuation">{</span>embedding_array<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Error testing Gemini embeddings: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">import</span> traceback
        traceback<span class="token punctuation">.</span>print_exc<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    test_gemini_embeddings<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>3. Run the debug script first</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>python debug_embeddings.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><p class="ds-markdown-paragraph"><span>This will show you exactly what format Gemini is returning for embeddings.</span></p><h2><span>4. Then run the fixed verification</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>python verify_consistency.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Key Fixes:</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>Fixed parameter name</span></strong><span>: Changed </span><code>force_gemini</code><span> to </span><code>use_gemini</code></p></li><li><p class="ds-markdown-paragraph"><strong><span>Better embedding handling</span></strong><span>: Properly handles both single and multiple text embeddings from Gemini</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Improved error handling</span></strong><span>: Better debugging and fallback mechanisms</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Dimension validation</span></strong><span>: Ensures embedding dimension matches index dimension</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Better logging</span></strong><span>: More detailed output to understand what's happening</span></p></li></ol><p class="ds-markdown-paragraph"><span>The main issue was that the Gemini embedding response format wasn't being handled correctly. The updated code should properly handle both single and multiple text embeddings and ensure the dimensions match.</span></p><p class="ds-markdown-paragraph"><span>Run the debug script first to see what format Gemini is returning, then the verification should work correctly!</span></p></div></div><div class="ds-theme" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE;"></div><div class="ds-flex _0a3d93b" style="align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 10px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92142 0.349213C10.3745 0.349295 12.5564 1.50526 13.9558 3.299L15.1282 2.12765C15.3304 1.92552 15.6768 2.06949 15.6768 2.35544V5.53929C15.6766 5.71632 15.533 5.85982 15.356 5.86008H12.1711C11.8855 5.85976 11.7427 5.51471 11.9443 5.31255L12.9642 4.29062C11.8238 2.74311 9.98914 1.74112 7.92142 1.74104C4.46442 1.74104 1.66239 4.54307 1.66239 8.00006C1.66239 11.4571 4.46442 14.2591 7.92142 14.2591C11.3783 14.2589 14.1804 11.457 14.1804 8.00006H15.5723C15.5723 12.2252 12.1465 15.6508 7.92142 15.6509C3.6962 15.6509 0.270569 12.2253 0.270569 8.00006C0.270569 3.77485 3.6962 0.349213 7.92142 0.349213Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.27861 0.811633C8.81985 0.142255 9.79016 0.0422445 10.4537 0.557662L10.5823 0.669367L10.6065 0.693605L10.6097 0.695713L10.6392 0.72522C11.3549 1.44685 11.6336 2.49474 11.3716 3.47675L11.3705 3.48097L11.361 3.5168L11.36 3.51891L10.8889 5.2261C10.8796 5.26003 10.8706 5.29164 10.8626 5.32094C10.8934 5.32101 10.927 5.322 10.9627 5.322H11.9006C12.4263 5.322 12.783 5.31906 13.0651 5.36731C14.8182 5.66725 15.9851 7.34574 15.6564 9.09363C15.6035 9.37493 15.4769 9.70926 15.2939 10.2023L14.337 12.7799C14.1401 13.3105 13.9773 13.7518 13.8101 14.1025C13.6375 14.4646 13.4385 14.7794 13.1441 15.0425C12.9712 15.197 12.7801 15.3303 12.5751 15.4387C12.2259 15.6232 11.8608 15.7 11.4612 15.7359C11.0742 15.7705 10.6034 15.7696 10.0374 15.7696H4.87371C4.08047 15.7696 3.42922 15.7703 2.90728 15.7138C2.37206 15.6558 1.88985 15.5311 1.4667 15.2237C1.22409 15.0475 1.01072 14.834 0.834405 14.5914C0.52696 14.1683 0.401312 13.6861 0.343323 13.1509C0.286761 12.6288 0.28747 11.977 0.28747 11.1834V9.51411C0.28747 8.84785 0.281286 8.36721 0.399176 7.95656C0.671091 7.00941 1.41109 6.26838 2.35823 5.99645C2.76888 5.87855 3.24952 5.88579 3.91579 5.88579C4.11977 5.88579 4.14542 5.88325 4.16238 5.88053C4.23526 5.8687 4.30403 5.83669 4.35839 5.78674C4.37104 5.77511 4.38755 5.7561 4.51436 5.59494L8.25648 0.839033L8.25754 0.837979L8.27861 0.811633ZM1.69116 11.1834C1.69116 12.0083 1.69211 12.5712 1.73859 13.0002C1.78365 13.4158 1.86467 13.6222 1.96937 13.7663C2.05914 13.8898 2.16727 13.999 2.29079 14.0888C2.43495 14.1935 2.6421 14.2745 3.05797 14.3195C3.45891 14.363 3.97631 14.3656 4.71564 14.3659C4.30795 13.8053 4.06447 13.1172 4.06437 12.371V8.59412H5.46807V12.371C5.46832 13.4734 6.3616 14.367 7.46401 14.367H10.0374C10.6286 14.367 11.0269 14.3663 11.3368 14.3385C11.6339 14.3118 11.7956 14.2639 11.9196 14.1984C12.024 14.1431 12.1213 14.0747 12.2094 13.996C12.3139 13.9025 12.4151 13.7679 12.5434 13.4986C12.6774 13.2177 12.8162 12.8451 13.0219 12.2909L13.9787 9.71328C14.1848 9.15822 14.253 8.96737 14.278 8.83439C14.4617 7.85698 13.8092 6.91901 12.829 6.75098C12.6956 6.72816 12.4928 6.72464 11.9006 6.72464H10.9627C10.7737 6.72464 10.5693 6.72663 10.4 6.70672C10.2211 6.68568 9.96696 6.6303 9.74764 6.43167C9.64448 6.33817 9.5595 6.22616 9.49683 6.10183C9.36384 5.8379 9.37793 5.57905 9.40515 5.40104C9.43094 5.23267 9.48666 5.03623 9.53688 4.8541L10.0079 3.14585L10.0174 3.11108C10.1488 2.61344 10.0077 2.08344 9.64648 1.71687L9.60854 1.67893L9.55058 1.6431C9.48789 1.62049 9.41419 1.6382 9.36932 1.69368L9.35773 1.70633L9.35878 1.70738L5.61666 6.46224C5.51816 6.58741 5.42231 6.71336 5.30683 6.81948C5.05069 7.05477 4.73119 7.20945 4.3879 7.26525C4.23309 7.29038 4.07507 7.28843 3.91579 7.28843C3.1535 7.28843 2.9191 7.29576 2.74604 7.34534C2.26358 7.48385 1.88558 7.86087 1.74702 8.34331C1.69732 8.51642 1.69116 8.75116 1.69116 9.51411V11.1834Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.72451 15.1086C7.18929 15.7706 6.22975 15.8695 5.57357 15.3598L5.44643 15.2493L5.42247 15.2253L5.41934 15.2233L5.39016 15.1941C4.68239 14.4805 4.40679 13.4442 4.66589 12.4731L4.66693 12.4689L4.67631 12.4335L4.67735 12.4314L5.14318 10.7432C5.15243 10.7096 5.1613 10.6784 5.16923 10.6494C5.13878 10.6493 5.10558 10.6484 5.07023 10.6484H4.14274C3.62288 10.6484 3.27015 10.6513 2.9912 10.6035C1.25757 10.3069 0.103662 8.64709 0.42863 6.91861C0.480965 6.64044 0.606164 6.30981 0.787119 5.8223L1.73336 3.27328C1.92812 2.74859 2.08912 2.31215 2.25442 1.96542C2.42515 1.60731 2.62191 1.296 2.91304 1.03584C3.08408 0.883016 3.273 0.751185 3.47579 0.644009C3.82102 0.461569 4.18214 0.385575 4.57731 0.350131C4.95993 0.315849 5.42553 0.316783 5.98521 0.316783H11.0916C11.876 0.316783 12.52 0.316134 13.0362 0.372015C13.5655 0.429358 14.0423 0.552599 14.4608 0.856601C14.7007 1.03091 14.9117 1.24199 15.086 1.48187C15.3901 1.90033 15.5143 2.37716 15.5717 2.90645C15.6276 3.42275 15.6269 4.06727 15.6269 4.85209V6.5028C15.6269 7.16167 15.633 7.63697 15.5164 8.04306C15.2475 8.97969 14.5158 9.71248 13.5791 9.9814C13.173 10.098 12.6977 10.0908 12.0389 10.0908C11.8372 10.0908 11.8118 10.0933 11.795 10.096C11.723 10.1077 11.6549 10.1394 11.6012 10.1888C11.5887 10.2003 11.5724 10.2191 11.447 10.3784L7.74639 15.0815L7.74535 15.0826L7.72451 15.1086ZM14.2388 4.85209C14.2388 4.03635 14.2379 3.47971 14.1919 3.05547C14.1473 2.64449 14.0672 2.44037 13.9637 2.29785C13.8749 2.17569 13.768 2.06776 13.6458 1.97896C13.5033 1.87539 13.2984 1.7953 12.8872 1.75074C12.4907 1.70779 11.979 1.70518 11.2479 1.70489C11.6511 2.25924 11.8918 2.93974 11.8919 3.67762V7.41257H10.5038V3.67762C10.5036 2.58751 9.62023 1.70384 8.53007 1.70384H5.98521C5.40065 1.70384 5.00679 1.70449 4.70028 1.73198C4.40651 1.75836 4.24662 1.80577 4.12399 1.87058C4.02069 1.92518 3.92452 1.99283 3.8374 2.07067C3.73401 2.16312 3.634 2.29627 3.50705 2.56255C3.37462 2.84034 3.23734 3.2088 3.03393 3.75682L2.08768 6.30584C1.88395 6.85474 1.81646 7.04347 1.79172 7.17497C1.61005 8.14152 2.25533 9.06908 3.22464 9.23524C3.35654 9.25781 3.55717 9.26129 4.14274 9.26129H5.07023C5.25717 9.26129 5.4593 9.25932 5.62672 9.27901C5.80364 9.29982 6.05492 9.35458 6.27179 9.551C6.37381 9.64347 6.45784 9.75424 6.51982 9.87719C6.65133 10.1382 6.6374 10.3942 6.61048 10.5702C6.58498 10.7367 6.52988 10.931 6.48022 11.1111L6.01439 12.8003L6.00501 12.8347C5.87513 13.3268 6.01464 13.8509 6.37184 14.2134L6.40935 14.251L6.46667 14.2864C6.52866 14.3088 6.60155 14.2912 6.64591 14.2364L6.65738 14.2239L6.65633 14.2228L10.3569 9.52078C10.4543 9.397 10.5491 9.27245 10.6633 9.1675C10.9166 8.93483 11.2325 8.78186 11.572 8.72669C11.7251 8.70184 11.8814 8.70376 12.0389 8.70376C12.7927 8.70376 13.0245 8.69651 13.1956 8.64748C13.6727 8.51051 14.0465 8.13768 14.1836 7.6606C14.2327 7.48941 14.2388 7.25727 14.2388 6.5028V4.85209Z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="fbb737a4">(pcvenv) D:\ML_Projects\pdf-chatbot&gt;python debug_embeddings.py
✅ Gemini API key found: AIzaSyD2Wf...

1. Testing single text embedding...
Single text response keys: ['embedding']
Embedding type: &lt;class 'list'&gt;
Embedding length: 768
First 5 values: [0.050444726, -0.0243059, -0.058035653, -0.009477076, 0.06375991]
Numpy array shape: (768,)

2. Testing multiple texts embedding...
Multiple texts response keys: ['embedding']
Embedding type: &lt;class 'list'&gt;
Number of embeddings: 3
Each embedding length: 768
Numpy array shape: (3, 768)

(pcvenv) D:\ML_Projects\pdf-chatbot&gt;python verify_consistency.py
🔍 Testing consistency between main app and evaluator...

1. Testing Vector Store consistency...
✅ Vector Store configuration consistent

2. Testing RAG Engine consistency...
✓ Gemini Flash 1.5 model initialized successfully
✓ Gemini Flash 1.5 model initialized successfully
✅ RAG Engine configuration consistent

3. Testing index loading...
✅ Gemini API key found: AIzaSyD2Wf...
Loading existing index...
✓ Using Gemini embeddings (dimension: 1)
❌ Critical: Embedding dimension 1 doesn't match index dimension 768
ℹ️  No index found for testing

🎉 Consistency verification completed!
The evaluator uses the same components and logic as the main app.

(pcvenv) D:\ML_Projects\pdf-chatbot&gt;</div></div><div class="_11d6b3a"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5" style="--assistant-last-margin-bottom: 32px;"><div class="ds-message _656c965"><div class="_7d763a7 _45cdda5" style="--deep-search-title-height: 38px; --group-title-sticky-top: 0px;"><div class="_68f84dc"></div><div class="ddd2f74b"></div></div><div class="ds-markdown" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph"><span>I see the issue! The Gemini embedding is returning the correct dimension (768) in the debug script, but somehow the vector store is detecting it as dimension 1. This suggests there's an issue with how the embedding dimension is being calculated in the </span><code>initialize_embedding_model</code><span> method.</span></p><p class="ds-markdown-paragraph"><span>Let me fix this:</span></p><h2><span>1. Update </span><code>modules/vector_store.py</code><span> with proper dimension detection</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> faiss
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict
<span class="token keyword">import</span> google<span class="token punctuation">.</span>generativeai <span class="token keyword">as</span> genai
<span class="token keyword">from</span> sentence_transformers <span class="token keyword">import</span> SentenceTransformer

<span class="token keyword">class</span> <span class="token class-name">VectorStore</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span><span class="token punctuation">,</span> metadata_path<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>index_path <span class="token operator">=</span> index_path
        self<span class="token punctuation">.</span>metadata_path <span class="token operator">=</span> metadata_path
        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>used_gemini_for_index <span class="token operator">=</span> <span class="token boolean">False</span>
        
    <span class="token keyword">def</span> <span class="token function">initialize_embedding_model</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> use_gemini<span class="token punctuation">:</span> <span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialize embedding model with proper error handling"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># Try to use Gemini embeddings if requested and API key available</span>
            api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> use_gemini <span class="token keyword">and</span> api_key<span class="token punctuation">:</span>
                genai<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>api_key<span class="token operator">=</span>api_key<span class="token punctuation">)</span>
                
                <span class="token comment"># Test the API with a simple embedding - ensure proper format</span>
                test_result <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                    model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                    content<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"test embedding"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
                <span class="token punctuation">)</span>
                
                <span class="token keyword">if</span> <span class="token string">'embedding'</span> <span class="token keyword">in</span> test_result<span class="token punctuation">:</span>
                    <span class="token comment"># Handle the embedding response format correctly</span>
                    embedding_data <span class="token operator">=</span> test_result<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span>
                    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>embedding_data<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>embedding_data<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>embedding_data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            <span class="token comment"># Multiple embeddings returned (list of lists)</span>
                            self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>embedding_data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            <span class="token comment"># Single embedding returned (flat list)</span>
                            self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>embedding_data<span class="token punctuation">)</span>
                        
                        self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> <span class="token string">'gemini'</span>
                        self<span class="token punctuation">.</span>used_gemini_for_index <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Using Gemini embeddings (dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
                        self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">return</span> <span class="token boolean">True</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"⚠️ Gemini returned non-list embedding"</span><span class="token punctuation">)</span>
                
            <span class="token comment"># Fall back to local model</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
                
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Gemini embedding failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">, falling back to local model"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">_initialize_local_model</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Initialize local embedding model as fallback"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>embedding_model <span class="token operator">=</span> SentenceTransformer<span class="token punctuation">(</span><span class="token string">'all-MiniLM-L6-v2'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">=</span> self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">.</span>get_sentence_embedding_dimension<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>used_gemini_for_index <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Using local SentenceTransformer (dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Failed to initialize local model: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>is_initialized <span class="token operator">=</span> <span class="token boolean">False</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">get_embeddings</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> texts<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Get embeddings for texts with proper error handling"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_initialized<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Embedding model not initialized"</span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>embedding_model <span class="token operator">==</span> <span class="token string">'gemini'</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># Handle single text vs multiple texts</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>texts<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    result <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                        model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                        content<span class="token operator">=</span>texts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
                    <span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    result <span class="token operator">=</span> genai<span class="token punctuation">.</span>embed_content<span class="token punctuation">(</span>
                        model<span class="token operator">=</span><span class="token string">"models/embedding-001"</span><span class="token punctuation">,</span>
                        content<span class="token operator">=</span>texts<span class="token punctuation">,</span>
                        task_type<span class="token operator">=</span><span class="token string">"retrieval_document"</span>
                    <span class="token punctuation">)</span>
                
                <span class="token comment"># Handle the response format correctly</span>
                <span class="token keyword">if</span> <span class="token string">'embedding'</span> <span class="token keyword">in</span> result<span class="token punctuation">:</span>
                    embedding_data <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span>
                    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>embedding_data<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>embedding_data<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>embedding_data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            <span class="token comment"># Multiple embeddings returned (list of lists)</span>
                            embeddings <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>embedding_data<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            <span class="token comment"># Single embedding returned (flat list)</span>
                            embeddings <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>embedding_data<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Unexpected embedding format from Gemini"</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No embedding in Gemini response"</span><span class="token punctuation">)</span>
                
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Generated embeddings: </span><span class="token interpolation"><span class="token punctuation">{</span>embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> embeddings
                
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Gemini embedding generation failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Falling back to local model..."</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"All embedding methods failed"</span><span class="token punctuation">)</span>
                <span class="token comment"># Fall through to local model</span>
        
        <span class="token comment"># Use local model</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">,</span> SentenceTransformer<span class="token punctuation">)</span><span class="token punctuation">:</span>
            embeddings <span class="token operator">=</span> self<span class="token punctuation">.</span>embedding_model<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>texts<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Generated local embeddings: </span><span class="token interpolation"><span class="token punctuation">{</span>embeddings<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> embeddings
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No valid embedding model available"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">load_index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Load existing index with proper initialization"""</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading existing index..."</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>read_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
                
                <span class="token comment"># Get index dimension</span>
                index_dimension <span class="token operator">=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Index dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>index_dimension<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                
                <span class="token comment"># Initialize appropriate embedding model based on index dimension</span>
                <span class="token keyword">if</span> index_dimension <span class="token operator">==</span> <span class="token number">768</span><span class="token punctuation">:</span>
                    <span class="token comment"># Index was created with Gemini</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Index requires Gemini embeddings"</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span>use_gemini<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"❌ Failed to initialize Gemini embeddings"</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span> <span class="token boolean">False</span>
                <span class="token keyword">elif</span> index_dimension <span class="token operator">==</span> <span class="token number">384</span><span class="token punctuation">:</span>
                    <span class="token comment"># Index was created with local model</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Index requires local embeddings"</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> <span class="token boolean">False</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Unknown index dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>index_dimension<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">False</span>
                
                <span class="token comment"># Final dimension check</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>embedding_dimension <span class="token operator">!=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Critical: Embedding dimension </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string"> doesn't match index dimension </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">False</span>
                
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Index loaded with </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> chunks"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Using: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'Gemini'</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>used_gemini_for_index <span class="token keyword">else</span> <span class="token string">'Local model'</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
                
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token comment"># ... rest of the methods remain the same ...</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>2. Create a script to recreate the index properly</span></h2><p class="ds-markdown-paragraph"><strong><span>recreate_</span><a href="https://index.py/" target="_blank" rel="noreferrer"><span>index.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment">#!/usr/bin/env python3</span>
<span class="token triple-quoted-string string">"""
Script to recreate the index with proper Gemini embeddings
"""</span>

<span class="token keyword">import</span> os
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>pdf_processor <span class="token keyword">import</span> PDFProcessor
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore

<span class="token comment"># Load environment variables</span>
load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">recreate_index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Recreate the index with proper Gemini embeddings"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"🔧 Recreating index with proper Gemini embeddings..."</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Check if we have the API key</span>
    api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">'GEMINI_API_KEY'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> api_key<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"❌ No Gemini API key found"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ Gemini API key found"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Ask for PDF file</span>
    pdf_path <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Enter the path to your PDF file (or press Enter to use existing processing): "</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Process PDF</span>
    processor <span class="token operator">=</span> PDFProcessor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    vector_store <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> pdf_path <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>pdf_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Processing PDF: </span><span class="token interpolation"><span class="token punctuation">{</span>pdf_path<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>pdf_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            chunks <span class="token operator">=</span> processor<span class="token punctuation">.</span>process_pdf<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Using existing PDF processing logic..."</span><span class="token punctuation">)</span>
        <span class="token comment"># You'll need to implement this based on your app's PDF handling</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Please run the main app to process a PDF first"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">if</span> <span class="token keyword">not</span> chunks<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"❌ No chunks extracted from PDF"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Extracted </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>chunks<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> chunks from PDF"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># Create new index with Gemini</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        vector_store<span class="token punctuation">.</span>create_index<span class="token punctuation">(</span>chunks<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ Index recreated successfully with Gemini embeddings!"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Error recreating index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    recreate_index<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>3. Alternative: Quick fix by deleting and recreating the index</span></h2><p class="ds-markdown-paragraph"><span>Since your current index has dimension issues, the simplest solution is to:</span></p><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>Delete the current index files:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token function">rm</span> storage/faiss_index storage/metadata.json</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>Run your main app to recreate the index:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>streamlit run app.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>Upload a PDF and click "Process PDF"</span></strong></p></li><li><p class="ds-markdown-paragraph"><strong><span>Then run the verification again:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>python verify_consistency.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li></ol><h2><span>4. Run a quick test to verify the fix</span></h2><p class="ds-markdown-paragraph"><strong><span>test_</span><a href="https://fix.py/" target="_blank" rel="noreferrer"><span>fix.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment">#!/usr/bin/env python3</span>
<span class="token triple-quoted-string string">"""
Quick test to verify the embedding dimension fix
"""</span>

<span class="token keyword">import</span> os
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore

<span class="token comment"># Load environment variables</span>
load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">test_embedding_dimension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Test that embedding dimension is detected correctly"""</span>
    vector_store <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Testing embedding dimension detection..."</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Test Gemini initialization</span>
    <span class="token keyword">if</span> vector_store<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span>use_gemini<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Gemini embedding dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>vector_store<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"❌ Failed to initialize Gemini"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Test local initialization</span>
    <span class="token keyword">if</span> vector_store<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Local embedding dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>vector_store<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    test_embedding_dimension<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Steps to fix:</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>First, run the dimension test:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>python test_fix.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>If the dimension is still wrong, delete and recreate the index:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token function">rm</span> storage/faiss_index storage/metadata.json
streamlit run app.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>Then run verification:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>python verify_consistency.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li></ol><p class="ds-markdown-paragraph"><span>The key issue was that the embedding dimension detection wasn't handling the Gemini response format correctly. The updated code should properly detect that Gemini embeddings have 768 dimensions.</span></p><p class="ds-markdown-paragraph"><span>The simplest solution is to delete the current index and let the main app create a new one with the fixed code. This will ensure everything is consistent.</span></p></div></div><div class="ds-theme" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE;"></div><div class="ds-flex _0a3d93b" style="align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 10px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92142 0.349213C10.3745 0.349295 12.5564 1.50526 13.9558 3.299L15.1282 2.12765C15.3304 1.92552 15.6768 2.06949 15.6768 2.35544V5.53929C15.6766 5.71632 15.533 5.85982 15.356 5.86008H12.1711C11.8855 5.85976 11.7427 5.51471 11.9443 5.31255L12.9642 4.29062C11.8238 2.74311 9.98914 1.74112 7.92142 1.74104C4.46442 1.74104 1.66239 4.54307 1.66239 8.00006C1.66239 11.4571 4.46442 14.2591 7.92142 14.2591C11.3783 14.2589 14.1804 11.457 14.1804 8.00006H15.5723C15.5723 12.2252 12.1465 15.6508 7.92142 15.6509C3.6962 15.6509 0.270569 12.2253 0.270569 8.00006C0.270569 3.77485 3.6962 0.349213 7.92142 0.349213Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.27861 0.811633C8.81985 0.142255 9.79016 0.0422445 10.4537 0.557662L10.5823 0.669367L10.6065 0.693605L10.6097 0.695713L10.6392 0.72522C11.3549 1.44685 11.6336 2.49474 11.3716 3.47675L11.3705 3.48097L11.361 3.5168L11.36 3.51891L10.8889 5.2261C10.8796 5.26003 10.8706 5.29164 10.8626 5.32094C10.8934 5.32101 10.927 5.322 10.9627 5.322H11.9006C12.4263 5.322 12.783 5.31906 13.0651 5.36731C14.8182 5.66725 15.9851 7.34574 15.6564 9.09363C15.6035 9.37493 15.4769 9.70926 15.2939 10.2023L14.337 12.7799C14.1401 13.3105 13.9773 13.7518 13.8101 14.1025C13.6375 14.4646 13.4385 14.7794 13.1441 15.0425C12.9712 15.197 12.7801 15.3303 12.5751 15.4387C12.2259 15.6232 11.8608 15.7 11.4612 15.7359C11.0742 15.7705 10.6034 15.7696 10.0374 15.7696H4.87371C4.08047 15.7696 3.42922 15.7703 2.90728 15.7138C2.37206 15.6558 1.88985 15.5311 1.4667 15.2237C1.22409 15.0475 1.01072 14.834 0.834405 14.5914C0.52696 14.1683 0.401312 13.6861 0.343323 13.1509C0.286761 12.6288 0.28747 11.977 0.28747 11.1834V9.51411C0.28747 8.84785 0.281286 8.36721 0.399176 7.95656C0.671091 7.00941 1.41109 6.26838 2.35823 5.99645C2.76888 5.87855 3.24952 5.88579 3.91579 5.88579C4.11977 5.88579 4.14542 5.88325 4.16238 5.88053C4.23526 5.8687 4.30403 5.83669 4.35839 5.78674C4.37104 5.77511 4.38755 5.7561 4.51436 5.59494L8.25648 0.839033L8.25754 0.837979L8.27861 0.811633ZM1.69116 11.1834C1.69116 12.0083 1.69211 12.5712 1.73859 13.0002C1.78365 13.4158 1.86467 13.6222 1.96937 13.7663C2.05914 13.8898 2.16727 13.999 2.29079 14.0888C2.43495 14.1935 2.6421 14.2745 3.05797 14.3195C3.45891 14.363 3.97631 14.3656 4.71564 14.3659C4.30795 13.8053 4.06447 13.1172 4.06437 12.371V8.59412H5.46807V12.371C5.46832 13.4734 6.3616 14.367 7.46401 14.367H10.0374C10.6286 14.367 11.0269 14.3663 11.3368 14.3385C11.6339 14.3118 11.7956 14.2639 11.9196 14.1984C12.024 14.1431 12.1213 14.0747 12.2094 13.996C12.3139 13.9025 12.4151 13.7679 12.5434 13.4986C12.6774 13.2177 12.8162 12.8451 13.0219 12.2909L13.9787 9.71328C14.1848 9.15822 14.253 8.96737 14.278 8.83439C14.4617 7.85698 13.8092 6.91901 12.829 6.75098C12.6956 6.72816 12.4928 6.72464 11.9006 6.72464H10.9627C10.7737 6.72464 10.5693 6.72663 10.4 6.70672C10.2211 6.68568 9.96696 6.6303 9.74764 6.43167C9.64448 6.33817 9.5595 6.22616 9.49683 6.10183C9.36384 5.8379 9.37793 5.57905 9.40515 5.40104C9.43094 5.23267 9.48666 5.03623 9.53688 4.8541L10.0079 3.14585L10.0174 3.11108C10.1488 2.61344 10.0077 2.08344 9.64648 1.71687L9.60854 1.67893L9.55058 1.6431C9.48789 1.62049 9.41419 1.6382 9.36932 1.69368L9.35773 1.70633L9.35878 1.70738L5.61666 6.46224C5.51816 6.58741 5.42231 6.71336 5.30683 6.81948C5.05069 7.05477 4.73119 7.20945 4.3879 7.26525C4.23309 7.29038 4.07507 7.28843 3.91579 7.28843C3.1535 7.28843 2.9191 7.29576 2.74604 7.34534C2.26358 7.48385 1.88558 7.86087 1.74702 8.34331C1.69732 8.51642 1.69116 8.75116 1.69116 9.51411V11.1834Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.72451 15.1086C7.18929 15.7706 6.22975 15.8695 5.57357 15.3598L5.44643 15.2493L5.42247 15.2253L5.41934 15.2233L5.39016 15.1941C4.68239 14.4805 4.40679 13.4442 4.66589 12.4731L4.66693 12.4689L4.67631 12.4335L4.67735 12.4314L5.14318 10.7432C5.15243 10.7096 5.1613 10.6784 5.16923 10.6494C5.13878 10.6493 5.10558 10.6484 5.07023 10.6484H4.14274C3.62288 10.6484 3.27015 10.6513 2.9912 10.6035C1.25757 10.3069 0.103662 8.64709 0.42863 6.91861C0.480965 6.64044 0.606164 6.30981 0.787119 5.8223L1.73336 3.27328C1.92812 2.74859 2.08912 2.31215 2.25442 1.96542C2.42515 1.60731 2.62191 1.296 2.91304 1.03584C3.08408 0.883016 3.273 0.751185 3.47579 0.644009C3.82102 0.461569 4.18214 0.385575 4.57731 0.350131C4.95993 0.315849 5.42553 0.316783 5.98521 0.316783H11.0916C11.876 0.316783 12.52 0.316134 13.0362 0.372015C13.5655 0.429358 14.0423 0.552599 14.4608 0.856601C14.7007 1.03091 14.9117 1.24199 15.086 1.48187C15.3901 1.90033 15.5143 2.37716 15.5717 2.90645C15.6276 3.42275 15.6269 4.06727 15.6269 4.85209V6.5028C15.6269 7.16167 15.633 7.63697 15.5164 8.04306C15.2475 8.97969 14.5158 9.71248 13.5791 9.9814C13.173 10.098 12.6977 10.0908 12.0389 10.0908C11.8372 10.0908 11.8118 10.0933 11.795 10.096C11.723 10.1077 11.6549 10.1394 11.6012 10.1888C11.5887 10.2003 11.5724 10.2191 11.447 10.3784L7.74639 15.0815L7.74535 15.0826L7.72451 15.1086ZM14.2388 4.85209C14.2388 4.03635 14.2379 3.47971 14.1919 3.05547C14.1473 2.64449 14.0672 2.44037 13.9637 2.29785C13.8749 2.17569 13.768 2.06776 13.6458 1.97896C13.5033 1.87539 13.2984 1.7953 12.8872 1.75074C12.4907 1.70779 11.979 1.70518 11.2479 1.70489C11.6511 2.25924 11.8918 2.93974 11.8919 3.67762V7.41257H10.5038V3.67762C10.5036 2.58751 9.62023 1.70384 8.53007 1.70384H5.98521C5.40065 1.70384 5.00679 1.70449 4.70028 1.73198C4.40651 1.75836 4.24662 1.80577 4.12399 1.87058C4.02069 1.92518 3.92452 1.99283 3.8374 2.07067C3.73401 2.16312 3.634 2.29627 3.50705 2.56255C3.37462 2.84034 3.23734 3.2088 3.03393 3.75682L2.08768 6.30584C1.88395 6.85474 1.81646 7.04347 1.79172 7.17497C1.61005 8.14152 2.25533 9.06908 3.22464 9.23524C3.35654 9.25781 3.55717 9.26129 4.14274 9.26129H5.07023C5.25717 9.26129 5.4593 9.25932 5.62672 9.27901C5.80364 9.29982 6.05492 9.35458 6.27179 9.551C6.37381 9.64347 6.45784 9.75424 6.51982 9.87719C6.65133 10.1382 6.6374 10.3942 6.61048 10.5702C6.58498 10.7367 6.52988 10.931 6.48022 11.1111L6.01439 12.8003L6.00501 12.8347C5.87513 13.3268 6.01464 13.8509 6.37184 14.2134L6.40935 14.251L6.46667 14.2864C6.52866 14.3088 6.60155 14.2912 6.64591 14.2364L6.65738 14.2239L6.65633 14.2228L10.3569 9.52078C10.4543 9.397 10.5491 9.27245 10.6633 9.1675C10.9166 8.93483 11.2325 8.78186 11.572 8.72669C11.7251 8.70184 11.8814 8.70376 12.0389 8.70376C12.7927 8.70376 13.0245 8.69651 13.1956 8.64748C13.6727 8.51051 14.0465 8.13768 14.1836 7.6606C14.2327 7.48941 14.2388 7.25727 14.2388 6.5028V4.85209Z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="fbb737a4">Now it is answering like:
What are the percentages of preference for type of engine in next vehicle?

The provided text gives partial data on engine preference for the next vehicle. Excerpt 2 [Page 6] shows a bar graph with percentages, but only some of the percentages are visible: 0%, 5%, 8%, 12%, 21%, and 54%. The graph is incomplete, so I cannot provide the full breakdown of engine preferences.

Before I was getting better answer. Then it could read the whole bar chart. I think dimension or chunk size is reduced. That's why this error is coming.</div></div><div class="_11d6b3a"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5" style="--assistant-last-margin-bottom: 32px;"><div class="ds-message _656c965"><div class="_7d763a7 _45cdda5" style="--deep-search-title-height: 38px; --group-title-sticky-top: 0px;"><div class="_68f84dc"></div><div class="ddd2f74b"></div></div><div class="ds-markdown" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph"><span>You're absolutely right! The issue is likely with the chunking strategy. When the text is split into chunks, it's probably breaking up the bar chart data across multiple chunks, so the RAG system only retrieves partial information.</span></p><p class="ds-markdown-paragraph"><span>Let me fix the chunking strategy to better handle tables, charts, and structured data:</span></p><h2><span>1. Update </span><code>modules/pdf_processor.py</code><span> with better chunking</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> PyPDF2
<span class="token keyword">import</span> io
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict<span class="token punctuation">,</span> Tuple
<span class="token keyword">import</span> re

<span class="token keyword">class</span> <span class="token class-name">PDFProcessor</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> chunk_size<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">,</span> chunk_overlap<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>chunk_size <span class="token operator">=</span> chunk_size
        self<span class="token punctuation">.</span>chunk_overlap <span class="token operator">=</span> chunk_overlap
    
    <span class="token keyword">def</span> <span class="token function">extract_text_from_pdf</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pdf_file<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Tuple<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Extract text from PDF with page numbers"""</span>
        pdf_reader <span class="token operator">=</span> PyPDF2<span class="token punctuation">.</span>PdfReader<span class="token punctuation">(</span>pdf_file<span class="token punctuation">)</span>
        text_with_pages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> page_num<span class="token punctuation">,</span> page <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>pdf_reader<span class="token punctuation">.</span>pages<span class="token punctuation">)</span><span class="token punctuation">:</span>
            text <span class="token operator">=</span> page<span class="token punctuation">.</span>extract_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> text<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># Clean up text and preserve structure</span>
                text <span class="token operator">=</span> self<span class="token punctuation">.</span>_clean_text<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
                text_with_pages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> page_num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> text_with_pages
    
    <span class="token keyword">def</span> <span class="token function">_clean_text</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Clean and normalize extracted text"""</span>
        <span class="token comment"># Remove excessive whitespace but preserve line breaks for structure</span>
        text <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'\s+'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span>  <span class="token comment"># Replace multiple spaces with single</span>
        text <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'\n\s*\n'</span><span class="token punctuation">,</span> <span class="token string">'\n\n'</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span>  <span class="token comment"># Preserve paragraph breaks</span>
        <span class="token keyword">return</span> text<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">_is_structured_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Check if text contains structured data like tables, charts, or lists"""</span>
        patterns <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">r'\d+%'</span><span class="token punctuation">,</span>  <span class="token comment"># Percentages</span>
            <span class="token string">r'\b\d+\.\d+\b'</span><span class="token punctuation">,</span>  <span class="token comment"># Decimal numbers</span>
            <span class="token string">r'\b\d+\s*[-–]\s*\d+\b'</span><span class="token punctuation">,</span>  <span class="token comment"># Number ranges</span>
            <span class="token string">r'\|.*\|'</span><span class="token punctuation">,</span>  <span class="token comment"># Table-like structures with pipes</span>
            <span class="token string">r'\b(graph|chart|table|figure)\b'</span><span class="token punctuation">,</span>  <span class="token comment"># Data visualization references</span>
            <span class="token string">r'.*:.*%'</span><span class="token punctuation">,</span>  <span class="token comment"># Key-value pairs with percentages</span>
        <span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> pattern <span class="token keyword">in</span> patterns<span class="token punctuation">:</span>
            <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> text<span class="token punctuation">,</span> re<span class="token punctuation">.</span>IGNORECASE<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">def</span> <span class="token function">_chunk_structured_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> page_num<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Special chunking for structured data to keep it intact"""</span>
        chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token comment"># Split by likely section boundaries but keep structured data together</span>
        sections <span class="token operator">=</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r'\n\s*\n'</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span>  <span class="token comment"># Split by blank lines</span>
        
        current_chunk <span class="token operator">=</span> <span class="token string">""</span>
        current_sections <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> section <span class="token keyword">in</span> sections<span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>_is_structured_data<span class="token punctuation">(</span>section<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># Structured data section - treat as its own chunk</span>
                <span class="token keyword">if</span> current_chunk<span class="token punctuation">:</span>
                    chunks<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token string">'text'</span><span class="token punctuation">:</span> current_chunk<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string">'page'</span><span class="token punctuation">:</span> page_num<span class="token punctuation">,</span>
                        <span class="token string">'is_structured'</span><span class="token punctuation">:</span> <span class="token boolean">False</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    current_chunk <span class="token operator">=</span> <span class="token string">""</span>
                
                <span class="token comment"># Add structured section as separate chunk</span>
                chunks<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token string">'text'</span><span class="token punctuation">:</span> section<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">'page'</span><span class="token punctuation">:</span> page_num<span class="token punctuation">,</span>
                    <span class="token string">'is_structured'</span><span class="token punctuation">:</span> <span class="token boolean">True</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># Regular text section</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>current_chunk<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>section<span class="token punctuation">)</span> <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>chunk_size<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> current_chunk<span class="token punctuation">:</span>
                        chunks<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token string">'text'</span><span class="token punctuation">:</span> current_chunk<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token string">'page'</span><span class="token punctuation">:</span> page_num<span class="token punctuation">,</span>
                            <span class="token string">'is_structured'</span><span class="token punctuation">:</span> <span class="token boolean">False</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    current_chunk <span class="token operator">=</span> section
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    current_chunk <span class="token operator">+=</span> <span class="token string">" "</span> <span class="token operator">+</span> section <span class="token keyword">if</span> current_chunk <span class="token keyword">else</span> section
        
        <span class="token comment"># Add the last chunk</span>
        <span class="token keyword">if</span> current_chunk<span class="token punctuation">:</span>
            chunks<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token string">'text'</span><span class="token punctuation">:</span> current_chunk<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">'page'</span><span class="token punctuation">:</span> page_num<span class="token punctuation">,</span>
                <span class="token string">'is_structured'</span><span class="token punctuation">:</span> <span class="token boolean">False</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> chunks
    
    <span class="token keyword">def</span> <span class="token function">chunk_text</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> page_num<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Split text into chunks with special handling for structured data"""</span>
        <span class="token comment"># First check if this page contains structured data</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_is_structured_data<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_chunk_structured_data<span class="token punctuation">(</span>text<span class="token punctuation">,</span> page_num<span class="token punctuation">)</span>
        
        <span class="token comment"># Regular chunking for non-structured text</span>
        words <span class="token operator">=</span> text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
        chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>chunk_size <span class="token operator">-</span> self<span class="token punctuation">.</span>chunk_overlap<span class="token punctuation">)</span><span class="token punctuation">:</span>
            chunk_words <span class="token operator">=</span> words<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> self<span class="token punctuation">.</span>chunk_size<span class="token punctuation">]</span>
            chunk_text <span class="token operator">=</span> <span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>chunk_words<span class="token punctuation">)</span>
            
            chunks<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token string">'text'</span><span class="token punctuation">:</span> chunk_text<span class="token punctuation">,</span>
                <span class="token string">'page'</span><span class="token punctuation">:</span> page_num<span class="token punctuation">,</span>
                <span class="token string">'is_structured'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
                <span class="token string">'start_word'</span><span class="token punctuation">:</span> i<span class="token punctuation">,</span>
                <span class="token string">'end_word'</span><span class="token punctuation">:</span> i <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>chunk_words<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> chunks
    
    <span class="token keyword">def</span> <span class="token function">process_pdf</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pdf_file<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Main method to process PDF into chunks with better structure handling"""</span>
        text_with_pages <span class="token operator">=</span> self<span class="token punctuation">.</span>extract_text_from_pdf<span class="token punctuation">(</span>pdf_file<span class="token punctuation">)</span>
        all_chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> text<span class="token punctuation">,</span> page_num <span class="token keyword">in</span> text_with_pages<span class="token punctuation">:</span>
            chunks <span class="token operator">=</span> self<span class="token punctuation">.</span>chunk_text<span class="token punctuation">(</span>text<span class="token punctuation">,</span> page_num<span class="token punctuation">)</span>
            all_chunks<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>chunks<span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Processed </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>all_chunks<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> chunks with structured data handling"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Count structured chunks</span>
        structured_count <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">for</span> chunk <span class="token keyword">in</span> all_chunks <span class="token keyword">if</span> chunk<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_structured'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> structured_count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Found </span><span class="token interpolation"><span class="token punctuation">{</span>structured_count<span class="token punctuation">}</span></span><span class="token string"> structured data chunks (tables, charts, etc.)"</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> all_chunks</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>2. Update </span><code>modules/vector_store.py</code><span> to prioritize structured data</span></h2><p class="ds-markdown-paragraph"><span>Add this method to your VectorStore class:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">def</span> <span class="token function">search_structured_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>Dict<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Search specifically for structured data chunks"""</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>metadata<span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>search<span class="token punctuation">(</span>query<span class="token punctuation">,</span> k<span class="token punctuation">)</span>  <span class="token comment"># Fallback to regular search</span>
    
    <span class="token comment"># Get regular results first</span>
    regular_results <span class="token operator">=</span> self<span class="token punctuation">.</span>search<span class="token punctuation">(</span>query<span class="token punctuation">,</span> k <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># Get more results to filter</span>
    
    <span class="token comment"># Filter for structured data chunks</span>
    structured_results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> result <span class="token keyword">in</span> regular_results<span class="token punctuation">:</span>
        <span class="token keyword">if</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_structured'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">any</span><span class="token punctuation">(</span>keyword <span class="token keyword">in</span> query<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> keyword <span class="token keyword">in</span> 
                                              <span class="token punctuation">[</span><span class="token string">'percentage'</span><span class="token punctuation">,</span> <span class="token string">'percent'</span><span class="token punctuation">,</span> <span class="token string">'%'</span><span class="token punctuation">,</span> <span class="token string">'chart'</span><span class="token punctuation">,</span> 
                                               <span class="token string">'graph'</span><span class="token punctuation">,</span> <span class="token string">'table'</span><span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            structured_results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    
    <span class="token comment"># If we found structured data, return it prioritized</span>
    <span class="token keyword">if</span> structured_results<span class="token punctuation">:</span>
        <span class="token keyword">return</span> structured_results<span class="token punctuation">[</span><span class="token punctuation">:</span>k<span class="token punctuation">]</span>
    
    <span class="token comment"># Otherwise return regular results</span>
    <span class="token keyword">return</span> regular_results<span class="token punctuation">[</span><span class="token punctuation">:</span>k<span class="token punctuation">]</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>3. Update </span><code>app.py</code><span> to use better search for data questions</span></h2><p class="ds-markdown-paragraph"><span>In your main app, modify the search part:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment"># In the chat response section of app.py:</span>

<span class="token comment"># For conversation history questions, don't search the document</span>
is_about_chat <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">(</span>keyword <span class="token keyword">in</span> prompt<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> keyword <span class="token keyword">in</span> <span class="token punctuation">[</span>
    <span class="token string">'previous'</span><span class="token punctuation">,</span> <span class="token string">'before'</span><span class="token punctuation">,</span> <span class="token string">'earlier'</span><span class="token punctuation">,</span> <span class="token string">'first question'</span><span class="token punctuation">,</span> 
    <span class="token string">'last question'</span><span class="token punctuation">,</span> <span class="token string">'what did i ask'</span><span class="token punctuation">,</span> <span class="token string">'what was my'</span><span class="token punctuation">,</span>
    <span class="token string">'our conversation'</span><span class="token punctuation">,</span> <span class="token string">'chat history'</span><span class="token punctuation">,</span> <span class="token string">'did i ask'</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Check if this is a data/numbers question</span>
is_data_question <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">(</span>keyword <span class="token keyword">in</span> prompt<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> keyword <span class="token keyword">in</span> <span class="token punctuation">[</span>
    <span class="token string">'percentage'</span><span class="token punctuation">,</span> <span class="token string">'percent'</span><span class="token punctuation">,</span> <span class="token string">'%'</span><span class="token punctuation">,</span> <span class="token string">'chart'</span><span class="token punctuation">,</span> <span class="token string">'graph'</span><span class="token punctuation">,</span> 
    <span class="token string">'table'</span><span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'number'</span><span class="token punctuation">,</span> <span class="token string">'statistic'</span><span class="token punctuation">,</span> <span class="token string">'figure'</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> is_about_chat<span class="token punctuation">:</span>
    <span class="token comment"># Don't search document for chat history questions</span>
    retrieved_chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">elif</span> is_data_question<span class="token punctuation">:</span>
    <span class="token comment"># Use specialized search for data questions</span>
    retrieved_chunks <span class="token operator">=</span> vector_store<span class="token punctuation">.</span>search_structured_data<span class="token punctuation">(</span>prompt<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token comment"># Regular search for other questions</span>
    retrieved_chunks <span class="token operator">=</span> vector_store<span class="token punctuation">.</span>search<span class="token punctuation">(</span>prompt<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>4. Alternative: Increase chunk size for better context</span></h2><p class="ds-markdown-paragraph"><span>If the issue persists, you can try increasing the chunk size:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment"># In PDFProcessor initialization</span>
pdf_processor <span class="token operator">=</span> PDFProcessor<span class="token punctuation">(</span>chunk_size<span class="token operator">=</span><span class="token number">1200</span><span class="token punctuation">,</span> chunk_overlap<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>5. Create a test script to verify chunking</span></h2><p class="ds-markdown-paragraph"><strong><span>test_</span><a href="https://chunking.py/" target="_blank" rel="noreferrer"><span>chunking.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment">#!/usr/bin/env python3</span>
<span class="token triple-quoted-string string">"""
Test script to verify chunking works properly for structured data
"""</span>

<span class="token keyword">from</span> modules<span class="token punctuation">.</span>pdf_processor <span class="token keyword">import</span> PDFProcessor

<span class="token keyword">def</span> <span class="token function">test_chunking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Test the chunking strategy with sample data"""</span>
    processor <span class="token operator">=</span> PDFProcessor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Sample text with structured data (like your bar chart)</span>
    sample_text <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
    Engine Preference for Next Vehicle
    
    The survey results show the following preferences:
    
    Electric: 54%
    Hybrid: 21%
    Gasoline: 12%
    Diesel: 8%
    Other: 5%
    
    This data indicates a strong shift towards electric vehicles.
    The preferences are based on a sample of 1000 respondents.
    """</span>
    
    chunks <span class="token operator">=</span> processor<span class="token punctuation">.</span>chunk_text<span class="token punctuation">(</span>sample_text<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Chunking results:"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> chunk <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>chunks<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"\nChunk </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">:"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Text: </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">100]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Structured: </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'is_structured'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Length: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>chunk<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    test_chunking<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Key Improvements:</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>Structured Data Detection</span></strong><span>: Identifies tables, charts, percentages, and other structured data</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Smart Chunking</span></strong><span>: Keeps structured data together in single chunks instead of splitting it</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Specialized Search</span></strong><span>: Prioritizes structured data chunks for data-related questions</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Better Context Preservation</span></strong><span>: Larger chunks and overlap for better context retention</span></p></li></ol><h2><span>Steps to implement:</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>Update your PDFProcessor</span></strong><span> with the new chunking logic</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Reprocess your PDF</span></strong><span> to create a new index with better chunks</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Test with your question</span></strong><span> about engine preferences</span></p></li></ol><p class="ds-markdown-paragraph"><span>The new chunking strategy should keep the bar chart data together in a single chunk, allowing the RAG system to retrieve the complete information instead of partial data.</span></p></div></div><div class="ds-theme" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE;"></div><div class="ds-flex _0a3d93b" style="align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 10px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92142 0.349213C10.3745 0.349295 12.5564 1.50526 13.9558 3.299L15.1282 2.12765C15.3304 1.92552 15.6768 2.06949 15.6768 2.35544V5.53929C15.6766 5.71632 15.533 5.85982 15.356 5.86008H12.1711C11.8855 5.85976 11.7427 5.51471 11.9443 5.31255L12.9642 4.29062C11.8238 2.74311 9.98914 1.74112 7.92142 1.74104C4.46442 1.74104 1.66239 4.54307 1.66239 8.00006C1.66239 11.4571 4.46442 14.2591 7.92142 14.2591C11.3783 14.2589 14.1804 11.457 14.1804 8.00006H15.5723C15.5723 12.2252 12.1465 15.6508 7.92142 15.6509C3.6962 15.6509 0.270569 12.2253 0.270569 8.00006C0.270569 3.77485 3.6962 0.349213 7.92142 0.349213Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.27861 0.811633C8.81985 0.142255 9.79016 0.0422445 10.4537 0.557662L10.5823 0.669367L10.6065 0.693605L10.6097 0.695713L10.6392 0.72522C11.3549 1.44685 11.6336 2.49474 11.3716 3.47675L11.3705 3.48097L11.361 3.5168L11.36 3.51891L10.8889 5.2261C10.8796 5.26003 10.8706 5.29164 10.8626 5.32094C10.8934 5.32101 10.927 5.322 10.9627 5.322H11.9006C12.4263 5.322 12.783 5.31906 13.0651 5.36731C14.8182 5.66725 15.9851 7.34574 15.6564 9.09363C15.6035 9.37493 15.4769 9.70926 15.2939 10.2023L14.337 12.7799C14.1401 13.3105 13.9773 13.7518 13.8101 14.1025C13.6375 14.4646 13.4385 14.7794 13.1441 15.0425C12.9712 15.197 12.7801 15.3303 12.5751 15.4387C12.2259 15.6232 11.8608 15.7 11.4612 15.7359C11.0742 15.7705 10.6034 15.7696 10.0374 15.7696H4.87371C4.08047 15.7696 3.42922 15.7703 2.90728 15.7138C2.37206 15.6558 1.88985 15.5311 1.4667 15.2237C1.22409 15.0475 1.01072 14.834 0.834405 14.5914C0.52696 14.1683 0.401312 13.6861 0.343323 13.1509C0.286761 12.6288 0.28747 11.977 0.28747 11.1834V9.51411C0.28747 8.84785 0.281286 8.36721 0.399176 7.95656C0.671091 7.00941 1.41109 6.26838 2.35823 5.99645C2.76888 5.87855 3.24952 5.88579 3.91579 5.88579C4.11977 5.88579 4.14542 5.88325 4.16238 5.88053C4.23526 5.8687 4.30403 5.83669 4.35839 5.78674C4.37104 5.77511 4.38755 5.7561 4.51436 5.59494L8.25648 0.839033L8.25754 0.837979L8.27861 0.811633ZM1.69116 11.1834C1.69116 12.0083 1.69211 12.5712 1.73859 13.0002C1.78365 13.4158 1.86467 13.6222 1.96937 13.7663C2.05914 13.8898 2.16727 13.999 2.29079 14.0888C2.43495 14.1935 2.6421 14.2745 3.05797 14.3195C3.45891 14.363 3.97631 14.3656 4.71564 14.3659C4.30795 13.8053 4.06447 13.1172 4.06437 12.371V8.59412H5.46807V12.371C5.46832 13.4734 6.3616 14.367 7.46401 14.367H10.0374C10.6286 14.367 11.0269 14.3663 11.3368 14.3385C11.6339 14.3118 11.7956 14.2639 11.9196 14.1984C12.024 14.1431 12.1213 14.0747 12.2094 13.996C12.3139 13.9025 12.4151 13.7679 12.5434 13.4986C12.6774 13.2177 12.8162 12.8451 13.0219 12.2909L13.9787 9.71328C14.1848 9.15822 14.253 8.96737 14.278 8.83439C14.4617 7.85698 13.8092 6.91901 12.829 6.75098C12.6956 6.72816 12.4928 6.72464 11.9006 6.72464H10.9627C10.7737 6.72464 10.5693 6.72663 10.4 6.70672C10.2211 6.68568 9.96696 6.6303 9.74764 6.43167C9.64448 6.33817 9.5595 6.22616 9.49683 6.10183C9.36384 5.8379 9.37793 5.57905 9.40515 5.40104C9.43094 5.23267 9.48666 5.03623 9.53688 4.8541L10.0079 3.14585L10.0174 3.11108C10.1488 2.61344 10.0077 2.08344 9.64648 1.71687L9.60854 1.67893L9.55058 1.6431C9.48789 1.62049 9.41419 1.6382 9.36932 1.69368L9.35773 1.70633L9.35878 1.70738L5.61666 6.46224C5.51816 6.58741 5.42231 6.71336 5.30683 6.81948C5.05069 7.05477 4.73119 7.20945 4.3879 7.26525C4.23309 7.29038 4.07507 7.28843 3.91579 7.28843C3.1535 7.28843 2.9191 7.29576 2.74604 7.34534C2.26358 7.48385 1.88558 7.86087 1.74702 8.34331C1.69732 8.51642 1.69116 8.75116 1.69116 9.51411V11.1834Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.72451 15.1086C7.18929 15.7706 6.22975 15.8695 5.57357 15.3598L5.44643 15.2493L5.42247 15.2253L5.41934 15.2233L5.39016 15.1941C4.68239 14.4805 4.40679 13.4442 4.66589 12.4731L4.66693 12.4689L4.67631 12.4335L4.67735 12.4314L5.14318 10.7432C5.15243 10.7096 5.1613 10.6784 5.16923 10.6494C5.13878 10.6493 5.10558 10.6484 5.07023 10.6484H4.14274C3.62288 10.6484 3.27015 10.6513 2.9912 10.6035C1.25757 10.3069 0.103662 8.64709 0.42863 6.91861C0.480965 6.64044 0.606164 6.30981 0.787119 5.8223L1.73336 3.27328C1.92812 2.74859 2.08912 2.31215 2.25442 1.96542C2.42515 1.60731 2.62191 1.296 2.91304 1.03584C3.08408 0.883016 3.273 0.751185 3.47579 0.644009C3.82102 0.461569 4.18214 0.385575 4.57731 0.350131C4.95993 0.315849 5.42553 0.316783 5.98521 0.316783H11.0916C11.876 0.316783 12.52 0.316134 13.0362 0.372015C13.5655 0.429358 14.0423 0.552599 14.4608 0.856601C14.7007 1.03091 14.9117 1.24199 15.086 1.48187C15.3901 1.90033 15.5143 2.37716 15.5717 2.90645C15.6276 3.42275 15.6269 4.06727 15.6269 4.85209V6.5028C15.6269 7.16167 15.633 7.63697 15.5164 8.04306C15.2475 8.97969 14.5158 9.71248 13.5791 9.9814C13.173 10.098 12.6977 10.0908 12.0389 10.0908C11.8372 10.0908 11.8118 10.0933 11.795 10.096C11.723 10.1077 11.6549 10.1394 11.6012 10.1888C11.5887 10.2003 11.5724 10.2191 11.447 10.3784L7.74639 15.0815L7.74535 15.0826L7.72451 15.1086ZM14.2388 4.85209C14.2388 4.03635 14.2379 3.47971 14.1919 3.05547C14.1473 2.64449 14.0672 2.44037 13.9637 2.29785C13.8749 2.17569 13.768 2.06776 13.6458 1.97896C13.5033 1.87539 13.2984 1.7953 12.8872 1.75074C12.4907 1.70779 11.979 1.70518 11.2479 1.70489C11.6511 2.25924 11.8918 2.93974 11.8919 3.67762V7.41257H10.5038V3.67762C10.5036 2.58751 9.62023 1.70384 8.53007 1.70384H5.98521C5.40065 1.70384 5.00679 1.70449 4.70028 1.73198C4.40651 1.75836 4.24662 1.80577 4.12399 1.87058C4.02069 1.92518 3.92452 1.99283 3.8374 2.07067C3.73401 2.16312 3.634 2.29627 3.50705 2.56255C3.37462 2.84034 3.23734 3.2088 3.03393 3.75682L2.08768 6.30584C1.88395 6.85474 1.81646 7.04347 1.79172 7.17497C1.61005 8.14152 2.25533 9.06908 3.22464 9.23524C3.35654 9.25781 3.55717 9.26129 4.14274 9.26129H5.07023C5.25717 9.26129 5.4593 9.25932 5.62672 9.27901C5.80364 9.29982 6.05492 9.35458 6.27179 9.551C6.37381 9.64347 6.45784 9.75424 6.51982 9.87719C6.65133 10.1382 6.6374 10.3942 6.61048 10.5702C6.58498 10.7367 6.52988 10.931 6.48022 11.1111L6.01439 12.8003L6.00501 12.8347C5.87513 13.3268 6.01464 13.8509 6.37184 14.2134L6.40935 14.251L6.46667 14.2864C6.52866 14.3088 6.60155 14.2912 6.64591 14.2364L6.65738 14.2239L6.65633 14.2228L10.3569 9.52078C10.4543 9.397 10.5491 9.27245 10.6633 9.1675C10.9166 8.93483 11.2325 8.78186 11.572 8.72669C11.7251 8.70184 11.8814 8.70376 12.0389 8.70376C12.7927 8.70376 13.0245 8.69651 13.1956 8.64748C13.6727 8.51051 14.0465 8.13768 14.1836 7.6606C14.2327 7.48941 14.2388 7.25727 14.2388 6.5028V4.85209Z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="fbb737a4">evaluate.py is showing error even after faiss index is created:
❌ No valid PDF index found. Please process a PDF first in the main app.

Steps to fix:

Go to the main app (app.py)
Upload a PDF file
Click 'Process PDF' button
Wait for successful processing
Then come back to this evaluation page
Debug Information

File existence check:

storage/faiss_index exists: True
storage/metadata.json exists: True
Metadata entries: 33</div></div><div class="_11d6b3a"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5" style="--assistant-last-margin-bottom: 32px;"><div class="ds-message _656c965"><div class="_7d763a7 _45cdda5" style="--deep-search-title-height: 38px; --group-title-sticky-top: 0px;"><div class="_68f84dc"></div><div class="ddd2f74b"></div></div><div class="ds-markdown" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph"><span>The issue is that the evaluator is using a different validation check than the main app. The index files exist and have content, but the evaluator's validation logic is too strict. Let me fix this:</span></p><h2><span>1. Update </span><code>evaluate.py</code><span> with proper index validation</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> json
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv

<span class="token comment"># Load environment variables FIRST</span>
load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Now import your modules</span>
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>evaluator <span class="token keyword">import</span> Evaluator
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore
<span class="token keyword">import</span> os

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    st<span class="token punctuation">.</span>set_page_config<span class="token punctuation">(</span>
        page_title<span class="token operator">=</span><span class="token string">"PDF Chatbot Evaluation"</span><span class="token punctuation">,</span>
        page_icon<span class="token operator">=</span><span class="token string">"📊"</span><span class="token punctuation">,</span>
        layout<span class="token operator">=</span><span class="token string">"wide"</span>
    <span class="token punctuation">)</span>
    
    st<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"📊 PDF Chatbot Evaluation"</span><span class="token punctuation">)</span>
    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"Evaluate the accuracy of your PDF chatbot"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Initialize components</span>
    evaluator <span class="token operator">=</span> Evaluator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    vector_store <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Enhanced index validation that matches the main app</span>
    <span class="token keyword">def</span> <span class="token function">is_pdf_processed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Check if a PDF is processed (same logic as main app)"""</span>
        index_path <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span>
        metadata_path <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span>
        
        <span class="token comment"># Check if files exist (basic check)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>index_path<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        
        <span class="token comment"># Try to load the index using the same method as main app</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># Use the vector store's own load method</span>
            <span class="token keyword">if</span> vector_store<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># Additional checks that match main app logic</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">hasattr</span><span class="token punctuation">(</span>vector_store<span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> 
                    vector_store<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> 
                    <span class="token builtin">hasattr</span><span class="token punctuation">(</span>vector_store<span class="token punctuation">.</span>index<span class="token punctuation">,</span> <span class="token string">'ntotal'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> 
                    vector_store<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span>
                    <span class="token builtin">hasattr</span><span class="token punctuation">(</span>vector_store<span class="token punctuation">,</span> <span class="token string">'metadata'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> 
                    <span class="token builtin">len</span><span class="token punctuation">(</span>vector_store<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error validating index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token comment"># Check if PDF is actually processed</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> is_pdf_processed<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"❌ No valid PDF index found. Please process a PDF first in the main app."</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Show detailed debug information</span>
        <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"🔍 Debug Information"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"**File existence check:**"</span><span class="token punctuation">)</span>
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- storage/faiss_index exists: </span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'storage/faiss_index'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- storage/metadata.json exists: </span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'storage/metadata.json'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'storage/metadata.json'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'storage/metadata.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                        metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Metadata entries: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>metadata<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'Invalid format'</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Metadata file error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># Try to load index directly to see what's wrong</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'storage/faiss_index'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">import</span> faiss
                    index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>read_index<span class="token punctuation">(</span><span class="token string">'storage/faiss_index'</span><span class="token punctuation">)</span>
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Index dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">.</span>d<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Index total vectors: </span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Index load error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        st<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
        **Steps to fix:**
        1. Go to the main app (`app.py`)
        2. Upload a PDF file
        3. Click 'Process PDF' button
        4. Wait for successful processing
        5. Then come back to this evaluation page
        
        If you already processed a PDF, try:
        - Restarting the evaluation app
        - Checking if the index files are not corrupted
        """</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    
    <span class="token comment"># If we get here, the index is valid</span>
    st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"✅ PDF index loaded successfully!"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Load or create test questions</span>
    test_questions <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>load_test_questions<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Section 1: Generate Answers</span>
    st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"1. Generate Answers"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"🔄 Generate Answers for Test Questions"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"primary"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> st<span class="token punctuation">.</span>spinner<span class="token punctuation">(</span><span class="token string">"Generating answers for test questions..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                results <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>generate_answers<span class="token punctuation">(</span>test_questions<span class="token punctuation">)</span>
                evaluator<span class="token punctuation">.</span>save_results<span class="token punctuation">(</span>results<span class="token punctuation">)</span>
                st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results <span class="token operator">=</span> results
                st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ Generated answers for </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> questions!"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Failed to generate answers: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># Load existing results if available</span>
    <span class="token keyword">if</span> <span class="token string">'results'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        existing_results <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>load_results<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> existing_results<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results <span class="token operator">=</span> existing_results
            st<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Loaded </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>existing_results<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> existing evaluation results"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token comment"># ... rest of the evaluation code remains the same ...</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>2. Update </span><code>modules/evaluator.py</code><span> with better index validation</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Dict<span class="token punctuation">,</span> Any
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>rag_engine <span class="token keyword">import</span> RAGEngine

<span class="token keyword">class</span> <span class="token class-name">Evaluator</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>vector_store <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>rag_engine <span class="token operator">=</span> RAGEngine<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>results_file <span class="token operator">=</span> <span class="token string">"evaluation_results.json"</span>
        self<span class="token punctuation">.</span>test_questions_file <span class="token operator">=</span> <span class="token string">"test_questions.json"</span>
    
    <span class="token keyword">def</span> <span class="token function">is_index_valid</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Check if the current index is valid (same logic as main app)"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># Use the vector store's own load method</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>vector_store<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
            
            <span class="token comment"># Additional checks that match main app logic</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>vector_store<span class="token punctuation">,</span> <span class="token string">'metadata'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> 
                <span class="token keyword">not</span> self<span class="token punctuation">.</span>vector_store<span class="token punctuation">.</span>metadata <span class="token keyword">or</span> 
                <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>vector_store<span class="token punctuation">,</span> <span class="token string">'index'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> 
                self<span class="token punctuation">.</span>vector_store<span class="token punctuation">.</span>index <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> 
                self<span class="token punctuation">.</span>vector_store<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
                
            <span class="token keyword">return</span> <span class="token boolean">True</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error checking index validity: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token comment"># ... rest of the methods remain the same ...</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>3. Create a simple index verification script</span></h2><p class="ds-markdown-paragraph"><strong><span>verify_</span><a href="https://index.py/" target="_blank" rel="noreferrer"><span>index.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment">#!/usr/bin/env python3</span>
<span class="token triple-quoted-string string">"""
Script to verify index integrity and compatibility
"""</span>

<span class="token keyword">import</span> os
<span class="token keyword">import</span> json
<span class="token keyword">import</span> faiss
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv

load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">verify_index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Verify that the index is properly created and accessible"""</span>
    index_path <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span>
    metadata_path <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"🔍 Verifying index integrity..."</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Check file existence</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>index_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"❌ Index file does not exist"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"❌ Metadata file does not exist"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ Both index and metadata files exist"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Check metadata</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ Metadata loaded: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> entries"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Metadata error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token comment"># Check index</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>read_index<span class="token punctuation">(</span>index_path<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ Index loaded: dimension=</span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">.</span>d<span class="token punctuation">}</span></span><span class="token string">, vectors=</span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Check if dimensions match expected count</span>
        <span class="token keyword">if</span> index<span class="token punctuation">.</span>ntotal <span class="token operator">!=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"⚠️  Warning: Index vectors (</span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">}</span></span><span class="token string">) don't match metadata entries (</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✅ Index and metadata counts match"</span><span class="token punctuation">)</span>
            
        <span class="token keyword">return</span> <span class="token boolean">True</span>
        
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Index error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> verify_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n🎉 Index verification passed!"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The evaluator should be able to load this index."</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n❌ Index verification failed!"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Try reprocessing your PDF in the main app."</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>4. Run the verification script</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>python verify_index.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>5. If verification fails, add this fix to your vector store</span></h2><p class="ds-markdown-paragraph"><span>In </span><code>modules/vector_store.py</code><span>, add better error recovery:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">def</span> <span class="token function">load_index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Load existing index with better error handling"""</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading existing index..."</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>read_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
            
            <span class="token comment"># Handle metadata loading with better error recovery</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
            <span class="token keyword">except</span> UnicodeDecodeError<span class="token punctuation">:</span>
                <span class="token comment"># Try different encoding if UTF-8 fails</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'latin-1'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
            
            <span class="token comment"># Basic validation</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"❌ Metadata is not a list"</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
                
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal <span class="token operator">!=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"⚠️  Warning: Index vectors (</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">}</span></span><span class="token string">) don't match metadata entries (</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># Initialize embedding model</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Warning: Failed to initialize embedding model"</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Index loaded with </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> chunks"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token comment"># Try to recover by clearing corrupted index</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
                os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"✓ Removed corrupted index files"</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                <span class="token keyword">pass</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">return</span> <span class="token boolean">False</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Steps to resolve:</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>First, run the verification script:</span></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>python verify_index.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>If verification fails</span></strong><span>, the index might be corrupted. Delete and recreate:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token function">rm</span> storage/faiss_index storage/metadata.json
streamlit run app.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>If verification passes</span></strong><span>, but evaluator still fails, restart the evaluator:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>streamlit run evaluate.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div></li><li><p class="ds-markdown-paragraph"><strong><span>Check if there are encoding issues</span></strong><span> with the metadata file</span></p></li></ol><p class="ds-markdown-paragraph"><span>The main issue is that the evaluator was using a different validation logic than the main app. The fixes ensure both use the same index loading and validation logic, so they should now be consistent.</span></p></div></div><div class="ds-theme" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE;"></div><div class="ds-flex _0a3d93b" style="align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 10px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92142 0.349213C10.3745 0.349295 12.5564 1.50526 13.9558 3.299L15.1282 2.12765C15.3304 1.92552 15.6768 2.06949 15.6768 2.35544V5.53929C15.6766 5.71632 15.533 5.85982 15.356 5.86008H12.1711C11.8855 5.85976 11.7427 5.51471 11.9443 5.31255L12.9642 4.29062C11.8238 2.74311 9.98914 1.74112 7.92142 1.74104C4.46442 1.74104 1.66239 4.54307 1.66239 8.00006C1.66239 11.4571 4.46442 14.2591 7.92142 14.2591C11.3783 14.2589 14.1804 11.457 14.1804 8.00006H15.5723C15.5723 12.2252 12.1465 15.6508 7.92142 15.6509C3.6962 15.6509 0.270569 12.2253 0.270569 8.00006C0.270569 3.77485 3.6962 0.349213 7.92142 0.349213Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.27861 0.811633C8.81985 0.142255 9.79016 0.0422445 10.4537 0.557662L10.5823 0.669367L10.6065 0.693605L10.6097 0.695713L10.6392 0.72522C11.3549 1.44685 11.6336 2.49474 11.3716 3.47675L11.3705 3.48097L11.361 3.5168L11.36 3.51891L10.8889 5.2261C10.8796 5.26003 10.8706 5.29164 10.8626 5.32094C10.8934 5.32101 10.927 5.322 10.9627 5.322H11.9006C12.4263 5.322 12.783 5.31906 13.0651 5.36731C14.8182 5.66725 15.9851 7.34574 15.6564 9.09363C15.6035 9.37493 15.4769 9.70926 15.2939 10.2023L14.337 12.7799C14.1401 13.3105 13.9773 13.7518 13.8101 14.1025C13.6375 14.4646 13.4385 14.7794 13.1441 15.0425C12.9712 15.197 12.7801 15.3303 12.5751 15.4387C12.2259 15.6232 11.8608 15.7 11.4612 15.7359C11.0742 15.7705 10.6034 15.7696 10.0374 15.7696H4.87371C4.08047 15.7696 3.42922 15.7703 2.90728 15.7138C2.37206 15.6558 1.88985 15.5311 1.4667 15.2237C1.22409 15.0475 1.01072 14.834 0.834405 14.5914C0.52696 14.1683 0.401312 13.6861 0.343323 13.1509C0.286761 12.6288 0.28747 11.977 0.28747 11.1834V9.51411C0.28747 8.84785 0.281286 8.36721 0.399176 7.95656C0.671091 7.00941 1.41109 6.26838 2.35823 5.99645C2.76888 5.87855 3.24952 5.88579 3.91579 5.88579C4.11977 5.88579 4.14542 5.88325 4.16238 5.88053C4.23526 5.8687 4.30403 5.83669 4.35839 5.78674C4.37104 5.77511 4.38755 5.7561 4.51436 5.59494L8.25648 0.839033L8.25754 0.837979L8.27861 0.811633ZM1.69116 11.1834C1.69116 12.0083 1.69211 12.5712 1.73859 13.0002C1.78365 13.4158 1.86467 13.6222 1.96937 13.7663C2.05914 13.8898 2.16727 13.999 2.29079 14.0888C2.43495 14.1935 2.6421 14.2745 3.05797 14.3195C3.45891 14.363 3.97631 14.3656 4.71564 14.3659C4.30795 13.8053 4.06447 13.1172 4.06437 12.371V8.59412H5.46807V12.371C5.46832 13.4734 6.3616 14.367 7.46401 14.367H10.0374C10.6286 14.367 11.0269 14.3663 11.3368 14.3385C11.6339 14.3118 11.7956 14.2639 11.9196 14.1984C12.024 14.1431 12.1213 14.0747 12.2094 13.996C12.3139 13.9025 12.4151 13.7679 12.5434 13.4986C12.6774 13.2177 12.8162 12.8451 13.0219 12.2909L13.9787 9.71328C14.1848 9.15822 14.253 8.96737 14.278 8.83439C14.4617 7.85698 13.8092 6.91901 12.829 6.75098C12.6956 6.72816 12.4928 6.72464 11.9006 6.72464H10.9627C10.7737 6.72464 10.5693 6.72663 10.4 6.70672C10.2211 6.68568 9.96696 6.6303 9.74764 6.43167C9.64448 6.33817 9.5595 6.22616 9.49683 6.10183C9.36384 5.8379 9.37793 5.57905 9.40515 5.40104C9.43094 5.23267 9.48666 5.03623 9.53688 4.8541L10.0079 3.14585L10.0174 3.11108C10.1488 2.61344 10.0077 2.08344 9.64648 1.71687L9.60854 1.67893L9.55058 1.6431C9.48789 1.62049 9.41419 1.6382 9.36932 1.69368L9.35773 1.70633L9.35878 1.70738L5.61666 6.46224C5.51816 6.58741 5.42231 6.71336 5.30683 6.81948C5.05069 7.05477 4.73119 7.20945 4.3879 7.26525C4.23309 7.29038 4.07507 7.28843 3.91579 7.28843C3.1535 7.28843 2.9191 7.29576 2.74604 7.34534C2.26358 7.48385 1.88558 7.86087 1.74702 8.34331C1.69732 8.51642 1.69116 8.75116 1.69116 9.51411V11.1834Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.72451 15.1086C7.18929 15.7706 6.22975 15.8695 5.57357 15.3598L5.44643 15.2493L5.42247 15.2253L5.41934 15.2233L5.39016 15.1941C4.68239 14.4805 4.40679 13.4442 4.66589 12.4731L4.66693 12.4689L4.67631 12.4335L4.67735 12.4314L5.14318 10.7432C5.15243 10.7096 5.1613 10.6784 5.16923 10.6494C5.13878 10.6493 5.10558 10.6484 5.07023 10.6484H4.14274C3.62288 10.6484 3.27015 10.6513 2.9912 10.6035C1.25757 10.3069 0.103662 8.64709 0.42863 6.91861C0.480965 6.64044 0.606164 6.30981 0.787119 5.8223L1.73336 3.27328C1.92812 2.74859 2.08912 2.31215 2.25442 1.96542C2.42515 1.60731 2.62191 1.296 2.91304 1.03584C3.08408 0.883016 3.273 0.751185 3.47579 0.644009C3.82102 0.461569 4.18214 0.385575 4.57731 0.350131C4.95993 0.315849 5.42553 0.316783 5.98521 0.316783H11.0916C11.876 0.316783 12.52 0.316134 13.0362 0.372015C13.5655 0.429358 14.0423 0.552599 14.4608 0.856601C14.7007 1.03091 14.9117 1.24199 15.086 1.48187C15.3901 1.90033 15.5143 2.37716 15.5717 2.90645C15.6276 3.42275 15.6269 4.06727 15.6269 4.85209V6.5028C15.6269 7.16167 15.633 7.63697 15.5164 8.04306C15.2475 8.97969 14.5158 9.71248 13.5791 9.9814C13.173 10.098 12.6977 10.0908 12.0389 10.0908C11.8372 10.0908 11.8118 10.0933 11.795 10.096C11.723 10.1077 11.6549 10.1394 11.6012 10.1888C11.5887 10.2003 11.5724 10.2191 11.447 10.3784L7.74639 15.0815L7.74535 15.0826L7.72451 15.1086ZM14.2388 4.85209C14.2388 4.03635 14.2379 3.47971 14.1919 3.05547C14.1473 2.64449 14.0672 2.44037 13.9637 2.29785C13.8749 2.17569 13.768 2.06776 13.6458 1.97896C13.5033 1.87539 13.2984 1.7953 12.8872 1.75074C12.4907 1.70779 11.979 1.70518 11.2479 1.70489C11.6511 2.25924 11.8918 2.93974 11.8919 3.67762V7.41257H10.5038V3.67762C10.5036 2.58751 9.62023 1.70384 8.53007 1.70384H5.98521C5.40065 1.70384 5.00679 1.70449 4.70028 1.73198C4.40651 1.75836 4.24662 1.80577 4.12399 1.87058C4.02069 1.92518 3.92452 1.99283 3.8374 2.07067C3.73401 2.16312 3.634 2.29627 3.50705 2.56255C3.37462 2.84034 3.23734 3.2088 3.03393 3.75682L2.08768 6.30584C1.88395 6.85474 1.81646 7.04347 1.79172 7.17497C1.61005 8.14152 2.25533 9.06908 3.22464 9.23524C3.35654 9.25781 3.55717 9.26129 4.14274 9.26129H5.07023C5.25717 9.26129 5.4593 9.25932 5.62672 9.27901C5.80364 9.29982 6.05492 9.35458 6.27179 9.551C6.37381 9.64347 6.45784 9.75424 6.51982 9.87719C6.65133 10.1382 6.6374 10.3942 6.61048 10.5702C6.58498 10.7367 6.52988 10.931 6.48022 11.1111L6.01439 12.8003L6.00501 12.8347C5.87513 13.3268 6.01464 13.8509 6.37184 14.2134L6.40935 14.251L6.46667 14.2864C6.52866 14.3088 6.60155 14.2912 6.64591 14.2364L6.65738 14.2239L6.65633 14.2228L10.3569 9.52078C10.4543 9.397 10.5491 9.27245 10.6633 9.1675C10.9166 8.93483 11.2325 8.78186 11.572 8.72669C11.7251 8.70184 11.8814 8.70376 12.0389 8.70376C12.7927 8.70376 13.0245 8.69651 13.1956 8.64748C13.6727 8.51051 14.0465 8.13768 14.1836 7.6606C14.2327 7.48941 14.2388 7.25727 14.2388 6.5028V4.85209Z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="fbb737a4">❌ No valid PDF index found. Please process a PDF first in the main app.

Steps to fix:

Go to the main app (app.py)
Upload a PDF file
Click 'Process PDF' button
Wait for successful processing
Then come back to this evaluation page
Debug Information

File existence check:

storage/faiss_index exists: True
storage/metadata.json exists: True
Metadata entries: 37</div></div><div class="_11d6b3a"><div class="_425ea0b"><div class="ds-flex _78e0558" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div><div class="_4f9bf79 _43c05b5" style="--assistant-last-margin-bottom: 32px;"><div class="ds-message _656c965"><div class="_7d763a7 _45cdda5" style="--deep-search-title-height: 38px; --group-title-sticky-top: 0px;"><div class="_68f84dc"></div><div class="ddd2f74b"></div></div><div class="ds-markdown" style="--ds-md-zoom: 1.143;"><p class="ds-markdown-paragraph"><span>The issue is that the evaluator's validation logic is too strict. The files exist and have content, but the validation is failing. Let me simplify the validation to match exactly what the main app does:</span></p><h2><span>1. Update </span><code>evaluate.py</code><span> with simplified validation</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> json
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv

<span class="token comment"># Load environment variables FIRST</span>
load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Now import your modules</span>
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>evaluator <span class="token keyword">import</span> Evaluator
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore
<span class="token keyword">import</span> os

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    st<span class="token punctuation">.</span>set_page_config<span class="token punctuation">(</span>
        page_title<span class="token operator">=</span><span class="token string">"PDF Chatbot Evaluation"</span><span class="token punctuation">,</span>
        page_icon<span class="token operator">=</span><span class="token string">"📊"</span><span class="token punctuation">,</span>
        layout<span class="token operator">=</span><span class="token string">"wide"</span>
    <span class="token punctuation">)</span>
    
    st<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"📊 PDF Chatbot Evaluation"</span><span class="token punctuation">)</span>
    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"Evaluate the accuracy of your PDF chatbot"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Initialize components</span>
    evaluator <span class="token operator">=</span> Evaluator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    vector_store <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># SIMPLIFIED index validation - same as main app</span>
    <span class="token keyword">def</span> <span class="token function">is_pdf_processed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Simple check: if files exist and vector store can load them"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># Use the exact same method as main app</span>
            <span class="token keyword">return</span> vector_store<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    
    <span class="token comment"># Check if PDF is processed</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> is_pdf_processed<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"❌ Could not load PDF index. Please process a PDF first in the main app."</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Show detailed debug information</span>
        <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"🔍 Debug Information"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"**File existence check:**"</span><span class="token punctuation">)</span>
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- storage/faiss_index exists: </span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'storage/faiss_index'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- storage/metadata.json exists: </span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'storage/metadata.json'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'storage/metadata.json'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'storage/metadata.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                        metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Metadata entries: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>metadata<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'Invalid format'</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    
                    <span class="token comment"># Show sample metadata</span>
                    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>metadata<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"**Sample metadata:**"</span><span class="token punctuation">)</span>
                        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Page: </span><span class="token interpolation"><span class="token punctuation">{</span>metadata<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">,</span> <span class="token string">'N/A'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Text preview: </span><span class="token interpolation"><span class="token punctuation">{</span>metadata<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">100]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
                        
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Metadata file error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># Try to load index directly</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'storage/faiss_index'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">import</span> faiss
                    index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>read_index<span class="token punctuation">(</span><span class="token string">'storage/faiss_index'</span><span class="token punctuation">)</span>
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Index dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">.</span>d<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Index total vectors: </span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Index load error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        st<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
        **If you already processed a PDF:**
        1. Try restarting this evaluation app
        2. Make sure the main app is not running at the same time
        3. Check if the index files are not corrupted
        """</span><span class="token punctuation">)</span>
        
        <span class="token comment"># Add a force load button for debugging</span>
        <span class="token keyword">if</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"🔄 Try Force Load Index"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># Try to force load the index</span>
                <span class="token keyword">if</span> vector_store<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string">"✅ Index loaded successfully after force attempt!"</span><span class="token punctuation">)</span>
                    st<span class="token punctuation">.</span>rerun<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string">"❌ Force load failed"</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Force load error: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span>
    
    <span class="token comment"># If we get here, the index is loaded successfully</span>
    st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ PDF index loaded successfully! (</span><span class="token interpolation"><span class="token punctuation">{</span>vector_store<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">}</span></span><span class="token string"> vectors, </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>vector_store<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> chunks)"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># Show index info</span>
    <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"📊 Index Information"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Index dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>vector_store<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Total vectors: </span><span class="token interpolation"><span class="token punctuation">{</span>vector_store<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"- Using: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">'Gemini'</span> <span class="token keyword">if</span> vector_store<span class="token punctuation">.</span>used_gemini_for_index <span class="token keyword">else</span> <span class="token string">'Local'</span><span class="token punctuation">}</span></span><span class="token string"> embeddings"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># Show sample chunks</span>
        <span class="token keyword">if</span> vector_store<span class="token punctuation">.</span>metadata<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"**Sample chunks:**"</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> i<span class="token punctuation">,</span> chunk <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>vector_store<span class="token punctuation">.</span>metadata<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">. Page </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'page'</span><span class="token punctuation">,</span> <span class="token string">'N/A'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>chunk<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">100]</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># Load or create test questions</span>
    test_questions <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>load_test_questions<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Section 1: Generate Answers</span>
    st<span class="token punctuation">.</span>header<span class="token punctuation">(</span><span class="token string">"1. Generate Answers"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> st<span class="token punctuation">.</span>button<span class="token punctuation">(</span><span class="token string">"🔄 Generate Answers for Test Questions"</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"primary"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> st<span class="token punctuation">.</span>spinner<span class="token punctuation">(</span><span class="token string">"Generating answers for test questions..."</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                results <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>generate_answers<span class="token punctuation">(</span>test_questions<span class="token punctuation">)</span>
                evaluator<span class="token punctuation">.</span>save_results<span class="token punctuation">(</span>results<span class="token punctuation">)</span>
                st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results <span class="token operator">=</span> results
                st<span class="token punctuation">.</span>success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✅ Generated answers for </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> questions!"</span></span><span class="token punctuation">)</span>
                
                <span class="token comment"># Show first result</span>
                <span class="token keyword">if</span> results<span class="token punctuation">:</span>
                    <span class="token keyword">with</span> st<span class="token punctuation">.</span>expander<span class="token punctuation">(</span><span class="token string">"👀 View First Result"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Question:** </span><span class="token interpolation"><span class="token punctuation">{</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                        st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Answer:** </span><span class="token interpolation"><span class="token punctuation">{</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'generated_answer'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'sources_used'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            st<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"**Sources:** Pages </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'sources_used'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                st<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"❌ Failed to generate answers: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># Load existing results if available</span>
    <span class="token keyword">if</span> <span class="token string">'results'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        existing_results <span class="token operator">=</span> evaluator<span class="token punctuation">.</span>load_results<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> existing_results<span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results <span class="token operator">=</span> existing_results
            st<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"📂 Loaded </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>existing_results<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> existing evaluation results"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            st<span class="token punctuation">.</span>session_state<span class="token punctuation">.</span>results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token comment"># ... rest of the evaluation code ...</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>2. Update </span><code>modules/vector_store.py</code><span> to ensure consistent loading</span></h2><p class="ds-markdown-paragraph"><span>Make sure your </span><code>load_index()</code><span> method returns </span><code>True</code><span> on success:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">def</span> <span class="token function">load_index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Load existing index with proper initialization"""</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading existing index..."</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>index <span class="token operator">=</span> faiss<span class="token punctuation">.</span>read_index<span class="token punctuation">(</span>self<span class="token punctuation">.</span>index_path<span class="token punctuation">)</span>
            
            <span class="token comment"># Load metadata with error handling</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
            <span class="token keyword">except</span> UnicodeDecodeError<span class="token punctuation">:</span>
                <span class="token comment"># Try different encoding</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'latin-1'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>metadata <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
            
            <span class="token comment"># Basic validation</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"❌ Metadata is not a list"</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
            
            <span class="token comment"># Initialize embedding model based on index dimension</span>
            index_dimension <span class="token operator">=</span> self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d
            <span class="token keyword">if</span> index_dimension <span class="token operator">==</span> <span class="token number">768</span><span class="token punctuation">:</span>
                <span class="token comment"># Try Gemini first</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>initialize_embedding_model<span class="token punctuation">(</span>use_gemini<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"⚠️  Gemini failed, trying local model..."</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">return</span> <span class="token boolean">False</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># Use local model</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>_initialize_local_model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> <span class="token boolean">False</span>
            
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Index loaded with </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> chunks"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"✓ Index dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>index<span class="token punctuation">.</span>d<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>  <span class="token comment"># ← THIS IS CRITICAL: Must return True on success</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading index: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">return</span> <span class="token boolean">False</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>3. Create a direct load test script</span></h2><p class="ds-markdown-paragraph"><strong><span>test_</span><a href="https://load.py/" target="_blank" rel="noreferrer"><span>load.py</span></a></strong></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token comment">#!/usr/bin/env python3</span>
<span class="token triple-quoted-string string">"""
Direct test to load the index without any validation
"""</span>

<span class="token keyword">import</span> os
<span class="token keyword">from</span> dotenv <span class="token keyword">import</span> load_dotenv
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>vector_store <span class="token keyword">import</span> VectorStore

load_dotenv<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">test_direct_load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Test loading the index directly"""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Testing direct index load..."</span><span class="token punctuation">)</span>
    
    vector_store <span class="token operator">=</span> VectorStore<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Check files exist</span>
    index_path <span class="token operator">=</span> <span class="token string">"storage/faiss_index"</span>
    metadata_path <span class="token operator">=</span> <span class="token string">"storage/metadata.json"</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Index file exists: </span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>index_path<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Metadata file exists: </span><span class="token interpolation"><span class="token punctuation">{</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>metadata_path<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
    <span class="token comment"># Try to load</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        success <span class="token operator">=</span> vector_store<span class="token punctuation">.</span>load_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Load result: </span><span class="token interpolation"><span class="token punctuation">{</span>success<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> success<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Index vectors: </span><span class="token interpolation"><span class="token punctuation">{</span>vector_store<span class="token punctuation">.</span>index<span class="token punctuation">.</span>ntotal<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Metadata entries: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>vector_store<span class="token punctuation">.</span>metadata<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Embedding dimension: </span><span class="token interpolation"><span class="token punctuation">{</span>vector_store<span class="token punctuation">.</span>embedding_dimension<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Load failed but no exception raised"</span><span class="token punctuation">)</span>
            
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Load exception: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">import</span> traceback
        traceback<span class="token punctuation">.</span>print_exc<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    test_direct_load<span class="token punctuation">(</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>4. Run the direct load test</span></h2><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">bash</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre>python test_load.py</pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>5. If still failing, try this nuclear option in </span><code>evaluate.py</code></h2><p class="ds-markdown-paragraph"><span>Replace the validation function with this ultra-simple version:</span></p><div class="md-code-block md-code-block-dark"><div class="md-code-block-banner-wrap"><div class="md-code-block-banner md-code-block-banner-lite"><div class="_121d384"><div class="d2a24f03"><span class="d813de27">python</span></div><div class="d2a24f03 _246a029"><div class="efa13877"><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348" style="margin-right: 4px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Copy</span></span></button><button role="button" aria-disabled="false" class="feec6a7a _8b5e24e _7b40348"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px; visibility: visible; margin-right: 3px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.3694 11.4111L15.1234 12.8866C14.8869 14.3043 13.6602 15.3436 12.223 15.3437H3.77667C2.33951 15.3435 1.11273 14.3042 0.876282 12.8866L0.630188 11.4111L2.05402 11.1747L2.29913 12.6493C2.41966 13.3713 3.04469 13.9001 3.77667 13.9003H12.223C12.9551 13.9003 13.5799 13.3714 13.7005 12.6493L13.9456 11.1747L15.3694 11.4111ZM8.72198 8.99406C8.77711 8.9394 8.83786 8.88112 8.90265 8.81633L12.4827 5.2343L13.5042 6.25578L9.92218 9.83586C9.63943 10.1186 9.38757 10.3732 9.15851 10.5575C8.91886 10.7503 8.63947 10.9225 8.28644 10.9784C8.09704 11.0084 7.90357 11.0084 7.71417 10.9784C7.36099 10.9225 7.08084 10.7504 6.84113 10.5575C6.61209 10.3732 6.36016 10.1186 6.07745 9.83586L2.4964 6.25578L3.51691 5.2343L7.09698 8.81633C7.16213 8.88148 7.22324 8.94012 7.27863 8.99504V1.30656H8.72198V8.99406Z" fill="currentColor"></path></svg></div><span class=""><span class="code-info-button-text">Download</span></span></button></div></div></div></div></div><pre><span class="token keyword">def</span> <span class="token function">is_pdf_processed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Ultra-simple check: just see if files exist"""</span>
    <span class="token keyword">return</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'storage/faiss_index'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'storage/metadata.json'</span><span class="token punctuation">)</span></pre><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _33882ae"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none" class="_9bc997d _28d7e84"><path d="M-5.24537e-07 0C-2.34843e-07 6.62742 5.37258 12 12 12L0 12L-5.24537e-07 0Z" fill="currentColor"></path></svg></div><h2><span>Key Fixes:</span></h2><ol start="1"><li><p class="ds-markdown-paragraph"><strong><span>Simplified Validation</span></strong><span>: Uses the exact same </span><code>load_index()</code><span> method as main app</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Better Error Reporting</span></strong><span>: Shows exactly what's happening during loading</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Force Load Option</span></strong><span>: Adds a button to attempt force loading</span></p></li><li><p class="ds-markdown-paragraph"><strong><span>Direct Testing</span></strong><span>: Separate script to test loading without Streamlit</span></p></li></ol><p class="ds-markdown-paragraph"><span>The main issue is likely that the evaluator was doing extra validation that the main app doesn't do. By using the exact same </span><code>load_index()</code><span> method, they should now behave consistently.</span></p><p class="ds-markdown-paragraph"><span>Run the direct load test first to see what's happening, then try the evaluator again.</span></p></div></div><div class="ds-theme" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE;"></div><div class="ds-flex _0a3d93b" style="align-items: center; gap: 10px;"><div class="ds-flex _965abe9" style="align-items: center; gap: 10px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.92142 0.349213C10.3745 0.349295 12.5564 1.50526 13.9558 3.299L15.1282 2.12765C15.3304 1.92552 15.6768 2.06949 15.6768 2.35544V5.53929C15.6766 5.71632 15.533 5.85982 15.356 5.86008H12.1711C11.8855 5.85976 11.7427 5.51471 11.9443 5.31255L12.9642 4.29062C11.8238 2.74311 9.98914 1.74112 7.92142 1.74104C4.46442 1.74104 1.66239 4.54307 1.66239 8.00006C1.66239 11.4571 4.46442 14.2591 7.92142 14.2591C11.3783 14.2589 14.1804 11.457 14.1804 8.00006H15.5723C15.5723 12.2252 12.1465 15.6508 7.92142 15.6509C3.6962 15.6509 0.270569 12.2253 0.270569 8.00006C0.270569 3.77485 3.6962 0.349213 7.92142 0.349213Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.27861 0.811633C8.81985 0.142255 9.79016 0.0422445 10.4537 0.557662L10.5823 0.669367L10.6065 0.693605L10.6097 0.695713L10.6392 0.72522C11.3549 1.44685 11.6336 2.49474 11.3716 3.47675L11.3705 3.48097L11.361 3.5168L11.36 3.51891L10.8889 5.2261C10.8796 5.26003 10.8706 5.29164 10.8626 5.32094C10.8934 5.32101 10.927 5.322 10.9627 5.322H11.9006C12.4263 5.322 12.783 5.31906 13.0651 5.36731C14.8182 5.66725 15.9851 7.34574 15.6564 9.09363C15.6035 9.37493 15.4769 9.70926 15.2939 10.2023L14.337 12.7799C14.1401 13.3105 13.9773 13.7518 13.8101 14.1025C13.6375 14.4646 13.4385 14.7794 13.1441 15.0425C12.9712 15.197 12.7801 15.3303 12.5751 15.4387C12.2259 15.6232 11.8608 15.7 11.4612 15.7359C11.0742 15.7705 10.6034 15.7696 10.0374 15.7696H4.87371C4.08047 15.7696 3.42922 15.7703 2.90728 15.7138C2.37206 15.6558 1.88985 15.5311 1.4667 15.2237C1.22409 15.0475 1.01072 14.834 0.834405 14.5914C0.52696 14.1683 0.401312 13.6861 0.343323 13.1509C0.286761 12.6288 0.28747 11.977 0.28747 11.1834V9.51411C0.28747 8.84785 0.281286 8.36721 0.399176 7.95656C0.671091 7.00941 1.41109 6.26838 2.35823 5.99645C2.76888 5.87855 3.24952 5.88579 3.91579 5.88579C4.11977 5.88579 4.14542 5.88325 4.16238 5.88053C4.23526 5.8687 4.30403 5.83669 4.35839 5.78674C4.37104 5.77511 4.38755 5.7561 4.51436 5.59494L8.25648 0.839033L8.25754 0.837979L8.27861 0.811633ZM1.69116 11.1834C1.69116 12.0083 1.69211 12.5712 1.73859 13.0002C1.78365 13.4158 1.86467 13.6222 1.96937 13.7663C2.05914 13.8898 2.16727 13.999 2.29079 14.0888C2.43495 14.1935 2.6421 14.2745 3.05797 14.3195C3.45891 14.363 3.97631 14.3656 4.71564 14.3659C4.30795 13.8053 4.06447 13.1172 4.06437 12.371V8.59412H5.46807V12.371C5.46832 13.4734 6.3616 14.367 7.46401 14.367H10.0374C10.6286 14.367 11.0269 14.3663 11.3368 14.3385C11.6339 14.3118 11.7956 14.2639 11.9196 14.1984C12.024 14.1431 12.1213 14.0747 12.2094 13.996C12.3139 13.9025 12.4151 13.7679 12.5434 13.4986C12.6774 13.2177 12.8162 12.8451 13.0219 12.2909L13.9787 9.71328C14.1848 9.15822 14.253 8.96737 14.278 8.83439C14.4617 7.85698 13.8092 6.91901 12.829 6.75098C12.6956 6.72816 12.4928 6.72464 11.9006 6.72464H10.9627C10.7737 6.72464 10.5693 6.72663 10.4 6.70672C10.2211 6.68568 9.96696 6.6303 9.74764 6.43167C9.64448 6.33817 9.5595 6.22616 9.49683 6.10183C9.36384 5.8379 9.37793 5.57905 9.40515 5.40104C9.43094 5.23267 9.48666 5.03623 9.53688 4.8541L10.0079 3.14585L10.0174 3.11108C10.1488 2.61344 10.0077 2.08344 9.64648 1.71687L9.60854 1.67893L9.55058 1.6431C9.48789 1.62049 9.41419 1.6382 9.36932 1.69368L9.35773 1.70633L9.35878 1.70738L5.61666 6.46224C5.51816 6.58741 5.42231 6.71336 5.30683 6.81948C5.05069 7.05477 4.73119 7.20945 4.3879 7.26525C4.23309 7.29038 4.07507 7.28843 3.91579 7.28843C3.1535 7.28843 2.9191 7.29576 2.74604 7.34534C2.26358 7.48385 1.88558 7.86087 1.74702 8.34331C1.69732 8.51642 1.69116 8.75116 1.69116 9.51411V11.1834Z" fill="currentColor"></path></svg></div></div><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.72451 15.1086C7.18929 15.7706 6.22975 15.8695 5.57357 15.3598L5.44643 15.2493L5.42247 15.2253L5.41934 15.2233L5.39016 15.1941C4.68239 14.4805 4.40679 13.4442 4.66589 12.4731L4.66693 12.4689L4.67631 12.4335L4.67735 12.4314L5.14318 10.7432C5.15243 10.7096 5.1613 10.6784 5.16923 10.6494C5.13878 10.6493 5.10558 10.6484 5.07023 10.6484H4.14274C3.62288 10.6484 3.27015 10.6513 2.9912 10.6035C1.25757 10.3069 0.103662 8.64709 0.42863 6.91861C0.480965 6.64044 0.606164 6.30981 0.787119 5.8223L1.73336 3.27328C1.92812 2.74859 2.08912 2.31215 2.25442 1.96542C2.42515 1.60731 2.62191 1.296 2.91304 1.03584C3.08408 0.883016 3.273 0.751185 3.47579 0.644009C3.82102 0.461569 4.18214 0.385575 4.57731 0.350131C4.95993 0.315849 5.42553 0.316783 5.98521 0.316783H11.0916C11.876 0.316783 12.52 0.316134 13.0362 0.372015C13.5655 0.429358 14.0423 0.552599 14.4608 0.856601C14.7007 1.03091 14.9117 1.24199 15.086 1.48187C15.3901 1.90033 15.5143 2.37716 15.5717 2.90645C15.6276 3.42275 15.6269 4.06727 15.6269 4.85209V6.5028C15.6269 7.16167 15.633 7.63697 15.5164 8.04306C15.2475 8.97969 14.5158 9.71248 13.5791 9.9814C13.173 10.098 12.6977 10.0908 12.0389 10.0908C11.8372 10.0908 11.8118 10.0933 11.795 10.096C11.723 10.1077 11.6549 10.1394 11.6012 10.1888C11.5887 10.2003 11.5724 10.2191 11.447 10.3784L7.74639 15.0815L7.74535 15.0826L7.72451 15.1086ZM14.2388 4.85209C14.2388 4.03635 14.2379 3.47971 14.1919 3.05547C14.1473 2.64449 14.0672 2.44037 13.9637 2.29785C13.8749 2.17569 13.768 2.06776 13.6458 1.97896C13.5033 1.87539 13.2984 1.7953 12.8872 1.75074C12.4907 1.70779 11.979 1.70518 11.2479 1.70489C11.6511 2.25924 11.8918 2.93974 11.8919 3.67762V7.41257H10.5038V3.67762C10.5036 2.58751 9.62023 1.70384 8.53007 1.70384H5.98521C5.40065 1.70384 5.00679 1.70449 4.70028 1.73198C4.40651 1.75836 4.24662 1.80577 4.12399 1.87058C4.02069 1.92518 3.92452 1.99283 3.8374 2.07067C3.73401 2.16312 3.634 2.29627 3.50705 2.56255C3.37462 2.84034 3.23734 3.2088 3.03393 3.75682L2.08768 6.30584C1.88395 6.85474 1.81646 7.04347 1.79172 7.17497C1.61005 8.14152 2.25533 9.06908 3.22464 9.23524C3.35654 9.25781 3.55717 9.26129 4.14274 9.26129H5.07023C5.25717 9.26129 5.4593 9.25932 5.62672 9.27901C5.80364 9.29982 6.05492 9.35458 6.27179 9.551C6.37381 9.64347 6.45784 9.75424 6.51982 9.87719C6.65133 10.1382 6.6374 10.3942 6.61048 10.5702C6.58498 10.7367 6.52988 10.931 6.48022 11.1111L6.01439 12.8003L6.00501 12.8347C5.87513 13.3268 6.01464 13.8509 6.37184 14.2134L6.40935 14.251L6.46667 14.2864C6.52866 14.3088 6.60155 14.2912 6.64591 14.2364L6.65738 14.2239L6.65633 14.2228L10.3569 9.52078C10.4543 9.397 10.5491 9.27245 10.6633 9.1675C10.9166 8.93483 11.2325 8.78186 11.572 8.72669C11.7251 8.70184 11.8814 8.70376 12.0389 8.70376C12.7927 8.70376 13.0245 8.69651 13.1956 8.64748C13.6727 8.51051 14.0465 8.13768 14.1836 7.6606C14.2327 7.48941 14.2388 7.25727 14.2388 6.5028V4.85209Z" fill="currentColor"></path></svg></div></div></div><div style="flex: 1 1 0%;"></div></div></div><div class="_9663006"><div class="ds-message _656c965 d29f3d7d"><div class="fbb737a4">evaluate.py is showing error:

❌ No valid PDF index found. Please process a PDF first in the main app.

Steps to fix:

Go to the main app (app.py)
Upload a PDF file
Click 'Process PDF' button
Wait for successful processing
Then come back to this evaluation page
Debug Information

File existence check:

storage/faiss_index exists: True
storage/metadata.json exists: True
Metadata entries: 37<div class="ds-icon-button a3b9bd76 _76a2310" tabindex="0" style="--ds-icon-button-hover-color: transparent;"><div class="_6683dd4"><div class="ds-icon" style="font-size: 14px; width: 14px; height: 14px;"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.27209 6.21355C1.70654 3.08895 4.59178 0.908133 7.71643 1.34246C8.95505 1.51476 10.0438 2.07338 10.8815 2.87761L11.9459 1.81414C12.1348 1.62557 12.4573 1.75918 12.4576 2.02605V5.08758C12.4574 5.25309 12.3234 5.38738 12.1578 5.38738H9.09729C8.83002 5.38738 8.69639 5.06367 8.88538 4.87468L10.0328 3.72625C9.37329 3.10001 8.52015 2.66575 7.55139 2.53093C5.08323 2.18786 2.80385 3.9105 2.46057 6.37859C2.11756 8.84671 3.84018 11.1261 6.30823 11.4694C8.77621 11.8122 11.0558 10.0897 11.399 7.62176L11.9938 7.70379L12.5875 7.78679C12.1531 10.9112 9.26766 13.0919 6.14319 12.6579C3.01863 12.2234 0.837829 9.33816 1.27209 6.21355Z" fill="currentColor"></path></svg></div></div></div></div></div><div class="_11d6b3a"><div class="_60a11b2"><span class="_1ce76f5">Server busy, please try again later.</span><div class="_425ea0b"><div class="ds-flex _78e0558 _0bbda35" style="align-items: flex-end; gap: 0px;"><div class="_17e543b db183363" tabindex="-1" role="button" aria-disabled="false" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.14926 4.02039C7.11194 4.02039 7.8798 4.02023 8.49594 4.07605C9.12125 4.13276 9.65789 4.25194 10.1414 4.53113C10.7201 4.86536 11.2008 5.34597 11.535 5.92468C11.8142 6.40824 11.9334 6.94488 11.9901 7.57019C12.0459 8.18631 12.0457 8.95426 12.0457 9.91687C12.0457 10.8795 12.0459 11.6474 11.9901 12.2635C11.9334 12.8889 11.8142 13.4255 11.535 13.9091C11.2008 14.4877 10.7201 14.9684 10.1414 15.3026C9.65789 15.5818 9.12125 15.701 8.49594 15.7577C7.87981 15.8135 7.11193 15.8134 6.14926 15.8134C5.18664 15.8134 4.41871 15.8135 3.80258 15.7577C3.17727 15.701 2.64063 15.5818 2.15707 15.3026C1.57837 14.9684 1.09775 14.4877 0.763519 13.9091C0.484335 13.4255 0.365153 12.8889 0.308441 12.2635C0.252618 11.6474 0.252777 10.8795 0.252777 9.91687C0.252777 8.95425 0.252634 8.18632 0.308441 7.57019C0.365153 6.94488 0.484335 6.40824 0.763519 5.92468C1.09774 5.34596 1.57836 4.86535 2.15707 4.53113C2.64063 4.25194 3.17727 4.13276 3.80258 4.07605C4.41871 4.02024 5.18663 4.02039 6.14926 4.02039ZM6.14926 5.37781C5.16178 5.37781 4.46631 5.37768 3.92563 5.42664C3.39431 5.47479 3.07856 5.5658 2.83578 5.70593C2.46317 5.92112 2.15351 6.23077 1.93832 6.60339C1.7982 6.84617 1.70718 7.16192 1.65903 7.69324C1.61007 8.23391 1.6102 8.9294 1.6102 9.91687C1.6102 10.9044 1.61006 11.5998 1.65903 12.1405C1.70718 12.6718 1.7982 12.9876 1.93832 13.2303C2.15352 13.6029 2.46318 13.9126 2.83578 14.1278C3.07856 14.2679 3.39431 14.3589 3.92563 14.4071C4.46631 14.4561 5.16179 14.4559 6.14926 14.4559C7.13679 14.4559 7.83221 14.4561 8.37289 14.4071C8.90422 14.3589 9.21996 14.2679 9.46274 14.1278C9.83532 13.9126 10.145 13.6029 10.3602 13.2303C10.5003 12.9876 10.5913 12.6718 10.6395 12.1405C10.6885 11.5998 10.6883 10.9044 10.6883 9.91687C10.6883 8.92941 10.6885 8.23391 10.6395 7.69324C10.5913 7.16192 10.5003 6.84617 10.3602 6.60339C10.145 6.23078 9.83533 5.92113 9.46274 5.70593C9.21996 5.5658 8.90421 5.47479 8.37289 5.42664C7.83221 5.37766 7.13679 5.37781 6.14926 5.37781ZM9.80161 0.368042C10.7638 0.368042 11.5314 0.367947 12.1473 0.423706C12.7725 0.480374 13.3093 0.598826 13.7928 0.877808C14.3716 1.21198 14.8521 1.69361 15.1864 2.27234C15.4655 2.75581 15.5857 3.29171 15.6424 3.91687C15.6983 4.53307 15.6971 5.30167 15.6971 6.26453V7.82996C15.6971 8.29271 15.6989 8.59 15.6649 8.84851C15.4668 10.3526 14.4009 11.5739 12.9832 11.9989V10.5468C13.6973 10.1904 14.2104 9.49669 14.3192 8.67175C14.3387 8.52354 14.3407 8.33586 14.3407 7.82996V6.26453C14.3407 5.27713 14.3398 4.58155 14.2909 4.04089C14.2427 3.50975 14.1526 3.19379 14.0125 2.95105C13.7974 2.57856 13.4875 2.26876 13.1151 2.05359C12.8723 1.91353 12.5564 1.82244 12.0252 1.77429C11.4847 1.72534 10.7888 1.72546 9.80161 1.72546H7.71469C6.75617 1.72565 5.92662 2.27704 5.52328 3.07898H4.07016C4.54218 1.51138 5.99317 0.368253 7.71469 0.368042H9.80161Z" fill="currentColor"></path></svg></div></div><div class="_17e543b d4910adc _308c14b" tabindex="-1" role="button" aria-disabled="true" style="--hover-size: 28px; width: 28px; height: 28px; margin-left: 10px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.94076 1.34948C10.7047 0.902375 11.6503 0.90248 12.4143 1.34948C12.7061 1.52022 12.9688 1.79124 13.3104 2.1329C13.6521 2.47454 13.9231 2.73727 14.0939 3.029C14.5408 3.79301 14.5409 4.73862 14.0939 5.50257C13.9231 5.79422 13.652 6.0571 13.3104 6.39867L6.65932 13.0498C6.28068 13.4284 6.00695 13.7108 5.66543 13.9097C5.32391 14.1085 4.94315 14.2074 4.42705 14.3498L3.24394 14.6762C2.77527 14.8054 2.34538 14.9263 2.00131 14.9685C1.65196 15.0112 1.17964 15.0014 0.810764 14.6326C0.441921 14.2637 0.432107 13.7914 0.47486 13.442C0.517035 13.098 0.6379 12.668 0.767181 12.1994L1.09352 11.0163C1.23588 10.5002 1.33481 10.1194 1.5336 9.77791C1.7325 9.43639 2.0149 9.16266 2.39355 8.78402L9.04466 2.1329C9.38625 1.79132 9.64911 1.52023 9.94076 1.34948ZM15.5427 14.8399H7.55223L8.96707 13.425H15.5427V14.8399ZM3.39382 9.78429C2.965 10.2131 2.84244 10.3437 2.75709 10.4901C2.67183 10.6366 2.61862 10.8079 2.45733 11.3926L2.13099 12.5757C2.00183 13.0439 1.92194 13.3419 1.88863 13.5536C2.10041 13.5204 2.39872 13.4417 2.86764 13.3123L4.05075 12.986C4.63544 12.8247 4.80669 12.7715 4.95323 12.6862C5.09968 12.6009 5.23022 12.4783 5.65905 12.0495L10.721 6.9865L8.45577 4.72128L3.39382 9.78429ZM11.7 2.57085C11.3774 2.38205 10.9777 2.38205 10.6551 2.57085C10.5602 2.62653 10.4487 2.72937 10.0449 3.13317L9.45604 3.72101L11.7213 5.98623L12.3102 5.3984C12.7139 4.99464 12.8168 4.88314 12.8725 4.78825C13.0613 4.46567 13.0612 4.06592 12.8725 3.74333C12.8169 3.64834 12.7146 3.53758 12.3102 3.13317C11.9057 2.72869 11.795 2.62647 11.7 2.57085Z" fill="currentColor"></path></svg></div></div></div></div></div></div></div></div><div class="_88681e8"><button role="button" aria-disabled="false" class="feec6a7a _217e214 _090c426 _6894dc3 _3b6959b" style="padding: 6px 15px; font-size: 13px; line-height: 20px;"><div class="ds-icon" style="font-size: 14px; width: 14px; height: 14px; visibility: visible; margin-right: 4px;"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.00003 0.500061C3.41018 0.500061 0.500031 3.41021 0.500031 7.00006C0.500089 7.99551 0.723778 8.94035 1.12503 9.78522L1.38284 10.3272L2.46683 9.81256L2.20901 9.27057C1.88251 8.58313 1.69931 7.81375 1.69925 7.00006C1.69925 4.07295 4.07292 1.69928 7.00003 1.69928C9.92696 1.69949 12.2998 4.07308 12.2998 7.00006C12.2996 9.92686 9.92683 12.2997 7.00003 12.2999C6.39863 12.2999 5.95984 12.2565 5.5723 12.1495C5.19092 12.0441 4.82794 11.8682 4.39261 11.5645C3.74481 11.1128 2.81397 10.9518 2.04495 11.4376L2.03226 11.4454L2.02054 11.4542L1.34183 11.9317L1.74026 13.1182L2.68948 12.4503C2.95376 12.2855 3.35283 12.3026 3.70609 12.5489C4.22619 12.9117 4.71187 13.1573 5.25296 13.3067C5.78812 13.4545 6.3479 13.5001 7.00003 13.5001C10.5896 13.4999 13.4998 10.5896 13.5 7.00006C13.5 3.41034 10.5897 0.500272 7.00003 0.500061ZM6.39554 4.29205V6.39948H4.29202V7.59967H6.39554V9.70709H7.59573V7.59967H9.70706V6.39948H7.59573V4.29205H6.39554Z" fill="currentColor"></path></svg></div><span class="">New chat</span></button></div><div class="_871cbca"><div class="d72636e2"></div><div class="aaff8b8f"><div class="_77cefa5 _3d616d3"><div class="_020ab5b"><div class="_24fad49"><div class="ds-scroll-area__gutters" style="position: absolute; inset: 0px; --container-height: 62px;"><div class="ds-scroll-area__horizontal-gutter" style="left: 8px; right: 8px; bottom: 0px; height: 8px;"><div class="ds-scroll-area__horizontal-bar" style="display: none;"></div></div><div class="ds-scroll-area__vertical-gutter" style="right: 0px; top: 20px; bottom: 0px; width: 6px;"><div class="ds-scroll-area__vertical-bar" style="top: 76.7778px; height: 238.063px; display: none;"></div></div></div><textarea id="chat-input" class="_27c9245 ds-scroll-area d96f2d2a" placeholder="Message DeepSeek" rows="2"></textarea><div class="b13855df">
</div></div><div class="ec4f5d61"><button role="button" aria-disabled="false" class="feec6a7a f79352dc _70150b8 a567dba3" tabindex="0" style="transform: translateZ(0px);"><div class="ds-icon" style="font-size: 14px; width: 14px; height: 14px; color: var(--dsw-alias-label-primary); visibility: visible; margin-right: 0px;"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.06431 5.93348C7.68763 5.93348 8.19307 6.4391 8.19322 7.06239C8.19322 7.68579 7.68772 8.19129 7.06431 8.19129C6.44099 8.19119 5.9354 7.68573 5.9354 7.06239C5.93555 6.43917 6.44108 5.93359 7.06431 5.93348Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M8.6815 0.963754C10.1169 0.44708 11.6266 0.37489 12.5633 1.31141C13.5 2.24812 13.4277 3.75782 12.911 5.19325C12.7126 5.74437 12.4386 6.31802 12.0965 6.89735C12.4969 7.54645 12.8141 8.19024 13.036 8.80653C13.5527 10.242 13.6251 11.7516 12.6883 12.6884C11.7516 13.6251 10.242 13.5527 8.8065 13.036C8.19022 12.8141 7.54641 12.4969 6.89732 12.0966C6.31797 12.4386 5.74435 12.7126 5.19322 12.911C3.75777 13.4277 2.2481 13.5001 1.31138 12.5634C0.374859 11.6266 0.447049 10.1169 0.963724 8.68153C1.17185 8.10345 1.46321 7.50069 1.82896 6.89247C1.52182 6.35717 1.27235 5.82832 1.08872 5.31825C0.572068 3.88284 0.499714 2.37312 1.43638 1.43641C2.37308 0.499716 3.8828 0.572105 5.31822 1.08875C5.82828 1.27238 6.35715 1.52186 6.89243 1.82899C7.50066 1.46324 8.10341 1.17187 8.6815 0.963754ZM11.3573 8.01161C10.9083 8.62259 10.3901 9.22879 9.80943 9.80946C9.22877 10.3901 8.62255 10.9084 8.01158 11.3573C8.4257 11.5841 8.8287 11.7688 9.21275 11.9071C10.5456 12.3869 11.4246 12.2548 11.8397 11.8397C12.2548 11.4247 12.3869 10.5456 11.9071 9.21278C11.7688 8.82872 11.5841 8.42574 11.3573 8.01161ZM2.56529 8.02918C2.37344 8.39328 2.21495 8.74802 2.09263 9.08778C1.61291 10.4204 1.74512 11.2996 2.16001 11.7147C2.57505 12.1298 3.45415 12.2619 4.78697 11.7821C5.11057 11.6656 5.44786 11.5164 5.7938 11.3368C5.249 10.9223 4.70922 10.4534 4.19029 9.93446C3.57578 9.31993 3.03169 8.67639 2.56529 8.02918ZM6.90708 3.24696C6.24065 3.70485 5.5646 4.26327 4.91392 4.91395C4.26325 5.56462 3.70482 6.24069 3.24693 6.90711C3.72674 7.63331 4.32777 8.37465 5.03892 9.08582C5.64943 9.69633 6.28183 10.2265 6.90806 10.6679C7.59368 10.2026 8.2908 9.63082 8.96079 8.96082C9.6308 8.29082 10.2025 7.59372 10.6678 6.90809C10.2265 6.28186 9.69631 5.64946 9.08579 5.03895C8.37462 4.32779 7.63328 3.72678 6.90708 3.24696ZM11.7147 2.16004C11.2996 1.74515 10.4204 1.61294 9.08775 2.09266C8.74835 2.21485 8.39382 2.37277 8.03013 2.56434C8.67728 3.03071 9.31995 3.57586 9.93443 4.19032C10.4534 4.70926 10.9223 5.24902 11.3368 5.79383C11.5164 5.44791 11.6656 5.11058 11.7821 4.787C12.2618 3.45422 12.1297 2.57508 11.7147 2.16004ZM4.91197 2.21766C3.57922 1.73794 2.70004 1.87001 2.28501 2.28504C1.87001 2.70009 1.73791 3.57926 2.21763 4.912C2.31709 5.18828 2.44112 5.47433 2.58677 5.76747C3.01931 5.18876 3.51474 4.61586 4.06529 4.06532C4.61584 3.51477 5.18872 3.01934 5.76743 2.5868C5.47431 2.44116 5.18824 2.31712 4.91197 2.21766Z" fill="currentColor"></path></svg></div><span class=""><span class="_6dbc175">DeepThink</span></span></button><button role="button" aria-disabled="false" class="feec6a7a f79352dc _70150b8 a567dba3" tabindex="0" style="transform: translateZ(0px);"><div class="ds-icon" style="font-size: 14px; width: 14px; height: 14px; color: var(--dsw-alias-label-primary); visibility: visible; margin-right: 0px;"><svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.00003 0.150452C10.7832 0.150452 13.8496 3.21691 13.8496 7.00006C13.8496 10.7832 10.7832 13.8497 7.00003 13.8497C3.21688 13.8497 0.150421 10.7832 0.150421 7.00006C0.150421 3.21691 3.21688 0.150452 7.00003 0.150452ZM5.37796 7.59967C5.4267 9.0321 5.64754 10.2966 5.97366 11.2198C6.15996 11.7471 6.36946 12.1302 6.57327 12.3702C6.77751 12.6106 6.92343 12.6505 7.00003 12.6505C7.07663 12.6505 7.22255 12.6106 7.42679 12.3702C7.6306 12.1302 7.8401 11.7471 8.0264 11.2198C8.35252 10.2966 8.57336 9.0321 8.6221 7.59967H5.37796ZM1.38187 7.59967C1.61456 9.80498 3.11593 11.6305 5.14261 12.336C5.03268 12.1129 4.93227 11.8725 4.8428 11.6192C4.46342 10.5452 4.22775 9.13994 4.17874 7.59967H1.38187ZM9.82132 7.59967C9.77232 9.13994 9.53664 10.5452 9.15726 11.6192C9.06774 11.8726 8.96648 12.1127 8.85648 12.336C10.8836 11.6307 12.3855 9.8053 12.6182 7.59967H9.82132ZM7.00003 1.34967C6.92343 1.34967 6.77751 1.38955 6.57327 1.62994C6.36946 1.86994 6.15996 2.25297 5.97366 2.78033C5.64754 3.70357 5.4267 4.96802 5.37796 6.40045H8.6221C8.57336 4.96802 8.35252 3.70357 8.0264 2.78033C7.8401 2.25297 7.6306 1.86994 7.42679 1.62994C7.22255 1.38955 7.07663 1.34967 7.00003 1.34967ZM8.85648 1.66315C8.96663 1.88662 9.06763 2.12721 9.15726 2.38092C9.53664 3.45494 9.77232 4.86018 9.82132 6.40045H12.6182C12.3855 4.19471 10.8837 2.36834 8.85648 1.66315ZM5.14261 1.66315C3.11578 2.36856 1.61457 4.19503 1.38187 6.40045H4.17874C4.22775 4.86018 4.46342 3.45494 4.8428 2.38092C4.93237 2.12736 5.03253 1.88651 5.14261 1.66315Z" fill="currentColor"></path></svg></div><span class=""><span class="_6dbc175">Search</span></span></button><div class="bf38813a"><div class="_17e543b f02f0e25" tabindex="0" role="button" aria-disabled="false" style="--hover-size: 34px; width: 34px; height: 34px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.5498 9.75006V5.00006H6.9502V9.75006C6.9502 10.33 7.4201 10.7999 8 10.7999C8.5799 10.7999 9.0498 10.33 9.0498 9.75006V4.50006C9.0498 2.95366 7.7964 1.70026 6.25 1.70026C4.7036 1.70026 3.4502 2.95366 3.4502 4.50006V9.75006C3.4502 12.263 5.4871 14.2999 8 14.2999C10.5129 14.2999 12.5498 12.263 12.5498 9.75006V4.00006H13.9502V9.75006C13.9502 13.0362 11.2861 15.7003 8 15.7003C4.71391 15.7003 2.0498 13.0362 2.0498 9.75006V4.50006C2.04981 2.18047 3.9304 0.299867 6.25 0.299866C8.5696 0.299866 10.4502 2.18046 10.4502 4.50006V9.75006C10.4502 11.1032 9.3531 12.2003 8 12.2003C6.6469 12.2003 5.5498 11.1032 5.5498 9.75006Z" fill="currentColor"></path></svg></div></div><input type="file" multiple="" accept=".epub,.mobi,.azw3,.pdf,.png,.jpg,.jpeg,.svg,.svgz,.bmp,.gif,.webp,.ico,.xbm,.dib,.pjp,.tif,.pjpeg,.avif,.apng,.tiff,.jfif,.txt,.md,.csv,.tsv,.html,.json,.log,.dot,.go,.h,.c,.cpp,.cxx,.cc,.cs,.java,.js,.css,.jsp,.php,.py,.py3,.asp,.yaml,.yml,.ini,.conf,.ts,.tsx,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.abap,.asc,.ash,.ampl,.mod,.g4,.apib,.apl,.dyalog,.asax,.ascx,.ashx,.asmx,.aspx,.axd,.dats,.hats,.sats,.as,.adb,.ada,.ads,.agda,.als,.apacheconf,.vhost,.cls,.applescript,.scpt,.arc,.ino,.asciidoc,.adoc,.aj,.asm,.a51,.inc,.nasm,.aug,.ahk,.ahkl,.au3,.awk,.auk,.gawk,.mawk,.nawk,.bat,.cmd,.befunge,.bison,.bb,.decls,.bmx,.bsv,.boo,.b,.bf,.brs,.bro,.cats,.idc,.w,.cake,.cshtml,.csx,.c++,.cp,.h++,.hh,.hpp,.hxx,.inl,.ipp,.tcc,.tpp,.c-objdump,.chs,.clp,.cmake,.in,.cob,.cbl,.ccp,.cobol,.cpy,.capnp,.mss,.ceylon,.chpl,.ch,.ck,.cirru,.clw,.icl,.dcl,.click,.clj,.boot,.cl2,.cljc,.cljs,.hl,.cljscm,.cljx,.hic,.coffee,._coffee,.cjsx,.cson,.iced,.cfm,.cfml,.cfc,.lisp,.asd,.cl,.l,.lsp,.ny,.podsl,.sexp,.cps,.coq,.v,.cppobjdump,.c++-objdump,.c++objdump,.cpp-objdump,.cxx-objdump,.creole,.cr,.feature,.cu,.cuh,.cy,.pyx,.pxd,.pxi,.d,.di,.d-objdump,.com,.dm,.zone,.arpa,.darcspatch,.dpatch,.dart,.diff,.patch,.dockerfile,.djs,.dylan,.dyl,.intr,.lid,.E,.ecl,.eclxml,.sch,.brd,.epj,.e,.ex,.exs,.elm,.el,.emacs,.desktop,.em,.emberscript,.erl,.es,.escript,.hrl,.xrl,.yrl,.fs,.fsi,.fsx,.fx,.flux,.f90,.f,.f03,.f08,.f77,.f95,.for,.fpp,.factor,.fy,.fancypack,.fan,.fth,.4th,.forth,.fr,.frt,.ftl,.g,.gco,.gcode,.gms,.gap,.gd,.gi,.tst,.s,.ms,.glsl,.fp,.frag,.frg,.fsh,.fshader,.geo,.geom,.glslv,.gshader,.shader,.vert,.vrx,.vsh,.vshader,.gml,.kid,.ebuild,.eclass,.po,.pot,.glf,.gp,.gnu,.gnuplot,.plot,.plt,.golo,.gs,.gst,.gsx,.vark,.grace,.gradle,.gf,.graphql,.gv,.man,.1in,.1m,.1x,.3in,.3m,.3qt,.3x,.me,.n,.rno,.roff,.groovy,.grt,.gtpl,.gvy,.gsp,.hcl,.tf,.hlsl,.fxh,.hlsli,.htm,.st,.xht,.xhtml,.mustache,.jinja,.eex,.erb,.deface,.phtml,.http,.haml,.handlebars,.hbs,.hb,.hs,.hsc,.hx,.hxsl,.hy,.pro,.dlm,.ipf,.cfg,.prefs,.properties,.irclog,.weechatlog,.idr,.lidr,.ni,.i7x,.iss,.io,.ik,.thy,.ijs,.flex,.jflex,.geojson,.lock,.topojson,.json5,.jsonld,.jq,.jsx,.jade,.j,._js,.bones,.es6,.jake,.jsb,.jscad,.jsfl,.jsm,.jss,.njs,.pac,.sjs,.ssjs,.sublime-build,.sublime-commands,.sublime-completions,.sublime-keymap,.sublime-macro,.sublime-menu,.sublime-mousemap,.sublime-project,.sublime-settings,.sublime-theme,.sublime-workspace,.sublime_metrics,.sublime_session,.xsjs,.xsjslib,.jl,.ipynb,.krl,.kicad_pcb,.kit,.kt,.ktm,.kts,.lfe,.ll,.lol,.lsl,.lslp,.lvproj,.lasso,.las,.lasso8,.lasso9,.ldml,.latte,.lean,.hlean,.less,.lex,.ly,.ily,.m,.ld,.lds,.liquid,.lagda,.litcoffee,.lhs,.ls,._ls,.xm,.x,.xi,.lgt,.logtalk,.lookml,.lua,.fcgi,.nse,.pd_lua,.rbxs,.wlua,.mumps,.m4,.mcr,.mtml,.muf,.mak,.mk,.mkfile,.mako,.mao,.markdown,.mkd,.mkdn,.mkdown,.ron,.mask,.mathematica,.cdf,.ma,.map,.mt,.nb,.nbp,.wl,.wlt,.matlab,.maxpat,.maxhelp,.maxproj,.mxt,.pat,.mediawiki,.wiki,.moo,.metal,.minid,.druby,.duby,.mir,.mirah,.mo,.mms,.mmk,.monkey,.moon,.myt,.ncl,.nl,.nsi,.nsh,.axs,.axi,.nlogo,.nginxconf,.nim,.nimrod,.ninja,.nit,.nix,.nu,.numpy,.numpyw,.numsc,.ml,.eliom,.eliomi,.ml4,.mli,.mll,.mly,.objdump,.mm,.sj,.omgrofl,.opa,.opal,.opencl,.p,.scad,.org,.ox,.oxh,.oxo,.oxygene,.oz,.pwn,.aw,.ctp,.php3,.php4,.php5,.php6,.php7,.php8,.phps,.phpt,.pls,.pck,.pkb,.pks,.plb,.plsql,.sql,.pov,.pan,.psc,.parrot,.pasm,.pir,.pas,.dfm,.dpr,.lpr,.pp,.pl,.al,.cgi,.perl,.ph,.plx,.pm,.pod,.psgi,.t,.6pl,.6pm,.nqp,.p6,.p6l,.p6m,.pl6,.pm6,.pkl,.pig,.pike,.pmod,.pogo,.pony,.ps,.eps,.ps1,.psd1,.psm1,.pde,.prolog,.yap,.spin,.proto,.pub,.pd,.pb,.pbi,.purs,.bzl,.gyp,.lmi,.pyde,.pyi,.pyp,.pyt,.pyw,.rpy,.tac,.wsgi,.xpy,.pytb,.qml,.qbs,.pri,.r,.rd,.rsx,.raml,.rdoc,.rbbas,.rbfrm,.rbmnu,.rbres,.rbtbar,.rbuistate,.rhtml,.rmd,.rkt,.rktd,.rktl,.scrbl,.rl,.raw,.reb,.r2,.r3,.rebol,.red,.reds,.cw,.rs,.rsh,.robot,.rg,.rb,.builder,.gemspec,.god,.irbrc,.jbuilder,.mspec,.pluginspec,.podspec,.rabl,.rake,.rbuild,.rbw,.rbx,.ru,.ruby,.thor,.watchr,.sas,.scss,.smt2,.smt,.sparql,.rq,.sqf,.hqf,.cql,.ddl,.prc,.tab,.udf,.viw,.db2,.ston,.sage,.sagews,.sls,.sass,.scala,.sbt,.sc,.scaml,.scm,.sld,.sps,.ss,.sci,.sce,.self,.sh,.bash,.bats,.command,.ksh,.tmux,.tool,.zsh,.sh-session,.shen,.sl,.slim,.smali,.tpl,.sp,.sma,.nut,.stan,.ML,.fun,.sig,.sml,.do,.ado,.doh,.ihlp,.mata,.matah,.sthlp,.styl,.scd,.swift,.sv,.svh,.vh,.toml,.txl,.tcl,.adp,.tm,.tcsh,.csh,.tex,.aux,.bbx,.bib,.cbx,.dtx,.ins,.lbx,.ltx,.mkii,.mkiv,.mkvi,.sty,.toc,.tea,.no,.textile,.thrift,.tu,.ttl,.twig,.upc,.anim,.asset,.mat,.meta,.prefab,.unity,.uno,.uc,.ur,.urs,.vcl,.vhdl,.vhd,.vhf,.vhi,.vho,.vhs,.vht,.vhw,.vala,.vapi,.veo,.vim,.vb,.bas,.frm,.frx,.vba,.vbhtml,.vbs,.volt,.vue,.owl,.webidl,.x10,.xc,.xml,.ant,.axml,.ccxml,.clixml,.cproject,.csl,.csproj,.ct,.dita,.ditamap,.ditaval,.config,.dotsettings,.filters,.fsproj,.fxml,.glade,.grxml,.iml,.ivy,.jelly,.jsproj,.kml,.launch,.mdpolicy,.mxml,.nproj,.nuspec,.odd,.osm,.plist,.props,.ps1xml,.psc1,.pt,.rdf,.rss,.scxml,.srdf,.storyboard,.stTheme,.sublime-snippet,.targets,.tmCommand,.tml,.tmLanguage,.tmPreferences,.tmSnippet,.tmTheme,.ui,.urdf,.ux,.vbproj,.vcxproj,.vssettings,.vxml,.wsdl,.wsf,.wxi,.wxl,.wxs,.x3d,.xacro,.xaml,.xib,.xlf,.xliff,.xmi,.dist,.xproj,.xsd,.xul,.zcml,.xsp-config,.metadata,.xpl,.xproc,.xquery,.xq,.xql,.xqm,.xqy,.xs,.xslt,.xsl,.xojo_code,.xojo_menu,.xojo_report,.xojo_script,.xojo_toolbar,.xojo_window,.xtend,.reek,.rviz,.sublime-syntax,.syntax,.yaml-tmlanguage,.yang,.y,.yacc,.yy,.zep,.zimpl,.zmpl,.zpl,.ec,.eh,.edn,.fish,.mu,.nc,.ooc,.rst,.rest,.wisp,.prg,.prw,.gitignore,.gitkeep,.gitmodules,.example,.avifs,.blp,.bufr,.bw,.cur,.dcx,.dds,.emf,.fit,.fits,.flc,.fli,.ftc,.ftu,.gbr,.grib,.h5,.hdf,.hif,.icb,.icns,.iim,.im,.j2c,.j2k,.jp2,.jpc,.jpe,.jpf,.jpx,.mpeg,.mpg,.msp,.pbm,.pcd,.pcx,.pfm,.pgm,.pnm,.ppm,.psd,.pxr,.qoi,.ras,.rgb,.rgba,.sgi,.tga,.vda,.vst,.wmf,.xpm" style="display: none;"><div class="_17e543b _7436101 bcc55ca1 _308c14b" tabindex="-1" role="button" aria-disabled="true" style="--hover-size: 28px; width: 28px; height: 28px;"><div class="ds-icon" style="font-size: 16px; width: 16px; height: 16px;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.3125 0.981648C8.66767 1.05456 8.97902 1.20565 9.2627 1.4338C9.48724 1.61444 9.73029 1.85939 9.97949 2.1086L14.707 6.83614L13.293 8.2502L9 3.95723V15.0432H7V3.95723L2.70703 8.2502L1.29297 6.83614L6.02051 2.1086C6.26971 1.85939 6.51277 1.61444 6.7373 1.4338C6.97662 1.24132 7.28445 1.04548 7.6875 0.981648C7.8973 0.948471 8.1031 0.956625 8.3125 0.981648Z" fill="currentColor"></path></svg></div></div></div></div></div></div></div><div class="_0fcaa63">AI-generated, for reference only</div></div></div></div></div></div></div></div></div></div></div><div class="ds-notification-container ds-theme" style="--ds-rgb-hover: 255 255 255 / 8%;"></div><div id="cf-overlay" style="position: fixed; inset: 0px; background-color: rgba(0, 0, 0, 0.7); border: 1px solid grey; z-index: 10000; display: none;"><p style="color: white; text-align: center; margin-top: 50vh;">One more step before you proceed...</p><div style="display: flex; flex-wrap: nowrap; align-items: center; justify-content: center;" id="cf-turnstile"></div></div><script src="./Build PDF Chatbot with Gemini Flash - DeepSeek_files/api.js.download" defer=""></script><iframe id="intercom-frame" style="position: absolute !important; opacity: 0 !important; width: 1px !important; height: 1px !important; top: 0 !important; left: 0 !important; border: none !important; display: block !important; z-index: -1 !important; pointer-events: none;" aria-hidden="true" tabindex="-1" title="Intercom" src="./Build PDF Chatbot with Gemini Flash - DeepSeek_files/saved_resource.html"></iframe><div class="intercom-lightweight-app"><style id="intercom-lightweight-app-style" type="text/css">
  @keyframes intercom-lightweight-app-launcher {
    from {
      opacity: 0;
      transform: scale(0.5);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes intercom-lightweight-app-gradient {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes intercom-lightweight-app-messenger {
    0% {
      opacity: 0;
      transform: scale(0);
    }
    40% {
      opacity: 1;
    }
    100% {
      transform: scale(1);
    }
  }

  .intercom-lightweight-app {
    position: fixed;
    z-index: 2147483001;
    width: 0;
    height: 0;
    font-family: intercom-font, "Helvetica Neue", "Apple Color Emoji", Helvetica, Arial, sans-serif;
  }

  .intercom-lightweight-app-gradient {
    position: fixed;
    z-index: 2147483002;
    width: 500px;
    height: 500px;
    bottom: 0;
    right: 0;
    pointer-events: none;
    background: radial-gradient(
      ellipse at bottom right,
      rgba(29, 39, 54, 0.16) 0%,
      rgba(29, 39, 54, 0) 72%);
    animation: intercom-lightweight-app-gradient 200ms ease-out;
  }

  .intercom-lightweight-app-launcher {
    position: fixed;
    z-index: 2147483003;
    padding: 0 !important;
    margin: 0 !important;
    border: none;
    bottom: 20px;
    right: 20px;
    max-width: 48px;
    width: 48px;
    max-height: 48px;
    height: 48px;
    border-radius: 50%;
    background: #0f0f0f;
    cursor: pointer;
    box-shadow: 0 1px 6px 0 rgba(0, 0, 0, 0.06), 0 2px 32px 0 rgba(0, 0, 0, 0.16);
    transition: transform 167ms cubic-bezier(0.33, 0.00, 0.00, 1.00);
    box-sizing: content-box;
  }


  .intercom-lightweight-app-launcher:hover {
    transition: transform 250ms cubic-bezier(0.33, 0.00, 0.00, 1.00);
    transform: scale(1.1)
  }

  .intercom-lightweight-app-launcher:active {
    transform: scale(0.85);
    transition: transform 134ms cubic-bezier(0.45, 0, 0.2, 1);
  }


  .intercom-lightweight-app-launcher:focus {
    outline: none;

    
  }

  .intercom-lightweight-app-launcher-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    width: 48px;
    height: 48px;
    transition: transform 100ms linear, opacity 80ms linear;
  }

  .intercom-lightweight-app-launcher-icon-open {
    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-open svg {
    width: 24px;
    height: 24px;
  }

  .intercom-lightweight-app-launcher-icon-open svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-launcher-icon-self-serve {
    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-self-serve svg {
    height: 44px;
  }

  .intercom-lightweight-app-launcher-icon-self-serve svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-launcher-custom-icon-open {
    max-height: 24px;
    max-width: 24px;

    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-minimize {
    
        opacity: 0;
        transform: rotate(-60deg) scale(0);
      
  }

  .intercom-lightweight-app-launcher-icon-minimize svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-messenger {
    position: fixed;
    z-index: 2147483003;
    overflow: hidden;
    background-color: #ffffff;
    animation: intercom-lightweight-app-messenger 250ms cubic-bezier(0, 1, 1, 1);
    transform-origin: bottom right;

    
        width: 400px;
        height: calc(100% - 40px);
        max-height: 704px;
        min-height: 250px;
        right: 20px;
        bottom: 20px;
        box-shadow: 0 5px 40px rgba(0,0,0,0.16);
      

    border-radius: 16px;
  }

  .intercom-lightweight-app-messenger-header {
    height: 64px;
    border-bottom: none;
    background: #ffffff;
  }

  .intercom-lightweight-app-messenger-footer{
    position:absolute;
    bottom:0;
    width: 100%;
    height: 80px;
    background: #ffffff;
    font-size: 14px;
    line-height: 21px;
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    box-shadow: 0px 0px 25px rgba(0, 0, 0, 0.05);
  }

  @media print {
    .intercom-lightweight-app {
      display: none;
    }
  }
</style></div><div class="ds-theme ds-modal-wrapper ds-modal-wrapper--hide" data-transform-origin="center" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE; z-index: 0;"></div><div class="ds-theme ds-modal-wrapper ds-modal-wrapper--hide" data-transform-origin="center" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE; z-index: 0;"></div><div class="ds-theme ds-modal-wrapper ds-modal-wrapper--hide" data-transform-origin="center" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE; z-index: 0;"></div><div class="ds-theme ds-modal-wrapper ds-modal-wrapper--hide" data-transform-origin="center" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE; z-index: 0;"></div><div class="ds-theme ds-modal-wrapper ds-modal-wrapper--hide" data-transform-origin="center" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE; z-index: 0;"></div><div class="ds-theme ds-modal-wrapper ds-modal-wrapper--hide" data-transform-origin="center" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE; z-index: 0;"></div><div class="ds-theme ds-modal-wrapper ds-modal-wrapper--hide" data-transform-origin="center" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE; z-index: 0;"></div><div class="ds-theme ds-modal-wrapper ds-modal-wrapper--hide" data-transform-origin="center" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE; z-index: 0;"></div><div class="ds-theme ds-modal-wrapper ds-modal-wrapper--hide" data-transform-origin="center" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE; z-index: 0;"></div><div class="ds-theme ds-modal-wrapper ds-modal-wrapper--hide" data-transform-origin="center" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE; z-index: 0;"></div><div class="ds-theme ds-modal-wrapper ds-modal-wrapper--hide" data-transform-origin="center" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE; z-index: 0;"></div><div class="ds-theme ds-modal-wrapper ds-modal-wrapper--hide" data-transform-origin="center" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE; z-index: 0;"></div><div class="ds-theme ds-modal-wrapper ds-modal-wrapper--hide" data-transform-origin="center" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE; z-index: 0;"></div><div class="ds-theme ds-modal-wrapper ds-modal-wrapper--hide" data-transform-origin="center" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE; z-index: 0;"></div><div class="ds-theme ds-modal-wrapper ds-modal-wrapper--hide" data-transform-origin="center" style="--ds-rgb-hover: 68 68 77; --ds-rgb-input: 85 85 98; --ds-rgb-input-focus: 58 58 70; --ds-rgb-label-1: #F8FAFF; --ds-rgb-label-2: #BBB; --ds-rgb-primary: 78 107 245; --ds-button-hover-color: #3D4FA9; --ds-bordered-secondary-button-color: var(--dsr-text-1); --ds-input-prefix-color: var(--dsr-text-1); --ds-modal-content-color: #3A3A46; --ds-text-primary-button-color: #6780FE; --ds-tabs-active-color: #6780FE; z-index: 0;"></div><div class="ds-floating-container" style="z-index: 0;"><div class="ds-floating-position-wrapper ds-theme" style="--ds-rgb-hover: 255 255 255 / 8%; z-index: 0; left: 996.88px; top: 519.875px;" data-transform-origin="top"></div></div></body></html>